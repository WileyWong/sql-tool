---
name: discovering-project-insights
description: 使用 CodeBuddy 内置工具进行**结构化项目诊断**，从多维度发现潜在问题、需求缺陷和演进机会，输出具体改进方案。
---

# Skill: Discovering Project Insights
**项目洞察挖掘**

使用 CodeBuddy 内置工具进行**结构化项目诊断**，从多维度发现潜在问题、需求缺陷和演进机会，输出具体改进方案。

## 🎯 核心能力

通过系统化工具组合，帮助技术团队、产品经理和架构师：
- 🔍 **发现问题** - 代码质量、架构设计、需求完整性问题
- 🎯 **验证需求** - 现有需求的完整性和一致性
- 🚀 **规划未来** - 技术演进方向和功能扩展路线
- 📋 **生成方案** - 具体改进建议和任务清单

## 🔧 工具集成

本技能集成以下 CodeBuddy 内置工具：

| 工具 | 用途 | 诊断维度 |
|------|------|---------|
| **Task (Explore Agent)** | 快速探索项目结构、代码模式 | 架构/代码 |
| **Grep** | 搜索代码中的技术债、风险模式 | 代码质量 |
| **Glob** | 识别项目文件组织、缺失模块 | 结构完整性 |
| **Read** | 深入分析关键文件、需求文档 | 需求/架构 |
| **AskUserQuestion** | 结构化采集专家知识和偏好 | 验证/规划 |
| **TodoWrite** | 组织诊断发现和改进方案 | 任务管理 |
| **Bash** | 运行项目分析脚本 (lint、test、build) | 质量指标 |

## 🔄 执行流程

### 阶段 1: 诊断准备 (5 分钟)

**目标**: 了解项目基本情况和诊断焦点

**步骤**:
```
1. 收集项目基本信息
   - 项目名称、类型、技术栈
   - 项目规模（文件数、LOC、团队规模）
   - 项目阶段（初创/成长/成熟）

2. 确定诊断焦点
   - 重点关注哪个维度？(架构/代码/需求/演进)
   - 是否进行全面体检还是深度诊断？
   - 预期输出是问题清单还是具体方案？
```

**推荐提问**（使用 AskUserQuestion）:
```
问题 1: "项目属于什么类型和阶段？"
- [ ] 新项目（<3 个月）
- [ ] 快速发展期（3-12 个月）
- [ ] 成熟期（>1 年）

问题 2: "优先诊断哪个维度？"
- [ ] 架构设计质量
- [ ] 代码质量和技术债
- [ ] 需求完整性
- [ ] 技术栈规划
```

### 阶段 2: 多维诊断 (15-30 分钟)

#### 维度 A: 架构诊断

**工具**: Task (Explore) + Read

**步骤**:
1. 使用 Explore Agent 快速探索项目架构
   ```
   用途: 快速理解项目分层、模块划分、关键路径
   ```

2. 检查清单:
   - ✓ 是否遵循分层架构(Controller/Service/Repo)?
   - ✓ 模块间依赖是否清晰无循环?
   - ✓ 是否存在明显的技术债(混乱的依赖)?
   - ✓ 缺失哪些关键模块(日志/监控/缓存)?

3. 可视化输出:
   ```
   项目架构现状
   ├─ Controller 层: REST API 接口定义
   │  └─ 问题: 缺少统一的异常处理
   ├─ Service 层: 业务逻辑
   │  └─ 问题: 事务管理不统一
   ├─ Repository 层: 数据访问
   │  └─ 问题: SQL 优化空间
   └─ 基础设施: 缺少日志/缓存/监控
   ```


#### 维度 B: 需求诊断

**工具**: Read + Grep + AskUserQuestion

**步骤**:
1. 查看现有需求文档 (使用 Read):
   ```
   扫描路径: docs/requirements/, workspace/
   检查内容:
   - 需求是否完整(功能/性能/安全)
   - 是否有验收标准
   - 是否与代码实现一致
   ```

2. 搜索代码中的业务规则 (使用 Grep):
   ```
   寻找模式:
   - @Transactional, @Validated (业务约束)
   - if/else 分支过多 (隐藏的业务规则)
   - 枚举值、常量定义 (业务常数)
   ```

3. 验证需求与代码一致性:
   ```
   需求验证矩阵
   ├─ 功能完整性
   │  ├─ 已需求化: 90% ✓
   │  ├─ 未文档化: 8% (隐藏业务规则)
   │  └─ 代码实现超规格: 2% (scope creep)
   ├─ 边界条件
   │  └─ 缺少验收标准: 15 个需求
   └─ 性能/安全需求
      └─ 缺少明确规范: 8 个场景
   ```

#### 维度 C: 技术栈规划诊断

**工具**: Glob + Read + AskUserQuestion

**步骤**:
1. 分析现有技术栈 (使用 Glob/Read):
   ```
   检查清单:
   - 框架版本是否过时?
   - 依赖冲突/重复?
   - 是否有多个相似库竞争(如 JSONObject vs Gson)?
   - 关键库是否有安全更新?
   ```

2. 识别演进需求:
   ```
   通过 AskUserQuestion 询问:
   - 项目未来 3 个月的需求?
   - 是否考虑微服务化/容器化?
   - 是否有性能优化计划?
   - 是否需要跨端支持(移动/Web)?
   ```

3. 规划建议:
   ```
   技术栈演进规划
   ├─ 短期 (1-3 个月)
   │  ├─ 升级 Spring Boot 到 3.x
   │  ├─ 更新依赖安全补丁
   │  └─ 集成分布式追踪
   ├─ 中期 (3-6 个月)
   │  ├─ 微服务拆分评估
   │  ├─ 缓存层架构优化
   │  └─ 消息队列集成
   └─ 长期 (6-12 个月)
      ├─ 云原生容器化
      └─ 国际化/多语言支持
   ```

### 阶段 3: 问题聚类和优先级排序 (10 分钟)

**使用 TodoWrite 组织发现**:

```
按优先级和类型分类:
├─ 高优先级 P0 (3 个月内解决)
│  ├─ [架构] SQL 注入风险
│  ├─ [代码] 未处理异常覆盖
│  └─ [需求] 验收标准补全
├─ 中优先级 P1 (3-6 个月)
│  ├─ [代码] 性能优化
│  ├─ [技术] 框架升级
│  └─ [设计] 模块解耦
└─ 低优先级 P2 (6-12 个月)
   ├─ [代码] 重构改进
   └─ [规划] 新技术探索
```

### 阶段 4: 方案生成 (20 分钟)

**输出具体改进方案**:

对每个高优先级问题，生成:

```
问题: [问题标题]
━━━━━━━━━━━━━━━━━━━━━━━━━━
📊 现状分析
  - 影响范围: X 处代码/Y 个模块
  - 风险等级: 高/中/低
  - 根本原因: [原因分析]

🎯 改进目标
  - 质量指标: [量化目标]
  - 预期收益: [业务价值]

✅ 改进方案
  步骤 1: [具体操作]
  步骤 2: [具体操作]
  ...

📋 任务清单
  - [ ] 任务 1 (1-2 天)
  - [ ] 任务 2 (2-3 天)
  - [ ] 验收和测试 (1 天)

👥 责任分工
  - 设计负责人: [角色]
  - 实施负责人: [角色]
  - 审查负责人: [角色]

📅 预期时间表
  开始: [日期] 完成: [日期] 总耗时: X 天
```

### 阶段 5: 规划方案生成 (20 分钟)

**针对未来演进，生成**:

```
演进方向: [方向标题]
━━━━━━━━━━━━━━━━━━━━━━━━━━━

🎯 战略目标
  短期 (1-3 个月): [目标]
  中期 (3-6 个月): [目标]
  长期 (6-12 个月): [目标]

📊 价值评估
  团队能力提升: ⭐⭐⭐⭐☆
  业务价值: ⭐⭐⭐⭐⭐
  技术创新: ⭐⭐⭐☆☆
  实施难度: 中等 (需要 2-3 个冲刺)

🛣️ 实施路线
  第 1 阶段: [里程碑 1]
  第 2 阶段: [里程碑 2]
  第 3 阶段: [里程碑 3]

⚡ 关键成功因素
  - [ ] [因素 1]
  - [ ] [因素 2]
  - [ ] [因素 3]

📚 参考资源
  - 相关文档/案例
  - 开源项目参考
  - 学习资源链接
```

## ✅ 使用流程总结

```
启动诊断
   ↓
阶段 1: 准备 (收集信息)
   ↓
阶段 2: 诊断 (多维分析)
   │   ├─ 架构诊断
   │   ├─ 代码质量
   │   ├─ 需求验证
   │   └─ 技术规划
   ↓
阶段 3: 聚类 (整理发现)
   ↓
阶段 4: 方案 (生成改进方案)
   ↓
阶段 5: 规划 (生成演进规划)
   ↓
输出诊断报告
```

## 💡 最佳实践

### 聚焦度优化

✅ **推荐用法**: 针对特定维度的深度诊断
```
"使用 discovering-project-insights 进行架构诊断"
"使用 discovering-project-insights 分析代码技术债"
"使用 discovering-project-insights 规划技术栈演进"
```

❌ **避免用法**: 一次诊断所有维度
```
过于宽泛，应该分次诊断不同维度
```

### 输出优化

✅ 结构化输出: 清单、矩阵、流程图
✅ 可视化呈现: 使用 Markdown 表格和缩进层级
✅ 可执行性: 每个方案都包含具体步骤和责任人

❌ 冗长叙述: 用表格替代段落
❌ 模糊建议: 必须有具体的操作步骤

### 工具选用指南

| 场景 | 推荐工具 | 原因 |
|------|---------|------|
| 快速了解项目结构 | Task (Explore) | 快速全局认知 |
| 深入分析特定问题 | Read + Grep | 精准定位 |
| 发现风险模式 | Grep | 批量搜索 |
| 质量数据收集 | Bash (lint/test) | 量化指标 |
| 采集专家知识 | AskUserQuestion | 结构化输入 |
| 组织任务清单 | TodoWrite | 任务追踪 |

## 🔍 常见诊断场景

### 场景 1: 新项目快速体检 (1 小时)

```
目标: 在快速拍抓阶段发现基础问题

工具组合: Explore + Grep + Bash
步骤:
  1. Explore Agent 快速扫描架构 (5 分钟)
  2. Grep 查找常见风险 (5 分钟)
  3. Bash 运行 lint/test (5 分钟)
  4. 整理成 P0 问题清单 (5 分钟)

输出: 10-15 个核心问题 + 优先级
```

### 场景 2: 遗留系统深度诊断 (4-8 小时)

```
目标: 理清现状、评估技术债规模

工具组合: 全套工具深度使用
步骤:
  1. Task (Explore) 理解整体架构 (30 分钟)
  2. Grep 系统性扫描风险 (1 小时)
  3. Read 分析关键模块 (1-2 小时)
  4. AskUserQuestion 采集业务背景 (30 分钟)
  5. 生成详细诊断报告 (1-2 小时)

输出: 完整诊断报告 + 改进方案 + 优先级排序
```

### 场景 3: 技术规划工作坊 (2-4 小时)

```
目标: 集合多角色洞察，规划未来演进

工具组合: AskUserQuestion + TodoWrite + Read
步骤:
  1. 多轮 AskUserQuestion 采集需求 (30 分钟)
  2. Explore 分析技术栈现状 (30 分钟)
  3. 头脑风暴规划方向 (1 小时)
  4. 生成演进路线图 (1 小时)

输出: 3-12 个月技术规划 + 关键里程碑 + 资源预估
```

## 📊 诊断结果模板

### 输出 1: 诊断摘要

```
项目诊断摘要
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
项目名称: [项目名]
诊断日期: [日期]
诊断范围: [架构/代码/需求/规划]
诊断深度: [快速体检/标准诊断/深度分析]

📊 整体评分
  架构设计: ⭐⭐⭐☆☆ (3/5) - 需要解耦
  代码质量: ⭐⭐⭐☆☆ (3/5) - 技术债多
  需求完整: ⭐⭐⭐⭐☆ (4/5) - 边界条件不清
  技术栈: ⭐⭐⭐⭐⭐ (5/5) - 选型合理

🎯 核心发现 (Top 5)
  1. [高优先级问题 1]
  2. [高优先级问题 2]
  3. [中优先级问题 1]
  4. [中优先级问题 2]
  5. [演进机会 1]

💼 预期投入
  诊断工作量: [X 人日]
  改进周期: [3-6 个月]
  预期收益: [提升项目质量/加快交付/降低风险等]
```

### 输出 2: 改进方案清单

```
优先级 | 类型 | 问题 | 影响范围 | 预期耗时 | 责任人
-------|------|------|---------|---------|--------
P0     | 安全 | SQL 注入风险 | 2 处 | 2 天 | [人名]
P0     | 代码 | 未处理异常 | 8 处 | 2 天 | [人名]
P1     | 架构 | 模块耦合 | 3 个模块 | 5 天 | [人名]
P1     | 性能 | N+1 查询 | 3 处 | 3 天 | [人名]
P2     | 规划 | 微服务评估 | - | 10 天 | [人名]
```

### 输出 3: 演进路线图

```
Q1 (1-3 个月)        Q2 (4-6 个月)        Q3 (7-12 个月)
├─ [里程碑 1]        ├─ [里程碑 3]        ├─ [里程碑 5]
├─ [里程碑 2]        ├─ [里程碑 4]        └─ [里程碑 6]
```

## 🚀 开始使用

```
1. 准备工作:
   - 理解项目基本情况
   - 确定诊断焦点和深度
   - 确保有权限访问项目代码

2. 触发诊断:
   "使用 discovering-project-insights 对项目进行 [维度] 诊断"

3. 配合工具:
   - 根据 Explore Agent 发现进行深度分析
   - 根据 Grep 结果验证具体问题
   - 用 AskUserQuestion 补充业务背景
   - 用 TodoWrite 组织改进方案

4. 输出交付:
   - 诊断摘要 (1 页)
   - 改进方案清单 (优先级排序)
   - 演进规划 (12 个月路线图)
   - 具体任务分配 (责任人+耗时)
```

## 📚 相关资源

- [Project Memory Constitution](../.spec-code/memory/constitution.md) - 项目原则
- [CodeBuddy Tools Guide](../docs/tools.md) - 工具详解
- [Architecture Design Best Practices](../docs/architecture.md)
- [Code Quality Standards](../docs/quality.md)

## 🔄 版本历史

- **v1.0** (2025-01-05): 初始版本
  - 集成 6 大诊断维度
  - 5 阶段执行流程
  - 3 个常见场景模板
  - 多种输出格式支持

---

**提示**: 这个技能最适合由**技术负责人、架构师或产品经理**启动。根据团队角色选择诊断焦点，充分利用结构化问卷采集多元视角。
