# 用户故事编写参考指南

## 用户故事格式

### 标准格式
```
作为 {用户角色}，
我希望 {功能描述}，
以便 {业务价值}。
```

### 格式要素说明

| 要素 | 说明 | 示例 |
|------|------|------|
| 用户角色 | 具体的用户类型，不是泛指"用户" | 客服人员、系统管理员、VIP客户 |
| 功能描述 | 用户想要完成的操作，使用用户语言 | 查询我的订单状态、导出月度报表 |
| 业务价值 | 为什么需要这个功能，解决什么问题 | 了解物流进度、分析销售趋势 |

## 粒度评估标准

| 粒度 | 工作量 | 特征 | 建议 |
|------|--------|------|------|
| S | 1-3天 | 单一功能点，边界清晰 | 理想粒度 |
| M | 3-5天 | 包含2-3个功能点 | 可接受 |
| L | 5-10天 | 功能较复杂，可能需拆分 | 评估是否拆分 |
| XL | >10天 | 功能过于复杂 | 必须拆分 |

## 常见拆分模式

### 1. 按业务规则拆分
```
原始：作为用户，我希望系统计算折扣
拆分后：
- US001: 普通用户无折扣
- US002: VIP用户享受9折
- US003: 超级VIP享受8折
- US004: 促销活动叠加折扣
```

### 2. 按数据变体拆分
```
原始：作为用户，我希望导出报告
拆分后：
- US001: 导出Excel格式
- US002: 导出PDF格式
- US003: 按时间范围筛选导出
- US004: 按部门筛选导出
```

### 3. 按操作类型拆分（CRUD）
```
原始：作为管理员，我希望管理用户
拆分后：
- US001: 创建新用户
- US002: 查看用户列表
- US003: 编辑用户信息
- US004: 删除/停用用户
```

### 4. 按用户角色拆分
```
原始：作为用户，我希望查看订单
拆分后：
- US001: 作为买家，查看我的订单
- US002: 作为卖家，查看店铺订单
- US003: 作为客服，查询任意订单
```

## 编写模式库

### 数据查询类
```
作为 {角色}，
我希望 能查询{数据对象}，
以便 {业务目的}。

示例：作为客户，我希望能查询我的订单状态，以便了解物流进度。
```

### 数据录入类
```
作为 {角色}，
我希望 能录入/提交{数据对象}，
以便 {业务目的}。

示例：作为客服，我希望能录入客户反馈信息，以便跟踪问题处理进度。
```

### 配置管理类
```
作为 {角色}，
我希望 能配置{配置项}，
以便 {业务目的}。

示例：作为系统管理员，我希望能配置自动回复规则，以便提高智能客服准确性。
```

### 通知提醒类
```
作为 {角色}，
我希望 收到{事件}的通知，
以便 {业务目的}。

示例：作为客户，我希望收到问题处理进度通知，以便及时了解处理状态。
```

### 数据分析类
```
作为 {角色}，
我希望 能查看{数据对象}的统计/分析，
以便 {业务目的}。

示例：作为运营经理，我希望能查看客服工作量统计，以便合理分配资源。
```

## 质量检查清单

- [ ] 用户角色是否具体明确？
- [ ] 功能描述是否使用用户语言？
- [ ] 业务价值是否回答"为什么需要"？
- [ ] 粒度是否在 S-M 范围内？
- [ ] 是否避免了技术实现细节？

---

## 故事数量要求

| Epic 规模 | 建议故事数 | 说明 |
|----------|-----------|------|
| 小型 | 8-12个 | 单一功能模块，1-2个用户角色 |
| 中型 | 15-25个 | 标准 Epic，3-5个用户角色（**默认**） |
| 大型 | 25-40个 | 复杂 Epic，多模块多角色 |

**注意**：
- 故事数量应根据 Epic 复杂度灵活调整
- 过少可能遗漏功能，过多可能粒度过细
- 优先保证覆盖核心用户角色和主要功能

---

## 信息不足处理

当输入材料信息不完整时，采用以下处理方式：

| 缺失信息 | 处理方式 | 标注方式 |
|---------|---------|---------|
| **角色不明确** | 基于功能特点推断可能的用户角色 | 标注 `（推断）` |
| **功能点不完整** | 补充常见的增删改查、通知、统计等功能 | 标注 `（补充）` |
| **业务规则缺失** | 基于行业最佳实践补充 | 标注 `（建议）` |

**示例**：
```
### US005: 查看操作日志（补充）

**用户故事**
> 作为 系统管理员（推断），
> 我希望 查看用户操作日志，
> 以便 追溯问题和审计操作记录。

**业务规则**
- BR1: 日志保留90天（建议）
- BR2: 敏感操作日志不可删除（建议）
```

---

## 常见编写错误

### 错误1：缺少业务价值

| 类型 | 示例 |
|------|------|
| ❌ 错误 | 作为用户，我希望能登录系统。 |
| ✅ 正确 | 作为客户，我希望能登录系统，以便访问我的个人订单和服务记录。 |

**问题**：缺少"以便"部分，无法说明功能的业务价值。

### 错误2：角色过于模糊

| 类型 | 示例 |
|------|------|
| ❌ 错误 | 作为用户，我希望... |
| ✅ 正确 | 作为客服人员/客户/系统管理员，我希望... |

**问题**："用户"过于泛化，无法区分不同角色的需求差异。

### 错误3：功能描述过于技术化

| 类型 | 示例 |
|------|------|
| ❌ 错误 | 作为用户，我希望系统调用API获取数据... |
| ✅ 正确 | 作为客户，我希望能实时查看订单物流信息... |

**问题**：使用技术术语（API、数据库、接口），应使用用户语言。

### 错误4：故事粒度过大

| 类型 | 示例 |
|------|------|
| ❌ 错误 | 作为管理员，我希望能管理所有用户（包含增删改查、权限、日志...） |
| ✅ 正确 | 拆分为多个故事：用户创建、用户编辑、用户删除、权限分配... |

**问题**：单个故事包含过多功能，应按 CRUD 或业务规则拆分。

---

## 成功标准

完成用户故事生成后，检查是否满足以下标准：

| 标准 | 检查项 | 状态 |
|------|--------|------|
| **数量合理** | 生成15-25个用户故事（视Epic规模调整） | ✅/❌ |
| **格式规范** | 每个故事都遵循"作为...我希望...以便..."格式 | ✅/❌ |
| **价值明确** | 每个故事都有明确的用户价值 | ✅/❌ |
| **粒度适中** | 故事粒度适中，无明显过大（XL）或过小 | ✅/❌ |
| **覆盖完整** | 覆盖所有核心用户角色和主要功能 | ✅/❌ |

**全部 ✅ 才可输出最终文档**。

---

## 质量验证循环

完成初稿后，执行以下验证：

```
┌─────────────────────────────────────────────────┐
│                  质量验证循环                    │
├─────────────────────────────────────────────────┤
│  1. 格式检查                                     │
│     └─ 每个故事是否遵循"作为...我希望...以便..."？ │
│                                                 │
│  2. 价值检查                                     │
│     └─ 每个故事的业务价值是否明确？               │
│                                                 │
│  3. 粒度检查                                     │
│     └─ 是否存在 XL 故事需要进一步拆分？           │
│                                                 │
│  4. 覆盖检查                                     │
│     └─ 是否覆盖所有核心角色和主要功能？           │
│                                                 │
│  验证 → 修正 → 重复                              │
│  全部通过后输出最终文档                          │
└─────────────────────────────────────────────────┘
```
