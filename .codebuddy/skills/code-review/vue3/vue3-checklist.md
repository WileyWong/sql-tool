# Vue 3 代码审查检查清单

Vue 3 + TypeScript 代码审查检查清单，确保审查质量和一致性。

## ⚠️ 版本兼容性检查

| 特性 | 最低版本 | 检查项 |
|------|----------|--------|
| `<script setup>` | Vue 3.2+ | 项目是否支持 |
| `v-memo` | Vue 3.2+ | 是否正确使用 |
| `effectScope` | Vue 3.2+ | 是否需要管理多个响应式效果 |
| `defineSlots` | Vue 3.3+ | 泛型组件是否需要 |
| `defineOptions` | Vue 3.3+ | 是否需要定义组件选项 |
| `defineModel` | Vue 3.4+ | v-model 是否可简化 |
| `useTemplateRef` | Vue 3.5+ | 模板引用是否可简化 |

---

## 🟢 基础审查 (15-30min)

### 代码规范
- [ ] ESLint 检查通过
- [ ] TypeScript 无编译错误
- [ ] 组件使用多词命名（如 `UserProfile`）
- [ ] 使用 `<script setup>` 语法 **[Vue 3.2+]**

### 组件大小
- [ ] 组件代码 < 300 行
- [ ] 模板代码 < 100 行
- [ ] Props 数量 ≤ 10 个

### 类型定义
- [ ] Props 有 TypeScript 类型定义
- [ ] Emits 有 TypeScript 类型定义
- [ ] 无 `any` 类型（业务代码）

---

## 🟡 标准审查 (45-60min)

**包含基础审查 +**

### 响应式系统
- [ ] 基本类型使用 `ref`
- [ ] 对象类型使用 `reactive`
- [ ] 无响应性丢失（解构 reactive 使用 toRefs）
- [ ] 派生状态使用 `computed`
- [ ] 大对象使用 `shallowRef` 优化

### Composables
- [ ] 命名以 `use` 前缀开头
- [ ] 副作用在 `onUnmounted` 中清理
- [ ] 返回值有明确类型定义
- [ ] 职责单一
- [ ] 多个 watcher 使用 `effectScope` 管理 **[Vue 3.2+]**

### 性能优化
- [ ] 大列表使用虚拟滚动
- [ ] 路由组件懒加载
- [ ] 重组件使用 `defineAsyncComponent`
- [ ] 静态内容使用 `v-once`
- [ ] 列表优化使用 `v-memo` **[Vue 3.2+]**

### 安全性
- [ ] 无直接使用 `v-html`（或已使用 DOMPurify）
- [ ] 用户输入有验证
- [ ] 无控制台打印敏感信息
- [ ] 动态组件使用白名单验证

---

## 🔴 专业审查 (2-3h)

**包含标准审查 +**

### 组件设计
- [ ] 组件职责单一
- [ ] 组件通信清晰（props down, events up）
- [ ] 复杂逻辑提取到 Composables
- [ ] 无过深的组件嵌套
- [ ] 泛型组件类型正确 **[Vue 3.3+]**

### TypeScript 深度检查
- [ ] 启用 strict 模式
- [ ] 无隐式 any
- [ ] 使用泛型提高复用性
- [ ] API 响应有完整类型定义
- [ ] Props 使用 `defineProps<T>()` 泛型语法

### 测试覆盖
- [ ] 关键组件有单元测试
- [ ] 测试覆盖率 ≥ 80%
- [ ] 边界条件有测试用例

### 无障碍性
- [ ] 图片有 alt 属性
- [ ] 表单有 label 关联
- [ ] 可键盘导航
- [ ] ARIA 属性正确使用

### 性能深度检查
- [ ] Lighthouse 性能评分 > 90
- [ ] 无不必要的重渲染
- [ ] 使用 `shallowRef` 优化大对象
- [ ] 图片懒加载
- [ ] SSR 场景无状态泄漏

### 安全深度检查
- [ ] 无原型污染风险（Object.assign 用户输入）
- [ ] 动态组件使用白名单
- [ ] SSR 无跨请求状态共享
- [ ] 无 `javascript:` 协议 URL
- [ ] 第三方库无已知漏洞

---

## 常见问题检查

### 响应式问题
- [ ] 没有解构 reactive 导致响应性丢失
- [ ] 没有直接赋值 ref.value 为新对象
- [ ] 没有在 setup 外使用响应式 API
- [ ] 没有在 computed 中产生副作用

### 性能问题
- [ ] 没有在模板中调用方法（应使用 computed）
- [ ] 没有大列表直接渲染
- [ ] 没有未清理的定时器/事件监听
- [ ] 没有在循环中创建内联函数/对象

### 安全问题
- [ ] 没有 XSS 漏洞（v-html 未过滤）
- [ ] 没有敏感信息暴露
- [ ] 没有未验证的用户输入
- [ ] 没有原型污染风险
- [ ] 没有 SSR 状态泄漏

### 类型问题
- [ ] 没有使用 any 类型
- [ ] 没有类型断言滥用
- [ ] 没有缺失的类型定义
- [ ] 没有使用 `as` 绕过类型检查

---

## 检查工具

```bash
# ESLint 检查
npm run lint

# 组件大小检查
node tools/check-component-size.js

# 测试覆盖率
npm run test:coverage

# TypeScript 检查
npx tsc --noEmit

# Vue 版本检查
npm list vue

# 安全漏洞检查
npm audit
```

---

## 评分计算

| 维度 | 权重 | 得分 |
|------|------|------|
| 组件设计 | 20% | /100 |
| 响应式系统 | 20% | /100 |
| Composables | 15% | /100 |
| 性能优化 | 20% | /100 |
| 安全性 | 15% | /100 |
| 可维护性 | 10% | /100 |
| **综合得分** | | **/100** |

**等级**: A级(≥85) / B级(70-84) / C级(60-69) / D级(<60)
