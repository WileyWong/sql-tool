# Go 代码审查检查清单

Go 语言代码审查检查清单，确保审查质量和一致性。

---

## 🟢 基础审查 (15-30min)

### 代码规范
- [ ] `gofmt` / `goimports` 格式化通过
- [ ] `go vet` 无警告
- [ ] 包名小写、简短有意义
- [ ] 导出标识符有文档注释

### 命名规范
- [ ] 变量/函数命名清晰有意义
- [ ] 接口使用 `-er` 后缀（如 `Reader`）
- [ ] 缩写词大小写一致（`userID` 或 `HTTPClient`）
- [ ] 避免包名与导出符号重复

### 错误处理
- [ ] 所有错误都被检查（无 `_` 忽略）
- [ ] 错误信息清晰有上下文
- [ ] 使用 `%w` 包装错误

---

## 🟡 标准审查 (45-60min)

**包含基础审查 +**

### 错误处理深度
- [ ] 定义了自定义错误类型
- [ ] 使用 `errors.Is` / `errors.As` 判断错误
- [ ] 无字符串比较错误
- [ ] panic 仅用于不可恢复场景

### 并发安全
- [ ] goroutine 有退出机制（context）
- [ ] 使用 WaitGroup 等待 goroutine
- [ ] 循环变量正确传递给 goroutine
- [ ] channel 正确关闭

### 锁使用
- [ ] 使用 `defer` 解锁
- [ ] 读写锁分离（RWMutex）
- [ ] 锁范围最小化
- [ ] 无死锁风险

### 性能基础
- [ ] 切片预分配（已知长度）
- [ ] 大量字符串拼接用 `strings.Builder`
- [ ] 无循环内 `+` 拼接字符串

### 安全性
- [ ] 用户输入有验证
- [ ] SQL 使用参数化查询
- [ ] 无硬编码密钥/密码
- [ ] 敏感信息不打印到日志

---

## 🔴 专业审查 (2-3h)

**包含标准审查 +**

### 并发深度
- [ ] 使用 `context` 传递取消信号
- [ ] 设置合理的超时
- [ ] channel 方向明确（`chan<-` / `<-chan`）
- [ ] 无 goroutine 泄漏
- [ ] 通过 `-race` 检测无竞态

### 性能优化
- [ ] 使用 `sync.Pool` 复用对象
- [ ] 大结构体使用指针传递
- [ ] 热点代码有 benchmark
- [ ] 内存分配合理（pprof 分析）

### 接口设计
- [ ] 接口小而专注
- [ ] 接受接口，返回具体类型
- [ ] 依赖注入而非全局变量
- [ ] 无过度抽象

### 测试覆盖
- [ ] 单元测试覆盖率 ≥ 80%
- [ ] 使用表驱动测试
- [ ] 边界条件有测试
- [ ] 错误路径有测试

### HTTP 安全
- [ ] 设置请求超时
- [ ] 设置安全响应头
- [ ] 验证 Content-Type
- [ ] 限制请求体大小

---

## 常见问题检查

### 错误处理问题
- [ ] 没有忽略错误（`_`）
- [ ] 没有只打印不返回错误
- [ ] 没有用 panic 做流程控制
- [ ] 没有字符串比较错误
- [ ] defer 中的错误被正确处理
- [ ] 使用 `errors.Join` 聚合多个错误 **[Go 1.20+]**

### 并发问题
- [ ] 没有 goroutine 泄漏
- [ ] 没有向已关闭 channel 发送
- [ ] 没有锁内执行耗时操作
- [ ] 没有数据竞争
- [ ] 共享计数器使用 `sync/atomic` 包
- [ ] 64 位原子操作在 32 位系统上正确对齐
- [ ] 使用 `errgroup` 处理并发错误 **[golang.org/x/sync]**

### 性能问题
- [ ] 没有循环内字符串 `+` 拼接
- [ ] 没有未预分配的大切片
- [ ] 没有不必要的内存分配
- [ ] 没有 N+1 查询
- [ ] 热点代码通过逃逸分析优化
- [ ] 泛型代码性能已验证 **[Go 1.18+]**

### 安全问题
- [ ] 没有 SQL 字符串拼接
- [ ] 没有硬编码密钥
- [ ] 没有敏感信息日志
- [ ] 没有未验证的用户输入
- [ ] 没有命令注入（`os/exec` 参数分离）
- [ ] HTML 输出使用 `html/template`（非 `text/template`）
- [ ] 密码比较使用 `subtle.ConstantTimeCompare`
- [ ] 随机数使用 `crypto/rand`（非 `math/rand`）
- [ ] 整数类型转换有边界检查

---

## 检查工具

```bash
# 格式化
gofmt -w .
goimports -w .

# 静态分析
go vet ./...
staticcheck ./...
golangci-lint run

# 测试覆盖率
go test -coverprofile=coverage.out ./...
go tool cover -func=coverage.out

# 竞态检测
go test -race ./...

# 性能分析
go test -bench=. -benchmem ./...

# 逃逸分析
go build -gcflags="-m" ./...

# 模糊测试 [Go 1.18+]
go test -fuzz=FuzzXxx -fuzztime=30s ./...

# 漏洞扫描 [govulncheck]
govulncheck ./...
```

---

## 评分计算

| 维度 | 权重 | 得分 |
|------|------|------|
| 代码规范 | 20% | /100 |
| 错误处理 | 20% | /100 |
| 并发安全 | 20% | /100 |
| 性能优化 | 15% | /100 |
| 安全性 | 15% | /100 |
| 可维护性 | 10% | /100 |
| **综合得分** | | **/100** |

**等级**: A级(≥85) / B级(70-84) / C级(60-69) / D级(<60)

---

## Go 版本特性检查

| 版本 | 特性 | 审查要点 |
|------|------|----------|
| Go 1.18 | 泛型 | 类型约束设计、性能影响 |
| Go 1.18 | 模糊测试 | Fuzz 测试覆盖 |
| Go 1.20 | `errors.Join` | 多错误聚合 |
| Go 1.21 | `slices`/`maps` 包 | 使用标准库替代手写 |
| Go 1.22 | 循环变量语义 | 闭包捕获自动安全 |
| Go 1.23 | `iter` 包 | 迭代器模式 |

### 版本兼容性检查
- [ ] 确认项目最低 Go 版本要求
- [ ] 新特性使用与目标版本兼容
- [ ] 第三方库版本与 Go 版本兼容
