# 微信小程序代码审查检查清单

微信小程序代码审查检查清单，确保审查质量和一致性。

## ⚠️ 版本兼容性检查

| 特性 | 最低版本 | 检查项 |
|------|----------|--------|
| 初始渲染缓存 | 2.9.0+ | 是否启用 |
| 分包预下载 | 2.9.0+ | 是否配置 |
| 自定义 tabBar | 2.11.0+ | 是否正确实现 |
| Skyline 渲染 | 2.14.0+ | 是否适用 |
| 按需注入 | 2.11.1+ | 是否启用 |

---

## 🟢 基础审查 (15-30min)

### 代码规范
- [ ] ESLint 检查通过
- [ ] 组件使用多词命名（如 `user-profile`）
- [ ] 目录结构清晰（pages/components/utils 分离）
- [ ] 无控制台调试代码（console.log）

### 组件大小
- [ ] 组件代码 < 300 行
- [ ] WXML 代码 < 100 行
- [ ] Properties 数量 ≤ 10 个

### WXML 规范
- [ ] wx:for 使用唯一 wx:key
- [ ] 无复杂表达式（应使用 WXS）
- [ ] 条件渲染使用 wx:if/wx:elif/wx:else

### 样式规范
- [ ] 使用 rpx 单位适配
- [ ] 使用 class 选择器
- [ ] 无过深选择器嵌套（≤3层）

---

## 🟡 标准审查 (45-60min)

**包含基础审查 +**

### 组件设计
- [ ] 组件职责单一
- [ ] Properties 有完整类型定义和默认值
- [ ] 使用 triggerEvent 进行父子通信
- [ ] 组件样式隔离设置正确

### 性能优化
- [ ] setData 调用合并
- [ ] setData 只传递渲染所需数据
- [ ] 使用路径更新局部数据
- [ ] 大列表使用分页或虚拟滚动
- [ ] 图片使用 lazy-load

### 分包配置
- [ ] 主包 ≤ 2MB
- [ ] 合理使用分包
- [ ] 配置分包预加载
- [ ] 非首屏页面放入分包

### 安全性
- [ ] 无明文存储敏感信息
- [ ] 使用 HTTPS 请求
- [ ] 用户输入有验证
- [ ] 无控制台打印敏感信息

---

## 🔴 专业审查 (2-3h)

**包含标准审查 +**

### 深度性能优化
- [ ] 启用初始渲染缓存
- [ ] 启用按需注入（lazyCodeLoading）
- [ ] WXML 节点数 < 1000
- [ ] 无频繁 setData（>100ms/次）
- [ ] 定时器/音频等资源正确清理
- [ ] 体验评分 > 90

### 分包深度检查
- [ ] 独立分包配置正确
- [ ] 分包异步化使用合理
- [ ] 公共组件提取到主包
- [ ] 分包间无循环依赖

### 安全深度检查
- [ ] WebView URL 白名单验证
- [ ] 富文本内容已过滤
- [ ] 隐私协议声明完整
- [ ] 权限获取按需申请
- [ ] 敏感 API 调用有保护

### 可维护性
- [ ] 关键函数有 JSDoc 注释
- [ ] 环境配置分离
- [ ] 统一错误处理
- [ ] API 请求封装

### 无障碍性
- [ ] 图片有 alt 描述
- [ ] 表单有 label 关联
- [ ] 颜色对比度符合标准

---

## 常见问题检查

### 性能问题
- [ ] 没有频繁调用 setData
- [ ] 没有 setData 传递大量无用数据
- [ ] 没有大列表直接渲染（>100项）
- [ ] 没有未清理的定时器/监听器
- [ ] 没有主包体积超标

### WXML 问题
- [ ] 没有使用 index 作为 wx:key
- [ ] 没有缺少 wx:key 的列表
- [ ] 没有过多 WXML 节点
- [ ] 没有在模板中写复杂逻辑

### 安全问题
- [ ] 没有明文存储密码/Token
- [ ] 没有使用 HTTP 请求
- [ ] 没有未验证的用户输入
- [ ] 没有直接渲染用户 HTML
- [ ] 没有过度获取用户权限

### 样式问题
- [ ] 没有使用 px 单位（边框除外）
- [ ] 没有使用标签选择器
- [ ] 没有使用 ID 选择器
- [ ] 没有样式污染问题

---

## 检查工具

```bash
# ESLint 检查
npm run lint

# 代码质量检查（开发者工具）
详情 → 本地设置 → 开启代码质量检查

# 体验评分
调试器 → Audits → 体验评分

# 包体积检查
详情 → 本地设置 → 代码包大小
# 主包 ≤ 2MB，单包 ≤ 2MB，总包 ≤ 20MB

# 性能分析
调试器 → Performance
```

---

## 评分计算

| 维度 | 权重 | 得分 |
|------|------|------|
| 组件设计 | 20% | /100 |
| WXML 规范 | 15% | /100 |
| 样式规范 | 10% | /100 |
| 性能优化 | 25% | /100 |
| 安全性 | 20% | /100 |
| 可维护性 | 10% | /100 |
| **综合得分** | | **/100** |

**等级**: A级(≥85) / B级(70-84) / C级(60-69) / D级(<60)
