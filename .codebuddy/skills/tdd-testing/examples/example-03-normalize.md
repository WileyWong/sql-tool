# 示例 3: 规范化已有测试用例文档（normalize 策略）

本示例展示如何将非标准的测试用例文档规范化为标准格式。

## 输入：非标准测试用例文档

```markdown
# 用户测试

## 测试1：创建用户
- 输入用户信息
- 点击保存
- 应该成功

## 测试2：查询用户
- 输入ID
- 查询
- 返回用户信息
```

## 步骤 0: 输入判断

```yaml
输入类型: 文档
文档类型: 测试用例设计文档（非标准）
判断依据:
  - 包含测试用例列表
  - 包含测试场景描述
  - 缺少标准格式
选择策略: design-test-case/normalize
```

## 步骤 1: 规范化处理

```markdown
# 用户管理 API 测试用例设计文档

## 元信息

| 属性 | 值 |
|------|-----|
| change_id | USER-NORM-001 |
| domain | 用户管理 |
| test_type | 集成测试 |
| api_base_path | /api/users |
| 规范化日期 | 2024-01-15 |

## 测试范围

- 用户创建功能
- 用户查询功能

## 测试用例

### 1. 创建用户

#### TC-USER-NORM-001: CreateUser-ValidInput-ReturnsSuccess

**前置条件**: 
- 系统正常运行
- 数据库连接正常

**测试步骤**:
1. 构造有效的用户创建请求
2. 发送 POST /api/users 请求
3. 验证响应

**测试数据**:
```json
{
  "name": "测试用户",
  "email": "test@example.com",
  "phone": "13800138000"
}
```

**预期结果**:
- 状态码: 201 Created
- 响应体包含用户 ID
- 数据库中存在该用户记录

**清理策略**: 删除创建的测试用户

---

### 2. 查询用户

#### TC-USER-NORM-002: GetUser-ValidId-ReturnsUserInfo

**前置条件**: 
- 数据库中存在测试用户

**测试步骤**:
1. 获取已存在用户的 ID
2. 发送 GET /api/users/{id} 请求
3. 验证响应

**测试数据**:
- 用户 ID: {预置用户ID}

**预期结果**:
- 状态码: 200 OK
- 响应体包含完整用户信息

**清理策略**: 无需清理
```

---

## ✅ 检查点1: 测试用例完整性验证

```yaml
检查点1验证结果:

规范化前后对比:
  规范化前:
    结构完整性: ❌ 缺少元信息、测试范围
    用例规范性: ❌ 无用例ID、无前置条件、无测试数据
    覆盖完整性: ❌ 仅覆盖正常流程
    可执行性: ❌ 测试数据不明确

  规范化后:
    结构完整性: ✅ 通过
      - [x] 包含元信息（change_id, domain, test_type）
      - [x] 包含测试范围
      - [x] 包含用例分类

    用例规范性: ✅ 通过
      - [x] 用例 ID 唯一 (TC-USER-NORM-001, TC-USER-NORM-002)
      - [x] 命名遵循规范
      - [x] 包含前置条件
      - [x] 包含测试步骤
      - [x] 包含预期结果

    覆盖完整性: ⚠️ 部分通过 (60%)
      - [x] 正常流程覆盖
      - [ ] 参数验证覆盖（需补充）
      - [ ] 异常场景覆盖（需补充）

    可执行性: ✅ 通过
      - [x] 测试数据明确
      - [x] 清理策略明确

检查点1结论: ⚠️ 部分通过
  - 结构和规范性检查通过
  - 覆盖完整性需补充异常场景
  - 建议: 补充参数验证和异常场景用例后再进入步骤2
```

## 补充异常场景用例

```markdown
### 3. 异常场景

#### TC-USER-NORM-003: CreateUser-EmptyName-Returns400

**前置条件**: 无

**测试数据**:
```json
{
  "name": "",
  "email": "test@example.com"
}
```

**预期结果**:
- 状态码: 400 Bad Request
- 响应体包含验证错误信息

**清理策略**: 无需清理

---

#### TC-USER-NORM-004: GetUser-NotFound-Returns404

**前置条件**: 数据库中不存在 id=99999 的用户

**测试数据**:
- 用户 ID: 99999

**预期结果**:
- 状态码: 404 Not Found

**清理策略**: 无需清理
```

---

## ✅ 检查点1（重新验证）

```yaml
检查点1重新验证结果:

覆盖完整性: ✅ 通过 (80%+)
  - [x] 正常流程覆盖 (TC-USER-NORM-001, TC-USER-NORM-002)
  - [x] 参数验证覆盖 (TC-USER-NORM-003)
  - [x] 异常场景覆盖 (TC-USER-NORM-004)

检查点1结论: ✅ 通过，可以进入步骤2
```

后续按正常流程继续：步骤2 生成测试代码 → 检查点2 → 步骤3 执行测试 → 检查点3 → 步骤4 清理询问
