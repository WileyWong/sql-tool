# 测试用例文档规范化策略

对已有的测试用例文档进行规范化处理，确保符合标准格式，补充缺失内容。

---

## 适用场景

- 输入是已有的测试用例文档
- 文档格式不规范
- 缺少必要的章节或信息
- 需要统一格式后进入代码生成阶段

---

## 执行步骤

### 步骤 1: 解析现有文档

**识别文档类型**:
- Markdown 格式
- Excel/CSV 格式
- 其他格式（需转换）

**提取现有内容**:
- 用例列表
- 测试场景
- 预期结果
- 测试数据

### 步骤 2: 结构完整性检查

对照标准规范检查:

```yaml
结构检查:
  元信息:
    - [ ] change_id: 存在/缺失
    - [ ] domain: 存在/缺失
    - [ ] test_type: 存在/缺失
    - [ ] source: 存在/缺失
  
  章节:
    - [ ] 测试范围说明: 存在/缺失
    - [ ] 测试用例列表: 存在/缺失
    - [ ] 测试数据: 存在/缺失
    - [ ] 清理策略: 存在/缺失（集成测试）
```

### 步骤 3: 用例规范性检查

```yaml
用例检查:
  - [ ] 用例ID: 唯一/重复/缺失
  - [ ] 用例命名: 规范/不规范
  - [ ] 前置条件: 存在/缺失
  - [ ] 测试步骤: 存在/缺失
  - [ ] 预期结果: 存在/缺失
  - [ ] 清理操作: 存在/缺失（集成测试）
```

### 步骤 4: 补充缺失内容

#### 补充元信息

```yaml
---
change_id: "{从上下文推断或询问用户}"
domain: "{从用例内容推断}"
test_type: "api-test | unit-test"
source: "manual"
created_at: "{当前日期}"
author: "{作者}"
---
```

#### 补充用例ID

```markdown
# 原始
- 创建用户成功
- 用户名为空

# 规范化后
### TC001 - 创建用户成功
### TC010 - 用户名为空
```

#### 补充预期结果

```markdown
# 原始
预期: 成功

# 规范化后
**预期结果**:
- HTTP 状态码: 201
- 响应体: { "code": 0, "data": { "id": "不为空" } }
- 数据库: users 表新增一条记录
```

#### 补充清理策略

```markdown
## 4. 清理策略

### 4.1 清理方式
- 手动调用 execute_cleanup()

### 4.2 清理顺序
1. 删除关联数据
2. 删除主数据

### 4.3 清理 API
| 资源类型 | 清理接口 |
|---------|---------|
| 用户 | DELETE /api/users/{id} |
| 订单 | DELETE /api/orders/{id} |
```

### 步骤 5: 统一格式

#### 用例命名统一

```markdown
# API 测试
test_[HTTP方法]_[资源]_[场景描述]_returns_[预期状态码]

# 单元测试
should[预期行为]When[条件]
```

#### 测试数据格式统一

```json
{
  "valid": {
    "username": "testuser",
    "email": "test@example.com"
  },
  "boundary": {
    "username_at_min": "abc",
    "username_at_max": "a{20}"
  },
  "invalid": {
    "empty_username": "",
    "invalid_email": "invalid"
  }
}
```

### 步骤 6: 覆盖完整性检查

检查是否覆盖所有必要场景:

```yaml
覆盖检查:
  功能测试:
    - [ ] 正常流程（必填字段）
    - [ ] 正常流程（全字段）
  
  参数验证:
    - [ ] 必填字段缺失
    - [ ] 边界值（min-1/min/max/max+1）
    - [ ] 格式验证
  
  异常场景:
    - [ ] 401 未认证
    - [ ] 403 无权限
    - [ ] 404 不存在
    - [ ] 409 冲突
  
  安全测试:
    - [ ] SQL 注入
    - [ ] XSS
  
  性能测试:
    - [ ] 响应时间
```

### 步骤 7: 输出规范化文档

生成符合标准的测试用例文档。

---

## 规范化报告

规范化完成后，生成报告:

```markdown
# 测试用例文档规范化报告

## 1. 原始文档信息
- 文件名: {原始文件名}
- 用例数量: {数量}
- 格式: {格式}

## 2. 检查结果

### 2.1 结构完整性
| 检查项 | 状态 | 处理 |
|--------|------|------|
| 元信息 | ❌ 缺失 | ✅ 已补充 |
| 测试范围 | ✅ 存在 | - |
| 清理策略 | ❌ 缺失 | ✅ 已补充 |

### 2.2 用例规范性
| 检查项 | 状态 | 处理 |
|--------|------|------|
| 用例ID | ❌ 缺失 | ✅ 已补充 |
| 命名规范 | ❌ 不规范 | ✅ 已统一 |
| 预期结果 | ⚠️ 不完整 | ✅ 已补充 |

### 2.3 覆盖完整性
| 维度 | 原始覆盖 | 补充后覆盖 |
|------|---------|-----------|
| 功能测试 | 2/2 | 2/2 |
| 参数验证 | 3/8 | 8/8 |
| 异常场景 | 1/4 | 4/4 |
| 安全测试 | 0/2 | 2/2 |

## 3. 规范化后文档
- 文件名: {新文件名}
- 用例数量: {数量}
- 通过标准化检查: ✅
```

---

## 验证清单

- [ ] 元信息完整
- [ ] 所有用例有唯一ID
- [ ] 用例命名符合规范
- [ ] 预期结果包含多层断言
- [ ] 测试数据格式统一
- [ ] 清理策略已定义（集成测试）
- [ ] 覆盖完整性检查通过

---

## 相关资源

- [测试用例规范](../../test-case-spec-standard.md)
- [完整示例](../../examples/example-03-normalize.md)
- [验证清单](../../checklist.md)
