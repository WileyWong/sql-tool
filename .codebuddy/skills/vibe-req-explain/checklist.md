---
title: req-explain 检查清单
description: 需求解读完成后的验证清单
---

# 需求解读检查清单

## 前置条件检查

- [ ] 需求来源已提供（PRD/TAPD/文档链接/文本）
- [ ] 变更 ID 格式正确（格式: `YYYY-MM-DD-feature-name`）
- [ ] 已读取相关参考文档（requirement-review.md、clarifications.md，如存在）
- [ ] 已了解项目开发规范（参考 [开发指南](mdc:.spec-code/memory/guidelines.md)）

## 步骤 1: 收集和验证输入 - 质量检查

### 1.1 需求来源验证

- [ ] 需求来源类型已识别（PRD 文本/TAPD 链接/文档文件/用户描述）
- [ ] 需求来源已成功读取（无权限错误、无网络错误）
- [ ] 需求内容完整（包含功能描述、业务目标等核心信息）

**需求来源类型处理**:
- [ ] PRD 文本: 直接使用用户提供的文本内容
- [ ] TAPD 链接: 使用 `mcp_call_tool` 调用 `tapd_mcp_http.stories_get` 或 `web_fetch` 读取
- [ ] 文档文件: 使用 `read_file` 读取（如 `.md`、`.docx`、`.pdf`）
- [ ] 用户描述: 直接使用用户输入的文本

### 1.2 变更 ID 验证

- [ ] 变更 ID 格式正确（格式: `YYYY-MM-DD-feature-name`）
  - ✅ 示例: `2025-11-04-user-registration`
  - ❌ 错误: `user-registration`（缺少日期）
  - ❌ 错误: `2025/11/04-user-registration`（日期格式错误）
- [ ] 变更 ID 中的日期有效（年份 >= 2020，月份 1-12，日期 1-31）
- [ ] 变更 ID 中的功能名称清晰（使用小写字母和连字符）

**如果未提供变更 ID**:
- [ ] 只进行需求分析，不生成文档
- [ ] 明确告知用户"未提供变更 ID，仅分析不生成文档"
- [ ] 在分析结束后提示用户"如需生成正式文档，请提供变更 ID"

### 1.3 参考文档读取

- [ ] 检查 `workspace/{变更ID}/requirements/requirement-review.md` 是否存在
- [ ] 检查 `workspace/{变更ID}/requirements/clarifications.md` 是否存在
- [ ] 如果存在，读取文件内容
- [ ] 提取待澄清项数量（`[NEEDS CLARIFICATION]` 标记的数量）

### 1.4 常见错误检查

**错误 1: 未提供变更 ID 就生成文档**
- [ ] 用户未提供变更 ID → 只分析，不生成文档
- [ ] 生成文档前必须验证变更 ID 是否提供

**错误 2: 需求来源读取失败**
- [ ] TAPD 链接无法访问 → 提示用户检查权限或网络
- [ ] 文档文件不存在 → 提示用户提供正确的文件路径

**错误 3: 变更 ID 格式错误**
- [ ] 变更 ID 不符合规范 → 提示用户修正格式
- [ ] 示例: `错误格式: user-registration → 正确格式: 2025-11-04-user-registration`

---

## 步骤 2: 需求分析 - 质量检查

### 2.1 业务目标理解

**业务目标分析完整性**:
- [ ] 业务背景已阐述（解决什么问题）
- [ ] 用户价值已明确（用户获得什么好处）
- [ ] 业务目标已定义（实现什么目标）
- [ ] 成功指标已量化（可衡量的指标）

**业务目标示例**:
```markdown
✅ 正确示例:
**业务背景**: 用户注册是用户使用产品的第一步，注册流程的复杂度直接影响用户转化率。
**用户价值**: 用户可以快速创建账号，降低注册门槛。
**业务目标**: 提升用户注册转化率，减少注册流程的复杂度。
**成功指标**: 注册转化率 >= 60%，注册流程平均完成时间 <= 2 分钟。

❌ 错误示例:
**业务目标**: 开发用户注册功能。（未说明"为什么"）
**成功指标**: 功能正常工作。（不可量化）
```

### 2.2 功能点分解（FR）

**FR 提取完整性**:
- [ ] 所有功能点已识别（从需求来源中提取）
- [ ] 每个 FR 有唯一编号（FR-001、FR-002、FR-003...）
- [ ] 每个 FR 有清晰的功能描述
- [ ] 每个 FR 有用户场景（使用场景描述）
- [ ] 每个 FR 有输入/输出定义
- [ ] 每个 FR 有业务规则（BR）列表
- [ ] 每个 FR 有异常处理（E）列表
- [ ] 每个 FR 有验收标准（正常场景、边界条件、异常情况）

**FR 编号规范**:
- [ ] 编号格式为 `FR-XXX`（如 FR-001、FR-002）
- [ ] 编号从 001 开始，连续递增
- [ ] 编号与功能名称一致（如 FR-001: 手机号注册）

**功能描述质量**:
- [ ] 功能描述清晰简洁（1-2 句话）
- [ ] 功能描述聚焦核心目标（不涉及技术实现）
- [ ] 功能描述包含用户价值（解决用户什么问题）

**用户场景完整性**:
- [ ] 场景包含触发条件（用户在什么情况下使用）
- [ ] 场景包含操作步骤（用户做什么）
- [ ] 场景包含预期结果（系统做什么）

**输入/输出定义**:
- [ ] 输入参数已列出（字段名称、类型、是否必填）
- [ ] 输入参数有验证规则（格式、长度、范围）
- [ ] 输出结果已定义（成功响应、失败响应）
- [ ] 输出结果包含关键字段（不涉及技术实现细节）

**业务规则（BR）提取**:
- [ ] 所有业务规则已识别（从需求中提取）
- [ ] 每个业务规则有唯一编号（BR-001、BR-002...）
- [ ] 业务规则清晰准确（使用模态动词、量化指标）
- [ ] 业务规则无二义性（唯一解释、可测试）

**业务规则清晰度验证**（⭐ 核心质量标准）:
- [ ] **模态动词使用**: 必须/应当/可以/禁止/仅当...时
  - ✅ "手机号必须是 11 位数字"
  - ❌ "手机号是 11 位数字"（缺少模态动词）
  
- [ ] **量化指标**: 精确数字、时间、百分比、阈值
  - ✅ "验证码有效期 5 分钟"（精确时间）
  - ❌ "验证码过一段时间后失效"（模糊时间）
  
- [ ] **时间点明确**: 精确时间、时间段、超时时间
  - ✅ "验证码发送频率每分钟最多 1 次"
  - ❌ "验证码不能频繁发送"（时间不明确）
  
- [ ] **条件和状态精确**: 枚举值、比较运算符、布尔条件
  - ✅ "密码长度 >= 8 且 <= 20"
  - ❌ "密码长度适中"（条件不明确）
  
- [ ] **业务术语具体**: 使用实际术语、业务动作、业务对象
  - ✅ "手机号必须是中国大陆手机号（11 位，以 1 开头）"
  - ❌ "手机号必须有效"（术语不具体）
  
- [ ] **异常处理明确**: 异常类型、错误消息、触发条件
  - ✅ "手机号已注册 → 返回 409，提示'该手机号已注册'"
  - ❌ "手机号已注册 → 返回错误"（错误消息不明确）
  
- [ ] **无二义性**: 规则有唯一解释、可测试、可验证
  - ✅ "密码包含字母、数字、特殊字符中的至少 2 种"
  - ❌ "密码包含多种字符"（"多种"有歧义）

**异常处理（E）提取**:
- [ ] 所有异常场景已识别（参数错误、业务错误、系统错误）
- [ ] 每个异常有唯一编号（E-001、E-002...）
- [ ] 每个异常有触发条件（什么情况下触发）
- [ ] 每个异常有处理方式（返回错误码、错误消息）
- [ ] 错误消息用户友好（避免技术术语）

**验收标准完整性**:
- [ ] 验收标准包含正常场景（主流程测试）
- [ ] 验收标准包含边界条件（边界值测试）
- [ ] 验收标准包含异常情况（异常场景测试）
- [ ] 验收标准可测试（具体、可验证、可重复）
- [ ] 验收标准无技术术语（关注业务而非技术）

**验收标准示例**:
```markdown
✅ 正确示例:
- [ ] 正常场景: 输入有效手机号、符合强度的密码、正确的验证码，系统成功创建账号
- [ ] 边界条件: 输入 8 位密码（最短长度），系统正常处理
- [ ] 异常情况: 输入已注册的手机号，系统返回 409 错误并提示"该手机号已注册"

❌ 错误示例:
- [ ] 用户注册功能正常工作（不可测试）
- [ ] 数据库插入成功（技术术语）
- [ ] 密码验证通过（缺少具体条件）
```

**确认项（待澄清项）识别**:
- [ ] 所有模糊点已标记为确认项（`[NEEDS CLARIFICATION]`）
- [ ] 每个确认项有优先级（P0 阻塞性、P1 重要、P2 优化）
- [ ] 确认项描述清晰（明确澄清什么问题）
- [ ] 确认项不涉及技术实现（关注业务逻辑）

**确认项优先级判断标准**:
- **P0（阻塞性）**: 不澄清无法继续后续设计（如认证方式、数据存储位置）
- **P1（重要）**: 影响功能实现但有默认方案（如验证码倒计时）
- **P2（优化）**: 锦上添花的功能（如用户协议勾选）

### 2.3 非功能需求（NFR）提取

**NFR 提取完整性**:
- [ ] 性能要求已定义（响应时间、并发处理、吞吐量）
- [ ] 安全要求已定义（认证、授权、加密、防护）
- [ ] 可用性要求已定义（可用性百分比、降级策略）
- [ ] 易用性要求已定义（用户体验、操作流程）

**性能要求量化**:
- [ ] 响应时间有具体数值（如 <= 500ms）
- [ ] 并发处理有具体数值（如 >= 100 QPS）
- [ ] 性能指标有统计位数（如 P95、P99）

**安全要求明确**:
- [ ] 密码存储方式已定义（加密算法、成本因子）
- [ ] 防护措施已定义（防暴力破解、防刷）
- [ ] 数据脱敏已定义（敏感字段不返回）

**可用性要求量化**:
- [ ] 可用性百分比已定义（如 >= 99.9%）
- [ ] 降级策略已定义（如短信服务异常时的处理）

**易用性要求具体**:
- [ ] 用户体验要求已定义（如实时验证、自动聚焦）
- [ ] 错误提示要求已定义（如友好提示、避免技术术语）

### 2.4 常见错误检查

**错误 1: 功能描述涉及技术实现**
- [ ] ❌ "使用 MySQL 存储用户信息"（这是设计）
- [ ] ✅ "系统能够持久化存储用户信息"（这是需求）

**错误 2: 验收标准不可测试**
- [ ] ❌ "用户注册功能正常工作"（不可测试）
- [ ] ✅ "输入有效邮箱和密码，系统成功创建账号"（可测试）

**错误 3: 业务规则模糊**
- [ ] ❌ "密码强度适中"（模糊）
- [ ] ✅ "密码长度 8-20 位，包含字母、数字、特殊字符中的至少 2 种"（清晰）

**错误 4: 异常处理不明确**
- [ ] ❌ "手机号已注册 → 返回错误"（错误消息不明确）
- [ ] ✅ "手机号已注册 → 返回 409，提示'该手机号已注册，请直接登录'"（明确）

**错误 5: 未识别待澄清项**
- [ ] 需求中存在模糊点，但未标记为确认项
- [ ] 示例: "注册成功后自动登录"（未澄清登录方式是 JWT 还是 Session）

---

## 步骤 3: 澄清循环 - 质量检查

### 3.1 澄清触发条件验证

- [ ] 存在 `[NEEDS CLARIFICATION]` 标记 → 触发澄清循环
- [ ] 待澄清项已按优先级排序（P0 > P1 > P2）
- [ ] 待澄清项数量统计正确

### 3.2 澄清提问质量

**提问模板规范**:
- [ ] 每个澄清问题有清晰的问题描述
- [ ] 每个澄清问题有 2-4 个互斥选项（a/b/c/d）
- [ ] 每个选项有说明和影响（帮助用户理解）
- [ ] 提问使用封闭式问题（选择题）而非开放式问题

**提问模板示例**:
```markdown
✅ 正确示例:
📋 澄清问题 1/9: 登录凭证类型（P0 - 阻塞性）

**问题描述**: 注册成功后自动登录，系统生成什么类型的登录凭证？

选项:
a) JWT Token（无状态，适合分布式系统）
b) Session（有状态，适合单体应用）
c) 混合方案（Access Token + Refresh Token）

请选择（a/b/c）或提供其他建议。

❌ 错误示例:
"登录凭证是什么类型？"（开放式问题，无选项）
```

**澄清顺序规范**:
- [ ] P0 问题优先澄清（阻塞性）
- [ ] P1 问题其次澄清（重要）
- [ ] P2 问题最后澄清（优化）
- [ ] 澄清问题编号连续（1/9、2/9、3/9...）

### 3.3 决议记录规范

**决议更新格式**:
- [ ] 原有确认项内容保留（不删除 `[NEEDS CLARIFICATION]` 标记）
- [ ] 追加 `[CLARIFIED]` 标记
- [ ] 追加决议内容（用户选择的方案）
- [ ] 追加理由（为什么选择这个方案）
- [ ] 追加验收标准（如何验证这个决议）

**决议记录示例**:
```markdown
✅ 正确示例:
- [NEEDS CLARIFICATION] (P0) 登录凭证是 JWT Token 还是 Session？
- [CLARIFIED] (P0) 登录凭证是 JWT Token 还是 Session？
  - **决议**: JWT Token（无状态）
  - **理由**: 适合分布式系统，无需 Redis 存储 Session
  - **验收标准**: 
    - [ ] 注册成功后，响应返回 JWT Token（格式: `Bearer <token>`）
    - [ ] Token 包含用户 ID、手机号、签发时间、过期时间

❌ 错误示例:
（删除 [NEEDS CLARIFICATION] 标记，导致历史信息丢失）
- [CLARIFIED] (P0) 登录凭证是 JWT Token
  - **决议**: JWT Token
```

### 3.4 迭代澄清处理

**新增确认项处理**:
- [ ] 决议可能引发新的澄清项（如选择"支持优惠券"后，需澄清"优惠券使用规则"）
- [ ] 新增确认项追加到对应 FR（不创建新的 FR）
- [ ] 新增确认项有优先级标记（P0/P1/P2）
- [ ] 新增确认项纳入澄清循环（继续澄清）

**迭代澄清示例**:
```markdown
**原始确认项**:
- [NEEDS CLARIFICATION] (P0) 是否支持优惠券？

**用户决议**: 支持优惠券

**新增确认项**（由决议引发）:
- [NEEDS CLARIFICATION] (P0) 优惠券的使用规则是什么？（单次使用/多次使用）
- [NEEDS CLARIFICATION] (P1) 优惠券的叠加规则是什么？（可叠加/不可叠加）
```

### 3.5 保护性规则验证

**原有内容保护**:
- [ ] ❌ 不删除既有确认项原有内容
- [ ] ✅ 只能追加决议、理由、验收标准
- [ ] ✅ 保留 `[NEEDS CLARIFICATION]` 标记（追加 `[CLARIFIED]`）

**同步更新验证**:
- [ ] 决议同步更新到 requirement-review.md（如存在）
- [ ] 决议同步更新到 clarifications.md（如存在）
- [ ] 决议同步更新到当前需求分析（临时文档）

### 3.6 澄清完成条件

- [ ] 所有 P0 确认项已澄清（`[CLARIFIED]` 标记）
- [ ] 所有 P1 确认项已澄清（`[CLARIFIED]` 标记）
- [ ] P2 确认项已澄清或用户确认"可跳过"
- [ ] 用户确认"无待澄清项"

### 3.7 常见错误检查

**错误 1: 使用开放式问题**
- [ ] ❌ "密码强度要求是什么？"（开放式）
- [ ] ✅ 选项: a) 弱（6-8 位）  b) 中（8-12 位）  c) 强（12+ 位）

**错误 2: 删除既有确认项内容**
- [ ] ❌ 删除 `[NEEDS CLARIFICATION]` 标记
- [ ] ✅ 保留原有内容，追加 `[CLARIFIED]` 标记

**错误 3: 决议未记录理由**
- [ ] ❌ 只记录决议，未说明"为什么选择这个方案"
- [ ] ✅ 决议 + 理由 + 验收标准

**错误 4: 新增确认项未纳入澄清循环**
- [ ] ❌ 新增确认项后，未继续澄清
- [ ] ✅ 新增确认项纳入澄清循环，继续澄清

---

## 步骤 4: 补充信息收集 - 质量检查

### 4.1 主动询问时机

- [ ] 所有确认项已处理完成（P0/P1/P2 全部澄清）
- [ ] 澄清循环已结束（无待澄清项）
- [ ] 主动询问用户是否有补充信息

### 4.2 主动询问内容

**询问模板**:
```markdown
✅ 待澄清项已处理。请确认:

1. 是否还有其他功能需求？
2. 是否有其他非功能性需求？
3. 是否有其他业务规则或异常场景？

无补充请回复"无补充"。
```

### 4.3 补充信息处理

**如果用户有补充**:
- [ ] 补充信息追加到对应的 FR（如果是功能需求）
- [ ] 补充信息追加到 NFR（如果是非功能需求）
- [ ] 补充信息追加到业务规则（BR）或异常处理（E）
- [ ] 优先原地修改现有文档（requirement-review.md，如存在）

**如果用户无补充**:
- [ ] 用户回复"无补充"
- [ ] 继续下一步（生成最终文档）

### 4.4 常见错误检查

**错误 1: 未主动询问补充信息**
- [ ] ❌ 澄清循环结束后，直接生成文档
- [ ] ✅ 主动询问用户是否有补充信息

**错误 2: 补充信息覆盖原有内容**
- [ ] ❌ 补充信息覆盖原有 FR 内容
- [ ] ✅ 补充信息追加到现有 FR

---

## 步骤 5: 生成最终文档 - 质量检查

### 5.1 前置条件验证（⚠️ 关键）

**必须全部满足才输出文档**:
- [ ] ✅ 用户确认"无待澄清项"
- [ ] ✅ 用户确认"无补充信息"
- [ ] ✅ 用户回复"确认生成"
- [ ] ✅ 提供了有效变更 ID

**如果任一条件不满足**:
- [ ] 不生成文档
- [ ] 提示用户缺少哪个条件

### 5.2 文档结构完整性

**YAML Frontmatter 完整性**:
- [ ] change_id 字段正确（与用户提供的变更 ID 一致）
- [ ] stage 字段为 `requirements`
- [ ] document_type 字段为 `requirements_specification`
- [ ] version 字段正确（初始版本为 1.0）
- [ ] created_at、updated_at 字段为 ISO 8601 格式
- [ ] author 字段已填写（用户名）
- [ ] status 字段为 `final`

**文档章节完整性**:
- [ ] 1. 概述（需求来源、变更 ID、变更范围）
- [ ] 2. 业务目标（业务背景、用户价值、业务目标、成功指标）
- [ ] 3. 功能性需求（FR）（所有 FR，包含确认项状态）
- [ ] 4. 非功能性需求（NFR）（性能、安全、可用性、易用性）
- [ ] 5. 验收标准总览（功能验收清单、非功能验收清单）
- [ ] 6. 附录（变更历史、参考文档）

**功能性需求（FR）章节完整性**:
- [ ] 所有 FR 已包含（FR-001、FR-002、FR-003...）
- [ ] 每个 FR 有功能描述、用户场景、输入/输出、业务规则、异常处理、验收标准
- [ ] 每个 FR 的确认项状态已更新（`[CLARIFIED]` 标记 + 决议 + 理由 + 验收标准）
- [ ] 确认项按优先级排序（P0 > P1 > P2）

**非功能性需求（NFR）章节完整性**:
- [ ] NFR-001: 性能要求（响应时间、并发处理、吞吐量）
- [ ] NFR-002: 安全要求（认证、授权、加密、防护）
- [ ] NFR-003: 可用性要求（可用性百分比、降级策略）
- [ ] NFR-004: 易用性要求（用户体验、操作流程）

**验收标准总览章节完整性**:
- [ ] 功能验收清单（列出所有 FR 及其测试场景数量）
- [ ] 非功能验收清单（列出所有 NFR 及其验证方法）

**附录章节完整性**:
- [ ] 变更历史表格（版本、日期、作者、变更内容）
- [ ] 参考文档列表（PRD 链接、TAPD 链接、其他参考文档）

### 5.3 Markdown 格式规范

**标题层级正确**:
- [ ] 文档标题为 `# 需求规格说明书`（H1 级别）
- [ ] 章节标题为 `## 1. 概述`（H2 级别）
- [ ] 子章节标题为 `### FR-001: 手机号注册`（H3 级别）
- [ ] 无标题层级跳跃（H1 → H2 → H3，不能 H1 → H3）

**列表格式正确**:
- [ ] 有序列表使用数字编号（1. 2. 3.）
- [ ] 无序列表使用 `-` 符号
- [ ] 任务列表使用 `- [ ]` 格式

**代码块格式正确**:
- [ ] 代码块使用 ` ``` ` 包裹
- [ ] 代码块有语言标识（如 `markdown`、`yaml`）

**表格格式正确**:
- [ ] 表格有表头行
- [ ] 表格有分隔符行（`|------|------|`）
- [ ] 表格列对齐正确

### 5.4 内容准确性验证

**FR 内容准确性**:
- [ ] FR 编号连续无遗漏（FR-001、FR-002、FR-003...）
- [ ] FR 描述与需求来源一致（无遗漏、无错误）
- [ ] 确认项决议准确（与用户澄清结果一致）

**NFR 内容准确性**:
- [ ] NFR 描述合理（基于需求来源和 FR）
- [ ] NFR 指标量化（有具体数值）

**验收标准准确性**:
- [ ] 验收标准覆盖所有 FR（无遗漏）
- [ ] 验收标准可测试（具体、可验证）

### 5.5 输出路径规范

**输出路径正确**:
- [ ] 输出路径为 `workspace/{变更ID}/requirements/requirements.md`
- [ ] 变更 ID 与 YAML Frontmatter 一致
- [ ] 目录不存在时自动创建（`mkdir -p`）

**文件覆盖处理**:
- [ ] 如果文件已存在，提示用户是否覆盖
- [ ] 覆盖前备份原文件（如适用）

### 5.6 常见错误检查

**错误 1: 未经用户确认就生成文档**
- [ ] ❌ 用户未回复"确认生成"，AI 直接生成文档
- [ ] ✅ 必须等待用户明确回复"确认生成"

**错误 2: 未提供变更 ID 就生成文档**
- [ ] ❌ 用户未提供变更 ID，AI 生成文档
- [ ] ✅ 检查变更 ID 是否提供，未提供则只分析不生成文档

**错误 3: 文档章节不完整**
- [ ] ❌ 缺少业务目标、NFR、验收标准等章节
- [ ] ✅ 文档包含所有 6 个章节

**错误 4: 确认项状态未更新**
- [ ] ❌ 确认项仍为 `[NEEDS CLARIFICATION]`（未更新为 `[CLARIFIED]`）
- [ ] ✅ 所有确认项已更新为 `[CLARIFIED]` 并包含决议

**错误 5: 输出路径错误**
- [ ] ❌ 输出到项目根目录或其他位置
- [ ] ✅ 输出到 `workspace/{变更ID}/requirements/requirements.md`

---

## 最终验证清单

### 功能验证

- [ ] 需求来源已成功读取
- [ ] 所有功能点（FR）已提取
- [ ] 所有业务规则（BR）已识别
- [ ] 所有异常场景（E）已识别
- [ ] 所有待澄清项已处理
- [ ] 用户确认无补充信息

### 质量验证

- [ ] 业务目标清晰（有背景、价值、目标、指标）
- [ ] 功能描述聚焦业务（不涉及技术实现）
- [ ] 验收标准可测试（具体、可验证）
- [ ] 业务规则清晰准确（模态动词、量化指标、无二义性）
- [ ] 确认项决议完整（决议 + 理由 + 验收标准）
- [ ] 文档结构完整（6 个章节）

### 输出验证

- [ ] 文档路径正确（`workspace/{变更ID}/requirements/requirements.md`）
- [ ] YAML Frontmatter 正确（change_id、stage、version、status）
- [ ] Markdown 格式正确（标题层级、列表、表格）
- [ ] 内容无遗漏（所有 FR、NFR、验收标准）

### 规范验证

- [ ] 遵循 [项目宪章](mdc:.spec-code/memory/constitution.md) 的核心原则
- [ ] 遵循 [开发指南](mdc:.spec-code/memory/guidelines.md) 的需求编写规范
- [ ] 遵循 [文档生成规则](mdc:.codebuddy/spec/global/standards/common/document-generation-rules.md)
- [ ] 遵循 [输出目录规范](mdc:.codebuddy/spec/global/standards/common/output-directory-standard.md)

---

## 示例检查场景

### 场景 1: 用户注册功能（完整流程）

**验证要点**:
1. ✅ 需求来源已读取（PRD 文本）
2. ✅ 变更 ID 格式正确（`2025-11-04-user-registration`）
3. ✅ 提取了 3 个 FR（FR-001、FR-002、FR-003）
4. ✅ 识别了 9 个待澄清项（P0: 2、P1: 4、P2: 3）
5. ✅ 澄清循环完成（9/9 已澄清）
6. ✅ 用户确认"无补充信息"
7. ✅ 用户确认"确认生成"
8. ✅ 文档已生成到 `workspace/2025-11-04-user-registration/requirements/requirements.md`

### 场景 2: 订单支付功能（迭代澄清）

**验证要点**:
1. ✅ 第 1 轮澄清: 用户选择"支持优惠券和积分"
2. ✅ 识别新增确认项: "优惠券和积分的使用顺序"（P0）
3. ✅ 第 2 轮澄清: 用户选择"先扣优惠券再扣积分"
4. ✅ 决议已记录到 FR-001 确认项
5. ✅ 原有内容未删除（保留 `[NEEDS CLARIFICATION]`）

### 场景 3: 无变更 ID 的场景（只分析不生成文档）

**验证要点**:
1. ✅ 用户未提供变更 ID
2. ✅ AI 只进行需求分析（提取 FR、BR、E）
3. ✅ AI 不生成文档（不创建 requirements.md）
4. ✅ AI 提示用户"如需生成正式文档，请提供变更 ID"

### 场景 4: TAPD 需求解读

**验证要点**:
1. ✅ 用户提供 TAPD 链接（https://tapd.xxx/story/detail/123456）
2. ✅ AI 使用 `mcp_call_tool` 或 `web_fetch` 读取 TAPD 需求
3. ✅ 需求内容已成功读取（无权限错误、无网络错误）
4. ✅ 后续流程与示例 1 相同

---

## 常见问题排查

### 问题 1: 未提供变更 ID 就生成文档

**检查点**:
- [ ] 用户是否提供了变更 ID？
- [ ] 如果未提供，AI 是否只进行分析（不生成文档）？
- [ ] AI 是否提示用户"未提供变更 ID，仅分析不生成文档"？

### 问题 2: 澄清问题使用开放式问题

**检查点**:
- [ ] AI 是否使用了封闭式问题（选择题）？
- [ ] 每个选项是否有说明和影响？
- [ ] 是否避免了开放式问题（如"密码强度要求是什么？"）？

### 问题 3: 删除既有确认项内容

**检查点**:
- [ ] 原有 `[NEEDS CLARIFICATION]` 标记是否保留？
- [ ] 是否追加 `[CLARIFIED]` 标记？
- [ ] 是否追加决议、理由、验收标准？

### 问题 4: 验收标准不可测试

**检查点**:
- [ ] 验收标准是否具体（有明确的输入、输出、预期结果）？
- [ ] 验收标准是否可验证（可以编写测试用例）？
- [ ] 验收标准是否避免了技术术语（如"数据库插入成功"）？

### 问题 5: 业务规则模糊

**检查点**:
- [ ] 业务规则是否使用了模态动词（必须/应当/可以）？
- [ ] 业务规则是否有量化指标（精确数字、时间、百分比）？
- [ ] 业务规则是否无二义性（唯一解释、可测试）？

---

## AI 执行检查清单

在完成需求解读任务后，请确认以下所有项：

- [ ] ✅ 需求来源已成功读取（无权限错误、无网络错误）
- [ ] ✅ 变更 ID 已验证（格式正确，或未提供则只分析）
- [ ] ✅ 所有功能点（FR）已提取（无遗漏）
- [ ] ✅ 所有业务规则（BR）清晰准确（模态动词、量化指标、无二义性）
- [ ] ✅ 所有验收标准可测试（具体、可验证、无技术术语）
- [ ] ✅ 所有待澄清项已处理（P0/P1 全部澄清）
- [ ] ✅ 澄清问题使用封闭式问题（选择题，2-4 个选项）
- [ ] ✅ 决议已记录（决议 + 理由 + 验收标准）
- [ ] ✅ 原有内容未删除（保留 `[NEEDS CLARIFICATION]`，追加 `[CLARIFIED]`）
- [ ] ✅ 用户确认"无待澄清项"和"无补充信息"
- [ ] ✅ 用户确认"确认生成"（或未提供变更 ID 则不生成文档）
- [ ] ✅ 文档已生成到正确路径（`workspace/{变更ID}/requirements/requirements.md`）
- [ ] ✅ 文档结构完整（6 个章节，YAML Frontmatter 正确）
- [ ] ✅ Markdown 格式正确（标题层级、列表、表格）
- [ ] ✅ 遵循项目规范（宪章、开发指南、文档生成规则、输出目录规范）
