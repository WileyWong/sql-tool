# 项目文档索引生成 - 验证清单

本清单用于验证 `doc-index` skill 的输出质量，确保文档索引生成符合最佳实践和项目规范。

---

## 📋 前置条件检查

在开始生成文档索引前，确认以下条件已满足：

- [ ] 项目文档已基本完成（至少有 5 个以上文档）
- [ ] 文档使用 Markdown 格式（`.md` 文件）
- [ ] 文档包含 YAML Frontmatter 元数据（推荐，可选）
- [ ] 了解项目的文档组织结构（docs/、spec/ 等）
- [ ] 已确定输出路径（遵循输出目录规范）
- [ ] Python 3.x 已安装（用于运行扫描脚本）

---

## 步骤 1: 扫描项目文档 - 质量检查

### 【必须】文档存储位置识别完整性

- [ ] **标准文档目录识别**：
  - [ ] 已扫描 `docs/` 目录
  - [ ] 已扫描 `spec/` 目录
  - [ ] 已扫描 `.spec-code/memory/` 目录（项目记忆）
  - [ ] 已扫描 `skills/` 目录（Skill 技能文档）
  - [ ] 已扫描根目录的 Markdown 文件（README.md、CHANGELOG.md 等）

- [ ] **文档目录扫描策略**：
  - [ ] 递归扫描所有子目录
  - [ ] 排除非文档目录（.git、node_modules、.venv、__pycache__、dist、build 等）
  - [ ] 排除隐藏目录（以 `.` 开头，除了 `.spec-code`）

### 【必须】Markdown 文件扫描完整性

- [ ] **文件类型识别**：
  - [ ] 只扫描 `.md` 文件
  - [ ] 忽略其他文件类型（`.txt`、`.docx`、`.pdf` 等）

- [ ] **文件数量统计准确**：
  - [ ] 统计的文件数量与实际文件数量一致
  - [ ] 排除的文件数量已记录（可选）

### 【必须】YAML Frontmatter 元数据提取

- [ ] **元数据提取完整性**：
  - [ ] **title** 字段已提取（文档标题）
  - [ ] **description** 字段已提取（文档描述）
  - [ ] **category** 字段已提取（文档类型）
  - [ ] **tags** 字段已提取（文档标签，数组）
  - [ ] **priority** 字段已提取（优先级：P0/P1/P2）
  - [ ] **created_at** 字段已提取（创建时间）
  - [ ] **updated_at** 字段已提取（更新时间）

- [ ] **元数据回退机制**（如果 YAML Frontmatter 缺失）：
  - [ ] 使用文件名作为标题（去除扩展名和路径）
  - [ ] 使用第一个 `# 标题` 作为标题（如果存在）
  - [ ] 分类为 "uncategorized"
  - [ ] 优先级默认为 "P2"
  - [ ] 标签为空数组
  - [ ] 创建/更新时间从文件系统获取（可选）

### 【必须】文档基本信息记录

- [ ] **文档路径记录准确**：
  - [ ] 使用相对路径（相对于项目根目录）
  - [ ] 路径分隔符统一（使用 `/`，而非 `\`）

- [ ] **文档标题提取准确**：
  - [ ] 优先使用 YAML Frontmatter 的 `title` 字段
  - [ ] 回退使用第一个 `# 标题`
  - [ ] 最后回退使用文件名

- [ ] **文档描述提取准确**：
  - [ ] 使用 YAML Frontmatter 的 `description` 字段
  - [ ] 如果缺失，描述为空字符串

### 常见错误检查

- [ ] ❌ 错误1：未排除 `.git` 目录，导致扫描到 Git 内部文件
  - ✅ 解决：在排除列表中添加 `.git` 目录

- [ ] ❌ 错误2：未处理 YAML Frontmatter 格式错误，导致脚本崩溃
  - ✅ 解决：添加异常处理，YAML 解析失败时使用回退机制

- [ ] ❌ 错误3：文档路径使用绝对路径，导致索引文件不可移植
  - ✅ 解决：统一使用相对路径（相对于项目根目录）

---

## 步骤 2: 文档分类和分组 - 质量检查

### 【必须】按文档类型分类完整性

- [ ] **文档类型分类规则应用正确**：
  - [ ] **Requirements (需求文档)**: 包含"需求"、"requirement"、"PRD"、"spec" 等关键词
  - [ ] **Design (设计文档)**: 包含"设计"、"design"、"architecture"、"架构" 等关键词
  - [ ] **API (API 文档)**: 包含"API"、"interface"、"接口" 等关键词
  - [ ] **Tutorial (教程文档)**: 包含"教程"、"tutorial"、"guide"、"指南" 等关键词
  - [ ] **Reference (参考文档)**: 包含"参考"、"reference"、"standard"、"规范" 等关键词
  - [ ] **Uncategorized (未分类)**: 不符合上述任何规则的文档

- [ ] **分类关键词匹配准确**：
  - [ ] 关键词匹配不区分大小写
  - [ ] 关键词匹配支持中英文
  - [ ] 关键词匹配检查路径、文件名、YAML Frontmatter 的 `category` 字段

- [ ] **分类优先级处理正确**：
  - [ ] YAML Frontmatter 的 `category` 字段优先级最高
  - [ ] 路径匹配优先级其次（如 `docs/api/` → API）
  - [ ] 文件名匹配优先级最低

### 【必须】按优先级分类完整性

- [ ] **优先级分类规则应用正确**：
  - [ ] **P0 (核心文档 - 必读)**: README、CHANGELOG、constitution、guidelines、核心架构文档
  - [ ] **P1 (重要文档 - 推荐阅读)**: architecture、design、api、spec 等
  - [ ] **P2 (补充文档 - 可选阅读)**: tutorial、example、reference 等

- [ ] **优先级判断准确**：
  - [ ] YAML Frontmatter 的 `priority` 字段优先级最高
  - [ ] 文件名匹配优先级其次（如 `README.md` → P0）
  - [ ] 分类匹配优先级最低（如 Design → P1）

- [ ] **优先级分布合理**：
  - [ ] P0 文档数量占比 10%-20%（核心文档不宜过多）
  - [ ] P1 文档数量占比 30%-50%（重要文档为主）
  - [ ] P2 文档数量占比 30%-60%（补充文档）

### 【必须】按模块分类完整性（可选）

- [ ] **模块分类规则应用正确**：
  - [ ] **Frontend (前端模块)**: 包含 "frontend"、"web"、"ui" 等关键词
  - [ ] **Backend (后端模块)**: 包含 "backend"、"server"、"api" 等关键词
  - [ ] **Database (数据库模块)**: 包含 "database"、"db"、"sql" 等关键词
  - [ ] **Deployment (部署模块)**: 包含 "deployment"、"deploy"、"docker"、"kubernetes" 等关键词
  - [ ] **Documentation (文档模块)**: 包含 "documentation"、"docs"、"readme" 等关键词
  - [ ] **Uncategorized (未分类模块)**: 不符合上述任何规则的文档

- [ ] **模块分类关键词匹配准确**：
  - [ ] 关键词匹配不区分大小写
  - [ ] 关键词匹配检查路径、文件名、YAML Frontmatter

### 常见错误检查

- [ ] ❌ 错误1：分类关键词过于宽泛，导致大量文档被错误分类
  - ✅ 解决：使用精确且多样化的关键词，避免过于宽泛的匹配（如 "doc" 匹配到所有文档）

- [ ] ❌ 错误2：优先级判断不准确，核心文档被标记为 P2
  - ✅ 解决：检查优先级分类规则，确保核心文档（README、CHANGELOG 等）被标记为 P0

- [ ] ❌ 错误3：模块分类不准确，API 文档被分类到前端模块
  - ✅ 解决：调整模块分类规则的优先级，API 文档优先分类到后端模块

---

## 步骤 3: 生成文档索引 - 质量检查

### 【必须】索引文件结构完整性

- [ ] **YAML Frontmatter 完整性**：
  - [ ] `title` 字段已定义（索引标题）
  - [ ] `description` 字段已定义（索引描述）
  - [ ] `generated_at` 字段已定义（生成时间，格式：YYYY-MM-DD HH:MM:SS）
  - [ ] `total_documents` 字段已定义（文档总数）
  - [ ] `categories` 字段已定义（分类列表，数组）
  - [ ] `priorities` 字段已定义（优先级列表，数组）

- [ ] **索引章节完整性**：
  - [ ] **目录章节**（Table of Contents）：
    - [ ] 包含所有主要章节的锚点链接
    - [ ] 链接格式正确（`#章节名称`）
  - [ ] **快速导航章节**（Quick Navigation）：
    - [ ] 核心文档列表（6-10 个核心文档）
    - [ ] 新人推荐阅读路径（3-5 个步骤）
  - [ ] **按类型分类章节**（Classification by Type）：
    - [ ] 每个分类有独立的小节
    - [ ] 每个小节包含表格（文档名称、路径、优先级、更新时间、说明）
  - [ ] **按优先级分类章节**（Classification by Priority）：
    - [ ] P0、P1、P2 三级优先级
    - [ ] 每个优先级有独立的小节
    - [ ] 每个小节包含表格
  - [ ] **按模块分类章节**（Classification by Module，可选）：
    - [ ] 每个模块有独立的小节
    - [ ] 每个小节包含文档列表
  - [ ] **文档统计章节**（Statistics）：
    - [ ] 分类统计表格（分类、数量、占比）
    - [ ] 优先级统计表格（优先级、数量、占比）
    - [ ] 模块统计表格（模块、数量、占比，可选）
  - [ ] **文档关系图章节**（Document Relationship Diagram）：
    - [ ] Mermaid 图表（graph TD 类型）
    - [ ] 显示分类和优先级的层级关系
  - [ ] **完整文档列表章节**（Complete Document List）：
    - [ ] 表格格式（序号、文档名称、类型、优先级、路径、更新时间）
    - [ ] 按优先级排序（P0 > P1 > P2）
  - [ ] **最近更新章节**（Recent Updates）：
    - [ ] 表格格式（文档名称、类型、优先级、更新时间、变更说明）
    - [ ] 按更新时间倒序排列
    - [ ] 显示最近 10 个更新的文档

### 【必须】表格格式规范

- [ ] **表格对齐**：
  - [ ] 表头使用 `|` 分隔
  - [ ] 对齐行使用 `|------|---------|` 格式
  - [ ] 数据行使用 `|` 分隔

- [ ] **表格内容完整**：
  - [ ] 文档名称使用 Markdown 链接格式（`[名称](路径)`）
  - [ ] 路径使用代码格式（`` `路径` ``）
  - [ ] 更新时间格式统一（YYYY-MM-DD）
  - [ ] 优先级使用标准格式（P0/P1/P2）

### 【必须】Markdown 格式规范

- [ ] **标题层级正确**：
  - [ ] 文档标题使用 `#`（一级标题）
  - [ ] 主要章节使用 `##`（二级标题）
  - [ ] 子章节使用 `###`（三级标题）
  - [ ] 层级不超过 4 级

- [ ] **锚点链接正确**：
  - [ ] 目录中的锚点链接格式正确（`#章节名称`）
  - [ ] 锚点名称与章节标题一致
  - [ ] 特殊字符处理正确（空格转 `-`，emoji 保留）

- [ ] **代码块格式正确**：
  - [ ] Mermaid 图表使用 ` ```mermaid ` 代码块
  - [ ] 代码块正确关闭（` ``` `）

- [ ] **列表格式正确**：
  - [ ] 无序列表使用 `-` 或 `*`
  - [ ] 有序列表使用 `1.`、`2.`、`3.` 等
  - [ ] 嵌套列表缩进正确（2 或 4 个空格）

### 【必须】内容准确性验证

- [ ] **文档数量准确**：
  - [ ] 索引文件中的文档总数与实际扫描到的文档数量一致
  - [ ] 各分类的文档数量之和等于文档总数
  - [ ] 各优先级的文档数量之和等于文档总数

- [ ] **文档链接有效**：
  - [ ] 所有文档链接都指向实际存在的文件
  - [ ] 链接路径使用相对路径（相对于索引文件）
  - [ ] 链接路径分隔符统一（使用 `/`）

- [ ] **统计数据准确**：
  - [ ] 分类统计的数量与实际文档数量一致
  - [ ] 占比计算正确（保留 1 位小数）
  - [ ] 占比之和等于 100%

### 【必须】Mermaid 图表验证

- [ ] **图表语法正确**：
  - [ ] 使用 `graph TD` 类型（从上到下的流程图）
  - [ ] 节点定义正确（`A["文本"]`）
  - [ ] 连接定义正确（`A --> B`）

- [ ] **图表内容完整**：
  - [ ] 根节点显示项目名称和文档总数
  - [ ] 分类节点显示分类名称和文档数量
  - [ ] 优先级节点显示优先级和文档数量
  - [ ] 所有节点之间的连接关系正确

- [ ] **图表可渲染**：
  - [ ] 在 Markdown 预览工具中可正常渲染
  - [ ] 节点文本无乱码（正确处理中文、emoji）

### 常见错误检查

- [ ] ❌ 错误1：索引文件包含大量重复内容（相同的文档出现在多个章节）
  - ✅ 解决：每个文档在每个章节中只出现一次

- [ ] ❌ 错误2：表格格式错误，导致无法正确渲染
  - ✅ 解决：检查表格的分隔符、对齐行、数据行是否正确

- [ ] ❌ 错误3：Mermaid 图表语法错误，无法渲染
  - ✅ 解决：检查节点定义、连接定义是否正确，确保节点 ID 唯一

- [ ] ❌ 错误4：文档链接失效（相对路径不正确）
  - ✅ 解决：统一使用相对于项目根目录的相对路径

- [ ] ❌ 错误5：缺少"最近更新"章节
  - ✅ 解决：添加"最近更新"章节，显示最近 10 个更新的文档

---

## 步骤 4: 生成导航和统计 - 质量检查

### 【必须】快速导航完整性

- [ ] **核心文档列表**：
  - [ ] 包含 6-10 个核心文档
  - [ ] 核心文档包含：README.md、CHANGELOG.md、系统架构、数据库设计、快速开始、编码规范等
  - [ ] 每个文档包含：名称、路径、更新时间、说明

- [ ] **新人推荐阅读路径**：
  - [ ] 包含 3-5 个步骤
  - [ ] 步骤顺序合理（从概述到入门到进阶）
  - [ ] 每个步骤包含：文档链接、阅读目的

### 【必须】文档统计完整性

- [ ] **分类统计**：
  - [ ] 表格格式（分类、数量、占比）
  - [ ] 包含所有分类（Requirements、Design、API、Tutorial、Reference、Uncategorized）
  - [ ] 占比计算正确（保留 1 位小数）
  - [ ] 占比之和等于 100%

- [ ] **优先级统计**：
  - [ ] 表格格式（优先级、数量、占比）
  - [ ] 包含所有优先级（P0、P1、P2）
  - [ ] 占比计算正确
  - [ ] 占比之和等于 100%

- [ ] **模块统计**（可选）：
  - [ ] 表格格式（模块、数量、占比）
  - [ ] 包含所有模块
  - [ ] 占比计算正确
  - [ ] 占比之和等于 100%

### 【必须】最近更新章节

- [ ] **更新列表完整**：
  - [ ] 显示最近 10 个更新的文档
  - [ ] 按更新时间倒序排列（最新的在前）
  - [ ] 每个文档包含：名称、类型、优先级、更新时间、变更说明

- [ ] **变更说明提取**：
  - [ ] 从文档的提交历史提取变更说明（可选）
  - [ ] 或使用 YAML Frontmatter 的 `changelog` 字段（可选）
  - [ ] 如果无法提取，变更说明为空

### 【必须】输出路径规范

- [ ] **索引文件命名规范**：
  - [ ] 使用 `DOCUMENTATION-INDEX.md` 作为文件名（推荐）
  - [ ] 或使用 `DOC-INDEX.md`（简化）
  - [ ] 或使用 `INDEX.md`（最简）

- [ ] **索引文件位置**：
  - [ ] 放置在项目根目录
  - [ ] 或放置在 `docs/` 目录（如果有）

- [ ] **索引文件权限**：
  - [ ] 文件可读
  - [ ] 文件可写（用于自动更新）

### 常见错误检查

- [ ] ❌ 错误1：核心文档列表包含不重要的文档
  - ✅ 解决：只包含真正核心的文档（P0 优先级）

- [ ] ❌ 错误2：统计数据不准确（占比之和不等于 100%）
  - ✅ 解决：重新计算占比，确保精度正确

- [ ] ❌ 错误3：最近更新章节缺失
  - ✅ 解决：添加最近更新章节，显示最新的文档变更

- [ ] ❌ 错误4：索引文件放置位置不规范
  - ✅ 解决：统一放置在项目根目录或 `docs/` 目录

---

## 最终验证清单

### 功能完整性验证

- [ ] 所有文档已扫描（文档数量准确）
- [ ] 所有分类已应用（Requirements、Design、API、Tutorial、Reference、Uncategorized）
- [ ] 所有优先级已应用（P0、P1、P2）
- [ ] 索引文件已生成（DOCUMENTATION-INDEX.md）
- [ ] Mermaid 图表可正常渲染

### 质量标准验证

- [ ] 索引结构清晰（有目录、分类、统计）
- [ ] 元数据完整（YAML Frontmatter 包含所有必需字段）
- [ ] 链接有效（所有文档链接可点击）
- [ ] 统计信息准确（文档数量、占比正确）
- [ ] 格式规范（Markdown 格式正确）

### 可用性验证

- [ ] 快速导航清晰（核心文档在前）
- [ ] 多维度分类完整（类型、模块、优先级）
- [ ] 新人推荐阅读路径合理（3-5 个步骤）
- [ ] 最近更新章节准确（显示最新的 10 个文档）

---

## 示例检查场景

### 场景 1: 电商系统项目（完整流程）

**验证要点**:
1. 扫描到所有文档（45 个）
2. 分类准确（6 个分类：Requirements、Design、API、Tutorial、Reference、Uncategorized）
3. 优先级准确（P0: 8 个、P1: 18 个、P2: 19 个）
4. 索引章节完整（8 个章节）
5. Mermaid 图表可渲染
6. 快速导航包含核心文档（6 个）
7. 统计数据准确（占比之和等于 100%）

### 场景 2: 小型项目（简化索引）

**验证要点**:
1. 索引文件简洁（不包含复杂的统计和图表）
2. 分类准确（3 个分类：Design、API、Tutorial）
3. 核心文档突出（README.md、docs/architecture.md 等）
4. 表格格式正确

### 场景 3: 只生成特定类型的索引（API 文档）

**验证要点**:
1. 只包含 API 文档（8 个）
2. 索引文件命名为 `API-DOCUMENTATION-INDEX.md`
3. 分类准确（按模块分类：用户模块、商品模块、订单模块等）
4. 优先级准确（P0: 3 个、P1: 3 个、P2: 2 个）

### 场景 4: 自动化更新配置

**验证要点**:
1. Git Hook 配置正确（`.git/hooks/pre-commit`）
2. GitHub Actions 配置正确（`.github/workflows/update-doc-index.yml`）
3. 自动化脚本可正常运行
4. 每次提交文档时自动更新索引

### 场景 5: 错误处理（缺少元数据）

**验证要点**:
1. 识别缺少元数据的文档（15 个）
2. 使用回退机制（文件名作为标题、分类为 Uncategorized、优先级为 P2）
3. 在索引文件中标注缺少元数据的文档（⚠️ 符号）
4. 提示用户添加元数据

---

## 常见问题排查

### 问题 1: 扫描不到某些文档

**检查点**:
1. 确认文档目录在扫描范围内（docs/、spec/ 等）
2. 确认文档文件扩展名为 `.md`
3. 确认文档目录未被排除（不在 .git、node_modules 等排除列表中）

### 问题 2: 分类不准确（API 文档被分类为 Design）

**检查点**:
1. 检查分类关键词匹配规则（优先级：YAML Frontmatter > 路径 > 文件名）
2. 检查文档的 YAML Frontmatter 是否包含 `category` 字段
3. 调整分类规则，增加更精确的关键词

### 问题 3: Mermaid 图表无法渲染

**检查点**:
1. 检查 Mermaid 语法是否正确（节点定义、连接定义）
2. 检查节点 ID 是否唯一
3. 检查节点文本是否包含特殊字符（需要转义）

### 问题 4: 统计数据不准确（占比之和不等于 100%）

**检查点**:
1. 检查占比计算公式（数量 / 总数 * 100）
2. 检查占比保留的小数位数（推荐 1 位）
3. 检查是否有四舍五入误差

### 问题 5: 文档链接失效（相对路径不正确）

**检查点**:
1. 确认使用相对路径（相对于项目根目录）
2. 确认路径分隔符统一（使用 `/`）
3. 确认文档文件确实存在

---

## AI 执行检查清单

执行 `doc-index` skill 前，AI 应确认以下事项：

1. [ ] 已确认项目文档目录（docs/、spec/ 等）
2. [ ] 已确认扫描范围和排除规则
3. [ ] 已确认输出路径（项目根目录或 docs/ 目录）
4. [ ] 已确认索引文件命名（DOCUMENTATION-INDEX.md）
5. [ ] 已准备 Python 扫描脚本（或使用内置扫描功能）
6. [ ] 已确认 Mermaid 图表渲染支持
7. [ ] 已确认元数据提取和回退机制
8. [ ] 已确认分类规则和优先级规则
9. [ ] 已确认统计数据计算方法
10. [ ] 已确认快速导航和新人推荐阅读路径
11. [ ] 已确认最近更新章节
12. [ ] 已确认自动化更新配置（可选）
13. [ ] 已确认错误处理和提示机制
14. [ ] 已确认索引文件格式（Markdown + YAML Frontmatter）
15. [ ] 已确认所有表格和列表格式正确

---

**检查清单版本**: v2.1.0  
**更新时间**: 2025-11-10  
**适用技能**: doc-index (v2.1.0+)
