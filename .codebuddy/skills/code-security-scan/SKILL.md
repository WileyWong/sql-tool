---
name: code-security-scan
description: ä»£ç å®‰å…¨æ¼æ´æ‰«æå·¥å…·ï¼Œè‡ªåŠ¨æ£€æµ‹SQLæ³¨å…¥ã€XSSã€æ•æ„Ÿä¿¡æ¯æ³„éœ²ã€ä¸å®‰å…¨åŠ å¯†ç­‰å®‰å…¨é£é™©ï¼Œæä¾›è¯¦ç»†çš„é£é™©è¯„çº§å’Œä¿®å¤å»ºè®®ã€‚é€‚ç”¨äºä»£ç å®¡æŸ¥ã€å®‰å…¨è¯„ä¼°ã€ä¸Šçº¿å‰æ£€æŸ¥ç­‰åœºæ™¯ã€‚
category: security
tech_stack: [java, spring-boot, mybatis, security]
keywords: [å®‰å…¨æ‰«æ, æ¼æ´æ£€æµ‹, SQLæ³¨å…¥, XSS, æ•æ„Ÿä¿¡æ¯, ä»£ç å®¡æŸ¥]
priority: high
version: 1.0.0
author: Spec-Code Teamï¼ˆäººåŠ›èµ„æºå¹³å°éƒ¨/ä¸šåŠ¡ç ”å‘ä¸­å¿ƒ/æ‹›æ´»ç ”å‘äº¤ä»˜ç»„ï¼‰
created_at: 2025-12-08
updated_at: 2025-12-08
license: éµå¾ªé¡¹ç›®è®¸å¯è¯
---

# ä»£ç å®‰å…¨æ¼æ´æ‰«æ

è‡ªåŠ¨æ‰«æ Java ä»£ç ä¸­çš„å®‰å…¨æ¼æ´ï¼ŒåŒ…æ‹¬ SQL æ³¨å…¥ã€XSSã€æ•æ„Ÿä¿¡æ¯æ³„éœ²ã€ä¸å®‰å…¨åŠ å¯†ç­‰å¸¸è§å®‰å…¨é—®é¢˜ï¼Œæä¾›è¯¦ç»†çš„é£é™©è¯„çº§å’Œä¿®å¤å»ºè®®ã€‚

> ğŸ“š **é¡¹ç›®è®°å¿†å¼•ç”¨**
> - éµå¾ª [é¡¹ç›®å®ªç« ](mdc:.spec-code/memory/constitution.md) çš„æ ¸å¿ƒåŸåˆ™å’Œè´¨é‡æ ‡å‡†
> - å‚è€ƒ [å¼€å‘æŒ‡å—](mdc:.spec-code/memory/guidelines.md) çš„ Skill ç¼–å†™è§„èŒƒ
> - äº†è§£ [é¡¹ç›®ä¸Šä¸‹æ–‡](mdc:.spec-code/memory/context.md) çš„æŠ€æœ¯æ ˆå’Œé¡¹ç›®ç»“æ„

> âš ï¸ **æ–‡æ¡£ç”Ÿæˆè§„åˆ™**: 
> - âŒ ç¦æ­¢ä¸»åŠ¨ç”Ÿæˆæ€»ç»“æ–‡æ¡£ã€åˆ†ææŠ¥å‘Š
> - âœ… åªåœ¨ç”¨æˆ·æ˜ç¡®è¦æ±‚æ—¶ç”Ÿæˆæ–‡æ¡£
> - âœ… ä¼˜å…ˆåŸåœ°ä¿®æ”¹ç°æœ‰æ–‡æ¡£

> ğŸ“ **è¾“å‡ºç›®å½•è§„èŒƒ**:
> - è¾“å‡ºè·¯å¾„: `workspace/{å˜æ›´ID}/security/scan-{æ—¶é—´æˆ³}.md`
> - ä¸´æ—¶æ–‡ä»¶: `workspace/{å˜æ›´ID}/security/.scan-cache/`

## ğŸ¯ æ‰«æèƒ½åŠ›

æœ¬æŠ€èƒ½æä¾› **8 å¤§ç»´åº¦** çš„å®‰å…¨æ¼æ´æ£€æµ‹ï¼š

### 1. SQL æ³¨å…¥æ£€æµ‹
- âœ… å­—ç¬¦ä¸²æ‹¼æ¥ SQLï¼ˆé«˜å±ï¼‰
- âœ… MyBatis ${} åŠ¨æ€ SQLï¼ˆé«˜å±ï¼‰
- âœ… æœªä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢ï¼ˆä¸­å±ï¼‰
- âœ… JDBC æ‹¼æ¥æŸ¥è¯¢ï¼ˆé«˜å±ï¼‰

### 2. XSS è·¨ç«™è„šæœ¬æ”»å‡»
- âœ… æœªè½¬ä¹‰çš„ç”¨æˆ·è¾“å…¥è¾“å‡ºåˆ°é¡µé¢ï¼ˆé«˜å±ï¼‰
- âœ… å¯Œæ–‡æœ¬æœªè¿‡æ»¤ï¼ˆä¸­å±ï¼‰
- âœ… JSON å“åº”æœªè®¾ç½® Content-Typeï¼ˆä½å±ï¼‰
- âœ… innerHTML/dangerouslySetInnerHTML ç›´æ¥ä½¿ç”¨ï¼ˆé«˜å±ï¼‰

### 3. æ•æ„Ÿä¿¡æ¯æ³„éœ²
- âœ… æ—¥å¿—ä¸­æ‰“å°å¯†ç /Tokenï¼ˆé«˜å±ï¼‰
- âœ… å“åº”ä¸­è¿”å›æ•æ„Ÿå­—æ®µï¼ˆä¸­å±ï¼‰
- âœ… å¼‚å¸¸å †æ ˆæš´éœ²ç»™å‰ç«¯ï¼ˆä¸­å±ï¼‰
- âœ… æ³¨é‡Šä¸­åŒ…å«å¯†ç /å¯†é’¥ï¼ˆé«˜å±ï¼‰

### 4. ä¸å®‰å…¨çš„åŠ å¯†ç®—æ³•
- âœ… ä½¿ç”¨ MD5/SHA1 åŠ å¯†å¯†ç ï¼ˆé«˜å±ï¼‰
- âœ… ä½¿ç”¨ DES/3DES å¯¹ç§°åŠ å¯†ï¼ˆé«˜å±ï¼‰
- âœ… ä½¿ç”¨ ECB æ¨¡å¼ï¼ˆä¸­å±ï¼‰
- âœ… ç¡¬ç¼–ç çš„å¯†é’¥/ç›å€¼ï¼ˆé«˜å±ï¼‰

### 5. æƒé™ä¸è®¿é—®æ§åˆ¶
- âœ… ç¼ºå°‘æƒé™æ³¨è§£ï¼ˆ@PreAuthorize/@Securedï¼‰ï¼ˆé«˜å±ï¼‰
- âœ… å‚ç›´è¶Šæƒé£é™©ï¼ˆæœªæ£€æŸ¥æ‰€æœ‰è€…ï¼‰ï¼ˆé«˜å±ï¼‰
- âœ… æ°´å¹³è¶Šæƒé£é™©ï¼ˆæœªéªŒè¯ç”¨æˆ·IDï¼‰ï¼ˆé«˜å±ï¼‰
- âœ… ç›´æ¥æš´éœ²ç®¡ç†æ¥å£ï¼ˆä¸­å±ï¼‰

### 6. æ–‡ä»¶æ“ä½œå®‰å…¨
- âœ… è·¯å¾„éå†æ¼æ´ï¼ˆ../ï¼‰ï¼ˆé«˜å±ï¼‰
- âœ… æ–‡ä»¶ä¸Šä¼ æœªæ ¡éªŒç±»å‹ï¼ˆé«˜å±ï¼‰
- âœ… æ–‡ä»¶ä¸Šä¼ æœªé™åˆ¶å¤§å°ï¼ˆä¸­å±ï¼‰
- âœ… ä»»æ„æ–‡ä»¶è¯»å–/ä¸‹è½½ï¼ˆé«˜å±ï¼‰

### 7. ååºåˆ—åŒ–æ¼æ´
- âœ… ä¸å¯ä¿¡æ•°æ®ååºåˆ—åŒ–ï¼ˆé«˜å±ï¼‰
- âœ… ä½¿ç”¨ ObjectInputStreamï¼ˆä¸­å±ï¼‰
- âœ… Fastjson/Jackson ä¸å®‰å…¨é…ç½®ï¼ˆé«˜å±ï¼‰

### 8. é…ç½®ä¸ä¾èµ–å®‰å…¨
- âœ… ä½¿ç”¨å·²çŸ¥æ¼æ´çš„ä¾èµ–ç‰ˆæœ¬ï¼ˆé«˜å±ï¼‰
- âœ… Debug æ¨¡å¼å¼€å¯ï¼ˆä¸­å±ï¼‰
- âœ… æ•æ„Ÿé…ç½®æœªåŠ å¯†ï¼ˆä¸­å±ï¼‰
- âœ… CORS é…ç½®è¿‡äºå®½æ¾ï¼ˆä¸­å±ï¼‰

## ğŸ“‹ æ‰«ææµç¨‹

### æ­¥éª¤ 1: æ‰«æèŒƒå›´ç¡®å®š

**ç›®æ ‡**: ç¡®å®šéœ€è¦æ‰«æçš„ä»£ç èŒƒå›´

**æ“ä½œ**:
```bash
# æ‰«æå•ä¸ªæ–‡ä»¶
ä½¿ç”¨: read_file è¯»å–ç›®æ ‡ Java æ–‡ä»¶

# æ‰«ææ•´ä¸ªæ¨¡å—
ä½¿ç”¨: list_files åˆ—å‡ºç›®å½•ä¸‹æ‰€æœ‰ .java æ–‡ä»¶
ä½¿ç”¨: search_content æœç´¢å…³é”®å®‰å…¨æ¨¡å¼

# æ‰«ææ•´ä¸ªé¡¹ç›®
é€’å½’æ‰«ææ‰€æœ‰ Java æ–‡ä»¶
```

**æ‰«æä¼˜å…ˆçº§**:
1. **é«˜ä¼˜å…ˆçº§**: Controllerã€Serviceã€Repository å±‚
2. **ä¸­ä¼˜å…ˆçº§**: Utilsã€Helperã€Manager ç±»
3. **ä½ä¼˜å…ˆçº§**: DTOã€VOã€Entity ç±»

### æ­¥éª¤ 2: å®‰å…¨æ¨¡å¼åŒ¹é…

**ç›®æ ‡**: ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼å’Œä»£ç æ¨¡å¼è¯†åˆ«æ½œåœ¨å®‰å…¨é—®é¢˜

**æ£€æµ‹è§„åˆ™**:

#### ğŸ”´ é«˜å±æ¼æ´æ£€æµ‹è§„åˆ™

**SQL æ³¨å…¥æ£€æµ‹**:
```java
// âŒ å±é™©æ¨¡å¼ 1: å­—ç¬¦ä¸²æ‹¼æ¥ SQL
String sql = "SELECT * FROM users WHERE id = " + userId;
String sql = "SELECT * FROM users WHERE name = '" + userName + "'";

// âŒ å±é™©æ¨¡å¼ 2: MyBatis ${} åŠ¨æ€ SQL
@Select("SELECT * FROM users WHERE id = ${userId}")

// âŒ å±é™©æ¨¡å¼ 3: JDBC Statement æ‹¼æ¥
Statement stmt = conn.createStatement();
stmt.executeQuery("SELECT * FROM users WHERE id = " + id);

// âœ… å®‰å…¨æ¨¡å¼: å‚æ•°åŒ–æŸ¥è¯¢
@Select("SELECT * FROM users WHERE id = #{userId}")
PreparedStatement pstmt = conn.prepareStatement("SELECT * FROM users WHERE id = ?");
```

**æ£€æµ‹æ–¹æ³•**:
- æ­£åˆ™åŒ¹é…: `\".*SELECT.*\\+.*\"|\".*WHERE.*\\+.*\"`
- AST åˆ†æ: æ£€æµ‹ SQL å­—ç¬¦ä¸²æ‹¼æ¥
- MyBatis XML: æœç´¢ `${` è¯­æ³•

**XSS æ£€æµ‹**:
```java
// âŒ å±é™©æ¨¡å¼ 1: æœªè½¬ä¹‰çš„ç”¨æˆ·è¾“å…¥
return "<div>" + userInput + "</div>";
model.addAttribute("content", userInput); // å‰ç«¯æœªè½¬ä¹‰

// âŒ å±é™©æ¨¡å¼ 2: innerHTML ç›´æ¥è®¾ç½®
element.innerHTML = userInput;

// âœ… å®‰å…¨æ¨¡å¼: è½¬ä¹‰å¤„ç†
return HtmlUtils.htmlEscape(userInput);
return StringEscapeUtils.escapeHtml4(userInput);
```

**æ•æ„Ÿä¿¡æ¯æ³„éœ²æ£€æµ‹**:
```java
// âŒ å±é™©æ¨¡å¼ 1: æ—¥å¿—æ‰“å°æ•æ„Ÿä¿¡æ¯
log.info("ç”¨æˆ·ç™»å½•: {}", user); // User å¯¹è±¡åŒ…å«å¯†ç å­—æ®µ
log.debug("å¯†ç : {}", password);
log.info("Token: {}", token);

// âŒ å±é™©æ¨¡å¼ 2: å“åº”è¿”å›æ•æ„Ÿå­—æ®µ
return userRepository.findById(id); // ç›´æ¥è¿”å› Entityï¼ŒåŒ…å«å¯†ç 

// âŒ å±é™©æ¨¡å¼ 3: å¼‚å¸¸å †æ ˆæš´éœ²
catch (Exception e) {
    return ResponseEntity.status(500).body(e.getMessage());
}

// âŒ å±é™©æ¨¡å¼ 4: æ³¨é‡Šä¸­çš„æ•æ„Ÿä¿¡æ¯
// æµ‹è¯•å¯†ç : admin123
// APIå¯†é’¥: sk_test_abc123xyz

// âœ… å®‰å…¨æ¨¡å¼: è„±æ•å¤„ç†
log.info("ç”¨æˆ·ç™»å½•: {}", user.desensitize());
return userConverter.toDTO(user); // DTO ä¸åŒ…å«æ•æ„Ÿå­—æ®µ
```

**æ£€æµ‹æ–¹æ³•**:
- å…³é”®å­—æœç´¢: `password|pwd|token|secret|key|apiKey`
- æ—¥å¿—æ¨¡å¼: `log\.(info|debug|warn).*password|token`
- æ³¨é‡Šæ‰«æ: æ£€æµ‹æ³¨é‡Šä¸­çš„æ•æ„Ÿè¯

**ä¸å®‰å…¨åŠ å¯†ç®—æ³•æ£€æµ‹**:
```java
// âŒ å±é™©æ¨¡å¼ 1: MD5/SHA1 åŠ å¯†å¯†ç 
MessageDigest.getInstance("MD5");
MessageDigest.getInstance("SHA-1");
DigestUtils.md5Hex(password);

// âŒ å±é™©æ¨¡å¼ 2: DES/3DES åŠ å¯†
Cipher.getInstance("DES");
Cipher.getInstance("DESede");

// âŒ å±é™©æ¨¡å¼ 3: ECB æ¨¡å¼
Cipher.getInstance("AES/ECB/PKCS5Padding");

// âŒ å±é™©æ¨¡å¼ 4: ç¡¬ç¼–ç å¯†é’¥
String key = "1234567890abcdef";
byte[] salt = {1, 2, 3, 4, 5, 6, 7, 8};

// âœ… å®‰å…¨æ¨¡å¼: BCrypt/Argon2
BCryptPasswordEncoder encoder = new BCryptPasswordEncoder();
String hashedPassword = encoder.encode(password);

// âœ… å®‰å…¨æ¨¡å¼: AES-GCM
Cipher.getInstance("AES/GCM/NoPadding");
```

**æƒé™æ§åˆ¶æ£€æµ‹**:
```java
// âŒ å±é™©æ¨¡å¼ 1: ç¼ºå°‘æƒé™æ³¨è§£
@PostMapping("/api/admin/users")
public Result deleteUser(@PathVariable Long id) { // ç¼ºå°‘ @PreAuthorize

// âŒ å±é™©æ¨¡å¼ 2: å‚ç›´è¶Šæƒé£é™©
public Result updateOrder(Long orderId, OrderDTO dto) {
    // æœªæ£€æŸ¥è®¢å•æ˜¯å¦å±äºå½“å‰ç”¨æˆ·
    orderRepository.updateById(orderId, dto);
}

// âŒ å±é™©æ¨¡å¼ 3: æ°´å¹³è¶Šæƒé£é™©
public Result getUserInfo(Long userId) {
    // æœªéªŒè¯ userId æ˜¯å¦ä¸ºå½“å‰ç™»å½•ç”¨æˆ·
    return userService.getById(userId);
}

// âœ… å®‰å…¨æ¨¡å¼: æƒé™æ³¨è§£
@PreAuthorize("hasRole('ADMIN')")
@PostMapping("/api/admin/users")

// âœ… å®‰å…¨æ¨¡å¼: æ‰€æœ‰è€…æ£€æŸ¥
Order order = orderRepository.findById(orderId);
if (!order.getUserId().equals(currentUserId)) {
    throw new ForbiddenException("æ— æƒæ“ä½œæ­¤è®¢å•");
}
```

**æ–‡ä»¶æ“ä½œå®‰å…¨æ£€æµ‹**:
```java
// âŒ å±é™©æ¨¡å¼ 1: è·¯å¾„éå†
String path = "/uploads/" + filename; // filename å¯èƒ½æ˜¯ "../../../etc/passwd"
File file = new File(path);

// âŒ å±é™©æ¨¡å¼ 2: æœªæ ¡éªŒæ–‡ä»¶ç±»å‹
@PostMapping("/upload")
public Result upload(MultipartFile file) {
    file.transferTo(new File("/uploads/" + file.getOriginalFilename()));
}

// âŒ å±é™©æ¨¡å¼ 3: ä»»æ„æ–‡ä»¶è¯»å–
@GetMapping("/download")
public void download(String filename, HttpServletResponse response) {
    FileInputStream fis = new FileInputStream("/files/" + filename);
}

// âœ… å®‰å…¨æ¨¡å¼: è·¯å¾„è§„èŒƒåŒ–
String safePath = Paths.get("/uploads", filename).normalize().toString();
if (!safePath.startsWith("/uploads/")) {
    throw new SecurityException("éæ³•è·¯å¾„");
}

// âœ… å®‰å…¨æ¨¡å¼: æ–‡ä»¶ç±»å‹æ ¡éªŒ
String[] allowedTypes = {".jpg", ".png", ".pdf"};
String ext = FilenameUtils.getExtension(file.getOriginalFilename());
if (!Arrays.asList(allowedTypes).contains("." + ext)) {
    throw new BadRequestException("ä¸æ”¯æŒçš„æ–‡ä»¶ç±»å‹");
}
```

#### ğŸŸ¡ ä¸­å±æ¼æ´æ£€æµ‹è§„åˆ™

**é…ç½®å®‰å…¨æ£€æµ‹**:
```java
// âŒ å±é™©æ¨¡å¼ 1: Debug æ¨¡å¼å¼€å¯
debug: true  # application.yml

// âŒ å±é™©æ¨¡å¼ 2: æ•æ„Ÿé…ç½®æ˜æ–‡
spring.datasource.password=123456
redis.password=redis123

// âŒ å±é™©æ¨¡å¼ 3: CORS è¿‡äºå®½æ¾
@CrossOrigin(origins = "*")
registry.addMapping("/**").allowedOrigins("*");

// âœ… å®‰å…¨æ¨¡å¼: ä½¿ç”¨é…ç½®åŠ å¯†
spring.datasource.password=${JASYPT_ENCRYPTOR_PASSWORD}

// âœ… å®‰å…¨æ¨¡å¼: CORS é™åˆ¶åŸŸå
@CrossOrigin(origins = "https://example.com")
```

### æ­¥éª¤ 3: æ¼æ´åˆ†æä¸è¯„çº§

**ç›®æ ‡**: å¯¹æ£€æµ‹åˆ°çš„é—®é¢˜è¿›è¡Œåˆ†æå’Œé£é™©è¯„çº§

**é£é™©ç­‰çº§å®šä¹‰**:

| ç­‰çº§ | ç¬¦å· | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|------|
| ğŸ”´ **ä¸¥é‡** | Critical | å¯ç›´æ¥å¯¼è‡´ç³»ç»Ÿè¢«æ”»å‡»ï¼Œå¿…é¡»ç«‹å³ä¿®å¤ | SQL æ³¨å…¥ã€ä»»æ„æ–‡ä»¶è¯»å– |
| ğŸŸ  **é«˜å±** | High | å­˜åœ¨è¾ƒå¤§å®‰å…¨é£é™©ï¼Œåº”å°½å¿«ä¿®å¤ | XSSã€æ•æ„Ÿä¿¡æ¯æ³„éœ²ã€æƒé™ç¼ºå¤± |
| ğŸŸ¡ **ä¸­å±** | Medium | å­˜åœ¨å®‰å…¨éšæ‚£ï¼Œå»ºè®®ä¿®å¤ | ä¸å®‰å…¨çš„åŠ å¯†ã€é…ç½®é—®é¢˜ |
| ğŸŸ¢ **ä½å±** | Low | æœ€ä½³å®è·µå»ºè®®ï¼Œå¯é€‰ä¿®å¤ | æ—¥å¿—çº§åˆ«ã€æ³¨é‡Šè§„èŒƒ |

**é£é™©è¯„ä¼°çŸ©é˜µ**:
```
å½±å“ç¨‹åº¦ Ã— åˆ©ç”¨éš¾åº¦ = é£é™©ç­‰çº§

å½±å“ç¨‹åº¦:
- ä¸¥é‡: æ•°æ®æ³„éœ²ã€ç³»ç»Ÿæ§åˆ¶ã€æ‹’ç»æœåŠ¡
- é«˜: ç”¨æˆ·æ•°æ®æ³„éœ²ã€æƒé™ç»•è¿‡
- ä¸­: ä¿¡æ¯æ³„éœ²ã€é…ç½®ä¸å½“
- ä½: æœ€ä½³å®è·µè¿å

åˆ©ç”¨éš¾åº¦:
- å®¹æ˜“: æ— éœ€ç‰¹æ®ŠæŠ€èƒ½ï¼Œå¯ç›´æ¥åˆ©ç”¨
- ä¸­ç­‰: éœ€è¦ä¸€å®šæŠ€æœ¯çŸ¥è¯†
- å›°éš¾: éœ€è¦ç‰¹å®šæ¡ä»¶æˆ–é«˜çº§æŠ€èƒ½
```

**æ¼æ´è¯¦æƒ…åˆ†æ**:
```markdown
### æ¼æ´è¯¦æƒ…

#### ğŸ”´ SQL-001: SQL æ³¨å…¥æ¼æ´

**æ–‡ä»¶**: `src/main/java/com/example/user/UserService.java`  
**è¡Œå·**: 45-47  
**é£é™©ç­‰çº§**: ğŸ”´ ä¸¥é‡ (Critical)

**é—®é¢˜ä»£ç **:
```java
45: String sql = "SELECT * FROM users WHERE username = '" + username + "'";
46: List<User> users = jdbcTemplate.query(sql, new UserRowMapper());
47: return users.isEmpty() ? null : users.get(0);
```

**é£é™©æè¿°**:
ä½¿ç”¨å­—ç¬¦ä¸²æ‹¼æ¥æ„é€  SQL æŸ¥è¯¢ï¼Œæ”»å‡»è€…å¯é€šè¿‡æ„é€ ç‰¹æ®Šè¾“å…¥ï¼ˆå¦‚ `admin' OR '1'='1`ï¼‰ç»•è¿‡è®¤è¯æˆ–çªƒå–æ•°æ®ã€‚

**å½±å“èŒƒå›´**:
- æ•°æ®æ³„éœ²: å¯æŸ¥è¯¢ä»»æ„ç”¨æˆ·æ•°æ®
- è®¤è¯ç»•è¿‡: å¯ä»¥ä»»æ„ç”¨æˆ·èº«ä»½ç™»å½•
- æ•°æ®ç¯¡æ”¹: å¯èƒ½æ‰§è¡Œ UPDATE/DELETE æ“ä½œ

**æ”»å‡»ç¤ºä¾‹**:
```
è¾“å…¥: username = "admin' OR '1'='1"
ç”ŸæˆSQL: SELECT * FROM users WHERE username = 'admin' OR '1'='1'
ç»“æœ: è¿”å›æ‰€æœ‰ç”¨æˆ·ï¼Œç»•è¿‡èº«ä»½éªŒè¯
```

**ä¿®å¤å»ºè®®**:
```java
// âœ… æ¨èæ–¹æ¡ˆ 1: ä½¿ç”¨ PreparedStatement
String sql = "SELECT * FROM users WHERE username = ?";
List<User> users = jdbcTemplate.query(sql, new UserRowMapper(), username);

// âœ… æ¨èæ–¹æ¡ˆ 2: ä½¿ç”¨ MyBatis å‚æ•°åŒ–æŸ¥è¯¢
@Select("SELECT * FROM users WHERE username = #{username}")
User findByUsername(@Param("username") String username);

// âœ… æ¨èæ–¹æ¡ˆ 3: ä½¿ç”¨ JPA/Hibernate
@Query("SELECT u FROM User u WHERE u.username = :username")
User findByUsername(@Param("username") String username);
```

**å‚è€ƒèµ„æ–™**:
- [OWASP SQL Injection](https://owasp.org/www-community/attacks/SQL_Injection)
- [CWE-89: SQL Injection](https://cwe.mitre.org/data/definitions/89.html)
```

### æ­¥éª¤ 4: ç”Ÿæˆæ‰«ææŠ¥å‘Š

**ç›®æ ‡**: ç”Ÿæˆç»“æ„åŒ–çš„å®‰å…¨æ‰«ææŠ¥å‘Š

**æŠ¥å‘Šç»“æ„**:
```markdown
# ä»£ç å®‰å…¨æ‰«ææŠ¥å‘Š

**æ‰«ææ—¶é—´**: 2025-12-08 14:30:25  
**æ‰«æèŒƒå›´**: src/main/java/com/example/  
**æ‰«ææ–‡ä»¶æ•°**: 156  
**æ£€æµ‹è§„åˆ™æ•°**: 35

---

## ğŸ“Š æ‰«ææ‘˜è¦

### é£é™©ç»Ÿè®¡

| é£é™©ç­‰çº§ | æ•°é‡ | å æ¯” |
|---------|------|------|
| ğŸ”´ ä¸¥é‡ | 3 | 15% |
| ğŸŸ  é«˜å± | 8 | 40% |
| ğŸŸ¡ ä¸­å± | 7 | 35% |
| ğŸŸ¢ ä½å± | 2 | 10% |
| **æ€»è®¡** | **20** | **100%** |

### é—®é¢˜åˆ†ç±»

| ç±»åˆ« | æ•°é‡ | æœ€é«˜é£é™© |
|------|------|---------|
| SQL æ³¨å…¥ | 3 | ğŸ”´ ä¸¥é‡ |
| XSS è·¨ç«™è„šæœ¬ | 2 | ğŸŸ  é«˜å± |
| æ•æ„Ÿä¿¡æ¯æ³„éœ² | 5 | ğŸŸ  é«˜å± |
| ä¸å®‰å…¨çš„åŠ å¯† | 4 | ğŸŸ  é«˜å± |
| æƒé™æ§åˆ¶ç¼ºå¤± | 3 | ğŸŸ  é«˜å± |
| æ–‡ä»¶æ“ä½œä¸å®‰å…¨ | 1 | ğŸ”´ ä¸¥é‡ |
| é…ç½®å®‰å…¨é—®é¢˜ | 2 | ğŸŸ¡ ä¸­å± |

---

## ğŸ”´ ä¸¥é‡é£é™© (Critical)

### SQL-001: SQL æ³¨å…¥æ¼æ´
[è¯¦ç»†å†…å®¹å¦‚ä¸Š]

### FILE-001: è·¯å¾„éå†æ¼æ´
[è¯¦ç»†å†…å®¹]

---

## ğŸŸ  é«˜å±é£é™© (High)

### XSS-001: æœªè½¬ä¹‰çš„ç”¨æˆ·è¾“å…¥
[è¯¦ç»†å†…å®¹]

### AUTH-001: ç¼ºå°‘æƒé™æ§åˆ¶
[è¯¦ç»†å†…å®¹]

---

## ğŸŸ¡ ä¸­å±é£é™© (Medium)

### CONFIG-001: Debug æ¨¡å¼å¼€å¯
[è¯¦ç»†å†…å®¹]

---

## ğŸŸ¢ ä½å±é£é™© (Low)

---

## âœ… ä¿®å¤ä¼˜å…ˆçº§å»ºè®®

### ç¬¬ä¸€ä¼˜å…ˆçº§ (ç«‹å³ä¿®å¤)
- [ ] SQL-001: SQL æ³¨å…¥æ¼æ´ (UserService.java:45)
- [ ] SQL-002: SQL æ³¨å…¥æ¼æ´ (OrderService.java:78)
- [ ] FILE-001: è·¯å¾„éå†æ¼æ´ (FileController.java:32)

### ç¬¬äºŒä¼˜å…ˆçº§ (æœ¬å‘¨å†…ä¿®å¤)
- [ ] XSS-001: æœªè½¬ä¹‰çš„ç”¨æˆ·è¾“å…¥ (UserController.java:56)
- [ ] AUTH-001: ç¼ºå°‘æƒé™æ§åˆ¶ (AdminController.java:23)
- [ ] LEAK-001: æ—¥å¿—æ‰“å°å¯†ç  (AuthService.java:89)

### ç¬¬ä¸‰ä¼˜å…ˆçº§ (ä¸‹ä¸ªè¿­ä»£ä¿®å¤)
- [ ] CRYPTO-001: ä½¿ç”¨ MD5 åŠ å¯† (PasswordUtils.java:12)
- [ ] CONFIG-001: Debug æ¨¡å¼å¼€å¯ (application.yml:5)

---

## ğŸ“ˆ å®‰å…¨è¶‹åŠ¿åˆ†æ

### å†å²å¯¹æ¯”
- æœ¬æ¬¡æ‰«æ: 20 ä¸ªé—®é¢˜
- ä¸Šæ¬¡æ‰«æ: 25 ä¸ªé—®é¢˜
- æ”¹å–„: â†“ 5 ä¸ª (20%)

### é«˜é¢‘é—®é¢˜
1. æ•æ„Ÿä¿¡æ¯æ³„éœ² (5 æ¬¡)
2. ä¸å®‰å…¨çš„åŠ å¯† (4 æ¬¡)
3. SQL æ³¨å…¥ (3 æ¬¡)

---

## ğŸ“š å®‰å…¨åŠ å›ºå»ºè®®

### è¾“å…¥éªŒè¯
- æ‰€æœ‰å¤–éƒ¨è¾“å…¥å¿…é¡»éªŒè¯å’Œè¿‡æ»¤
- ä½¿ç”¨ @Valid æ³¨è§£è¿›è¡Œå‚æ•°æ ¡éªŒ
- å®ç°å…¨å±€å¼‚å¸¸å¤„ç†å™¨

### è¾“å‡ºç¼–ç 
- æ‰€æœ‰è¾“å‡ºåˆ°é¡µé¢çš„å†…å®¹å¿…é¡»è½¬ä¹‰
- ä½¿ç”¨ HtmlUtils.htmlEscape() æˆ–æ¨¡æ¿å¼•æ“è‡ªåŠ¨è½¬ä¹‰
- JSON å“åº”è®¾ç½®æ­£ç¡®çš„ Content-Type

### è®¤è¯æˆæƒ
- æ‰€æœ‰ç®¡ç†æ¥å£å¿…é¡»æ·»åŠ æƒé™æ³¨è§£
- å®ç°ç»Ÿä¸€çš„æƒé™æ‹¦æˆªå™¨
- éªŒè¯æ•°æ®æ‰€æœ‰æƒï¼Œé˜²æ­¢è¶Šæƒ

### æ•æ„Ÿæ•°æ®ä¿æŠ¤
- å¯†ç ä½¿ç”¨ BCrypt/Argon2 åŠ å¯†
- æ•æ„Ÿé…ç½®ä½¿ç”¨ Jasypt åŠ å¯†
- æ—¥å¿—è„±æ•ï¼Œä¸æ‰“å°æ•æ„Ÿä¿¡æ¯
- å“åº” DTO ä¸åŒ…å«æ•æ„Ÿå­—æ®µ

### å®‰å…¨é…ç½®
- ç”Ÿäº§ç¯å¢ƒå…³é—­ Debug æ¨¡å¼
- CORS é…ç½®é™åˆ¶å…è®¸çš„åŸŸå
- å®æ–½ HTTPSï¼Œç¦ç”¨æ˜æ–‡ä¼ è¾“
- å®šæœŸæ›´æ–°ä¾èµ–ç‰ˆæœ¬ï¼Œä¿®å¤å·²çŸ¥æ¼æ´

---

**ç”Ÿæˆæ—¶é—´**: 2025-12-08 14:35:10  
**ç”Ÿæˆå·¥å…·**: code-security-scan v1.0.0
```

## ğŸ› ï¸ ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹ 1: æ‰«æå•ä¸ªæ–‡ä»¶

**ç”¨æˆ·è¾“å…¥**:
```
æ‰«æ UserService.java çš„å®‰å…¨é—®é¢˜
```

**æ‰§è¡Œæ­¥éª¤**:
1. ä½¿ç”¨ `read_file` è¯»å– `UserService.java`
2. åº”ç”¨æ‰€æœ‰ 35 æ¡å®‰å…¨æ£€æµ‹è§„åˆ™
3. è¯†åˆ«é—®é¢˜å¹¶è¯„çº§
4. ç”Ÿæˆç®€åŒ–æŠ¥å‘Šï¼ˆåªåŒ…å«è¯¥æ–‡ä»¶çš„é—®é¢˜ï¼‰

**è¾“å‡ºç¤ºä¾‹**:
```markdown
# UserService.java å®‰å…¨æ‰«æç»“æœ

**æ–‡ä»¶**: src/main/java/com/example/user/UserService.java  
**æ‰«ææ—¶é—´**: 2025-12-08 14:30:25  
**é—®é¢˜æ•°**: 3

## é—®é¢˜åˆ—è¡¨

### ğŸ”´ SQL-001: SQL æ³¨å…¥æ¼æ´ (è¡Œ 45-47)
[è¯¦ç»†å†…å®¹]

### ğŸŸ  LEAK-001: æ—¥å¿—æ‰“å°æ•æ„Ÿä¿¡æ¯ (è¡Œ 89)
[è¯¦ç»†å†…å®¹]

### ğŸŸ¡ CRYPTO-001: ä½¿ç”¨ä¸å®‰å…¨çš„åŠ å¯†ç®—æ³• (è¡Œ 123)
[è¯¦ç»†å†…å®¹]
```

### ç¤ºä¾‹ 2: æ‰«ææ•´ä¸ªæ¨¡å—

**ç”¨æˆ·è¾“å…¥**:
```
æ‰«æ user æ¨¡å—çš„å®‰å…¨é—®é¢˜
```

**æ‰§è¡Œæ­¥éª¤**:
1. ä½¿ç”¨ `list_files` åˆ—å‡º `com/example/user/` ä¸‹æ‰€æœ‰ `.java` æ–‡ä»¶
2. å¯¹æ¯ä¸ªæ–‡ä»¶åº”ç”¨å®‰å…¨æ£€æµ‹è§„åˆ™
3. æ±‡æ€»æ‰€æœ‰é—®é¢˜
4. ç”Ÿæˆå®Œæ•´æŠ¥å‘Š

### ç¤ºä¾‹ 3: æ‰«æç‰¹å®šç±»å‹çš„é—®é¢˜

**ç”¨æˆ·è¾“å…¥**:
```
æ£€æŸ¥é¡¹ç›®ä¸­æ˜¯å¦å­˜åœ¨ SQL æ³¨å…¥é£é™©
```

**æ‰§è¡Œæ­¥éª¤**:
1. ä½¿ç”¨ `search_content` æœç´¢ SQL æ³¨å…¥ç›¸å…³æ¨¡å¼
   - æ­£åˆ™: `\".*SELECT.*\\+.*\"`
   - MyBatis: `\\$\\{`
2. å¯¹åŒ¹é…çš„æ–‡ä»¶åº”ç”¨ SQL æ³¨å…¥æ£€æµ‹è§„åˆ™
3. ç”Ÿæˆ SQL æ³¨å…¥ä¸“é¡¹æŠ¥å‘Š

## ğŸ“š æ‰©å±•èµ„æº

### æ£€æµ‹è§„åˆ™åº“
å‚è€ƒ [security-rules.md](security-rules.md) è·å–å®Œæ•´çš„ 35 æ¡å®‰å…¨æ£€æµ‹è§„åˆ™

### ä¿®å¤ç¤ºä¾‹åº“
å‚è€ƒ [security-fixes.md](security-fixes.md) è·å–å¸¸è§å®‰å…¨é—®é¢˜çš„ä¿®å¤ä»£ç ç¤ºä¾‹

### å®‰å…¨ç¼–ç è§„èŒƒ
å‚è€ƒ [secure-coding-guide.md](secure-coding-guide.md) äº†è§£å®‰å…¨ç¼–ç æœ€ä½³å®è·µ

## âœ… éªŒè¯æ¸…å•

æ‰§è¡Œæ‰«æå‰åä½¿ç”¨æ­¤æ¸…å•éªŒè¯ï¼š

**æ‰«æå‰å‡†å¤‡**:
- [ ] ç¡®å®šæ‰«æèŒƒå›´ï¼ˆæ–‡ä»¶/æ¨¡å—/é¡¹ç›®ï¼‰
- [ ] ç¡®è®¤æ‰«æçš„å®‰å…¨ç±»åˆ«ï¼ˆå…¨éƒ¨/ç‰¹å®šç±»åˆ«ï¼‰
- [ ] å‡†å¤‡è¾“å‡ºç›®å½•

**æ‰«æè¿‡ç¨‹**:
- [ ] å®Œæ•´è¯»å–æ‰€æœ‰ç›®æ ‡æ–‡ä»¶
- [ ] åº”ç”¨æ‰€æœ‰ç›¸å…³æ£€æµ‹è§„åˆ™
- [ ] å‡†ç¡®è¯†åˆ«æ¼æ´ä½ç½®ï¼ˆæ–‡ä»¶åã€è¡Œå·ï¼‰
- [ ] æ­£ç¡®è¯„ä¼°é£é™©ç­‰çº§

**æŠ¥å‘Šç”Ÿæˆ**:
- [ ] ç»Ÿè®¡ä¿¡æ¯å‡†ç¡®ï¼ˆæ–‡ä»¶æ•°ã€é—®é¢˜æ•°ã€é£é™©åˆ†å¸ƒï¼‰
- [ ] é—®é¢˜åˆ†ç±»æ¸…æ™°ï¼ˆSQLæ³¨å…¥ã€XSSã€æ•æ„Ÿä¿¡æ¯ç­‰ï¼‰
- [ ] æ¯ä¸ªé—®é¢˜åŒ…å«å®Œæ•´ä¿¡æ¯ï¼ˆä»£ç ã€é£é™©ã€ä¿®å¤å»ºè®®ï¼‰
- [ ] ä¿®å¤ä¼˜å…ˆçº§åˆç†
- [ ] æä¾›å¯è¡Œçš„ä¿®å¤ä»£ç ç¤ºä¾‹

**æŠ¥å‘Šè´¨é‡**:
- [ ] æ— è¯¯æŠ¥ï¼ˆFalse Positiveï¼‰
- [ ] æ— æ¼æŠ¥ï¼ˆFalse Negativeï¼‰
- [ ] ä¿®å¤å»ºè®®å¯ç›´æ¥åº”ç”¨
- [ ] å‚è€ƒèµ„æ–™é“¾æ¥æœ‰æ•ˆ

## ğŸ”— ç›¸å…³èµ„æº

### å®‰å…¨æ ‡å‡†
- [OWASP Top 10](https://owasp.org/www-project-top-ten/)
- [CWE Top 25](https://cwe.mitre.org/top25/)
- [SANS Top 25](https://www.sans.org/top25-software-errors/)

### æ‰«æå·¥å…·
- [SpotBugs](https://spotbugs.github.io/) - Java é™æ€åˆ†æå·¥å…·
- [SonarQube](https://www.sonarqube.org/) - ä»£ç è´¨é‡å’Œå®‰å…¨å¹³å°
- [Checkmarx](https://www.checkmarx.com/) - åº”ç”¨å®‰å…¨æµ‹è¯•å·¥å…·

### å­¦ä¹ èµ„æº
- [OWASP Cheat Sheet Series](https://cheatsheetseries.owasp.org/)
- [Secure Coding Guidelines](https://wiki.sei.cmu.edu/confluence/display/java/SEI+CERT+Oracle+Coding+Standard+for+Java)

---

**ç‰ˆæœ¬**: 1.0.0  
**æ›´æ–°æ—¶é—´**: 2025-12-08
