# 风险评估矩阵

本文档定义 `code-security-scan` 技能的风险评估标准。

## 风险等级定义

| 等级 | 符号 | 说明 | 处理时限 | CVSS 范围 |
|------|------|------|---------|-----------|
| 🔴 **严重** | Critical | 可直接导致系统被攻击 | 立即修复 | 9.0-10.0 |
| 🟠 **高危** | High | 存在较大安全风险 | 24小时内 | 7.0-8.9 |
| 🟡 **中危** | Medium | 存在安全隐患 | 本周内 | 4.0-6.9 |
| 🟢 **低危** | Low | 最佳实践建议 | 下迭代 | 0.1-3.9 |

---

## 风险计算公式

```
风险等级 = 影响程度 × 利用难度 × 上下文因子
```

### 影响程度 (Impact)

| 等级 | 分值 | 说明 | 示例 |
|------|------|------|------|
| **严重** | 4 | 数据泄露、系统控制、拒绝服务 | SQL 注入导致全库泄露 |
| **高** | 3 | 用户数据泄露、权限绕过 | XSS 窃取用户 Session |
| **中** | 2 | 信息泄露、配置不当 | 错误堆栈暴露 |
| **低** | 1 | 最佳实践违反 | 日志级别不当 |

### 利用难度 (Exploitability)

| 等级 | 分值 | 说明 | 示例 |
|------|------|------|------|
| **容易** | 3 | 无需特殊技能，可直接利用 | 公开接口的 SQL 注入 |
| **中等** | 2 | 需要一定技术知识 | 需要认证的 XSS |
| **困难** | 1 | 需要特定条件或高级技能 | 复杂的反序列化链 |

### 上下文因子 (Context Factor)

| 因子 | 分值 | 说明 |
|------|------|------|
| **公开接口** | 1.5 | API/Controller 层 |
| **内部接口** | 1.0 | Service/Repository 层 |
| **工具类** | 0.8 | Utils/Helper 类 |
| **测试代码** | 0.5 | Test 类 |

### 计算示例

```
SQL 注入 (Controller 层):
  影响程度 = 4 (严重)
  利用难度 = 3 (容易)
  上下文因子 = 1.5 (公开接口)
  风险分值 = 4 × 3 × 1.5 = 18 → 🔴 严重

MD5 加密 (Utils 类):
  影响程度 = 3 (高)
  利用难度 = 2 (中等)
  上下文因子 = 0.8 (工具类)
  风险分值 = 3 × 2 × 0.8 = 4.8 → 🟡 中危
```

---

## 风险等级阈值

| 分值范围 | 风险等级 |
|---------|---------|
| ≥ 12 | 🔴 严重 |
| 6-11.9 | 🟠 高危 |
| 3-5.9 | 🟡 中危 |
| < 3 | 🟢 低危 |

---

## 漏洞类型默认评级

### 🔴 严重 (Critical)

| 漏洞类型 | 规则ID | 默认评级理由 |
|---------|--------|-------------|
| SQL 注入 | SQL-001/002/003 | 可导致数据泄露、篡改、删除 |
| 命令注入 | CMD-001 | 可执行任意系统命令 |
| 路径遍历 | FILE-001/003 | 可读取任意系统文件 |
| 动态代码执行 | GRV-001 | 可执行任意代码 |
| 不安全反序列化 | DESER-001 | 可导致远程代码执行 |

### 🟠 高危 (High)

| 漏洞类型 | 规则ID | 默认评级理由 |
|---------|--------|-------------|
| XSS 跨站脚本 | XSS-001/002 | 可窃取用户凭证 |
| 敏感信息泄露 | LEAK-001/004 | 可暴露密码、Token |
| 权限控制缺失 | AUTH-001/002/003 | 可越权访问 |
| 不安全加密 | CRYPTO-001/002/004 | 可破解密码 |
| 文件上传漏洞 | FILE-002 | 可上传恶意文件 |

### 🟡 中危 (Medium)

| 漏洞类型 | 规则ID | 默认评级理由 |
|---------|--------|-------------|
| 配置安全 | CONFIG-001/002/003 | 可能暴露系统信息 |
| ECB 模式 | CRYPTO-003 | 加密强度不足 |
| 异常堆栈暴露 | LEAK-002/003 | 可能泄露系统结构 |
| 富文本未过滤 | XSS-003 | 有限的 XSS 风险 |

### 🟢 低危 (Low)

| 漏洞类型 | 规则ID | 默认评级理由 |
|---------|--------|-------------|
| 日志级别不当 | LOG-001 | 最佳实践建议 |
| 注释规范 | COMMENT-001 | 代码质量问题 |

---

## 语言特定评级调整

### Java

| 场景 | 调整 | 理由 |
|------|------|------|
| Spring Security 已启用 | 权限类降 1 级 | 框架提供基础保护 |
| 使用 JPA/Hibernate | SQL 注入降 1 级 | ORM 提供参数化 |

### Groovy

| 场景 | 调整 | 理由 |
|------|------|------|
| Gradle 脚本 | 命令注入升 1 级 | 构建环境敏感 |
| Grails 应用 | Web 漏洞升 1 级 | 公开接口风险高 |

### Go

| 场景 | 调整 | 理由 |
|------|------|------|
| 使用 sqlx/gorm | SQL 注入降 1 级 | ORM 提供参数化 |

### TypeScript

| 场景 | 调整 | 理由 |
|------|------|------|
| React/Vue 框架 | XSS 降 1 级 | 框架自动转义 |
| 服务端渲染 | XSS 升 1 级 | 服务端风险更高 |

---

## 检查点 2 验证清单

```yaml
checkpoint_2_validation:
  风险评估:
    - [ ] 所有问题已分配风险等级
    - [ ] 风险计算公式正确应用
    - [ ] 上下文因子已考虑
    - [ ] 语言特定调整已应用
  
  报告质量:
    - [ ] 风险统计准确
    - [ ] 修复优先级合理
    - [ ] 处理时限明确
```

---

**版本**: 1.0.0  
**更新时间**: 2025-12-22
