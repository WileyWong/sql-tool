---
name: ba-05-writing-acceptance-criteria
description: 为高优先级用户故事编写详细的验收标准（Acceptance Criteria），使用 Given-When-Then 格式，覆盖正常流程、异常情况和边界条件。触发词：验收标准、AC 编写、Given-When-Then、测试标准、验收条件、BDD 场景。
---

# 验收标准生成

为每个用户故事编写清晰、完整、可测试的验收标准，确保开发团队和测试团队对"完成"有一致的理解。

## 工作流位置

```
ba-01 业务需求提取
    ↓ 输出：业务目标、顶层用例、非功能需求
ba-02 Epic 分析
    ↓ 输出：拆解策略、用户角色分析、MVP 定义
ba-03 用户故事生成
    ↓ 输出：用户故事列表
ba-04 INVEST 评估
    ↓ 输出：评估报告、优先级排序
ba-05 验收标准 ← 当前技能
```

**上游依赖**: ba-04 输出的高优先级（Must Have）用户故事

## 输入材料

```
【故事ID】US001
【故事标题】
【用户故事】作为...我希望...以便...
【功能要点】
- 
- 

【故事ID】US002
...

【业务规则（可选）】
- 

【性能要求（可选）】
- 

【安全要求（可选）】
- 
```

## 核心输出

### 验收标准文档（每个故事）

```markdown
## US001: {故事标题}

### 用户故事
> 作为 {用户角色}，
> 我希望 {功能描述}，
> 以便 {业务价值}。

---

### 验收标准

#### AC1: {标准标题 - 正常流程}

**场景描述**: {简要说明这个验收标准覆盖的场景}

**Given** {前置条件}
- {条件1}
- {条件2}

**When** {用户操作}
- {操作步骤}

**Then** {预期结果}
- {结果1}
- {结果2}
- {结果3}

---

#### AC2: {标准标题 - 异常情况}

**场景描述**: {简要说明异常场景}

**Given** {前置条件}
**When** {用户执行异常操作}
**Then** {系统异常处理}
- {错误提示}
- {系统状态}

---

### 边界条件

| 边界场景 | 输入条件 | 预期行为 |
|---------|---------|---------|
| {边界1} | {条件描述} | {预期结果} |
| {边界2} | {条件描述} | {预期结果} |

---

### 性能要求

| 性能指标 | 要求 | 测试方法 |
|---------|------|---------|
| 响应时间 | {如<3秒} | {如何测试} |
| 并发用户 | {如100并发} | {如何测试} |

---

### 界面要求

**必要元素**:
- {界面元素1}
- {界面元素2}

**交互行为**:
- {交互要求1}
- {交互要求2}

---

### 测试建议

**测试类型**: {功能测试/集成测试/E2E测试}
**测试数据**: {需要准备的测试数据}
**自动化建议**: {是否适合自动化，优先级}
```

## Given-When-Then编写指南

**Given（给定/前置条件）**
- 描述场景开始时的系统状态
- 包括用户状态、数据状态、系统配置
- 示例：客户已登录系统、购物车中有3件商品

**When（当/用户操作）**
- 描述触发行为的用户操作
- 应该是具体的操作步骤
- 示例：点击"提交订单"按钮、输入搜索关键词

**Then（那么/预期结果）**
- 描述操作后的预期结果
- 包括系统响应、状态变化、显示内容
- 示例：显示订单确认页面、库存减少3件

## 验收标准类型

| 类型 | 说明 | 示例 |
|------|------|------|
| 功能验收 | 验证功能正确性 | 订单提交后生成订单号 |
| 数据验收 | 验证数据正确性 | 订单金额=商品价格×数量+运费 |
| 界面验收 | 验证界面元素 | 显示订单详情包含商品列表 |
| 性能验收 | 验证性能指标 | 页面加载时间<3秒 |
| 安全验收 | 验证安全要求 | 敏感信息脱敏显示 |

## 边界条件识别方法

**数值边界**:
- 最小值、最大值
- 空值、零值
- 边界值±1

**状态边界**:
- 首次使用 vs 重复使用
- 新用户 vs 老用户
- 空数据 vs 满数据

**时间边界**:
- 超时情况
- 并发操作
- 重复提交

## 场景大纲模板（数据驱动测试）

对于需要多组测试数据的场景，使用场景大纲（Scenario Outline）格式：

```gherkin
### AC-X: {场景标题} - 数据驱动

**Scenario Outline**: {场景描述}

**Given** {前置条件}
- {条件描述}

**When** {用户操作}
- 用户输入 <输入参数1> 和 <输入参数2>

**Then** {预期结果}
- 系统显示 <预期结果>

**Examples**:
| 输入参数1 | 输入参数2 | 预期结果 |
|-----------|-----------|----------|
| {值1} | {值2} | {结果1} |
| {值3} | {值4} | {结果2} |
| {值5} | {值6} | {结果3} |
```

**场景大纲使用场景**：
- 登录验证（多种用户名/密码组合）
- 权限校验（不同角色访问不同资源）
- 业务规则验证（不同输入产生不同结果）
- 边界值测试（多组边界数据）

**示例：用户登录验证**

```gherkin
### AC1: 用户登录验证 - 数据驱动

**Scenario Outline**: 验证不同凭证的登录结果

**Given** 用户在登录页面
- 系统正常运行

**When** 用户登录
- 用户输入 <用户名> 和 <密码>
- 点击"登录"按钮

**Then** 系统响应
- 系统显示 <登录结果>
- 页面跳转到 <目标页面>

**Examples**:
| 用户名 | 密码 | 登录结果 | 目标页面 |
|--------|------|----------|----------|
| admin | correct123 | 登录成功 | 首页 |
| admin | wrong | 密码错误，请重试 | 登录页 |
| invalid | any | 用户不存在 | 登录页 |
| admin | (空) | 请输入密码 | 登录页 |
| (空) | any | 请输入用户名 | 登录页 |
```

## 场景覆盖检查

在编写验收标准后，使用此矩阵确保覆盖完整：

| 场景类型 | 最少数量 | 检查状态 |
|---------|---------|---------|
| Happy Path（正常流程） | 1 | ✅/❌ |
| 异常处理（错误输入、权限不足等） | 2 | ✅/❌ |
| 边界条件（空值、最大值、超时等） | 2 | ✅/❌ |
| 权限控制（如适用） | 1 | ✅/❌ |

## 质量要求

### 可测试性（强制）
- 每条验收标准可以通过测试验证
- 预期结果具体明确，无歧义
- 避免主观性描述（如"用户体验好""响应快"）

### 完整性（强制）
- 覆盖正常流程（Happy Path）
- 覆盖至少2种异常情况（Unhappy Path）
- 识别关键边界条件

### 格式规范（强制）
- 使用Given-When-Then格式
- Given描述前置条件，When描述操作，Then描述结果
- 每个部分可包含多个条目

## 常见编写错误

❌ **错误1**: 验收标准不可测试
```
错误：Then 用户体验良好
正确：Then 页面加载时间<3秒，且显示加载进度条
```

❌ **错误2**: 缺少异常场景
```
错误：只有正常流程的验收标准
正确：包含输入错误、网络异常、权限不足等异常场景
```

❌ **错误3**: Given条件不完整
```
错误：Given 用户在订单页面
正确：Given 用户已登录系统，且购物车中有商品，且在订单确认页面
```

❌ **错误4**: Then结果模糊
```
错误：Then 系统处理订单
正确：Then 系统显示"订单提交成功"，并显示订单号，订单状态为"待支付"
```

## 成功标准

- ✅ 每个故事有3-5条核心验收标准
- ✅ 每条标准使用Given-When-Then格式
- ✅ 覆盖正常流程和至少2种异常情况
- ✅ 包含必要的性能和界面要求
- ✅ 验收标准可直接转化为测试用例

## 质量验证循环

完成初稿后，执行以下验证：

1. **可测试性检查**：每条 AC 是否可以通过测试验证？
2. **场景覆盖检查**：是否覆盖正常流程、异常情况、边界条件？
3. **格式规范检查**：是否使用 Given-When-Then 格式？

**验证→修正→重复**：如发现问题，修正后重新检查，只有全部通过才输出最终文档。

## 详细参考

- **完整示例**: 见 [examples.md](examples.md)
- **GWT 编写指南**: 见 [reference.md](reference.md)

## 输出格式

直接输出完整的验收标准文档，每个用户故事包含验收标准、边界条件、性能要求、界面要求和测试建议。不要有任何前言或解释。

## 技术协作接口

本技能输出需与以下角色协作确认：

| 协作角色 | 协作内容 | 协作时机 |
|---------|---------|---------|
| 测试团队 | AC 可测试性确认、测试用例转化 | AC 编写后 |
| 开发团队 | 技术实现可行性确认 | AC 编写后 |
| UX 设计师 | 界面要求确认 | 界面相关 AC 编写时 |
| 产品经理 | 业务规则确认 | 全部 AC 完成后 |

## 📝 版本历史

- **v1.0** (2025-12-17): 初始版本
  - Given-When-Then 格式验收标准
  - 场景大纲（Scenario Outline）数据驱动测试
  - 边界条件识别方法
  - 质量验证循环机制

---

**作者**: johnsonyang
