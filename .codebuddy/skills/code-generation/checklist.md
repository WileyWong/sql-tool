# 代码生成检查清单

## ⚠️ 强制检查点说明

> **重要**: 每个检查点必须通过才能进入下一步，不可跳过！

| 检查点 | 位置 | 检查内容 | 不通过处理 |
|--------|------|----------|-----------|
| **检查点0** | 步骤0完成后 | 输入类型正确识别、技术上下文获取完整 | 重新分析输入 |
| **检查点1** | 步骤2完成后 | 方案已获得用户确认 | 等待用户确认 |
| **检查点2** | 步骤3完成后 | 代码完整、无语法错误、可编译/运行 | 修正后重新验证 |

---

## 步骤0: 输入分析

### 输入类型识别

- [ ] 判断输入内容形式
- [ ] 识别输入类型（api-design/code-comment/database-ddl/requirement/example-code/natural-language）
- [ ] 若为混合输入，确定主类型（按优先级：api-design > database-ddl > code-comment > requirement > example-code > natural-language）
- [ ] 若为混合输入，提取辅助上下文
- [ ] 确定输出目标语言（java/go/typescript/mysql/groovy）
- [ ] 匹配策略模块

### 输入类型判断标准

```yaml
api-design:
  - OpenAPI/Swagger 文档
  - 接口文档（paths/endpoints）
  - RESTful API 设计

code-comment:
  - @param/@return/JavaDoc
  - TODO:实现 注释
  - 带详细注释的接口签名

database-ddl:
  - CREATE TABLE 语句
  - ALTER TABLE 语句
  - 数据库表结构定义

requirement:
  - 用户故事/PRD
  - 需求文档
  - 功能说明

example-code:
  - 参考代码/模板代码
  - 示例实现

natural-language:
  - 口语化描述/简短指令
  - 对话式输入
  - 非结构化的功能描述
```

### 技术上下文获取

```yaml
获取优先级:
  1. 用户明确指定
  2. 知识库 (.spec-code/memory/)，若没有则搜索 kb、knowledge、knowledge base 等文件夹
  3. 示例代码分析
  4. 项目配置 (pom.xml/go.mod/package.json)
  5. 若以上都找不到，则明确询问用户补充输入
```

---

## ✅ 检查点0: 输入分析验证（必须通过）

> **⚠️ 强制要求**: 此检查点必须全部通过才能进入步骤1！

### 输入类型识别

- [ ] 输入类型已正确识别
- [ ] 若为混合输入，主类型已确定
- [ ] 若为混合输入，辅助上下文已提取
- [ ] 输入内容完整可解析

### 技术上下文

- [ ] 技术上下文来源已确定
- [ ] 输出目标语言已确定

### 策略路由

- [ ] 已匹配到对应策略模块
- [ ] 策略模块文档已加载

### 检查点0通过标准

```
✅ 通过条件:
  - 所有输入类型识别检查项通过
  - 所有技术上下文检查项通过
  - 所有策略路由检查项通过

❌ 不通过处理:
  1. 列出未通过的检查项
  2. 向用户确认模糊信息
  3. 重新执行输入分析
  4. 直到全部通过才能继续
```

---

## 步骤1: 获取架构信息

### 知识库检测

- [ ] 检查 `.spec-code/memory/context.md` 是否存在
- [ ] 读取技术栈信息（语言、框架、版本）
- [ ] 读取架构模式信息
- [ ] 读取编码规范

### 示例代码分析

- [ ] 识别同模块现有代码
- [ ] 分析代码风格（命名、注释、结构）
- [ ] 提取异常处理模式
- [ ] 提取日志记录模式

### 项目配置解析

- [ ] 解析依赖管理文件（pom.xml/go.mod/package.json）
- [ ] 提取框架版本信息
- [ ] 提取依赖库信息

---

## 步骤2: 输出方案

### 方案内容检查

- [ ] 技术栈信息完整（语言/框架/版本）
- [ ] 架构信息来源已标注
- [ ] 文件清单完整（文件名/职责/路径）
- [ ] 关键设计决策已说明（命名/异常/日志）

### 方案展示

- [ ] 使用标准方案模板
- [ ] 包含确认提示语

---

## ✅ 检查点1: 方案确认验证（必须通过）

> **⚠️ 强制要求**: 此检查点必须全部通过才能进入步骤3！

### 方案完整性

- [ ] 技术栈信息完整
- [ ] 文件清单完整
- [ ] 设计决策已说明

### 用户确认

- [ ] 方案已展示给用户
- [ ] 用户已明确确认

### 检查点1通过标准

```
✅ 通过条件:
  - 所有方案完整性检查项通过
  - 用户已明确确认

❌ 不通过处理:
  1. 如果方案不完整，补充缺失信息
  2. 如果用户未确认，等待用户响应
  3. 如果用户提出修改，调整方案后重新确认
  4. 直到用户确认才能继续
```

---

## 步骤3: 生成代码

### 分层顺序

**Java**:
- [ ] Entity 实体类
- [ ] DTO 数据传输对象
- [ ] Mapper 数据访问层
- [ ] Service 业务逻辑层
- [ ] Controller 控制器层

**Go**:
- [ ] Model 数据模型
- [ ] Repository 数据访问层
- [ ] Service 业务逻辑层
- [ ] Handler 处理器层

**TypeScript**:
- [ ] Types 类型定义
- [ ] API 服务层
- [ ] Composables 组合式函数
- [ ] Components 组件层

### 编码规范应用

**通用规范**:
- [ ] 日志规范
- [ ] 注释规范
- [ ] 安全规范
- [ ] 错误处理规范
- [ ] 命名规范
- [ ] 性能规范
- [ ] 可读性规范

**语言特有规范**:
- [ ] 根据输出目标加载对应规范
- [ ] 应用语言最佳实践
- [ ] 避免反模式

---

## ✅ 检查点2: 代码质量验证（必须通过）

> **⚠️ 强制要求**: 此检查点必须全部通过才能标记任务完成！

### 代码完整性

- [ ] 所有计划文件已生成
- [ ] 所有 import 语句完整
- [ ] 所有依赖类已引用
- [ ] 代码结构完整（无截断）

### 语法检查

- [ ] 无语法错误
- [ ] 括号/引号匹配正确
- [ ] 注解/装饰器使用正确

### 编译/运行验证

**Java**:
- [ ] 执行 `mvn compile -DskipTests` 成功
- [ ] 无编译错误
- [ ] 无编译警告（可选）

**Go**:
- [ ] 执行 `go build ./...` 成功
- [ ] 无编译错误

**TypeScript**:
- [ ] 执行 `npm run build` 或 `npx tsc --noEmit` 成功
- [ ] 无类型错误
- [ ] 无 ESLint 错误

**MySQL**:
- [ ] DDL 语法正确
- [ ] 可在数据库客户端执行

### 规范检查

- [ ] 命名符合规范
- [ ] 注释完整
- [ ] 异常处理完善
- [ ] 日志记录完整

### 检查点2通过标准

```
✅ 通过条件:
  - 所有代码完整性检查项通过
  - 所有语法检查项通过
  - 编译/运行验证通过
  - 规范检查项至少 80% 通过

❌ 不通过处理:
  1. 列出编译错误和语法错误
  2. 修正代码
  3. 重新执行验证
  4. 直到全部通过才能标记完成

验证命令:
  # Java
  mvn compile -DskipTests
  
  # Go
  go build ./...
  
  # TypeScript
  npm run build
  # 或
  npx tsc --noEmit
```

---

## AI 执行验证清单

```yaml
执行前:
  - [ ] 确认输入类型已正确识别
  - [ ] 确认策略路径已选择

步骤0完成后（检查点0）:
  - [ ] 确认输入类型识别正确
  - [ ] 确认技术上下文获取完整
  - [ ] 确认策略路由匹配成功
  - [ ] ⚠️ 未通过则重新分析

步骤2完成后（检查点1）:
  - [ ] 确认方案内容完整
  - [ ] 确认用户已明确确认
  - [ ] ⚠️ 未确认则等待用户响应

步骤3完成后（检查点2）:
  - [ ] 确认代码完整性检查通过
  - [ ] 确认语法检查通过
  - [ ] 确认编译/运行验证通过
  - [ ] 确认规范检查通过
  - [ ] ⚠️ 未通过则修正后重新验证
```

---

## 详细检查项（按语言分类）

### Java 代码检查

#### Entity 实体类
- [ ] 包名正确（如 `com.example.demo.entity`）
- [ ] 类名符合命名规范（PascalCase）
- [ ] 使用 `@Data` 注解（Lombok）
- [ ] 使用 `@TableName` 指定表名
- [ ] 使用 `@TableId` 指定主键和生成策略
- [ ] 所有字段有 JavaDoc 注释
- [ ] 字段类型正确（Long、String、LocalDateTime）

#### Mapper 接口
- [ ] 包名正确（如 `com.example.demo.mapper`）
- [ ] 接口名符合命名规范（如 `UserMapper`）
- [ ] 使用 `@Mapper` 注解
- [ ] 继承 `BaseMapper<T>`

#### Service 接口
- [ ] 包名正确（如 `com.example.demo.service`）
- [ ] 接口名符合命名规范（如 `UserService`）
- [ ] 所有方法有 JavaDoc 注释

#### Service 实现类
- [ ] 包名正确（如 `com.example.demo.service.impl`）
- [ ] 类名符合命名规范（如 `UserServiceImpl`）
- [ ] 使用 `@Service` 注解
- [ ] 使用 `@Slf4j` 注解（日志）
- [ ] 使用 `@RequiredArgsConstructor` 注解（依赖注入）
- [ ] 使用 `@Transactional` 注解（事务方法）
- [ ] 参数验证完整
- [ ] 异常处理完善
- [ ] 日志记录完整

#### Controller 控制器
- [ ] 包名正确（如 `com.example.demo.controller`）
- [ ] 类名符合命名规范（如 `UserController`）
- [ ] 使用 `@RestController` 注解
- [ ] 使用 `@RequestMapping` 指定基础路径
- [ ] 使用正确的 HTTP 方法注解
- [ ] 使用 `@Valid` 验证请求体
- [ ] 日志记录完整

#### DTO 类
- [ ] 包名正确（如 `com.example.demo.dto`）
- [ ] 类名符合命名规范（如 `UserCreateDTO`）
- [ ] 使用 `@Data` 注解（Lombok）
- [ ] 请求 DTO 使用验证注解
- [ ] 所有字段有 JavaDoc 注释

### Go 代码检查

#### Model 数据模型
- [ ] 包名正确
- [ ] 结构体名符合命名规范（PascalCase）
- [ ] 字段标签正确（json/gorm）
- [ ] 字段注释完整

#### Repository 数据访问层
- [ ] 接口定义清晰
- [ ] 错误处理完善
- [ ] 使用 context 传递上下文

#### Service 业务逻辑层
- [ ] 接口定义清晰
- [ ] 依赖注入正确
- [ ] 错误处理完善
- [ ] 日志记录完整

#### Handler 处理器层
- [ ] 路由注册正确
- [ ] 参数绑定正确
- [ ] 响应格式统一
- [ ] 错误处理完善

### TypeScript 代码检查

#### Types 类型定义
- [ ] 文件路径正确
- [ ] 接口名符合命名规范（PascalCase）
- [ ] 字段类型正确
- [ ] 注释完整

#### API 服务层
- [ ] 文件路径正确
- [ ] 使用 axios 或 fetch
- [ ] 类型注解完整
- [ ] 错误处理完善

#### Vue 组件
- [ ] 文件路径正确
- [ ] 使用 `<script setup lang="ts">`
- [ ] 使用 ref/reactive 管理状态
- [ ] Props/Emits 定义正确
- [ ] 错误处理完善
- [ ] 加载状态完善

### MySQL 代码检查

#### DDL 语句
- [ ] 表名符合命名规范
- [ ] 字段名符合命名规范
- [ ] 字段类型正确
- [ ] 主键定义正确
- [ ] 索引定义合理
- [ ] 注释完整

---

## 提交前最终检查

- [ ] 所有检查点已通过
- [ ] 代码已格式化
- [ ] 无调试代码
- [ ] 无注释的代码
- [ ] 编译/运行验证通过
