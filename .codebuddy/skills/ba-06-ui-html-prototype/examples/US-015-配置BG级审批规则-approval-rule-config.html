<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®¡æ‰¹ç®¡ç†ç³»ç»Ÿ - BGçº§å®¡æ‰¹è§„åˆ™é…ç½®</title>
    <!-- TDesign Web Components -->
    <link rel="stylesheet" href="https://unpkg.com/tdesign-web-components@latest/dist/tdesign.css">
    <script src="https://unpkg.com/tdesign-web-components@latest/dist/TDesign%20Web%20Components.min.js"></script>
    <!-- é¡¹ç›®è‡ªå®šä¹‰æ ·å¼ -->
    <link rel="stylesheet" href="index.css">
    <link rel="stylesheet" href="layout.css">
    <style>
        /* ========== é¡µé¢ç‰¹æœ‰æ ·å¼ ========== */
        .page-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .page-title { font-size: 20px; font-weight: 600; color: #001226; }
        .page-subtitle { font-size: 14px; color: #666; margin-top: 4px; }
        .page-actions { display: flex; gap: 12px; }
        .content-card { background: #fff; border-radius: 10px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06); margin-bottom: 20px; }
        .content-card-header { padding: 16px 20px; border-bottom: 1px solid #e4e6eb; display: flex; justify-content: space-between; align-items: center; }
        .content-card-title { font-size: 16px; font-weight: 600; color: #001226; display: flex; align-items: center; gap: 8px; }
        .content-card-body { padding: 20px; }
        
        /* æŒ‰é’®æ ·å¼ */
        .btn { display: inline-flex; align-items: center; justify-content: center; gap: 4px; padding: 0 16px; height: 32px; font-size: 14px; border-radius: 4px; border: 1px solid transparent; cursor: pointer; transition: all 0.2s; white-space: nowrap; }
        .btn-primary { background: #3464e0; color: #fff; border-color: #3464e0; }
        .btn-primary:hover { background: #2f5ac9; border-color: #2f5ac9; }
        .btn-primary:disabled { background: #a5b0bd; border-color: #a5b0bd; cursor: not-allowed; }
        .btn-primary.loading { pointer-events: none; opacity: 0.8; }
        .btn-default { background: #fff; color: #333; border-color: #dcdcdc; }
        .btn-default:hover { background: #f5f7f9; border-color: #3464e0; color: #3464e0; }
        .btn-success { background: #2ba471; color: #fff; border-color: #2ba471; }
        .btn-success:hover { background: #239d69; border-color: #239d69; }
        .btn-text { background: transparent; color: #3464e0; border: none; padding: 0 8px; }
        .btn-text:hover { background: rgba(52, 100, 224, 0.1); }
        .btn-sm { height: 28px; padding: 0 12px; font-size: 12px; }
        
        /* æ ‡ç­¾æ ·å¼ */
        .tag { display: inline-flex; align-items: center; padding: 0 8px; height: 22px; font-size: 12px; border-radius: 4px; }
        .tag-primary { background: rgba(52, 100, 224, 0.1); color: #3464e0; }
        .tag-success { background: rgba(43, 164, 113, 0.1); color: #2ba471; }
        .tag-warning { background: rgba(255, 156, 18, 0.1); color: #ff9c12; }
        .tag-error { background: rgba(213, 73, 65, 0.1); color: #d54941; }
        .tag-default { background: #f5f7f9; color: #666; }
        
        /* è¡¨å•æ ·å¼ */
        .form-group { margin-bottom: 16px; }
        .form-label { display: block; font-size: 14px; color: #333; margin-bottom: 8px; }
        .form-label.required::after { content: '*'; color: #d54941; margin-left: 4px; }
        .form-input { width: 100%; height: 32px; padding: 0 12px; font-size: 14px; color: #333; background: #fff; border: 1px solid #dcdcdc; border-radius: 4px; transition: all 0.2s; }
        .form-input:hover { border-color: #3464e0; }
        .form-input:focus { outline: none; border-color: #3464e0; box-shadow: 0 0 0 2px rgba(52, 100, 224, 0.2); }
        .form-input:disabled { background: #f5f7f9; cursor: not-allowed; }
        .form-select { appearance: none; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23666' d='M2 4l4 4 4-4'/%3E%3C/svg%3E"); background-repeat: no-repeat; background-position: right 12px center; padding-right: 32px; }
        .form-row { display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; }
        
        /* Tabs æ ‡ç­¾é¡µ */
        .tabs { display: flex; border-bottom: 1px solid #e4e6eb; margin-bottom: 20px; }
        .tab-item { padding: 12px 20px; font-size: 14px; color: #666; cursor: pointer; border-bottom: 2px solid transparent; transition: all 0.2s; margin-bottom: -1px; }
        .tab-item:hover { color: #3464e0; }
        .tab-item.active { color: #3464e0; border-bottom-color: #3464e0; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        
        /* 6ç»´åº¦æ¡ä»¶é…ç½® */
        .dimension-config { display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; }
        .dimension-item { background: #f5f7f9; border-radius: 8px; padding: 16px; }
        .dimension-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
        .dimension-title { font-size: 14px; font-weight: 600; color: #333; }
        .dimension-switch { position: relative; width: 44px; height: 22px; background: #dcdcdc; border-radius: 11px; cursor: pointer; transition: all 0.2s; }
        .dimension-switch.active { background: #3464e0; }
        .dimension-switch::after { content: ''; position: absolute; top: 2px; left: 2px; width: 18px; height: 18px; background: #fff; border-radius: 50%; transition: all 0.2s; }
        .dimension-switch.active::after { left: 24px; }
        .dimension-values { display: flex; flex-wrap: wrap; gap: 8px; }
        .dimension-tag { display: inline-flex; align-items: center; gap: 4px; padding: 4px 10px; background: #fff; border: 1px solid #dcdcdc; border-radius: 4px; font-size: 12px; cursor: pointer; transition: all 0.2s; }
        .dimension-tag:hover { border-color: #3464e0; }
        .dimension-tag.selected { background: rgba(52, 100, 224, 0.1); border-color: #3464e0; color: #3464e0; }
        
        /* å®¡æ‰¹é“¾èŠ‚ç‚¹é…ç½® */
        .approval-chain { display: flex; align-items: flex-start; gap: 12px; overflow-x: auto; padding: 12px 0; }
        .chain-node { flex-shrink: 0; width: 200px; background: #fff; border: 2px solid #dcdcdc; border-radius: 8px; padding: 16px; position: relative; }
        .chain-node.start { border-color: #2ba471; }
        .chain-node.end { border-color: #d54941; }
        .chain-node.approval { border-color: #3464e0; }
        .chain-node-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
        .chain-node-type { font-size: 12px; padding: 2px 8px; border-radius: 4px; }
        .chain-node.start .chain-node-type { background: rgba(43, 164, 113, 0.1); color: #2ba471; }
        .chain-node.end .chain-node-type { background: rgba(213, 73, 65, 0.1); color: #d54941; }
        .chain-node.approval .chain-node-type { background: rgba(52, 100, 224, 0.1); color: #3464e0; }
        .chain-node-title { font-size: 14px; font-weight: 600; color: #333; margin-bottom: 4px; }
        .chain-node-desc { font-size: 12px; color: #666; }
        .chain-node-actions { display: flex; gap: 8px; margin-top: 12px; padding-top: 12px; border-top: 1px solid #e4e6eb; }
        .chain-arrow { flex-shrink: 0; width: 40px; height: 60px; display: flex; align-items: center; justify-content: center; color: #999; font-size: 20px; }
        .chain-add { flex-shrink: 0; width: 40px; height: 60px; display: flex; align-items: center; justify-content: center; }
        .chain-add-btn { width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; background: #fff; border: 2px dashed #dcdcdc; border-radius: 50%; cursor: pointer; transition: all 0.2s; color: #666; }
        .chain-add-btn:hover { border-color: #3464e0; color: #3464e0; }
        
        /* ç‰ˆæœ¬ç®¡ç† */
        .version-list { border: 1px solid #e4e6eb; border-radius: 8px; overflow: hidden; }
        .version-item { display: flex; align-items: center; padding: 12px 16px; border-bottom: 1px solid #e4e6eb; transition: background 0.2s; }
        .version-item:last-child { border-bottom: none; }
        .version-item:hover { background: #f9fafc; }
        .version-item.current { background: rgba(52, 100, 224, 0.05); }
        .version-info { flex: 1; }
        .version-number { font-size: 14px; font-weight: 600; color: #333; display: flex; align-items: center; gap: 8px; }
        .version-meta { font-size: 12px; color: #666; margin-top: 4px; }
        .version-actions { display: flex; gap: 8px; }
        
        /* è§„åˆ™æµ‹è¯• */
        .test-panel { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .test-input, .test-result { background: #f5f7f9; border-radius: 8px; padding: 16px; }
        .test-result-header { display: flex; align-items: center; gap: 8px; margin-bottom: 12px; }
        .test-result-icon { width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 14px; }
        .test-result-icon.success { background: #2ba471; color: #fff; }
        .test-result-icon.error { background: #d54941; color: #fff; }
        .test-result-title { font-size: 14px; font-weight: 600; }
        .test-chain-preview { display: flex; flex-wrap: wrap; gap: 8px; align-items: center; }
        .test-chain-node { display: inline-flex; align-items: center; gap: 4px; padding: 6px 10px; background: #fff; border-radius: 4px; font-size: 12px; }
        .test-chain-arrow { color: #999; }
        
        /* æ—¶é—´çº¿ */
        .timeline { position: relative; padding-left: 24px; }
        .timeline::before { content: ''; position: absolute; left: 7px; top: 0; bottom: 0; width: 2px; background: #e4e6eb; }
        .timeline-item { position: relative; padding-bottom: 20px; }
        .timeline-item:last-child { padding-bottom: 0; }
        .timeline-dot { position: absolute; left: -21px; top: 4px; width: 12px; height: 12px; border-radius: 50%; background: #3464e0; border: 2px solid #fff; }
        .timeline-content { font-size: 14px; color: #333; }
        .timeline-time { font-size: 12px; color: #666; margin-top: 4px; }
        
        /* ç»§æ‰¿æ ‡è¯† */
        .inherit-badge { display: inline-flex; align-items: center; gap: 4px; padding: 4px 8px; background: #f5f7f9; border-radius: 4px; font-size: 12px; color: #666; }
        
        /* Toast æç¤º */
        .toast-container { position: fixed; top: 80px; left: 50%; transform: translateX(-50%); z-index: 9999; display: flex; flex-direction: column; gap: 8px; }
        .toast { display: flex; align-items: center; gap: 8px; padding: 12px 20px; background: #fff; border-radius: 8px; box-shadow: 0 6px 16px rgba(0, 0, 0, 0.15); animation: toastIn 0.3s ease; }
        .toast.hiding { animation: toastOut 0.3s ease forwards; }
        @keyframes toastIn { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes toastOut { from { opacity: 1; transform: translateY(0); } to { opacity: 0; transform: translateY(-20px); } }
        .toast-icon { width: 20px; height: 20px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px; color: #fff; }
        .toast.success .toast-icon { background: #2ba471; }
        .toast.error .toast-icon { background: #d54941; }
        .toast.warning .toast-icon { background: #ff9c12; }
        .toast.info .toast-icon { background: #3464e0; }
        .toast-message { font-size: 14px; color: #333; }
        .toast-close { margin-left: 12px; cursor: pointer; color: #999; }
        
        /* æ¨¡æ€æ¡† */
        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.5); z-index: 1000; display: none; align-items: center; justify-content: center; }
        .modal-overlay.show { display: flex; }
        .modal { background: #fff; border-radius: 8px; box-shadow: 0 12px 32px rgba(0, 0, 0, 0.2); width: 560px; max-width: 90vw; max-height: 80vh; overflow: hidden; display: flex; flex-direction: column; }
        .modal-header { display: flex; justify-content: space-between; align-items: center; padding: 16px 20px; border-bottom: 1px solid #e4e6eb; }
        .modal-title { font-size: 16px; font-weight: 600; color: #333; }
        .modal-close { width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; cursor: pointer; color: #666; border-radius: 4px; transition: all 0.2s; }
        .modal-close:hover { background: #f5f7f9; color: #333; }
        .modal-body { padding: 20px; overflow-y: auto; flex: 1; }
        .modal-footer { display: flex; justify-content: flex-end; gap: 8px; padding: 12px 20px; border-top: 1px solid #e4e6eb; }
        
        .spinner { width: 16px; height: 16px; border: 2px solid currentColor; border-top-color: transparent; border-radius: 50%; animation: spin 0.8s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        @media (max-width: 991.98px) {
            .form-row { grid-template-columns: 1fr; }
            .dimension-config { grid-template-columns: 1fr; }
            .test-panel { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <!-- ========== é¡¶éƒ¨å¯¼èˆªæ  ========== -->
    <div class="sticky-header">
        <div class="header-background"></div>
        <div class="sticky-content">
            <div class="header-left">
                <button class="mobile-menu-btn header-action" onclick="toggleMobileSidebar()">â˜°</button>
                <div class="logo">å®¡æ‰¹ç®¡ç†ç³»ç»Ÿ</div>
                <div class="search-resume">
                    <div class="search-input"><input type="text" placeholder="æœç´¢è§„åˆ™ã€å®¡æ‰¹æµç¨‹..."></div>
                    <button class="search-btn">æœç´¢</button>
                </div>
            </div>
            <div class="header-right">
                <div class="head-navigation">
                    <span class="navigation-item">å®¡æ‰¹ä¸­å¿ƒ</span>
                    <span class="navigation-item">è§„åˆ™ç®¡ç†</span>
                    <span class="navigation-item">ç»Ÿè®¡æŠ¥è¡¨</span>
                </div>
                <div class="header-action" title="é€šçŸ¥">ğŸ””</div>
                <div class="header-action" title="å¸®åŠ©">â“</div>
                <div class="header-user" onclick="toggleUserDropdown()">
                    <div class="header-user-avatar">å¼ </div>
                    <span class="header-user-name">å¼ ä¸‰</span>
                    <span style="font-size: 10px;">â–¼</span>
                    <div class="user-dropdown" id="userDropdown">
                        <div class="dropdown-item"><span>ğŸ‘¤</span><span>ä¸ªäººä¸­å¿ƒ</span></div>
                        <div class="dropdown-item"><span>âš™ï¸</span><span>è´¦å·è®¾ç½®</span></div>
                        <div class="dropdown-divider"></div>
                        <div class="dropdown-item" style="color: #f66664;"><span>ğŸšª</span><span>é€€å‡ºç™»å½•</span></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ========== å†…å®¹å¸ƒå±€åŒºåŸŸ ========== -->
    <div class="content-layout">
        <!-- ========== å·¦ä¾§å¯¼èˆªæ  ========== -->
        <div class="left_nav">
            <div class="left_layout" id="sidebar">
                <div class="user-info">
                    <div class="user-photo">
                        <div style="width: 100%; height: 100%; background: linear-gradient(135deg, #3464e0, #5d9efe); display: flex; align-items: center; justify-content: center; color: #fff; font-size: 18px;">å¼ </div>
                    </div>
                    <div class="user-name">å¼ ä¸‰</div>
                </div>
                <div class="nav">
                    <div class="nav-auto">
                        <ul>
                            <li><a href="html-content-homepage.html"><i class="icon">ğŸ </i><span class="name">é¦–é¡µ</span></a></li>
                            <li><a href="html-content-homepage.html"><i class="icon">ğŸ“Š</i><span class="name">ä»ªè¡¨ç›˜</span></a></li>
                            <li><a href="html-content-search-data-list.html"><i class="icon">ğŸ“‹</i><span class="name">è®¢å•åˆ—è¡¨</span></a></li>
                            <li><a href="html-content-cards.html"><i class="icon">ğŸ“</i><span class="name">é¡¹ç›®åˆ—è¡¨</span></a></li>
                            <li><a href="html-content-details.html"><i class="icon">ğŸ“„</i><span class="name">è¯¦æƒ…é¡µ</span></a></li>
                            <li><a href="html-form-filling-submit.html"><i class="icon">ğŸ“</i><span class="name">è¡¨å•æäº¤</span></a></li>
                            <li><a href="html-content-hr-selectors.html"><i class="icon">ğŸ‘¥</i><span class="name">äººå‘˜é€‰æ‹©</span></a></li>
                            <li><a href="html-content-dialogs.html"><i class="icon">ğŸ¯</i><span class="name">å¼¹çª—ç¤ºä¾‹</span></a></li>
                        </ul>
                        <ul>
                            <li><a href="ba-04-INVESTåŸåˆ™è¯„ä¼°è¡¨å•-invest-evaluation-form.html"><i class="icon">ğŸ“ˆ</i><span class="name">INVESTè¯„ä¼°</span></a></li>
                            <li><a href="US-015-é…ç½®BGçº§å®¡æ‰¹è§„åˆ™-approval-rule-config.html" class="router-link-active"><i class="icon">âš™ï¸</i><span class="name">å®¡æ‰¹è§„åˆ™</span></a></li>
                        </ul>
                        <ul>
                            <li class="slide-btn"><div class="slide-icon" onclick="toggleSidebar()" title="æ”¶èµ·/å±•å¼€èœå•"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 19l-7-7 7-7M18 19l-7-7 7-7"/></svg></div></li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="sidebar-overlay" onclick="closeMobileSidebar()"></div>
        </div>
        
        <!-- ========== è§†å›¾å®¹å™¨ ========== -->
        <div class="view-container">
            <div class="page-header">
                <div>
                    <h1 class="page-title">CDG BG å®¡æ‰¹è§„åˆ™é…ç½®</h1>
                    <p class="page-subtitle"><span class="inherit-badge"><span>ğŸ“‹</span>ç»§æ‰¿è‡ª: é›†å›¢çº§è§„åˆ™</span></p>
                </div>
                <div class="page-actions">
                    <button class="btn btn-default" onclick="showVersionModal()">ğŸ“‹ ç‰ˆæœ¬ç®¡ç†</button>
                    <button class="btn btn-success" onclick="showTestModal()">ğŸ§ª è§„åˆ™æµ‹è¯•</button>
                    <button class="btn btn-primary" id="saveBtn" onclick="saveRule()">ğŸ’¾ ä¿å­˜è§„åˆ™</button>
                </div>
            </div>
            
            <div class="tabs">
                <div class="tab-item active" data-tab="condition">æ¡ä»¶é…ç½®</div>
                <div class="tab-item" data-tab="chain">å®¡æ‰¹é“¾é…ç½®</div>
                <div class="tab-item" data-tab="history">å˜æ›´å†å²</div>
            </div>
            
            <!-- Tabå†…å®¹ï¼šæ¡ä»¶é…ç½® -->
            <div class="tab-content active" id="tab-condition">
                <div class="content-card">
                    <div class="content-card-header"><h3 class="content-card-title"><span>ğŸ“Š</span>åŸºæœ¬ä¿¡æ¯</h3></div>
                    <div class="content-card-body">
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label required">è§„åˆ™åç§°</label>
                                <input type="text" class="form-input" id="ruleName" value="CDG-æ ‡å‡†å…¥èŒå®¡æ‰¹" placeholder="è¯·è¾“å…¥è§„åˆ™åç§°">
                            </div>
                            <div class="form-group">
                                <label class="form-label">è§„åˆ™ç¼–ç </label>
                                <input type="text" class="form-input" id="ruleCode" value="CDG-ONBOARD-001" disabled>
                            </div>
                            <div class="form-group">
                                <label class="form-label required">ç”Ÿæ•ˆçŠ¶æ€</label>
                                <select class="form-input form-select" id="ruleStatus">
                                    <option value="draft">è‰ç¨¿</option>
                                    <option value="active" selected>å·²ç”Ÿæ•ˆ</option>
                                    <option value="disabled">å·²åœç”¨</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">è§„åˆ™æè¿°</label>
                            <input type="text" class="form-input" id="ruleDesc" value="é€‚ç”¨äºCDG BGçš„æ ‡å‡†å…¥èŒå®¡æ‰¹æµç¨‹ï¼Œè¦†ç›–å¸¸è§„å²—ä½å…¥èŒåœºæ™¯" placeholder="è¯·è¾“å…¥è§„åˆ™æè¿°">
                        </div>
                    </div>
                </div>
                
                <div class="content-card">
                    <div class="content-card-header">
                        <h3 class="content-card-title"><span>ğŸ¯</span>6ç»´åº¦æ¡ä»¶é…ç½®</h3>
                        <span class="tag tag-primary">è‡³å°‘é…ç½®1ä¸ªç»´åº¦</span>
                    </div>
                    <div class="content-card-body">
                        <div class="dimension-config" id="dimensionConfig"></div>
                    </div>
                </div>
            </div>
            
            <!-- Tabå†…å®¹ï¼šå®¡æ‰¹é“¾é…ç½® -->
            <div class="tab-content" id="tab-chain">
                <div class="content-card">
                    <div class="content-card-header">
                        <h3 class="content-card-title"><span>ğŸ”—</span>å®¡æ‰¹é“¾èŠ‚ç‚¹</h3>
                        <button class="btn btn-default btn-sm" onclick="addChainNode()">+ æ·»åŠ èŠ‚ç‚¹</button>
                    </div>
                    <div class="content-card-body">
                        <div class="approval-chain" id="approvalChain"></div>
                    </div>
                </div>
                
                <div class="content-card">
                    <div class="content-card-header"><h3 class="content-card-title"><span>âš™ï¸</span>å®¡æ‰¹è®¾ç½®</h3></div>
                    <div class="content-card-body">
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">å®¡æ‰¹è¶…æ—¶æ—¶é—´</label>
                                <select class="form-input form-select" id="timeoutHours">
                                    <option value="24">24å°æ—¶</option>
                                    <option value="48" selected>48å°æ—¶</option>
                                    <option value="72">72å°æ—¶</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">è¶…æ—¶å¤„ç†æ–¹å¼</label>
                                <select class="form-input form-select" id="timeoutAction">
                                    <option value="remind">æé†’å®¡æ‰¹äºº</option>
                                    <option value="escalate" selected>ä¸Šå‡è‡³ä¸Šçº§</option>
                                    <option value="auto_pass">è‡ªåŠ¨é€šè¿‡</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">ä¼šç­¾/æˆ–ç­¾</label>
                                <select class="form-input form-select" id="signType">
                                    <option value="or" selected>æˆ–ç­¾ï¼ˆä»»ä¸€é€šè¿‡å³å¯ï¼‰</option>
                                    <option value="and">ä¼šç­¾ï¼ˆå…¨éƒ¨é€šè¿‡ï¼‰</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Tabå†…å®¹ï¼šå˜æ›´å†å² -->
            <div class="tab-content" id="tab-history">
                <div class="content-card">
                    <div class="content-card-header"><h3 class="content-card-title"><span>ğŸ“œ</span>æ“ä½œæ—¥å¿—</h3></div>
                    <div class="content-card-body">
                        <div class="timeline" id="historyTimeline"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="toast-container" id="toastContainer"></div>
    
    <!-- ç‰ˆæœ¬ç®¡ç†æ¨¡æ€æ¡† -->
    <div class="modal-overlay" id="versionModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">ç‰ˆæœ¬ç®¡ç†</h3>
                <div class="modal-close" onclick="closeModal('versionModal')">âœ•</div>
            </div>
            <div class="modal-body"><div class="version-list" id="versionList"></div></div>
            <div class="modal-footer">
                <button class="btn btn-default" onclick="closeModal('versionModal')">å…³é—­</button>
                <button class="btn btn-primary" onclick="createNewVersion()">åˆ›å»ºæ–°ç‰ˆæœ¬</button>
            </div>
        </div>
    </div>
    
    <!-- è§„åˆ™æµ‹è¯•æ¨¡æ€æ¡† -->
    <div class="modal-overlay" id="testModal">
        <div class="modal" style="width: 800px;">
            <div class="modal-header">
                <h3 class="modal-title">è§„åˆ™æµ‹è¯•</h3>
                <div class="modal-close" onclick="closeModal('testModal')">âœ•</div>
            </div>
            <div class="modal-body">
                <div class="test-panel">
                    <div class="test-input">
                        <h4 style="font-size: 14px; font-weight: 600; margin-bottom: 12px;">æµ‹è¯•è¾“å…¥</h4>
                        <div class="form-group">
                            <label class="form-label">BG</label>
                            <select class="form-input form-select" id="testBg"><option value="CDG">CDG</option><option value="WXG">WXG</option><option value="IEG">IEG</option></select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">ç»„ç»‡ç±»å‹</label>
                            <select class="form-input form-select" id="testOrgType"><option value="tech">æŠ€æœ¯ä¸­å¿ƒ</option><option value="product">äº§å“ä¸­å¿ƒ</option><option value="support">æ”¯æŒä¸­å¿ƒ</option></select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">å²—ä½çº§åˆ«</label>
                            <select class="form-input form-select" id="testLevel"><option value="T1-T3">T1-T3</option><option value="T4-T6">T4-T6</option><option value="T7+">T7+</option></select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">å‘˜å·¥ç±»å‹</label>
                            <select class="form-input form-select" id="testEmpType"><option value="regular">æ­£å¼å‘˜å·¥</option><option value="intern">å®ä¹ ç”Ÿ</option><option value="contractor">å¤–åŒ…</option></select>
                        </div>
                        <button class="btn btn-primary" style="width: 100%;" onclick="runTest()">è¿è¡Œæµ‹è¯•</button>
                    </div>
                    <div class="test-result">
                        <h4 style="font-size: 14px; font-weight: 600; margin-bottom: 12px;">æµ‹è¯•ç»“æœ</h4>
                        <div id="testResultContent">
                            <div style="text-align: center; padding: 48px 0; color: #666;">
                                <div style="font-size: 48px; margin-bottom: 12px; opacity: 0.5;">ğŸ§ª</div>
                                <div>ç‚¹å‡»"è¿è¡Œæµ‹è¯•"æŸ¥çœ‹ç»“æœ</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer"><button class="btn btn-default" onclick="closeModal('testModal')">å…³é—­</button></div>
        </div>
    </div>
    
    <!-- æ·»åŠ èŠ‚ç‚¹æ¨¡æ€æ¡† -->
    <div class="modal-overlay" id="addNodeModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">æ·»åŠ å®¡æ‰¹èŠ‚ç‚¹</h3>
                <div class="modal-close" onclick="closeModal('addNodeModal')">âœ•</div>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label required">èŠ‚ç‚¹åç§°</label>
                    <input type="text" class="form-input" id="nodeName" placeholder="å¦‚ï¼šéƒ¨é—¨ç»ç†å®¡æ‰¹">
                </div>
                <div class="form-group">
                    <label class="form-label required">å®¡æ‰¹äººç±»å‹</label>
                    <select class="form-input form-select" id="nodeApproverType"><option value="role">æŒ‰è§’è‰²</option><option value="level">æŒ‰å±‚çº§</option><option value="user">æŒ‡å®šäººå‘˜</option></select>
                </div>
                <div class="form-group">
                    <label class="form-label required">å®¡æ‰¹äºº</label>
                    <select class="form-input form-select" id="nodeApprover"><option value="direct_manager">ç›´å±ä¸Šçº§</option><option value="dept_manager">éƒ¨é—¨ç»ç†</option><option value="hrbp">HRBP</option><option value="coe">COEä¸“å®¶</option></select>
                </div>
                <div class="form-group">
                    <label class="form-label">èŠ‚ç‚¹æè¿°</label>
                    <input type="text" class="form-input" id="nodeDesc" placeholder="è¯·è¾“å…¥èŠ‚ç‚¹æè¿°">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-default" onclick="closeModal('addNodeModal')">å–æ¶ˆ</button>
                <button class="btn btn-primary" onclick="confirmAddNode()">æ·»åŠ </button>
            </div>
        </div>
    </div>

    <script>
        // ä¾§è¾¹æ äº¤äº’
        function toggleSidebar() { document.getElementById('sidebar').classList.toggle('collapsed'); }
        function toggleMobileSidebar() { document.getElementById('sidebar').classList.add('mobile-show'); }
        function closeMobileSidebar() { document.getElementById('sidebar').classList.remove('mobile-show'); }
        function toggleUserDropdown() { event.stopPropagation(); document.getElementById('userDropdown').classList.toggle('show'); }
        document.addEventListener('click', function(e) { if (!e.target.closest('.header-user')) document.getElementById('userDropdown').classList.remove('show'); });
        document.querySelectorAll('.nav li a:not([onclick])').forEach(item => { item.addEventListener('click', function() { document.querySelectorAll('.nav li a').forEach(i => i.classList.remove('router-link-active')); this.classList.add('router-link-active'); }); });

        // æ¨¡æ‹Ÿæ•°æ®
        const mockDimensions = [
            { id: 'bg', name: 'BG', enabled: true, values: ['CDG', 'WXG', 'IEG', 'PCG', 'CSIG', 'TEG'], selected: ['CDG'] },
            { id: 'orgType', name: 'ç»„ç»‡ç±»å‹', enabled: true, values: ['æŠ€æœ¯ä¸­å¿ƒ', 'äº§å“ä¸­å¿ƒ', 'è¿è¥ä¸­å¿ƒ', 'æ”¯æŒä¸­å¿ƒ'], selected: ['æŠ€æœ¯ä¸­å¿ƒ', 'äº§å“ä¸­å¿ƒ'] },
            { id: 'level', name: 'å²—ä½çº§åˆ«', enabled: true, values: ['T1-T3', 'T4-T6', 'T7-T9', 'T10+'], selected: ['T1-T3', 'T4-T6'] },
            { id: 'empType', name: 'å‘˜å·¥ç±»å‹', enabled: true, values: ['æ­£å¼å‘˜å·¥', 'å®ä¹ ç”Ÿ', 'å¤–åŒ…', 'é¡¾é—®'], selected: ['æ­£å¼å‘˜å·¥'] },
            { id: 'salary', name: 'è–ªèµ„æ¡£ä½', enabled: false, values: ['æ ‡å‡†æ¡£', 'è¶…æ ‡æ¡£', 'ç‰¹æ‰¹æ¡£'], selected: [] },
            { id: 'tag', name: 'ç‰¹æ®Šæ ‡ç­¾', enabled: false, values: ['ç´§æ€¥å…¥èŒ', 'æ¶‰å¯†å²—ä½', 'VIP', 'æ ¡æ‹›'], selected: [] }
        ];
        
        const mockApprovalChain = [
            { id: 'start', type: 'start', name: 'å‘èµ·ç”³è¯·', desc: 'SSCä¸“å‘˜æäº¤å…¥èŒç”³è¯·' },
            { id: 'node1', type: 'approval', name: 'ç›´å±ä¸Šçº§å®¡æ‰¹', desc: 'å®¡æ‰¹äººï¼šç›´å±ä¸Šçº§' },
            { id: 'node2', type: 'approval', name: 'HRBPå®¡æ‰¹', desc: 'å®¡æ‰¹äººï¼šå¯¹åº”HRBP' },
            { id: 'node3', type: 'approval', name: 'éƒ¨é—¨ç»ç†å®¡æ‰¹', desc: 'å®¡æ‰¹äººï¼šéƒ¨é—¨ç»ç†' },
            { id: 'end', type: 'end', name: 'å®¡æ‰¹å®Œæˆ', desc: 'æµç¨‹ç»“æŸï¼Œé€šçŸ¥ç›¸å…³äººå‘˜' }
        ];
        
        const mockVersions = [
            { version: 'v1.3', status: 'current', author: 'å¼ ä¸‰', time: '2024-12-10 14:30', desc: 'å¢åŠ T7+å²—ä½å®¡æ‰¹èŠ‚ç‚¹' },
            { version: 'v1.2', status: 'history', author: 'æå››', time: '2024-11-25 10:15', desc: 'è°ƒæ•´è¶…æ—¶æ—¶é—´ä¸º48å°æ—¶' },
            { version: 'v1.1', status: 'history', author: 'å¼ ä¸‰', time: '2024-10-18 16:45', desc: 'æ–°å¢HRBPå®¡æ‰¹èŠ‚ç‚¹' },
            { version: 'v1.0', status: 'history', author: 'ç‹äº”', time: '2024-09-01 09:00', desc: 'åˆå§‹ç‰ˆæœ¬' }
        ];
        
        const mockHistory = [
            { action: 'ä¿®æ”¹å®¡æ‰¹è¶…æ—¶æ—¶é—´', detail: '48å°æ—¶ â†’ 72å°æ—¶', user: 'å¼ ä¸‰', time: '2024-12-10 14:30' },
            { action: 'æ–°å¢å®¡æ‰¹èŠ‚ç‚¹', detail: 'æ·»åŠ "COEä¸“å®¶å®¡æ‰¹"èŠ‚ç‚¹', user: 'å¼ ä¸‰', time: '2024-12-10 14:25' },
            { action: 'ä¿®æ”¹æ¡ä»¶é…ç½®', detail: 'å²—ä½çº§åˆ«å¢åŠ "T7+"', user: 'æå››', time: '2024-12-09 11:20' },
            { action: 'å‘å¸ƒæ–°ç‰ˆæœ¬', detail: 'å‘å¸ƒv1.3ç‰ˆæœ¬', user: 'å¼ ä¸‰', time: '2024-12-08 16:00' },
            { action: 'åˆ›å»ºè§„åˆ™', detail: 'åŸºäºé›†å›¢è§„åˆ™åˆ›å»ºCDGè§„åˆ™', user: 'ç‹äº”', time: '2024-09-01 09:00' }
        ];

        // é¡µé¢åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            renderDimensionConfig();
            renderApprovalChain();
            renderVersionList();
            renderHistory();
            initTabs();
            initModalEvents();
        });

        // 6ç»´åº¦æ¡ä»¶é…ç½®
        function renderDimensionConfig() {
            document.getElementById('dimensionConfig').innerHTML = mockDimensions.map(dim => `
                <div class="dimension-item">
                    <div class="dimension-header">
                        <span class="dimension-title">${dim.name}</span>
                        <div class="dimension-switch ${dim.enabled ? 'active' : ''}" onclick="toggleDimension('${dim.id}')"></div>
                    </div>
                    <div class="dimension-values" style="opacity: ${dim.enabled ? 1 : 0.5}">
                        ${dim.values.map(val => `<span class="dimension-tag ${dim.selected.includes(val) ? 'selected' : ''}" onclick="${dim.enabled ? `toggleDimensionValue('${dim.id}', '${val}')` : ''}">${val}</span>`).join('')}
                    </div>
                </div>
            `).join('');
        }
        
        function toggleDimension(dimId) {
            const dim = mockDimensions.find(d => d.id === dimId);
            if (dim) { dim.enabled = !dim.enabled; if (!dim.enabled) dim.selected = []; renderDimensionConfig(); }
        }
        
        function toggleDimensionValue(dimId, value) {
            const dim = mockDimensions.find(d => d.id === dimId);
            if (dim && dim.enabled) {
                const index = dim.selected.indexOf(value);
                if (index > -1) dim.selected.splice(index, 1); else dim.selected.push(value);
                renderDimensionConfig();
            }
        }

        // å®¡æ‰¹é“¾é…ç½®
        function renderApprovalChain() {
            let html = '';
            mockApprovalChain.forEach((node, index) => {
                html += `<div class="chain-node ${node.type}">
                    <div class="chain-node-header">
                        <span class="chain-node-type">${getNodeTypeLabel(node.type)}</span>
                        ${node.type === 'approval' ? `<button class="btn btn-text btn-sm" onclick="removeChainNode('${node.id}')">åˆ é™¤</button>` : ''}
                    </div>
                    <div class="chain-node-title">${node.name}</div>
                    <div class="chain-node-desc">${node.desc}</div>
                    ${node.type === 'approval' ? `<div class="chain-node-actions"><button class="btn btn-text btn-sm" onclick="editChainNode('${node.id}')">ç¼–è¾‘</button></div>` : ''}
                </div>`;
                if (index < mockApprovalChain.length - 1) {
                    html += `<div class="chain-arrow">â†’</div>`;
                    if (node.type !== 'end' && mockApprovalChain[index + 1].type !== 'end') {
                        html += `<div class="chain-add"><div class="chain-add-btn" onclick="addChainNodeAt(${index + 1})">+</div></div><div class="chain-arrow">â†’</div>`;
                    }
                }
            });
            document.getElementById('approvalChain').innerHTML = html;
        }
        
        function getNodeTypeLabel(type) { return { start: 'å¼€å§‹', approval: 'å®¡æ‰¹', end: 'ç»“æŸ' }[type] || type; }
        function addChainNode() { document.getElementById('nodeName').value = ''; document.getElementById('nodeDesc').value = ''; showModal('addNodeModal'); }
        function addChainNodeAt(index) { addChainNode(); }
        
        function confirmAddNode() {
            const name = document.getElementById('nodeName').value.trim();
            const approver = document.getElementById('nodeApprover').value;
            const desc = document.getElementById('nodeDesc').value.trim();
            if (!name) { showToast('è¯·è¾“å…¥èŠ‚ç‚¹åç§°', 'error'); return; }
            const newNode = { id: 'node' + Date.now(), type: 'approval', name: name, desc: desc || `å®¡æ‰¹äººï¼š${getApproverLabel(approver)}` };
            const endIndex = mockApprovalChain.findIndex(n => n.type === 'end');
            mockApprovalChain.splice(endIndex, 0, newNode);
            renderApprovalChain();
            closeModal('addNodeModal');
            showToast('èŠ‚ç‚¹æ·»åŠ æˆåŠŸ', 'success');
        }
        
        function getApproverLabel(approver) { return { direct_manager: 'ç›´å±ä¸Šçº§', dept_manager: 'éƒ¨é—¨ç»ç†', hrbp: 'HRBP', coe: 'COEä¸“å®¶' }[approver] || approver; }
        function removeChainNode(nodeId) { const index = mockApprovalChain.findIndex(n => n.id === nodeId); if (index > -1) { mockApprovalChain.splice(index, 1); renderApprovalChain(); showToast('èŠ‚ç‚¹å·²åˆ é™¤', 'success'); } }
        function editChainNode(nodeId) { const node = mockApprovalChain.find(n => n.id === nodeId); if (node) { document.getElementById('nodeName').value = node.name; document.getElementById('nodeDesc').value = node.desc; showModal('addNodeModal'); } }

        // ç‰ˆæœ¬ç®¡ç†
        function renderVersionList() {
            document.getElementById('versionList').innerHTML = mockVersions.map(v => `
                <div class="version-item ${v.status === 'current' ? 'current' : ''}">
                    <div class="version-info">
                        <div class="version-number">${v.version} ${v.status === 'current' ? '<span class="tag tag-success">å½“å‰ç‰ˆæœ¬</span>' : ''}</div>
                        <div class="version-meta">${v.desc} Â· ${v.author} Â· ${v.time}</div>
                    </div>
                    <div class="version-actions">
                        <button class="btn btn-text btn-sm">æŸ¥çœ‹</button>
                        ${v.status !== 'current' ? `<button class="btn btn-text btn-sm" onclick="rollbackVersion('${v.version}')">å›æ»š</button>` : ''}
                    </div>
                </div>
            `).join('');
        }
        
        function showVersionModal() { showModal('versionModal'); }
        function createNewVersion() { showToast('æ–°ç‰ˆæœ¬åˆ›å»ºæˆåŠŸ', 'success'); closeModal('versionModal'); }
        function rollbackVersion(version) { showToast(`å·²å›æ»šè‡³ ${version}`, 'success'); closeModal('versionModal'); }

        // å˜æ›´å†å²
        function renderHistory() {
            document.getElementById('historyTimeline').innerHTML = mockHistory.map(h => `
                <div class="timeline-item">
                    <div class="timeline-dot"></div>
                    <div class="timeline-content"><strong>${h.action}</strong>ï¼š${h.detail}</div>
                    <div class="timeline-time">${h.user} Â· ${h.time}</div>
                </div>
            `).join('');
        }

        // è§„åˆ™æµ‹è¯•
        function showTestModal() { showModal('testModal'); }
        function runTest() {
            const bg = document.getElementById('testBg').value;
            const level = document.getElementById('testLevel').value;
            const matched = bg === 'CDG' && level !== 'T7+';
            const resultContainer = document.getElementById('testResultContent');
            if (matched) {
                resultContainer.innerHTML = `
                    <div class="test-result-header"><div class="test-result-icon success">âœ“</div><div class="test-result-title" style="color: #2ba471;">åŒ¹é…æˆåŠŸ</div></div>
                    <p style="margin-bottom: 12px; color: #666;">å½“å‰æ¡ä»¶åŒ¹é…è§„åˆ™ï¼š<strong>CDG-æ ‡å‡†å…¥èŒå®¡æ‰¹</strong></p>
                    <h5 style="font-size: 14px; font-weight: 600; margin-bottom: 8px;">ç”Ÿæˆçš„å®¡æ‰¹é“¾ï¼š</h5>
                    <div class="test-chain-preview">
                        <span class="test-chain-node">ğŸ“ å‘èµ·ç”³è¯·</span><span class="test-chain-arrow">â†’</span>
                        <span class="test-chain-node">ğŸ‘¤ ç›´å±ä¸Šçº§</span><span class="test-chain-arrow">â†’</span>
                        <span class="test-chain-node">ğŸ‘¥ HRBP</span><span class="test-chain-arrow">â†’</span>
                        <span class="test-chain-node">ğŸ‘” éƒ¨é—¨ç»ç†</span><span class="test-chain-arrow">â†’</span>
                        <span class="test-chain-node">âœ… å®Œæˆ</span>
                    </div>`;
            } else {
                resultContainer.innerHTML = `
                    <div class="test-result-header"><div class="test-result-icon error">âœ•</div><div class="test-result-title" style="color: #d54941;">æœªåŒ¹é…</div></div>
                    <p style="color: #666;">å½“å‰æ¡ä»¶æœªåŒ¹é…ä»»ä½•BGçº§è§„åˆ™ï¼Œå°†ä½¿ç”¨é›†å›¢çº§è§„åˆ™</p>
                    <div style="margin-top: 12px; padding: 12px; background: rgba(255, 156, 18, 0.1); border-radius: 4px;">
                        <strong style="color: #ff9c12;">å»ºè®®ï¼š</strong>
                        <span style="color: #666;">${level === 'T7+' ? 'å½“å‰å²—ä½çº§åˆ«ä¸ºT7+ï¼Œå»ºè®®åˆ›å»ºé«˜çº§åˆ«å²—ä½ä¸“ç”¨è§„åˆ™' : 'æ£€æŸ¥æ¡ä»¶é…ç½®æ˜¯å¦è¦†ç›–å½“å‰åœºæ™¯'}</span>
                    </div>`;
            }
        }

        // ä¿å­˜è§„åˆ™
        function saveRule() {
            const btn = document.getElementById('saveBtn');
            btn.classList.add('loading'); btn.innerHTML = '<span class="spinner"></span> ä¿å­˜ä¸­...'; btn.disabled = true;
            setTimeout(() => { btn.classList.remove('loading'); btn.innerHTML = 'ğŸ’¾ ä¿å­˜è§„åˆ™'; btn.disabled = false; showToast('è§„åˆ™ä¿å­˜æˆåŠŸ', 'success'); }, 1000);
        }

        // Tabs åˆ‡æ¢
        function initTabs() {
            document.querySelectorAll('.tab-item').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.dataset.tab;
                    document.querySelectorAll('.tab-item').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    document.getElementById('tab-' + tabId).classList.add('active');
                });
            });
        }

        // æ¨¡æ€æ¡†
        function showModal(modalId) { document.getElementById(modalId).classList.add('show'); }
        function closeModal(modalId) { document.getElementById(modalId).classList.remove('show'); }
        function initModalEvents() {
            document.addEventListener('keydown', function(e) { if (e.key === 'Escape') document.querySelectorAll('.modal-overlay.show').forEach(modal => modal.classList.remove('show')); });
            document.querySelectorAll('.modal-overlay').forEach(overlay => { overlay.addEventListener('click', function(e) { if (e.target === this) this.classList.remove('show'); }); });
        }

        // Toast æç¤º
        function showToast(message, type = 'info', duration = 3000) {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            const icons = { success: 'âœ“', error: 'âœ•', warning: '!', info: 'i' };
            toast.innerHTML = `<div class="toast-icon">${icons[type]}</div><span class="toast-message">${message}</span><span class="toast-close" onclick="this.parentElement.remove()">âœ•</span>`;
            container.appendChild(toast);
            setTimeout(() => { toast.classList.add('hiding'); setTimeout(() => toast.remove(), 300); }, duration);
        }
    </script>
</body>
</html>
