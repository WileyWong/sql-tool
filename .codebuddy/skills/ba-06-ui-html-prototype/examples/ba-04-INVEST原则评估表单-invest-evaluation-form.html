<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éœ€æ±‚ç®¡ç†ç³»ç»Ÿ - INVESTè¯„ä¼°ä¸ä¼˜å…ˆçº§æ’åº</title>
    <!-- TDesign Web Components -->
    <link rel="stylesheet" href="https://unpkg.com/tdesign-web-components@latest/dist/tdesign.css">
    <script src="https://unpkg.com/tdesign-web-components@latest/dist/TDesign%20Web%20Components.min.js"></script>
    <!-- é¡¹ç›®è‡ªå®šä¹‰æ ·å¼ -->
    <link rel="stylesheet" href="index.css">
    <link rel="stylesheet" href="layout.css">
    <style>
        /* ========== é¡µé¢ç‰¹æœ‰æ ·å¼ ========== */
        .page-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .page-title { font-size: 20px; font-weight: 600; color: #001226; }
        .page-actions { display: flex; gap: 12px; }
        .content-card { background: #fff; border-radius: 10px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06); margin-bottom: 20px; }
        .content-card-header { padding: 16px 20px; border-bottom: 1px solid #e4e6eb; display: flex; justify-content: space-between; align-items: center; }
        .content-card-title { font-size: 16px; font-weight: 600; color: #001226; }
        .content-card-body { padding: 20px; }

        /* æ­¥éª¤æ¡ */
        .steps { display: flex; justify-content: space-between; margin-bottom: 24px; position: relative; padding: 0 60px; }
        .steps::before { content: ''; position: absolute; top: 16px; left: 60px; right: 60px; height: 2px; background: #e4e6eb; }
        .step { display: flex; flex-direction: column; align-items: center; position: relative; z-index: 1; }
        .step-number { width: 32px; height: 32px; border-radius: 50%; background: #e4e6eb; color: #666; display: flex; align-items: center; justify-content: center; font-size: 14px; font-weight: 600; margin-bottom: 8px; transition: all 0.3s ease; }
        .step.active .step-number { background: #3464e0; color: #fff; }
        .step.completed .step-number { background: #2ba471; color: #fff; }
        .step-title { font-size: 12px; color: #666; }
        .step.active .step-title { color: #3464e0; font-weight: 600; }

        /* ç»Ÿè®¡å¡ç‰‡ */
        .stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; margin-bottom: 20px; }
        .stat-card { background: #fff; border-radius: 10px; padding: 20px; text-align: center; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06); }
        .stat-value { font-size: 28px; font-weight: 600; color: #3464e0; margin-bottom: 8px; }
        .stat-label { font-size: 12px; color: #666; }

        /* æ ‡ç­¾æ ·å¼ */
        .tag { display: inline-flex; align-items: center; padding: 2px 8px; border-radius: 4px; font-size: 12px; gap: 4px; }
        .tag-success { background: rgba(43, 164, 113, 0.1); color: #2ba471; }
        .tag-warning { background: rgba(255, 156, 18, 0.1); color: #ff9c12; }
        .tag-error { background: rgba(213, 73, 65, 0.1); color: #d54941; }
        .tag-brand { background: rgba(52, 100, 224, 0.1); color: #3464e0; }

        /* è¡¨æ ¼æ ·å¼ */
        .table-wrapper { overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; font-size: 14px; }
        thead { background: #f5f7f9; }
        th { padding: 12px 16px; text-align: left; font-weight: 600; color: #333; border-bottom: 1px solid #e4e6eb; white-space: nowrap; }
        td { padding: 12px 16px; border-bottom: 1px solid #e4e6eb; color: #333; }
        tr:hover { background: #f9fafc; }

        /* INVESTè¯„ä¼°å›¾æ ‡ */
        .invest-icon { width: 24px; height: 24px; display: inline-flex; align-items: center; justify-content: center; border-radius: 4px; font-size: 12px; }
        .invest-icon.pass { background: rgba(43, 164, 113, 0.1); color: #2ba471; }
        .invest-icon.warning { background: rgba(255, 156, 18, 0.1); color: #ff9c12; }
        .invest-icon.fail { background: rgba(213, 73, 65, 0.1); color: #d54941; }

        /* è¯„åˆ†è¿›åº¦æ¡ */
        .score-bar { display: flex; align-items: center; gap: 8px; }
        .score-bar .bar { flex: 1; height: 8px; background: #e4e6eb; border-radius: 4px; overflow: hidden; }
        .score-bar .bar-fill { height: 100%; border-radius: 4px; transition: width 0.5s ease; }
        .score-bar .bar-fill.high { background: #2ba471; }
        .score-bar .bar-fill.medium { background: #ff9c12; }
        .score-bar .bar-fill.low { background: #d54941; }
        .score-bar .score-text { font-weight: 600; min-width: 40px; text-align: right; }

        /* æŒ‰é’®æ ·å¼ */
        .btn { display: inline-flex; align-items: center; justify-content: center; gap: 4px; padding: 0 16px; height: 32px; border-radius: 4px; font-size: 14px; cursor: pointer; border: 1px solid transparent; transition: all 0.2s ease; }
        .btn-primary { background: #3464e0; color: #fff; border-color: #3464e0; }
        .btn-primary:hover { background: #2f5ac9; border-color: #2f5ac9; }
        .btn-primary:disabled { background: #a5b0bd; border-color: #a5b0bd; cursor: not-allowed; }
        .btn-primary.loading { pointer-events: none; opacity: 0.8; }
        .btn-outline { background: transparent; color: #3464e0; border-color: #3464e0; }
        .btn-outline:hover { background: rgba(52, 100, 224, 0.1); }
        .btn-text { background: transparent; color: #3464e0; border: none; padding: 0 8px; }
        .btn-text:hover { background: rgba(52, 100, 224, 0.1); }

        /* è¡¨å•æ ·å¼ */
        .form-group { margin-bottom: 16px; }
        .form-label { display: block; font-size: 14px; font-weight: 600; color: #333; margin-bottom: 8px; }
        .form-label .required { color: #d54941; margin-left: 2px; }
        .form-input { width: 100%; height: 32px; padding: 0 12px; border: 1px solid #dcdcdc; border-radius: 4px; font-size: 14px; color: #333; background: #fff; transition: all 0.2s ease; }
        .form-input:hover { border-color: #3464e0; }
        .form-input:focus { outline: none; border-color: #3464e0; box-shadow: 0 0 0 2px rgba(52, 100, 224, 0.2); }
        .form-textarea { min-height: 80px; padding: 8px 12px; resize: vertical; }
        .form-select { appearance: none; padding-right: 32px; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 16 16'%3E%3Cpath fill='%23666' d='M4.5 6L8 9.5 11.5 6z'/%3E%3C/svg%3E"); background-repeat: no-repeat; background-position: right 8px center; }

        /* è¯„åˆ†è¾“å…¥ç»„ */
        .score-input-group { display: grid; grid-template-columns: repeat(6, 1fr); gap: 12px; }
        .score-item { text-align: center; }
        .score-item label { display: block; font-size: 12px; color: #666; margin-bottom: 4px; }
        .score-item input { width: 100%; height: 40px; text-align: center; font-size: 16px; font-weight: 600; }

        /* ä¼˜å…ˆçº§å¡ç‰‡ */
        .priority-section { margin-bottom: 16px; }
        .priority-header { display: flex; align-items: center; gap: 8px; padding: 12px 16px; border-radius: 4px; margin-bottom: 12px; }
        .priority-header.must { background: rgba(213, 73, 65, 0.1); color: #d54941; }
        .priority-header.should { background: rgba(255, 156, 18, 0.1); color: #ff9c12; }
        .priority-header.could { background: rgba(43, 164, 113, 0.1); color: #2ba471; }
        .priority-header.wont { background: #f5f7f9; color: #666; }
        .priority-header .count { margin-left: auto; font-size: 12px; }

        .story-card { background: #fff; border: 1px solid #e4e6eb; border-radius: 4px; padding: 12px; margin-bottom: 8px; cursor: grab; transition: all 0.2s ease; }
        .story-card:hover { box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); border-color: #3464e0; }
        .story-card-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 4px; }
        .story-id { font-size: 12px; font-weight: 600; color: #3464e0; }
        .story-title { font-size: 14px; font-weight: 600; color: #333; margin-bottom: 4px; }
        .story-meta { display: flex; gap: 12px; font-size: 12px; color: #666; }

        /* è¯¦æƒ…å±•å¼€ */
        .detail-toggle { display: flex; align-items: center; gap: 4px; color: #3464e0; cursor: pointer; font-size: 14px; padding: 4px 0; }
        .detail-toggle:hover { text-decoration: underline; }
        .detail-content { display: none; padding: 12px; background: #f5f7f9; border-radius: 4px; margin-top: 8px; }
        .detail-content.show { display: block; }

        /* æ“ä½œæ  */
        .action-bar { display: flex; justify-content: space-between; align-items: center; padding: 16px 20px; background: #fff; border-radius: 10px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06); margin-top: 20px; }
        .action-bar .left { display: flex; gap: 12px; }
        .action-bar .right { display: flex; gap: 8px; }

        /* Toastæç¤º */
        #toastContainer { position: fixed; top: 80px; left: 50%; transform: translateX(-50%); z-index: 9999; display: flex; flex-direction: column; gap: 8px; }
        .toast { display: flex; align-items: center; gap: 8px; padding: 12px 20px; background: #fff; border-radius: 8px; box-shadow: 0 6px 16px rgba(0, 0, 0, 0.15); animation: slideIn 0.3s ease; min-width: 280px; }
        .toast.success { border-left: 4px solid #2ba471; }
        .toast.error { border-left: 4px solid #d54941; }
        .toast.warning { border-left: 4px solid #ff9c12; }
        .toast.info { border-left: 4px solid #3464e0; }
        .toast-icon { width: 20px; height: 20px; display: flex; align-items: center; justify-content: center; }
        .toast-message { flex: 1; font-size: 14px; }
        .toast-close { cursor: pointer; color: #999; }
        @keyframes slideIn { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }

        /* æ¨¡æ€æ¡† */
        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.5); display: none; align-items: center; justify-content: center; z-index: 9998; }
        .modal-overlay.show { display: flex; }
        .modal { background: #fff; border-radius: 8px; box-shadow: 0 12px 32px rgba(0, 0, 0, 0.2); min-width: 400px; max-width: 600px; animation: modalIn 0.2s ease; }
        .modal-header { padding: 16px 20px; border-bottom: 1px solid #e4e6eb; display: flex; justify-content: space-between; align-items: center; }
        .modal-title { font-size: 16px; font-weight: 600; }
        .modal-close { cursor: pointer; color: #999; font-size: 20px; }
        .modal-body { padding: 20px; }
        .modal-footer { padding: 12px 20px; border-top: 1px solid #e4e6eb; display: flex; justify-content: flex-end; gap: 8px; }
        @keyframes modalIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }

        .spinner { width: 16px; height: 16px; border: 2px solid transparent; border-top-color: currentColor; border-radius: 50%; animation: spin 0.8s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* ä¸¤æ å¸ƒå±€ */
        .two-column { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        @media (max-width: 1024px) {
            .two-column { grid-template-columns: 1fr; }
            .stats-grid { grid-template-columns: repeat(2, 1fr); }
            .score-input-group { grid-template-columns: repeat(3, 1fr); }
        }
    </style>
</head>
<body>
    <!-- ========== é¡¶éƒ¨å¯¼èˆªæ  ========== -->
    <div class="sticky-header">
        <div class="header-background"></div>
        <div class="sticky-content">
            <div class="header-left">
                <button class="mobile-menu-btn header-action" onclick="toggleMobileSidebar()">â˜°</button>
                <div class="logo">éœ€æ±‚ç®¡ç†ç³»ç»Ÿ</div>
                <div class="search-resume">
                    <div class="search-input"><input type="text" placeholder="æœç´¢éœ€æ±‚ã€æ•…äº‹..."></div>
                    <button class="search-btn">æœç´¢</button>
                </div>
            </div>
            <div class="header-right">
                <div class="head-navigation">
                    <span class="navigation-item">é¡¹ç›®çœ‹æ¿</span>
                    <span class="navigation-item">è¿­ä»£è®¡åˆ’</span>
                    <span class="navigation-item">æŠ¥è¡¨ä¸­å¿ƒ</span>
                </div>
                <div class="header-action" title="é€šçŸ¥">ğŸ””</div>
                <div class="header-action" title="å¸®åŠ©">â“</div>
                <div class="header-user" onclick="toggleUserDropdown()">
                    <div class="header-user-avatar">å¼ </div>
                    <span class="header-user-name">å¼ ä¸‰</span>
                    <span style="font-size: 10px;">â–¼</span>
                    <div class="user-dropdown" id="userDropdown">
                        <div class="dropdown-item"><span>ğŸ‘¤</span><span>ä¸ªäººä¸­å¿ƒ</span></div>
                        <div class="dropdown-item"><span>âš™ï¸</span><span>è´¦å·è®¾ç½®</span></div>
                        <div class="dropdown-divider"></div>
                        <div class="dropdown-item" style="color: #f66664;"><span>ğŸšª</span><span>é€€å‡ºç™»å½•</span></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ========== å†…å®¹å¸ƒå±€åŒºåŸŸ ========== -->
    <div class="content-layout">
        <!-- ========== å·¦ä¾§å¯¼èˆªæ  ========== -->
        <div class="left_nav">
            <div class="left_layout" id="sidebar">
                <div class="user-info">
                    <div class="user-photo">
                        <div style="width: 100%; height: 100%; background: linear-gradient(135deg, #3464e0, #5d9efe); display: flex; align-items: center; justify-content: center; color: #fff; font-size: 18px;">å¼ </div>
                    </div>
                    <div class="user-name">å¼ ä¸‰</div>
                </div>
                <div class="nav">
                    <div class="nav-auto">
                        <ul>
                            <li><a href="html-content-homepage.html"><i class="icon">ğŸ </i><span class="name">é¦–é¡µ</span></a></li>
                            <li><a href="html-content-homepage.html"><i class="icon">ğŸ“Š</i><span class="name">ä»ªè¡¨ç›˜</span></a></li>
                            <li><a href="html-content-search-data-list.html"><i class="icon">ğŸ“‹</i><span class="name">è®¢å•åˆ—è¡¨</span></a></li>
                            <li><a href="html-content-cards.html"><i class="icon">ğŸ“</i><span class="name">é¡¹ç›®åˆ—è¡¨</span></a></li>
                            <li><a href="html-content-details.html"><i class="icon">ğŸ“„</i><span class="name">è¯¦æƒ…é¡µ</span></a></li>
                            <li><a href="html-form-filling-submit.html"><i class="icon">ğŸ“</i><span class="name">è¡¨å•æäº¤</span></a></li>
                            <li><a href="html-content-hr-selectors.html"><i class="icon">ğŸ‘¥</i><span class="name">äººå‘˜é€‰æ‹©</span></a></li>
                            <li><a href="html-content-dialogs.html"><i class="icon">ğŸ¯</i><span class="name">å¼¹çª—ç¤ºä¾‹</span></a></li>
                        </ul>
                        <ul>
                            <li><a href="ba-04-INVESTåŸåˆ™è¯„ä¼°è¡¨å•-invest-evaluation-form.html" class="router-link-active"><i class="icon">ğŸ“ˆ</i><span class="name">INVESTè¯„ä¼°</span></a></li>
                            <li><a href="US-015-é…ç½®BGçº§å®¡æ‰¹è§„åˆ™-approval-rule-config.html"><i class="icon">âš™ï¸</i><span class="name">å®¡æ‰¹è§„åˆ™</span></a></li>
                        </ul>
                        <ul>
                            <li class="slide-btn"><div class="slide-icon" onclick="toggleSidebar()" title="æ”¶èµ·/å±•å¼€èœå•"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 19l-7-7 7-7M18 19l-7-7 7-7"/></svg></div></li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="sidebar-overlay" onclick="closeMobileSidebar()"></div>
        </div>
        
        <!-- ========== è§†å›¾å®¹å™¨ ========== -->
        <div class="view-container">
            <div class="page-header">
                <h1 class="page-title">INVESTè¯„ä¼°ä¸ä¼˜å…ˆçº§æ’åº</h1>
                <div class="page-actions">
                    <button class="btn btn-outline" onclick="exportReport()">å¯¼å‡ºæŠ¥å‘Š</button>
                    <button class="btn btn-primary" onclick="openAddStoryModal()">+ æ·»åŠ æ•…äº‹</button>
                </div>
            </div>
            
            <!-- æ­¥éª¤æ¡ -->
            <div class="content-card">
                <div class="content-card-body">
                    <p style="color: #666; margin-bottom: 16px;">å¯¹ç”¨æˆ·æ•…äº‹è¿›è¡ŒINVESTåŸåˆ™è¯„ä¼°ï¼Œè¯†åˆ«è´¨é‡é—®é¢˜å¹¶æå‡ºæ”¹è¿›å»ºè®®ï¼ŒåŒæ—¶æŒ‰MoSCoWæ–¹æ³•è¿›è¡Œä¼˜å…ˆçº§æ’åº</p>
                    <div class="steps">
                        <div class="step completed" data-step="1"><div class="step-number">âœ“</div><div class="step-title">å¯¼å…¥æ•…äº‹</div></div>
                        <div class="step active" data-step="2"><div class="step-number">2</div><div class="step-title">INVESTè¯„ä¼°</div></div>
                        <div class="step" data-step="3"><div class="step-number">3</div><div class="step-title">ä¼˜å…ˆçº§æ’åº</div></div>
                        <div class="step" data-step="4"><div class="step-number">4</div><div class="step-title">ç”ŸæˆæŠ¥å‘Š</div></div>
                    </div>
                </div>
            </div>

            <!-- ç»Ÿè®¡æ¦‚è§ˆ -->
            <div class="stats-grid">
                <div class="stat-card"><div class="stat-value" id="totalStories">8</div><div class="stat-label">æ•…äº‹æ€»æ•°</div></div>
                <div class="stat-card"><div class="stat-value" id="passedStories" style="color: #2ba471">5</div><div class="stat-label">é€šè¿‡ï¼ˆâ‰¥85åˆ†ï¼‰</div></div>
                <div class="stat-card"><div class="stat-value" id="warningStories" style="color: #ff9c12">2</div><div class="stat-label">éœ€æ”¹è¿›ï¼ˆ70-84åˆ†ï¼‰</div></div>
                <div class="stat-card"><div class="stat-value" id="failedStories" style="color: #d54941">1</div><div class="stat-label">éœ€é‡å†™ï¼ˆ<70åˆ†ï¼‰</div></div>
            </div>

            <!-- INVESTè¯„ä¼°æ€»è§ˆè¡¨æ ¼ -->
            <div class="content-card">
                <div class="content-card-header">
                    <div class="content-card-title"><span>ğŸ“Š</span> INVESTè¯„ä¼°æ€»è§ˆ</div>
                </div>
                <div class="content-card-body">
                    <div class="table-wrapper">
                        <table id="investTable">
                            <thead>
                                <tr><th>æ•…äº‹ID</th><th>æ•…äº‹æ ‡é¢˜</th><th>I</th><th>N</th><th>V</th><th>E</th><th>S</th><th>T</th><th>ç»¼åˆåˆ†</th><th>æ•…äº‹ç‚¹</th><th>çŠ¶æ€</th><th>æ“ä½œ</th></tr>
                            </thead>
                            <tbody id="investTableBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- ä¸¤æ å¸ƒå±€ï¼šé—®é¢˜æ•…äº‹è¯¦æƒ… + ä¼˜å…ˆçº§æ’åº -->
            <div class="two-column">
                <div class="content-card">
                    <div class="content-card-header">
                        <div class="content-card-title"><span>âš ï¸</span> é—®é¢˜æ•…äº‹è¯¦ç»†åˆ†æ</div>
                        <span class="tag tag-warning">3ä¸ªéœ€å…³æ³¨</span>
                    </div>
                    <div class="content-card-body" id="problemStoriesContainer"></div>
                </div>

                <div class="content-card">
                    <div class="content-card-header">
                        <div class="content-card-title"><span>ğŸ¯</span> MoSCoWä¼˜å…ˆçº§åˆ†ç±»</div>
                        <button class="btn btn-text" onclick="autoSort()">è‡ªåŠ¨æ’åº</button>
                    </div>
                    <div class="content-card-body" id="priorityContainer">
                        <div class="priority-section" id="mustHave">
                            <div class="priority-header must"><span>ğŸ”´</span><strong>Must Haveï¼ˆå¿…é¡»æœ‰ï¼‰</strong><span class="count">3ä¸ªæ•…äº‹</span></div>
                            <div class="priority-stories" data-priority="must"></div>
                        </div>
                        <div class="priority-section" id="shouldHave">
                            <div class="priority-header should"><span>ğŸŸ¡</span><strong>Should Haveï¼ˆåº”è¯¥æœ‰ï¼‰</strong><span class="count">2ä¸ªæ•…äº‹</span></div>
                            <div class="priority-stories" data-priority="should"></div>
                        </div>
                        <div class="priority-section" id="couldHave">
                            <div class="priority-header could"><span>ğŸŸ¢</span><strong>Could Haveï¼ˆå¯ä»¥æœ‰ï¼‰</strong><span class="count">2ä¸ªæ•…äº‹</span></div>
                            <div class="priority-stories" data-priority="could"></div>
                        </div>
                        <div class="priority-section" id="wontHave">
                            <div class="priority-header wont"><span>âšª</span><strong>Won't Haveï¼ˆæš‚ä¸å®ç°ï¼‰</strong><span class="count">1ä¸ªæ•…äº‹</span></div>
                            <div class="priority-stories" data-priority="wont"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- æ“ä½œæ  -->
            <div class="action-bar">
                <div class="left"><span style="color: #666;">å·²è¯„ä¼° <strong>8</strong> ä¸ªæ•…äº‹ï¼Œæ•…äº‹ç‚¹æ€»è®¡ <strong>34</strong> ç‚¹</span></div>
                <div class="right">
                    <button class="btn btn-outline" onclick="saveDraft()">ä¿å­˜è‰ç¨¿</button>
                    <button class="btn btn-primary" id="submitBtn" onclick="submitEvaluation()">æäº¤è¯„ä¼°</button>
                </div>
            </div>
        </div>
    </div>

    <div id="toastContainer"></div>

    <!-- æ·»åŠ æ•…äº‹æ¨¡æ€æ¡† -->
    <div class="modal-overlay" id="addStoryModal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title">æ·»åŠ ç”¨æˆ·æ•…äº‹</div>
                <span class="modal-close" onclick="closeModal('addStoryModal')">&times;</span>
            </div>
            <div class="modal-body">
                <div class="form-group"><label class="form-label">æ•…äº‹ID <span class="required">*</span></label><input type="text" class="form-input" id="storyId" placeholder="ä¾‹å¦‚ï¼šUS009"></div>
                <div class="form-group"><label class="form-label">æ•…äº‹æ ‡é¢˜ <span class="required">*</span></label><input type="text" class="form-input" id="storyTitle" placeholder="ç®€è¦æè¿°æ•…äº‹åŠŸèƒ½"></div>
                <div class="form-group"><label class="form-label">ç”¨æˆ·æ•…äº‹ <span class="required">*</span></label><textarea class="form-input form-textarea" id="storyContent" placeholder="ä½œä¸º...æˆ‘å¸Œæœ›...ä»¥ä¾¿..."></textarea></div>
                <div class="form-group">
                    <label class="form-label">INVESTè¯„åˆ†</label>
                    <div class="score-input-group">
                        <div class="score-item"><label>I ç‹¬ç«‹æ€§</label><input type="number" class="form-input" id="scoreI" min="0" max="20" value="15"></div>
                        <div class="score-item"><label>N å¯åå•†</label><input type="number" class="form-input" id="scoreN" min="0" max="20" value="15"></div>
                        <div class="score-item"><label>V æœ‰ä»·å€¼</label><input type="number" class="form-input" id="scoreV" min="0" max="20" value="15"></div>
                        <div class="score-item"><label>E å¯ä¼°ç®—</label><input type="number" class="form-input" id="scoreE" min="0" max="20" value="15"></div>
                        <div class="score-item"><label>S å°ç²’åº¦</label><input type="number" class="form-input" id="scoreS" min="0" max="20" value="15"></div>
                        <div class="score-item"><label>T å¯æµ‹è¯•</label><input type="number" class="form-input" id="scoreT" min="0" max="20" value="15"></div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">æ•…äº‹ç‚¹</label>
                    <select class="form-input form-select" id="storyPoints">
                        <option value="1">1 - ç®€å•é…ç½®</option><option value="2">2 - ç®€å•CRUD</option><option value="3" selected>3 - æ ‡å‡†è¡¨å•</option><option value="5">5 - å¤æ‚ä¸šåŠ¡é€»è¾‘</option><option value="8">8 - è·¨æ¨¡å—åŠŸèƒ½</option><option value="13">13 - éœ€æ‹†åˆ†</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('addStoryModal')">å–æ¶ˆ</button>
                <button class="btn btn-primary" onclick="addStory()">æ·»åŠ </button>
            </div>
        </div>
    </div>

    <!-- ç¼–è¾‘æ•…äº‹æ¨¡æ€æ¡† -->
    <div class="modal-overlay" id="editStoryModal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title">ç¼–è¾‘è¯„ä¼° - <span id="editStoryId"></span></div>
                <span class="modal-close" onclick="closeModal('editStoryModal')">&times;</span>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">INVESTè¯„åˆ†</label>
                    <div class="score-input-group">
                        <div class="score-item"><label>I ç‹¬ç«‹æ€§</label><input type="number" class="form-input" id="editScoreI" min="0" max="20"></div>
                        <div class="score-item"><label>N å¯åå•†</label><input type="number" class="form-input" id="editScoreN" min="0" max="20"></div>
                        <div class="score-item"><label>V æœ‰ä»·å€¼</label><input type="number" class="form-input" id="editScoreV" min="0" max="20"></div>
                        <div class="score-item"><label>E å¯ä¼°ç®—</label><input type="number" class="form-input" id="editScoreE" min="0" max="20"></div>
                        <div class="score-item"><label>S å°ç²’åº¦</label><input type="number" class="form-input" id="editScoreS" min="0" max="20"></div>
                        <div class="score-item"><label>T å¯æµ‹è¯•</label><input type="number" class="form-input" id="editScoreT" min="0" max="20"></div>
                    </div>
                </div>
                <div class="form-group"><label class="form-label">é—®é¢˜æè¿°</label><textarea class="form-input form-textarea" id="editProblem" placeholder="æè¿°å…·ä½“é—®é¢˜..."></textarea></div>
                <div class="form-group"><label class="form-label">æ”¹è¿›å»ºè®®</label><textarea class="form-input form-textarea" id="editSuggestion" placeholder="æä¾›æ”¹è¿›å»ºè®®..."></textarea></div>
                <div class="form-group">
                    <label class="form-label">ä¼˜å…ˆçº§</label>
                    <select class="form-input form-select" id="editPriority">
                        <option value="must">ğŸ”´ Must Have</option><option value="should">ğŸŸ¡ Should Have</option><option value="could">ğŸŸ¢ Could Have</option><option value="wont">âšª Won't Have</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('editStoryModal')">å–æ¶ˆ</button>
                <button class="btn btn-primary" onclick="saveEdit()">ä¿å­˜</button>
            </div>
        </div>
    </div>

    <script>
        // ä¾§è¾¹æ äº¤äº’
        function toggleSidebar() { document.getElementById('sidebar').classList.toggle('collapsed'); }
        function toggleMobileSidebar() { document.getElementById('sidebar').classList.add('mobile-show'); }
        function closeMobileSidebar() { document.getElementById('sidebar').classList.remove('mobile-show'); }
        function toggleUserDropdown() { event.stopPropagation(); document.getElementById('userDropdown').classList.toggle('show'); }
        document.addEventListener('click', function(e) { if (!e.target.closest('.header-user')) document.getElementById('userDropdown').classList.remove('show'); });
        document.querySelectorAll('.nav li a:not([onclick])').forEach(item => { item.addEventListener('click', function() { document.querySelectorAll('.nav li a').forEach(i => i.classList.remove('router-link-active')); this.classList.add('router-link-active'); }); });

        // æ¨¡æ‹Ÿæ•°æ®
        let stories = [
            { id: 'US001', title: 'ç”¨æˆ·ç™»å½•è®¤è¯', content: 'ä½œä¸ºç³»ç»Ÿç”¨æˆ·ï¼Œæˆ‘å¸Œæœ›èƒ½å¤Ÿå®‰å…¨ç™»å½•ç³»ç»Ÿï¼Œä»¥ä¾¿è®¿é—®ä¸ªäººæ•°æ®', scores: { I: 20, N: 18, V: 20, E: 18, S: 15, T: 18 }, points: 3, priority: 'must', problem: '', suggestion: '' },
            { id: 'US002', title: 'è®¢å•åˆ—è¡¨æŸ¥è¯¢', content: 'ä½œä¸ºè¿è¥äººå‘˜ï¼Œæˆ‘å¸Œæœ›èƒ½å¤ŸæŸ¥è¯¢è®¢å•åˆ—è¡¨ï¼Œä»¥ä¾¿äº†è§£è®¢å•çŠ¶æ€', scores: { I: 18, N: 15, V: 18, E: 20, S: 18, T: 15 }, points: 5, priority: 'must', problem: '', suggestion: '' },
            { id: 'US003', title: 'è®¢å•è¯¦æƒ…å¯¼å‡º', content: 'ä½œä¸ºè´¢åŠ¡äººå‘˜ï¼Œæˆ‘å¸Œæœ›èƒ½å¤Ÿå¯¼å‡ºè®¢å•è¯¦æƒ…ï¼Œä»¥ä¾¿è¿›è¡Œè´¢åŠ¡æ ¸ç®—', scores: { I: 10, N: 15, V: 15, E: 10, S: 15, T: 15 }, points: 5, priority: 'should', problem: 'ç‹¬ç«‹æ€§ä¸è¶³ï¼šä¾èµ–US002çš„è®¢å•æŸ¥è¯¢åŠŸèƒ½ï¼›å¯ä¼°ç®—é—®é¢˜ï¼šå¯¼å‡ºæ ¼å¼å’Œæ•°æ®é‡ä¸æ˜ç¡®', suggestion: '1. æ˜ç¡®å¯¼å‡ºæ–‡ä»¶æ ¼å¼ï¼ˆExcel/CSVï¼‰\n2. å®šä¹‰å•æ¬¡å¯¼å‡ºæ•°æ®é‡ä¸Šé™\n3. å¯ä¸US002å¹¶è¡Œå¼€å‘ï¼Œä½¿ç”¨Mockæ•°æ®' },
            { id: 'US004', title: 'ç”¨æˆ·æƒé™ç®¡ç†', content: 'ä½œä¸ºç®¡ç†å‘˜ï¼Œæˆ‘å¸Œæœ›èƒ½å¤Ÿç®¡ç†ç”¨æˆ·æƒé™ï¼Œä»¥ä¾¿æ§åˆ¶ç³»ç»Ÿè®¿é—®', scores: { I: 20, N: 18, V: 20, E: 15, S: 12, T: 18 }, points: 8, priority: 'must', problem: '', suggestion: '' },
            { id: 'US005', title: 'æ•°æ®ç»Ÿè®¡æŠ¥è¡¨', content: 'ä½œä¸ºç®¡ç†å±‚ï¼Œæˆ‘å¸Œæœ›èƒ½å¤ŸæŸ¥çœ‹æ•°æ®ç»Ÿè®¡æŠ¥è¡¨ï¼Œä»¥ä¾¿åšå‡ºå†³ç­–', scores: { I: 15, N: 12, V: 18, E: 8, S: 10, T: 12 }, points: 8, priority: 'should', problem: 'å¯ä¼°ç®—é—®é¢˜ï¼šæŠ¥è¡¨ç±»å‹å’Œç»Ÿè®¡ç»´åº¦ä¸æ˜ç¡®ï¼›å°ç²’åº¦é—®é¢˜ï¼šåŠŸèƒ½èŒƒå›´è¿‡å¤§ï¼Œå»ºè®®æ‹†åˆ†', suggestion: '1. æ˜ç¡®éœ€è¦å“ªäº›å…·ä½“æŠ¥è¡¨\n2. æ‹†åˆ†ä¸ºå¤šä¸ªå°æ•…äº‹ï¼šé”€å”®æŠ¥è¡¨ã€ç”¨æˆ·æŠ¥è¡¨ã€åº“å­˜æŠ¥è¡¨\n3. å®šä¹‰æ¯ä¸ªæŠ¥è¡¨çš„å…·ä½“ç»Ÿè®¡æŒ‡æ ‡' },
            { id: 'US006', title: 'æ¶ˆæ¯é€šçŸ¥æ¨é€', content: 'ä½œä¸ºç”¨æˆ·ï¼Œæˆ‘å¸Œæœ›èƒ½å¤Ÿæ¥æ”¶ç³»ç»Ÿé€šçŸ¥ï¼Œä»¥ä¾¿åŠæ—¶äº†è§£é‡è¦ä¿¡æ¯', scores: { I: 18, N: 15, V: 15, E: 18, S: 15, T: 18 }, points: 3, priority: 'could', problem: '', suggestion: '' },
            { id: 'US007', title: 'å¤šè¯­è¨€æ”¯æŒ', content: 'ä½œä¸ºå›½é™…ç”¨æˆ·ï¼Œæˆ‘å¸Œæœ›ç³»ç»Ÿæ”¯æŒå¤šè¯­è¨€ï¼Œä»¥ä¾¿æ›´å¥½åœ°ä½¿ç”¨ç³»ç»Ÿ', scores: { I: 20, N: 18, V: 12, E: 15, S: 10, T: 15 }, points: 13, priority: 'could', problem: 'å°ç²’åº¦é—®é¢˜ï¼šæ¶‰åŠå…¨ç³»ç»Ÿæ”¹é€ ï¼Œå·¥ä½œé‡å¤§', suggestion: '1. åˆ†é˜¶æ®µå®æ–½ï¼šå…ˆæ”¯æŒè‹±æ–‡ï¼Œå†æ‰©å±•å…¶ä»–è¯­è¨€\n2. ä¼˜å…ˆå¤„ç†æ ¸å¿ƒé¡µé¢\n3. å»ºè®®æ‹†åˆ†ä¸ºå¤šä¸ªè¿­ä»£å®Œæˆ' },
            { id: 'US008', title: 'æ·±è‰²æ¨¡å¼', content: 'ä½œä¸ºç”¨æˆ·ï¼Œæˆ‘å¸Œæœ›ç³»ç»Ÿæ”¯æŒæ·±è‰²æ¨¡å¼ï¼Œä»¥ä¾¿åœ¨å¤œé—´ä½¿ç”¨', scores: { I: 20, N: 20, V: 10, E: 18, S: 15, T: 18 }, points: 2, priority: 'wont', problem: '', suggestion: '' }
        ];

        // å·¥å…·å‡½æ•°
        function calculateTotalScore(scores) { return Object.values(scores).reduce((a, b) => a + b, 0); }
        function getScoreStatus(score) {
            if (score >= 85) return { status: 'pass', label: 'é€šè¿‡', class: 'tag-success' };
            if (score >= 70) return { status: 'warning', label: 'éœ€æ”¹è¿›', class: 'tag-warning' };
            return { status: 'fail', label: 'éœ€é‡å†™', class: 'tag-error' };
        }
        function getScoreIcon(score) {
            if (score >= 15) return '<span class="invest-icon pass">âœ“</span>';
            if (score >= 10) return '<span class="invest-icon warning">!</span>';
            return '<span class="invest-icon fail">âœ—</span>';
        }
        function showToast(message, type = 'info', duration = 3000) {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            const icons = { success: 'âœ“', error: 'âœ—', warning: '!', info: 'â„¹' };
            toast.innerHTML = `<span class="toast-icon">${icons[type]}</span><span class="toast-message">${message}</span><span class="toast-close" onclick="this.parentElement.remove()">Ã—</span>`;
            container.appendChild(toast);
            setTimeout(() => { toast.style.animation = 'slideIn 0.3s ease reverse'; setTimeout(() => toast.remove(), 300); }, duration);
        }
        function openModal(modalId) { document.getElementById(modalId).classList.add('show'); }
        function closeModal(modalId) { document.getElementById(modalId).classList.remove('show'); }
        function setButtonLoading(btn, loading) {
            if (loading) { btn.disabled = true; btn.classList.add('loading'); btn.dataset.originalText = btn.innerHTML; btn.innerHTML = '<span class="spinner"></span> å¤„ç†ä¸­...'; }
            else { btn.disabled = false; btn.classList.remove('loading'); btn.innerHTML = btn.dataset.originalText; }
        }

        // æ¸²æŸ“å‡½æ•°
        function renderInvestTable() {
            document.getElementById('investTableBody').innerHTML = stories.map(story => {
                const total = calculateTotalScore(story.scores);
                const status = getScoreStatus(total);
                return `<tr>
                    <td><span class="story-id">${story.id}</span></td>
                    <td>${story.title}</td>
                    <td>${getScoreIcon(story.scores.I)}</td><td>${getScoreIcon(story.scores.N)}</td><td>${getScoreIcon(story.scores.V)}</td>
                    <td>${getScoreIcon(story.scores.E)}</td><td>${getScoreIcon(story.scores.S)}</td><td>${getScoreIcon(story.scores.T)}</td>
                    <td><div class="score-bar"><div class="bar"><div class="bar-fill ${status.status === 'pass' ? 'high' : status.status === 'warning' ? 'medium' : 'low'}" style="width: ${total}%"></div></div><span class="score-text">${total}</span></div></td>
                    <td><span class="tag tag-brand">${story.points}ç‚¹</span></td>
                    <td><span class="tag ${status.class}">${status.label}</span></td>
                    <td><button class="btn btn-text" onclick="editStory('${story.id}')">ç¼–è¾‘</button><button class="btn btn-text" style="color: #d54941" onclick="deleteStory('${story.id}')">åˆ é™¤</button></td>
                </tr>`;
            }).join('');
        }

        function renderProblemStories() {
            const container = document.getElementById('problemStoriesContainer');
            const problemStories = stories.filter(s => calculateTotalScore(s.scores) < 85);
            if (problemStories.length === 0) { container.innerHTML = `<div style="text-align: center; padding: 48px 24px; color: #666;"><div style="font-size: 48px; margin-bottom: 12px; opacity: 0.5;">ğŸ‰</div><p>æ‰€æœ‰æ•…äº‹è¯„ä¼°é€šè¿‡ï¼Œæ— éœ€æ”¹è¿›ï¼</p></div>`; return; }
            container.innerHTML = problemStories.map(story => {
                const total = calculateTotalScore(story.scores);
                const status = getScoreStatus(total);
                const problemDimensions = [];
                if (story.scores.I < 15) problemDimensions.push('I(ç‹¬ç«‹æ€§)');
                if (story.scores.N < 15) problemDimensions.push('N(å¯åå•†)');
                if (story.scores.V < 15) problemDimensions.push('V(æœ‰ä»·å€¼)');
                if (story.scores.E < 15) problemDimensions.push('E(å¯ä¼°ç®—)');
                if (story.scores.S < 15) problemDimensions.push('S(å°ç²’åº¦)');
                if (story.scores.T < 15) problemDimensions.push('T(å¯æµ‹è¯•)');
                return `<div class="story-card">
                    <div class="story-card-header"><span class="story-id">${story.id}</span><span class="tag ${status.class}">${total}åˆ†</span></div>
                    <div class="story-title">${story.title}</div>
                    <div class="story-meta"><span>é—®é¢˜ç»´åº¦ï¼š${problemDimensions.join('ã€') || 'æ— '}</span></div>
                    <div class="detail-toggle" onclick="toggleDetail(this)"><span>â–¶</span> æŸ¥çœ‹è¯¦æƒ…</div>
                    <div class="detail-content">
                        <p style="margin-bottom: 8px;"><strong>é—®é¢˜æè¿°ï¼š</strong></p>
                        <p style="color: #666; margin-bottom: 12px;">${story.problem || 'æš‚æ— æè¿°'}</p>
                        <p style="margin-bottom: 8px;"><strong>æ”¹è¿›å»ºè®®ï¼š</strong></p>
                        <p style="color: #666; white-space: pre-line;">${story.suggestion || 'æš‚æ— å»ºè®®'}</p>
                    </div>
                </div>`;
            }).join('');
        }

        function renderPriorityStories() {
            ['must', 'should', 'could', 'wont'].forEach(priority => {
                const container = document.querySelector(`[data-priority="${priority}"]`);
                const priorityStories = stories.filter(s => s.priority === priority);
                container.previousElementSibling.querySelector('.count').textContent = `${priorityStories.length}ä¸ªæ•…äº‹`;
                container.innerHTML = priorityStories.map(story => {
                    const total = calculateTotalScore(story.scores);
                    return `<div class="story-card" draggable="true" data-id="${story.id}">
                        <div class="story-card-header"><span class="story-id">${story.id}</span><span class="tag tag-brand">${story.points}ç‚¹</span></div>
                        <div class="story-title">${story.title}</div>
                        <div class="story-meta"><span>è¯„åˆ†ï¼š${total}åˆ†</span></div>
                    </div>`;
                }).join('') || '<p style="color: #999; text-align: center; padding: 12px;">æš‚æ— æ•…äº‹</p>';
            });
        }

        function updateStats() {
            const passed = stories.filter(s => calculateTotalScore(s.scores) >= 85).length;
            const warning = stories.filter(s => { const score = calculateTotalScore(s.scores); return score >= 70 && score < 85; }).length;
            const failed = stories.filter(s => calculateTotalScore(s.scores) < 70).length;
            document.getElementById('totalStories').textContent = stories.length;
            document.getElementById('passedStories').textContent = passed;
            document.getElementById('warningStories').textContent = warning;
            document.getElementById('failedStories').textContent = failed;
        }

        function toggleDetail(element) {
            const content = element.nextElementSibling;
            const isShow = content.classList.toggle('show');
            element.innerHTML = isShow ? '<span>â–¼</span> æ”¶èµ·è¯¦æƒ…' : '<span>â–¶</span> æŸ¥çœ‹è¯¦æƒ…';
        }

        // ä¸šåŠ¡é€»è¾‘å‡½æ•°
        function openAddStoryModal() {
            document.getElementById('storyId').value = '';
            document.getElementById('storyTitle').value = '';
            document.getElementById('storyContent').value = '';
            ['I','N','V','E','S','T'].forEach(k => document.getElementById('score'+k).value = 15);
            document.getElementById('storyPoints').value = 3;
            openModal('addStoryModal');
        }

        function addStory() {
            const id = document.getElementById('storyId').value.trim();
            const title = document.getElementById('storyTitle').value.trim();
            const content = document.getElementById('storyContent').value.trim();
            if (!id || !title || !content) { showToast('è¯·å¡«å†™å¿…å¡«é¡¹', 'error'); return; }
            if (stories.find(s => s.id === id)) { showToast('æ•…äº‹IDå·²å­˜åœ¨', 'error'); return; }
            stories.push({
                id, title, content,
                scores: { I: parseInt(document.getElementById('scoreI').value), N: parseInt(document.getElementById('scoreN').value), V: parseInt(document.getElementById('scoreV').value), E: parseInt(document.getElementById('scoreE').value), S: parseInt(document.getElementById('scoreS').value), T: parseInt(document.getElementById('scoreT').value) },
                points: parseInt(document.getElementById('storyPoints').value), priority: 'should', problem: '', suggestion: ''
            });
            closeModal('addStoryModal');
            renderAll();
            showToast('æ•…äº‹æ·»åŠ æˆåŠŸ', 'success');
        }

        let currentEditId = null;
        function editStory(id) {
            const story = stories.find(s => s.id === id);
            if (!story) return;
            currentEditId = id;
            document.getElementById('editStoryId').textContent = id;
            ['I','N','V','E','S','T'].forEach(k => document.getElementById('editScore'+k).value = story.scores[k]);
            document.getElementById('editProblem').value = story.problem;
            document.getElementById('editSuggestion').value = story.suggestion;
            document.getElementById('editPriority').value = story.priority;
            openModal('editStoryModal');
        }

        function saveEdit() {
            const story = stories.find(s => s.id === currentEditId);
            if (!story) return;
            story.scores = { I: parseInt(document.getElementById('editScoreI').value), N: parseInt(document.getElementById('editScoreN').value), V: parseInt(document.getElementById('editScoreV').value), E: parseInt(document.getElementById('editScoreE').value), S: parseInt(document.getElementById('editScoreS').value), T: parseInt(document.getElementById('editScoreT').value) };
            story.problem = document.getElementById('editProblem').value;
            story.suggestion = document.getElementById('editSuggestion').value;
            story.priority = document.getElementById('editPriority').value;
            closeModal('editStoryModal');
            renderAll();
            showToast('ä¿å­˜æˆåŠŸ', 'success');
        }

        function deleteStory(id) {
            if (!confirm(`ç¡®å®šåˆ é™¤æ•…äº‹ ${id} å—ï¼Ÿ`)) return;
            stories = stories.filter(s => s.id !== id);
            renderAll();
            showToast('åˆ é™¤æˆåŠŸ', 'success');
        }

        function autoSort() {
            stories.forEach(story => {
                const score = calculateTotalScore(story.scores);
                if (score >= 90 && story.points <= 5) story.priority = 'must';
                else if (score >= 80) story.priority = 'should';
                else if (score >= 70) story.priority = 'could';
                else story.priority = 'wont';
            });
            renderPriorityStories();
            showToast('è‡ªåŠ¨æ’åºå®Œæˆ', 'success');
        }

        function saveDraft() { localStorage.setItem('investEvaluation', JSON.stringify(stories)); showToast('è‰ç¨¿å·²ä¿å­˜', 'success'); }
        function submitEvaluation() { const btn = document.getElementById('submitBtn'); setButtonLoading(btn, true); setTimeout(() => { setButtonLoading(btn, false); showToast('è¯„ä¼°æäº¤æˆåŠŸï¼', 'success'); }, 1500); }
        function exportReport() { showToast('æŠ¥å‘Šå¯¼å‡ºä¸­...', 'info'); setTimeout(() => showToast('æŠ¥å‘Šå·²å¯¼å‡º', 'success'), 1000); }
        function renderAll() { renderInvestTable(); renderProblemStories(); renderPriorityStories(); updateStats(); }

        // äº‹ä»¶ç»‘å®š
        document.addEventListener('DOMContentLoaded', function() {
            renderAll();
            document.addEventListener('keydown', function(e) { if (e.key === 'Escape') document.querySelectorAll('.modal-overlay.show').forEach(modal => modal.classList.remove('show')); });
            document.querySelectorAll('.modal-overlay').forEach(overlay => { overlay.addEventListener('click', function(e) { if (e.target === this) this.classList.remove('show'); }); });
        });
    </script>
</body>
</html>
