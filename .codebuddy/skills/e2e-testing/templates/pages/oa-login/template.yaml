# 腾讯 OA 登录页面模板
# 
# 适用场景：腾讯内部 OA 系统登录（passport.woa.com）
# 
# 使用说明：
# 1. 复制 template.js 到 pages/oaLogin.page.js
# 2. 根据实际登录 URL 修改 gotoLogin 方法
# 3. 如果 placeholder 不同，修改定位器

metadata:
  name: OA 登录页面
  type: auth-entry
  description: 腾讯内部 OA 系统登录页面模板
  
# 页面元素定义
elements:
  - name: englishId
    description: 英文 ID 输入框
    locator: getByPlaceholder('英文 ID')
    type: input
    wait: visible
    notes: |
      - 必须使用 getByPlaceholder，不要用 getByRole
      - placeholder 文本可能因环境不同而变化

  - name: pinToken
    description: PIN + TOKEN 密码输入框
    locator: getByPlaceholder('PIN + TOKEN')
    type: input
    wait: visible
    notes: |
      - 必须使用 getByPlaceholder，不要用 input[type="password"]
      - 页面存在隐藏的加密字段，CSS 选择器会匹配错误

  - name: loginBtn
    description: 登录按钮
    locator: getByText('登录', { exact: true })
    type: button
    wait: visible
    notes: |
      - 必须使用 { exact: true } 精确匹配
      - 避免匹配"登录中"、"正在登录"等文本

# 页面操作
actions:
  - name: gotoLogin
    description: 导航到登录页面
    steps:
      - goto: http://uat.passport.woa.com/modules/passport/signin.ashx
      - waitFor: englishId visible

  - name: login
    description: 执行登录
    params:
      - username: string
      - password: string
    steps:
      - waitFor: englishId visible
      - fill: englishId with username
      - waitFor: pinToken visible
      - fill: pinToken with password
      - click: loginBtn

# 注意事项
notes:
  - title: 隐藏字段问题
    content: |
      OA 登录页面存在 type="hidden" 的加密字段：
      <input type="hidden" name="password" class="txt userPass" id="passWordInp_encrypted"/>
      
      如果使用 input[type="password"] 或 input[name="password"]，
      可能会匹配到这个隐藏字段导致操作失败。
      
      解决方案：使用 getByPlaceholder 定位。

  - title: ARIA 规范问题
    content: |
      OA 登录页面不遵守 ARIA 规范，禁止使用：
      - getByRole('textbox')
      - getByRole('button')
      - getByLabel()
      
      使用 getByPlaceholder 和 getByText 替代。

  - title: 语言设置
    content: |
      必须在 playwright.config.js 中设置：
      - locale: 'zh-CN'
      - timezoneId: 'Asia/Shanghai'
      
      否则页面可能显示英文界面。
