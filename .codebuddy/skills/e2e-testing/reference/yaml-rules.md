# YAML 测试套件规则（扁平格式 v3.0）

> ⚠️ **本文档为强制规范，非建议性指引。所有内容必须严格遵循。**

本文档定义 E2E 测试套件的 YAML 扁平格式规范。YAML 作为工具间的中间格式，不需要人工编辑。

**示例文件**: [data_template.yaml](../tools/data_template.yaml)

## 目录

- [设计原则](#设计原则)
- [文件结构](#文件结构)
- [各部分详细说明](#各部分详细说明)
  - [cases（用例定义）](#cases用例定义)
  - [steps（执行步骤）](#steps执行步骤)
  - [pom（页面对象）](#pom页面对象)
  - [test_data（测试数据）](#test_data测试数据)
  - [users（用户配置）](#users用户配置)
  - [execution_plan（执行计划）](#execution_plan执行计划)
  - [mock_scenes（Mock场景）](#mock_scenesmock场景)
  - [global_config（全局配置）](#global_config全局配置)
- [枚举值说明](#枚举值说明)
- [与 Excel 的映射关系](#与-excel-的映射关系)

---

## 设计原则

1. **扁平化**：所有数据使用二维列表（数组的数组），直接映射 Excel 行列
2. **工具友好**：作为工具间的中间格式，不需要人工编辑
3. **单一格式**：统一使用扁平格式，避免维护多套规范

---

## 文件结构

```yaml
# 基础 URL（可选）
base_url: "https://example.com"

# 必填：用例定义（二维列表）
cases:
  - ['TC-001', '系统', '用例名称', '模块', 'P0', '前置条件', '标签', '已审核', '描述']

# 必填：执行步骤（二维列表）
steps:
  - ['TC-001', 1, '步骤描述', '操作类型', '目标元素', '输入值', '等待策略', 30000, '断言类型', '期望值', '', '', '备注']

# 必填：POM 元素定义（二维列表）
pom:
  - ['页面ID', '页面名称', '/', '元素ID', '元素名称', 'CSS选择器', 'selector', '可见', 10000, '', '描述']

# 可选：测试数据（二维列表）
test_data:
  - ['数据集', '字段名', '字段说明', '值']

# 可选：用户配置（二维列表）
users:
  - ['U001', 'testuser', '********', '普通用户', '查看权限', '启用', '测试账号']

# 可选：执行计划（二维列表，不传则自动生成）
execution_plan:
  - [1, 'TC-001', 'U001', 'default', '无', '清理所有Storage', '', '是', '待执行', '']

# 可选：Mock 场景（二维列表）
mock_scenes:
  - ['MOCK001', '成功', '/api/*', 200, '{"success":true}', 0, '正常响应']

# 可选：全局配置（二维列表）
global_config:
  - ['基础配置', 'baseURL', 'https://example.com', '应用基础URL']
```

---

## 各部分详细说明

### cases（用例定义）

**格式**: `[用例ID, 系统, 用例名称, 模块, 优先级, 前置条件, 标签, 用例状态, 描述]`

| 索引 | 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|------|
| 0 | 用例ID | string | ✅ | 唯一标识，格式 `TC-系统-模块-功能-序号` |
| 1 | 系统 | string | ❌ | 所属系统 |
| 2 | 用例名称 | string | ✅ | 用例名称 |
| 3 | 模块 | string | ✅ | 所属模块 |
| 4 | 优先级 | string | ❌ | P0/P1/P2/P3，默认 P1 |
| 5 | 前置条件 | string | ❌ | 执行前提 |
| 6 | 标签 | string | ❌ | 逗号分隔，如 "冒烟,回归" |
| 7 | 用例状态 | string | ❌ | 已审核/待审核/废弃 |
| 8 | 描述 | string | ❌ | 用例描述 |

### steps（执行步骤）

**格式**: `[用例ID, 步骤序号, 步骤描述, 操作类型, 目标元素, 输入值, 等待策略, 等待超时, 断言类型, 期望值, API模式, Mock数据, 备注]`

| 索引 | 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|------|
| 0 | 用例ID | string | ✅ | 关联的用例ID |
| 1 | 步骤序号 | number | ✅ | 执行顺序，从 1 开始 |
| 2 | 步骤描述 | string | ❌ | 步骤说明 |
| 3 | 操作类型 | string | ✅ | 见[操作类型枚举](#操作类型) |
| 4 | 目标元素 | string | ❌ | 元素ID 或 URL |
| 5 | 输入值 | string | ❌ | 输入内容或参数 |
| 6 | 等待策略 | string | ❌ | 见[等待策略枚举](#等待策略) |
| 7 | 等待超时 | number | ❌ | 超时时间(ms) |
| 8 | 断言类型 | string | ❌ | 见[断言类型枚举](#断言类型) |
| 9 | 期望值 | string | ❌ | 断言期望值 |
| 10 | API模式 | string | ❌ | API 路径模式 |
| 11 | Mock数据 | string | ❌ | Mock 响应 JSON |
| 12 | 备注 | string | ❌ | 备注说明 |

### pom（页面对象）

**格式**: `[页面ID, 页面名称, 页面URL, 元素ID, 元素名称, 定位方式, 定位值, 等待策略, 等待超时, API模式, 描述]`

| 索引 | 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|------|
| 0 | 页面ID | string | ✅ | 页面唯一标识 |
| 1 | 页面名称 | string | ✅ | 页面名称 |
| 2 | 页面URL | string | ✅ | 页面路径 |
| 3 | 元素ID | string | ✅ | 元素唯一标识 |
| 4 | 元素名称 | string | ✅ | 元素名称 |
| 5 | 定位方式 | string | ✅ | CSS选择器/XPath/Text/ID/Name/ARIA/TestId |
| 6 | 定位值 | string | ✅ | 定位器表达式 |
| 7 | 等待策略 | string | ❌ | 见[等待策略枚举](#等待策略) |
| 8 | 等待超时 | number | ❌ | 超时时间(ms)，默认 10000 |
| 9 | API模式 | string | ❌ | 关联的 API 路径 |
| 10 | 描述 | string | ❌ | 元素描述 |

### test_data（测试数据）

**格式**: `[数据集, 字段名, 字段说明, 值]`

| 索引 | 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|------|
| 0 | 数据集 | string | ✅ | 数据集标识 |
| 1 | 字段名 | string | ✅ | 字段名称 |
| 2 | 字段说明 | string | ❌ | 字段描述 |
| 3 | 值 | string | ✅ | 字段值 |

### users（用户配置）

**格式**: `[用户ID, 用户名, 密码, 角色, 权限, 状态, 备注]`

| 索引 | 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|------|
| 0 | 用户ID | string | ✅ | 用户唯一标识 |
| 1 | 用户名 | string | ✅ | 登录用户名 |
| 2 | 密码 | string | ✅ | 登录密码 |
| 3 | 角色 | string | ❌ | 角色名称 |
| 4 | 权限 | string | ❌ | 权限列表，逗号分隔 |
| 5 | 状态 | string | ❌ | 启用/禁用 |
| 6 | 备注 | string | ❌ | 备注说明 |

### execution_plan（执行计划）

**格式**: `[序号, 用例ID, 执行用户, 数据集, Mock场景, 状态隔离, 覆盖配置, 启用, 执行状态, 备注]`

| 索引 | 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|------|
| 0 | 序号 | number | ✅ | 执行顺序 |
| 1 | 用例ID | string | ✅ | 关联的用例ID |
| 2 | 执行用户 | string | ✅ | 用户ID |
| 3 | 数据集 | string | ❌ | 数据集标识 |
| 4 | Mock场景 | string | ❌ | Mock 场景名称，"无" 表示不使用 |
| 5 | 状态隔离 | string | ❌ | 状态隔离策略 |
| 6 | 覆盖配置 | string | ❌ | 覆盖配置 JSON |
| 7 | 启用 | string | ✅ | 是/否 |
| 8 | 执行状态 | string | ✅ | 待执行/执行中/已完成/失败 |
| 9 | 备注 | string | ❌ | 备注说明 |

### mock_scenes（Mock场景）

**格式**: `[场景ID, 场景名称, API模式, 响应状态, 响应数据, 延迟(ms), 说明]`

| 索引 | 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|------|
| 0 | 场景ID | string | ✅ | 场景唯一标识 |
| 1 | 场景名称 | string | ✅ | 场景名称 |
| 2 | API模式 | string | ✅ | API 路径模式（支持通配符） |
| 3 | 响应状态 | string/number | ✅ | HTTP 状态码或 "abort" |
| 4 | 响应数据 | string | ✅ | 响应 JSON 字符串 |
| 5 | 延迟(ms) | number | ❌ | 响应延迟，默认 0 |
| 6 | 说明 | string | ❌ | 场景描述 |

### global_config（全局配置）

**格式**: `[配置分类, 配置项, 配置值, 说明]`

| 索引 | 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|------|
| 0 | 配置分类 | string | ✅ | 配置分类 |
| 1 | 配置项 | string | ✅ | 配置项名称 |
| 2 | 配置值 | string | ✅ | 配置值 |
| 3 | 说明 | string | ❌ | 配置说明 |

---

## 枚举值说明

### 操作类型

共 35 项，完整定义见 [excel-rules.md](excel-rules.md#sheet7-元数据-枚举定义)

| 操作类型 | 说明 |
|----------|------|
| 点击 | 单击元素 |
| 双击 | 双击元素 |
| 右键点击 | 右键点击元素 |
| 输入 | 输入文本 |
| 清空并输入 | 清空后输入 |
| 选择 | 下拉选择 |
| 悬停 | 鼠标悬停 |
| 拖拽 | 拖拽元素 |
| 等待 | 等待元素 |
| 断言 | 验证元素 |
| 截图 | 页面截图 |
| 执行JS | 执行脚本 |
| 清理状态 | 清理 Storage |
| SPA导航 | SPA 路由跳转 |
| 等待URL | 等待 URL 变化 |
| 注册API监听 | 注册响应监听 |
| 等待API响应 | 等待响应返回 |
| Mock路由 | 拦截 Mock API |
| 取消Mock | 取消 Mock 路由 |
| 展开下拉 | 展开下拉菜单 |
| 滚动到底部 | 滚动到页面底部 |
| 滚动到元素 | 滚动到指定元素 |
| 上传文件 | 单文件上传 |
| 多文件上传 | 多文件上传 |
| 拖拽上传 | 拖拽上传文件 |
| 注册下载监听 | 下载事件监听 |
| 等待下载完成 | 等待下载完成 |
| 等待iframe | 等待 iframe 加载 |
| 切换到iframe | 进入 iframe |
| 退出iframe | 退出 iframe |
| 注册新标签监听 | 新标签页事件 |
| 切换到新标签 | 切换到新标签页 |
| 关闭标签页 | 关闭当前标签页 |
| 模拟网络错误 | 网络断开模拟 |
| 模拟慢网络 | 慢网络模拟 |

### 等待策略

共 10 项：

| 等待策略 | 说明 |
|----------|------|
| 无 | 不等待 |
| 网络空闲 | 等待网络空闲 |
| 可见 | 等待元素可见 |
| 隐藏 | 等待元素隐藏 |
| DOM更新 | 等待 DOM 更新 |
| 附加 | 等待元素挂载 |
| 分离 | 等待元素移除 |
| 可编辑 | 等待可编辑 |
| 可点击 | 等待可点击 |
| 稳定 | 等待位置稳定 |

### 断言类型

共 22 项：

| 断言类型 | 说明 |
|----------|------|
| 可见 | 元素可见 |
| 隐藏 | 元素隐藏 |
| 存在 | 元素存在 |
| 不存在 | 元素不存在 |
| 可用 | 元素可用 |
| 禁用 | 元素禁用 |
| 文本等于 | 文本完全匹配 |
| 文本包含 | 文本包含指定内容 |
| 值等于 | 输入值完全匹配 |
| 值包含 | 输入值包含指定内容 |
| 属性等于 | 属性值完全匹配 |
| 属性包含 | 属性值包含指定内容 |
| CSS属性等于 | CSS 属性值匹配 |
| 元素数量 | 元素数量等于指定值 |
| URL包含 | URL 包含指定内容 |
| URL等于 | URL 完全匹配 |
| 标题包含 | 页面标题包含 |
| 标题等于 | 页面标题完全匹配 |
| 已勾选 | 复选框已勾选 |
| 未勾选 | 复选框未勾选 |
| 聚焦 | 元素已聚焦 |
| 截图对比 | 视觉对比 |

---

## 与 Excel 的映射关系

| YAML 键 | Excel Sheet | 说明 |
|---------|-------------|------|
| cases | 用例-定义 | 用例基本信息 |
| steps | 用例-执行步骤 | 步骤明细 |
| pom | 元数据-POM | 页面对象模型 |
| test_data | 用例-测试数据 | 测试数据集 |
| users | 配置-用户 | 用户配置 |
| execution_plan | 执行-执行计划 | 执行计划 |
| mock_scenes | 元数据-Mock场景 | Mock 场景 |
| global_config | 配置-全局 | 全局配置 |

---

## 自动生成规则

以下字段在 YAML 中可选，`testsuite_generator.py` 会自动生成默认值：

| 字段 | 默认行为 |
|------|----------|
| execution_plan | 根据 cases 自动生成，每个用例一条执行记录 |
| users | 使用默认用户 U001 |
| global_config | 使用 25 项默认配置 |
| mock_scenes | 使用 7 个默认 Mock 场景 |
