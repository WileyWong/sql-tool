# 结果分析规范

> ⚠️ **本文档为强制规范，非建议性指引。所有内容必须严格遵循。**

## 输入

| 类型 | 必需 | 说明 |
|------|------|------|
| 执行结果 | 是 | results.json 或 progress.md |
| 历史数据 | 可选 | 用于趋势分析 |

## 分析维度

### 1. 通过率统计

- 总用例数、通过数、失败数、跳过数
- 按模块分布
- 按优先级分布
- 按标签分布

### 2. 失败原因分类

| 类型 | 特征 | 建议 |
|------|------|------|
| 元素定位 | NoSuchElement, Timeout | 更新选择器 |
| 断言失败 | AssertionError | 检查预期值 |
| 超时 | Timeout | 增加等待时间 |
| 环境问题 | NetworkError | 检查环境 |
| 数据问题 | DataError | 检查测试数据 |

### 3. 执行时间分析

- 总耗时
- 平均用例耗时
- 慢用例识别（> 平均值 2 倍）
- 执行时间分布

### 4. 趋势分析（需历史数据）

- 通过率趋势
- 新增失败用例
- 修复的用例
- 稳定性评估

## 输出格式

```markdown
# 测试报告

**执行时间**: 2025-12-31 10:30:00
**执行计划**: smoke
**耗时**: 5m 30s

## 概览

| 指标 | 值 |
|------|-----|
| 总用例 | 10 |
| 通过 | 8 (80%) |
| 失败 | 2 (20%) |
| 跳过 | 0 |

## 按优先级

| 优先级 | 通过 | 失败 | 通过率 |
|--------|------|------|--------|
| P0 | 3 | 0 | 100% |
| P1 | 4 | 1 | 80% |
| P2 | 1 | 1 | 50% |

## 按模块

| 模块 | 通过 | 失败 | 通过率 |
|------|------|------|--------|
| login | 3 | 1 | 75% |
| dashboard | 5 | 1 | 83% |

## 失败用例详情

### TC-OA-登录-002: 密码错误提示

- **模块**: login
- **优先级**: P1
- **失败步骤**: Step 4 - assert
- **错误类型**: 元素定位
- **错误信息**: Element not found: .error-message
- **截图**: [查看](./screenshots/TC-002/step-04-fail.png)

**根因分析**:
错误提示元素选择器已变更，页面重构后 class 名称改变。

**修复建议**:
更新选择器从 `.error-message` 到 `getByText('密码错误')` 或 `.new-error-class`

---

### TC-OA-Dashboard-005: 数据加载

- **模块**: dashboard
- **优先级**: P2
- **失败步骤**: Step 2 - assert
- **错误类型**: 超时
- **错误信息**: Timeout waiting for element
- **截图**: [查看](./screenshots/TC-005/step-02-fail.png)

**根因分析**:
数据量大时加载时间超过默认超时（30s）。

**修复建议**:
增加等待时间或添加显式等待条件。

## 执行时间分析

| 指标 | 值 |
|------|-----|
| 总耗时 | 5m 30s |
| 平均耗时 | 33s |
| 最快用例 | TC-001 (5s) |
| 最慢用例 | TC-005 (120s) |

### 慢用例（> 60s）

| 用例 | 耗时 | 原因 |
|------|------|------|
| TC-005 | 120s | 数据加载慢 |

## 改进建议

### 高优先级

1. **更新选择器** - TC-002
   - 当前: `.error-message`
   - 建议: `getByText('密码错误')` 或 `.new-error-class`

2. **增加等待时间** - TC-005
   - 当前: 30s
   - 建议: 60s 或使用显式等待

### 中优先级

3. 考虑增加登录失败重试的测试场景
4. Dashboard 模块建议增加空数据状态测试

## 与上次对比

| 指标 | 上次 | 本次 | 变化 |
|------|------|------|------|
| 通过率 | 70% | 80% | ↑ 10% |
| 失败数 | 3 | 2 | ↓ 1 |
| 新增失败 | - | 1 | TC-005 |
| 修复 | - | 2 | TC-003, TC-004 |
```

## 自动修复建议

根据失败类型生成修复建议：

```yaml
fixes:
  - case: TC-OA-登录-002
    type: selector_update
    current: ".error-message"
    suggested: "getByText('密码错误')"
    confidence: high
    
  - case: TC-OA-Dashboard-005
    type: timeout_increase
    current: 30000
    suggested: 60000
    confidence: medium
```

## 参考

- 输出规范：[output-spec.md](output-spec.md)
- 执行结果目录：`{outputDir}/execute-{timestamp}/`
