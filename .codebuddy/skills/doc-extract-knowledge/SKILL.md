---
name: doc-extract-knowledge
description: 从代码项目中提取知识库文档。自动识别场景并选择最佳策略：自顶向下（汇总文档，<100文件）、自底向上（文件级文档+依赖分析）、按模块（文件级文档，>200文件或指定模块）。触发词：知识库、项目文档、提取知识、生成文档、代码文档化。
category: documentation
---

# 提取项目知识库

从 Spring Boot 项目中提取结构化的知识库文档，支持三种策略自动选择。

## 快速开始

```
用户: 为这个项目生成知识库
AI: [扫描项目] → [统计文件数量] → [选择策略] → [执行生成] → [输出文档]
```

## 核心原则（15秒速查）

1. **场景优先** - 根据项目规模和需求自动选择最佳策略
2. **断点续传** - 所有策略都支持中断恢复
3. **质量保证** - 完整读取源码，不遗漏任何方法
4. **灵活适配** - 支持手动指定策略覆盖自动选择

## 三种策略对比

| 策略 | 输出粒度 | 适用场景 | 文档数量 | 优势 |
|------|---------|---------|---------|------|
| **top-down** | 一类文件/文件夹 → 一个文档 | 小型项目(<100文件)、快速概览 | 少（19个分类文档） | 结构清晰，快速概览 |
| **bottom-up** | 每个代码文件 → 一个文档 | 需要依赖分析、架构图 | 多（与文件数相当） | 依赖关系完整，架构图 |
| **by-module** | 每个代码文件 → 一个文档 | 大型项目(>200文件)、指定模块 | 多（与文件数相当） | 精准控制，断点友好 |

---

## 场景判断流程

### 步骤1：获取项目信息

使用 `list_files` 或 `search_file` 工具扫描代码目录，统计 Java 文件数量：

```
正在扫描项目规模...
发现 {{N}} 个目录，精确统计 {{M}} 个 Java 文件
```

### 步骤2：应用判断规则

```
┌─────────────────────────────────────────────────────────────────┐
│                    场景判断决策树                                │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ┌─────────────────────────────────────────────────────────────┐│
│  │ 规则0：判断输出粒度需求                                     ││
│  │   ├── 需要"概览文档"/"分类汇总" → top-down                 ││
│  │   └── 需要"详细文档"/"每个文件" → bottom-up 或 by-module   ││
│  └─────────────────────────────────────────────────────────────┘│
│         ↓                                                        │
│  ┌─────────────────────────────────────────────────────────────┐│
│  │ 规则1：判断处理范围                                         ││
│  │   ├── 用户指定了具体模块目录 → by-module                   ││
│  │   └── 用户要求整个项目 → 继续判断                          ││
│  └─────────────────────────────────────────────────────────────┘│
│         ↓                                                        │
│  ┌─────────────────────────────────────────────────────────────┐│
│  │ 规则2：判断是否需要依赖分析                                 ││
│  │   ├── 需要"依赖图"/"架构分析" → bottom-up                  ││
│  │   └── 不需要 → 继续判断                                     ││
│  └─────────────────────────────────────────────────────────────┘│
│         ↓                                                        │
│  ┌─────────────────────────────────────────────────────────────┐│
│  │ 规则3：根据代码文件数量自动选择                             ││
│  │   ├── < 100 个文件 → top-down（汇总文档，快速概览）         ││
│  │   ├── 100-200 个文件 → top-down 或 by-module 皆可          ││
│  │   │   └── 默认推荐 top-down，用户可选 by-module            ││
│  │   └── > 200 个文件 → by-module（文件级文档，分批处理）     ││
│  └─────────────────────────────────────────────────────────────┘│
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

### 步骤3：策略选择总结

| 条件 | 推荐策略 | 原因 |
|------|---------|------|
| 需要快速概览/分类汇总 | **top-down** | 输出少量汇总文档（19个分类） |
| 需要依赖分析/架构图 | **bottom-up** | 支持完整依赖关系分析 |
| 指定具体模块目录 | **by-module** | 精准控制范围 |
| 文件数 < 100 | **top-down** | 小项目适合汇总 |
| 100 ≤ 文件数 < 200 | **top-down**（默认）或 **by-module** | 用户可选 |
| 文件数 ≥ 200 | **by-module** | 大项目需分批处理 |

### 步骤4：确认并执行

```
📊 项目规模分析完成
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
文件数量: {{N}} 个 Java 文件
用户需求: {{需求描述}}
推荐策略: {{策略名称}}

策略说明:
- top-down: 生成 19 个分类汇总文档，适合快速了解项目结构
- bottom-up: 为每个文件生成独立文档 + 依赖分析 + 架构图
- by-module: 为每个文件生成独立文档，3个一批处理，支持断点续传

是否使用推荐策略？或选择其他策略：
1) 使用推荐策略（{{策略名称}}）
2) 使用 top-down（分类汇总）
3) 使用 bottom-up（文件级 + 依赖分析）
4) 使用 by-module（文件级 + 分批处理）
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

---

## 策略详情

### 📄 top-down 策略（自顶向下）

**适用场景**：小型项目（<100文件）、需要快速概览

**输出特点**：
- 一类文件/一个文件夹 → 一个文档
- 生成 19 个分类文档 + 可选扩展文档
- 先生成总索引 README，再逐章生成分类文档

**执行流程**：
1. 扫描代码规划分类
2. 生成总索引 README.md
3. 分批生成 19 个分类文档（每章后询问用户）
4. 可选生成扩展文档

**详细文档**：[strategies/top-down/strategy.md](./strategies/top-down/strategy.md)

---

### 📄 bottom-up 策略（自底向上）

**适用场景**：需要依赖分析、架构图

**输出特点**：
- 每个代码文件 → 一个独立文档
- 包含完整依赖关系图和被依赖分析
- 自动生成架构图（architecture.md）

**执行流程**：
1. 精准扫描 → 生成完整文件清单
2. 制定执行计划（每批 10 个文件）
3. 分批生成文档（每个文件完成后立即更新进度）
4. 汇总阶段：合并依赖、生成架构图和总索引

**详细文档**：[strategies/bottom-up/strategy.md](./strategies/bottom-up/strategy.md)

---

### 📄 by-module 策略（按模块）

**适用场景**：大型项目（>200文件）、指定模块

**输出特点**：
- 每个代码文件 → 一个独立文档
- 3 个一批处理，避免上下文过载
- 强大的断点续传支持

**执行流程**：
1. 扫描模块，建立文件索引
2. 按 3 个一批读取并生成文档
3. 每 3 个文件完成后立即更新索引
4. 完成后输出总结

**详细文档**：[strategies/by-module/strategy.md](./strategies/by-module/strategy.md)

---

## 输出结构

### top-down 输出

```
kb/
├── README.md                  # 总索引
├── interface.md               # 接口定义
├── abstract.md                # 抽象类
├── service-api-http.md        # HTTP API
├── business-logic.md          # 业务逻辑
├── orm-mapper.md              # ORM映射
├── entity.md                  # 实体
├── dto.md                     # DTO
├── ...                        # 其他分类文档（共19个）
└── extra/                     # 扩展文档（可选）
```

### bottom-up / by-module 输出

```
kb/
├── README.md                  # 总索引
├── architecture.md            # 架构图（仅 bottom-up）
├── .task-progress.md          # 进度跟踪
├── controller/
│   ├── UserController.md
│   └── OrderController.md
├── service/
│   ├── UserService.md
│   └── UserServiceImpl.md
├── mapper/
│   └── UserMapper.md
└── ...                        # 按类型分类
```

---

## 核心约束

- **完整读取**: 必须完整读取源码文件，不得截断
- **类型识别**: 根据注解/继承/关键字识别，**完全忽略目录名**
- **进度跟踪**: 实时更新进度，支持断点续传
- **质量保证**: 每个方法都必须记录完整签名

## 类型识别规则

⚠️ **目录名不可信**: `controller` 目录可能含 Service，`service` 目录可能含 Mapper

**识别优先级**: 注解 > 继承/关键字 > 命名约定 > 作用

| 类型 | 识别依据（按优先级） |
|------|---------------------|
| Interface | `interface` 关键字（非 `@interface`） |
| Abstract | `abstract class` 关键字 |
| Controller | `@RestController` > `@Controller` |
| Service | `@Service` > `*ServiceImpl` |
| Mapper | `@Mapper` > `extends BaseMapper` > `*Mapper` |
| Entity | `@Entity` > `@TableName` > `@Table` |
| Feign | `@FeignClient` |
| Exception | `extends Exception` > `extends RuntimeException` |
| Enum | `enum` 关键字定义 |
| Annotation | `@interface` 定义 |
| Constants | `*Constants.java` > `*Constant.java` > 全静态final字段类 |
| **Other（兜底）** | **无法匹配上述任何类型时使用 default.md 模板** |

---

## 参考资源

| 类型 | 资源 |
|------|------|
| **策略详情** | [top-down](./strategies/top-down/strategy.md) \| [bottom-up](./strategies/bottom-up/strategy.md) \| [by-module](./strategies/by-module/strategy.md) |
| **检查清单** | [checklist.md](./checklist.md) |
| **使用示例** | [examples.md](./examples.md) |

---

## 版本历史

- **v1.0** (2025-12-18): 整合 doc-extract-proj-top-down、doc-extract-proj-bottom-up、doc-extract-by-module 三个技能
  - 统一入口，自动场景判断
  - 支持手动选择策略
  - 保留各策略的完整功能

---

**作者**: johnsonyang
