---
name: doc-extract-proj-bottom-up
description: 为 Spring Boot 项目生成类级别知识库文档，包含依赖关系图、被依赖分析和完整方法签名。支持大型项目分批处理和断点续传。当用户提到"生成知识库"、"提取项目文档"、"分析依赖关系"、"Java项目文档化"或"自下向上分析"时使用。
---

# 自下向上提取项目知识

为 Spring Boot 项目生成结构化的类级别文档，包含依赖关系图和影响分析。

## 快速开始

```
用户: 为这个项目生成知识库
AI: [精准统计规模] → [制定执行计划] → [分批扫描] → [记录进度] → [生成报告]
```

## 最常见用法

### 所有项目（统一分批模式）
```
用户：为这个项目生成知识库
AI：
1. 精准扫描项目（使用工具递归扫描所有目录）
2. 生成完整文件清单（.complete-file-list.md）
3. 检查/创建执行计划（task-plan.md，每批10个）
4. 检查/创建进度跟踪（task-progress.md）
5. 按批次生成文档（每批10个，每个文件完成后立即更新进度）
6. 汇总阶段（合并依赖、生成架构图和总索引）
```

### 断点续传
```
用户：继续上次的文档生成
AI：
1. 读取 .complete-file-list.md（基准）
2. 检查 .task-plan.md 完整性（不一致则更新）
3. 检查 .task-progress.md 完整性（不一致则更新）
4. 进度同步检查（检查文档是否已存在）
5. 找到断点（第一个 ⏳）
6. 从断点继续执行
```

详细流程见本文档各章节。

## 任务管理文件

⚠️ **执行过程中必须维护以下任务管理文件**：

### 核心文档任务管理

| 文件 | 用途 | 生成时机 |
|------|------|----------|
| `kb/.complete-file-list.md` | 完整文件清单 | 阶段1扫描完成后（不再修改） |
| `kb/.task-plan.md` | 执行计划 | 基于完整清单生成，开始执行前 |
| `kb/.task-progress.md` | 进度跟踪 | 执行过程中实时更新 |
| `kb/.task-report.md` | 完成报告 | 全部完成后 |

### 扩展文档任务管理

| 文件 | 用途 | 生成时机 |
|------|------|----------|
| `kb/extra/.ext-task-plan.md` | 执行计划 | 用户选择后，开始前 |
| `kb/extra/.ext-task-progress.md` | 进度跟踪 | 执行过程中实时更新 |
| `kb/extra/.ext-task-report.md` | 完成报告 | 全部完成后 |

**模板位置**:
- 完整清单: [complete-file-list.md](./templates/complete-file-list.md)
- 核心文档: [task-plan.md](./templates/task-plan.md) | [task-progress.md](./templates/task-progress.md) | [task-report.md](./templates/task-report.md)
- 扩展文档: [ext-task-plan.md](./templates/ext-task-plan.md) | [ext-task-progress.md](./templates/ext-task-progress.md) | [ext-task-report.md](./templates/ext-task-report.md)

### ⛔ 强制执行规则

```
┌─────────────────────────────────────────────────────────────────┐
│                    ⛔ 强制执行规则（必须遵守）                    │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  🔴 规则1：必须基于任务进度文件执行                              │
│     ├── 每次执行前，必须先读取 kb/.task-progress.md             │
│     ├── 找到第一个状态为 ⏳ 的文件                               │
│     └── 从该文件所在批次开始执行，不得跳过                       │
│                                                                  │
│  🔴 规则2：必须按批次执行（每批 10 个文件）                      │
│     ├── 严格按照 .task-plan.md 中的批次规划                     │
│     ├── 每批处理 10 个文件，不得多处理或少处理                   │
│     └── 批次内的文件顺序必须与计划一致                           │
│                                                                  │
│  🔴 规则3：每个文件处理完成后必须立即更新进度文件 ⭐            │
│     └── 详见 [进度更新规则](#进度更新规则-)                     │
│                                                                  │
│  🔴 规则4：不得自行决定处理顺序或数量                            │
│     └── 必须按照 .task-plan.md 中的文件序号顺序处理             │
│                                                                  │
│  🔴 规则5：必须按模板生成文档                                    │
│     └── 生成前必须读取对应模板文件（templates/core/{type}.md）  │
│                                                                  │
│  🔴 规则6：执行前必须进行进度同步检查                            │
│     └── 详见 [执行前置检查](#执行前置检查必须)                   │
│                                                                  │
│  🔴 规则7：进度文件条目绝对不可变 ⭐                              │
│     └── 仅允许更新：状态、生成文档路径、方法数                   │
│                                                                  │
│  🔴 规则8：必须基于实际生成结果更新进度 ⭐                        │
│     └── 文档实际生成成功才能更新为 ✅                            │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

---

## 项目规模精准统计与执行策略

⚠️ **强制使用工具精准扫描（绝不使用预估）**

必须使用 `list_files` 或 `search_file` 工具递归扫描所有目录和子目录，获取精确的文件数量：

```
正在使用工具精准扫描项目规模...（使用 list_files 或 search_file 工具）
递归扫描所有目录和子目录...
发现 {{N}} 个目录，精确统计 {{M}} 个 Java 文件（工具扫描结果，非预估）
```

⚠️ **所有项目统一使用分批模式**

| 执行模式 | 适用范围 | 说明 |
|---------|---------|------|
| **分批模式** | **所有项目** | **不再区分项目规模，统一按文件序号分批处理（每批 10 个文件）+ 最终汇总** |

**关键特性**：
- ✅ 统一流程，简化执行逻辑
- ✅ 支持断点续传
- ✅ 每个文件完成后立即更新进度
- ✅ 进度可追踪，适合所有规模项目

---

## 执行策略

### 统一分批模式（所有项目）

**所有项目统一采用分批处理模式**，**按文件序号分批处理（每批 10 个文件），最终汇总**。

**注意**：此模式名称为"分批模式"，不是"分目录模式"。处理顺序按文件序号，不是按目录。

**核心特性**：
1. **精准扫描**：使用工具递归扫描所有目录和子目录
2. **分批处理**：每批处理 10 个文件
3. **实时更新**：每个文件完成后立即更新进度
4. **断点续传**：支持从中断位置继续
5. **最终汇总**：所有文件完成后生成依赖关系和架构图

#### 执行流程

```
┌─────────────────────────────────────────────────────────────────┐
│                    分批模式执行流程                              │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  阶段1: 完整扫描 → 验证准确性 → 生成清单 → 制定计划            │
│         ├── 递归扫描所有目录和子目录                             │
│         ├── 获取完整的文件清单（不遗漏任何文件）                 │
│         ├── 验证准确性（无遗漏、无重复、无虚假）                 │
│         ├── 生成 kb/.complete-file-list.md                      │
│         └── 基于完整清单，制定批次计划                           │
│         ↓                                                        │
│  ┌──────────────────────────────────────────────────────────┐   │
│  │  递归扫描 src/main/java/com/xxx/                         │   │
│  │  ├── controller/UserController.java                      │   │
│  │  ├── controller/OrderController.java                     │   │
│  │  ├── service/UserService.java                            │   │
│  │  ├── service/impl/UserServiceImpl.java                   │   │
│  │  ├── mapper/UserMapper.java                              │   │
│  │  └── ...（共 180 个 Java 文件）                          │   │
│  │  ↓                                                        │   │
│  │  验证准确性 ✅                                            │   │
│  │  - 检查文件存在性: 180/180                               │   │
│  │  - 检查重复: 无                                          │   │
│  │  - 检查路径有效性: 全部有效                              │   │
│  │  ↓                                                        │   │
│  │  生成 kb/.complete-file-list.md ✅                       │   │
│  └──────────────────────────────────────────────────────────┘   │
│         ↓                                                        │
│  阶段2: 任务管理文件准备（使用TODO技能拆分为3步）                                │
│         ├── 阶段2.1：读取完整清单                                │
│         ├── 阶段2.2：检查/创建/更新执行计划文件                   │
│         └── 阶段2.3：检查/创建/更新进度跟踪文件，检测断点         │
│         ↓                                                        │
│  阶段3: 按批次执行（使用TODO技能按批次拆分任务，每批 10 个文件）⭐⭐⭐                        │
│         ↓                                                        │
│  ┌──────────────────────────────────────────────────────────┐   │
│  │  对于当前批次的每个文件，循环执行以下步骤：              │   │
│  │                                                          │   │
│  │  3.1 读取源码文件                                        │   │
│  │       ↓                                                  │   │
│  │  3.2 识别类型并读取对应模板                              │   │
│  │       ↓                                                  │   │
│  │  3.3 生成文档并写入文件系统                              │   │
│  │       ↓                                                  │   │
│  │  3.4 ⚠️ 立即更新进度文件（该文件的状态）⭐⭐⭐            │   │
│  │       ├── 确认文档已成功写入                            │   │
│  │       ├── 更新该文件状态：⏳ → ✅ 或 ❌                  │   │
│  │       ├── 填写实际生成的文档路径                        │   │
│  │       ├── 填写实际提取的方法数量                        │   │
│  │       ├── ❌ 禁止增减条目                                │   │
│  │       ├── ❌ 禁止修改文件路径、序号、批次                │   │
│  │       └── ❌ 禁止批量更新多个文件                        │   │
│  │       ↓                                                  │   │
│  │  3.5 继续处理下一个文件                                  │   │
│  │       └── 重复步骤 3.1 - 3.4，直到批次完成              │   │
│  └──────────────────────────────────────────────────────────┘   │
│         ↓                                                        │
│  阶段4: 检查是否所有批次完成                                     │
│         ├── 未完成 → 继续下一批次（返回阶段3）                   │
│         └── 已完成 → 进入汇总阶段                                │
│         ↓                                                        │
│  阶段5: 汇总阶段（所有文件完成后）                               │
│         ├── 合并所有依赖索引                                     │
│         ├── 生成反向依赖（被依赖方）                             │
│         ├── 更新所有文档的被依赖方章节                           │
│         ├── 生成 architecture.md                                │
│         └── 生成 README.md 总索引                               │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

#### 阶段1：完整扫描 → 生成准确清单

**执行顺序**：先完整扫描 → 生成准确清单 → 再制定计划

⚠️ **清单准确性要求（必须）**：
```
┌─────────────────────────────────────────────────────────────────┐
│           .complete-file-list.md 清单准确性要求                  │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ✅ 必须精准（绝不使用预估或估算）：                             │
│     ├── 不能缺少文件（必须使用工具递归扫描所有目录和子目录）     │
│     ├── 不能有重复文件（同一文件只能出现一次）                   │
│     ├── 不能有不存在的文件（必须验证文件实际存在）               │
│     ├── 文件路径必须准确（相对于项目根目录的完整路径）           │
│     └── 文件数量必须精确（工具实际扫描结果，绝不凭感觉估算）     │
│                                                                  │
│  ❌ 绝对禁止（严重错误）：                                       │
│     ├── 🚫 使用预估或估算文件数量（必须使用工具精准扫描）        │
│     ├── 🚫 凭经验或感觉估算文件数量（必须工具扫描）              │
│     ├── 🚫 不使用 list_files/search_file 工具而直接猜测数量     │
│     ├── 遗漏文件（导致后续文档不完整）                           │
│     ├── 重复记录（导致批次规划混乱）                             │
│     ├── 虚假文件（导致执行失败）                                 │
│     └── 路径错误（导致无法读取文件）                             │
│                                                                  │
│  📌 强制验证要求：                                               │
│     ├── ⚠️ 必须使用 list_files 或 search_file 工具精准扫描      │
│     ├── ⚠️ 扫描后必须记录使用的工具名称和扫描参数               │
│     ├── 生成清单后，必须验证每个文件路径的有效性                 │
│     └── 🚫 绝不得凭经验、感觉或大致印象估算文件数量              │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

⚠️ **强制要求：必须使用 list_files 或 search_file 工具递归扫描**所有目录和子目录，获取完整的代码文件清单，并保存为 `kb/.complete-file-list.md`：

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🔍 步骤1：使用工具精准递归扫描所有目录（🚫绝不使用预估）
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
✅ 使用工具: list_files 或 search_file（必须记录使用的工具）
正在扫描项目结构...

src/main/java/com/xxx/
├── controller/  (工具扫描结果: 12个文件)
├── service/     (工具扫描结果: 15个文件)
├── mapper/      (工具扫描结果: 18个文件)
├── entity/      (工具扫描结果: 20个文件)
└── ...

工具扫描完成：15个目录，精确统计 180个文件（工具扫描结果，非预估）

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🔍 步骤2：验证文件清单准确性
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
验证中...
  ✅ 检查文件存在性: 180/180 通过
  ✅ 检查重复文件: 无重复
  ✅ 检查路径有效性: 全部有效
  ✅ 检查扫描方式: 已使用 list_files 工具精准扫描（非预估或估算）
  ✅ 检查数量精确性: 工具返回精确结果 180 个文件

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📋 步骤3：生成完整文件清单
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
生成: kb/.complete-file-list.md ✅

清单内容:
  - 扫描方式: 使用 list_files 工具（记录在清单中）
  - 文件总数: 180 个（工具扫描精确结果，非预估或估算）
  - 包含完整路径（相对于项目根目录）
  - 按扫描顺序编号（1-180）
  - 初步识别类类型（最终类型在生成文档时确定）
  - 批次分配: 18 批（每批 10 个文件）

⚠️ 重要：此清单基于 list_files 工具精准扫描，已验证准确，后续所有操作基于此清单
```

#### 阶段2：任务管理文件准备

基于 `kb/.complete-file-list.md` 中的完整文件清单（已验证准确：无遗漏、无重复、无虚假），分步检查和生成任务管理文件。

##### 阶段2.1：读取完整文件清单

首先读取 `kb/.complete-file-list.md`，这是所有后续操作的基准：

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📋 阶段2.1：读取完整文件清单
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
读取: kb/.complete-file-list.md ✅
  - 扫描方式: list_files 工具（已记录）
  - 文件总数: 180 个（工具扫描精确结果，非预估或估算）
  - 批次规划: 18 批（每批 10 个）

⚠️ 此清单将作为后续所有操作的基准
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

##### 阶段2.2：检查和处理执行计划文件

参考 [task-plan.md](./templates/task-plan.md) 模板，检查 `kb/.task-plan.md` 的完整性。

**情况1：计划文件不存在 → 创建新文件**

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📋 阶段2.2：检查执行计划文件
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
检查 kb/.task-plan.md ... ❌ 不存在

基于完整清单创建执行计划...

创建: kb/.task-plan.md ✅
  - 扫描方式: list_files 工具
  - 文件总数: 180 个（与完整清单精确一致）
  - 批次规划: 18 批（每批 10 个）
  - 批次分配:
    * 批次 1: 文件 1-10
    * 批次 2: 文件 11-20
    * 批次 3: 文件 21-30
    * ...
    * 批次 18: 文件 171-180

✅ 执行计划文件创建完成
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

**情况2：计划文件存在但与实际情况不一致 → 更新文件**

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📋 阶段2.2：检查执行计划文件
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
检查 kb/.task-plan.md ... ✅ 存在

验证与完整清单的一致性...
  - 完整清单文件数: 180（基准）
  - 执行计划记录数: 175 ⚠️ 不匹配
  - 差异分析: 缺失 5 个文件（新增）

⚠️ 检测到不一致，需要更新执行计划文件

更新执行计划...
  新增文件（追加到末尾）:
    176. com/xxx/dto/NewDTO1.java
    177. com/xxx/dto/NewDTO2.java
    178. com/xxx/vo/NewVO1.java
    179. com/xxx/vo/NewVO2.java
    180. com/xxx/utils/NewUtils.java

  更新批次规划:
    * 原批次数: 18
    * 新批次数: 18
    * 最后批次: 批次 18 (文件 171-180)

✅ 执行计划文件更新完成
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

**情况3：计划文件存在且完整 → 继续**

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📋 阶段2.2：检查执行计划文件
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
检查 kb/.task-plan.md ... ✅ 存在

验证与完整清单的一致性...
  - 完整清单文件数: 180（基准）
  - 执行计划记录数: 180 ✅ 精确匹配
  - 批次规划: 18 批（每批 10 个）✅ 正确

✅ 执行计划文件完整且一致，继续下一步
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

##### 阶段2.3：检查和处理进度跟踪文件

参考 [task-progress.md](./templates/task-progress.md) 模板，检查 `kb/.task-progress.md` 的完整性。

**情况1：进度文件不存在 → 创建新文件**

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📋 阶段2.3：检查进度跟踪文件
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
检查 kb/.task-progress.md ... ❌ 不存在

基于执行计划创建进度跟踪文件...

创建: kb/.task-progress.md ✅
  - 初始状态: 全部 ⏳ 待处理
  - 文件条目: 180 个（与执行计划精确一致）
  - 批次信息: 18 批（每批 10 个）

✅ 进度跟踪文件创建完成，可以开始执行
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

**情况2：进度文件存在但与实际情况不一致 → 更新文件**

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📋 阶段2.3：检查进度跟踪文件
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
检查 kb/.task-progress.md ... ✅ 存在

验证与执行计划的一致性...
  - 执行计划记录数: 180（基准）
  - 进度文件记录数: 175 ⚠️ 不匹配
  - 差异分析: 缺失 5 个文件条目

⚠️ 检测到不一致，需要更新进度跟踪文件

更新进度跟踪文件...
  新增条目（追加到末尾，状态 ⏳）:
    176. com/xxx/dto/NewDTO1.java
    177. com/xxx/dto/NewDTO2.java
    178. com/xxx/vo/NewVO1.java
    179. com/xxx/vo/NewVO2.java
    180. com/xxx/utils/NewUtils.java

  保留已完成的条目状态 ✅
  新增条目初始状态设为 ⏳

✅ 进度跟踪文件更新完成
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

**情况3：进度文件存在且完整 → 检测断点，继续执行**

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📋 阶段2.3：检查进度跟踪文件
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
检查 kb/.task-progress.md ... ✅ 存在

验证与执行计划的一致性...
  - 执行计划记录数: 180（基准）
  - 进度文件记录数: 180 ✅ 精确匹配

✅ 进度跟踪文件完整且一致

📊 检测断点信息...
  - 已完成文件: 60 个 (33.3%)
  - 待处理文件: 120 个
  - 当前批次: 批次 7
  - 下一个文件: 序号 61 - com/xxx/mapper/UserMapper.java

⚠️ 检测到未完成的任务，将从断点继续执行

**断点续传执行要求**：
   1. 执行前必须进行进度同步检查（见规则6）
   2. 从第一个 ⏳ 状态的文件开始处理
   3. 每生成一个文档后立即更新进度（见规则3）

✅ 准备从批次 7 继续执行
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

#### 阶段3：按批次执行

每次执行一个批次（10 个文件），对于批次中的每个文件执行以下流程：

**单文件处理流程示例**：

```
批次 1 (文件 1-10)

文件 1: UserController.java
1. 读取文件 (156行, Controller, 8个方法)
2. 读取模板: controller.md
3. 生成文档: kb/controller/UserController.md
4. 更新进度跟踪: ⏳ → ✅

文件 2: OrderController.java
1. 读取文件 (189行, Controller, 12个方法)
2. 读取模板: controller.md
3. 生成文档: kb/controller/OrderController.md
4. 更新进度跟踪: ⏳ → ✅

... (重复处理文件 3-20)

批次 1 完成 (10/10, 45个方法)
进度: 20/180 (11.1%)
```

**执行要求**：见 [进度更新规则](#进度更新规则-)

#### 阶段4：检查所有批次完成状态

检查进度跟踪文件中所有条目的状态：
- 若存在 ⏳ 或 🔄 → 继续下一批次（返回阶段3）
- 若全部为 ✅ 或 ❌ → 进入汇总阶段

#### 阶段5：汇总阶段（所有项目统一执行）

**所有批次完成后**，执行汇总操作：

```
开始汇总...

1. 合并依赖索引 (450个依赖关系)
2. 生成反向依赖 (380个被依赖关系)
3. 更新被依赖方章节 (85个文档)
4. 生成架构文档: kb/architecture.md
5. 生成总索引: kb/README.md

知识库生成完成！
- 文档数: 180
- 类型目录: 19
- 架构文档: 1
- 索引文档: 1
```

**所有代码文件的文档都生成完成后**，开始汇总：

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🔄 开始汇总阶段
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
检测到所有文件已处理完成: 180/180 (100%)

1. 合并依赖索引...
   - 读取所有文档的依赖信息
   - 合并为全局依赖图

2. 生成反向依赖...
   - 计算被依赖关系
   - UserService 被 3 个组件依赖
   - UserMapper 被 2 个组件依赖
   - ...

3. 更新文档的被依赖方章节...
   - 更新 kb/service/UserService.md
   - 更新 kb/mapper/UserMapper.md
   - ...
   📊 已更新 85 个文档

4. 生成架构文档...
   ✅ kb/architecture.md

5. 生成总索引...
   ✅ kb/README.md

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
✅ 知识库生成完成！
   - 总文档数: 180 个
   - 总目录数: 19 个类型目录
   - 架构文档: 1 个
   - 索引文档: 1 个
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

#### 断点续传支持

断点续传已整合到 **阶段2.3** 中处理。当检测到已存在的进度跟踪文件且文件完整时，会自动识别断点并准备继续执行。

详见 [阶段2.3：检查和处理进度跟踪文件](#阶段2任务管理文件准备) 中的 **情况3**。

#### 统一文件结构（所有项目）

```
kb/
├── .complete-file-list.md     # 完整文件清单（阶段1生成，不再修改）
├── .task-plan.md              # 执行计划（基于完整清单生成）
├── .task-progress.md          # 进度跟踪（实时更新状态）
├── .task-report.md            # 完成报告（结束后生成）
├── .index/                    # 临时索引目录（汇总后可删除）
│   └── dependencies.json      # 依赖索引
├── README.md                  # 总索引
├── architecture.md            # 架构图
├── controller/
├── service/
├── mapper/
└── ...
```

---

## 类型识别与模板选择

⚠️ **注意**：此表用于**类型识别和模板选择**，不是执行顺序。执行时必须按照 `.task-plan.md` 中的文件序号顺序处理，每批 10 个文件。

**识别优先级**: 注解 > 继承/关键字 > 命名约定 > 作用

| 类型 | 识别依据（按优先级） | 模板 |
|------|---------------------|------|
| Interface | `interface` 关键字（非 `@interface`） | [interface.md](./templates/core/interface.md) |
| Abstract | `abstract class` 关键字 | [abstract.md](./templates/core/abstract.md) |
| Controller | `@RestController` > `@Controller` | [controller.md](./templates/core/controller.md) |
| Service | `@Service` > `*ServiceImpl` | [service.md](./templates/core/service.md) |
| Mapper | `@Mapper` > `extends BaseMapper` > `*Mapper` | [mapper.md](./templates/core/mapper.md) |
| Feign | `@FeignClient` | [feign.md](./templates/core/feign.md) |
| Entity | `@Entity` > `@TableName` > `@Table` | [entity.md](./templates/core/entity.md) |
| Config | `@Configuration` > `@ConfigurationProperties` | [config.md](./templates/core/config.md) |
| Annotation | `@interface` 定义 | [annotation.md](./templates/core/annotation.md) |
| Exception | `extends Exception` > `extends RuntimeException` | [exception.md](./templates/core/exception.md) |
| Enum | `enum` 关键字定义 | [enum.md](./templates/core/enum.md) |
| Constants | `*Constants.java` > `*Constant.java` > 全静态final字段类 | [constants.md](./templates/core/constants.md) |
| DTO | `*DTO.java`, `*Dto.java`（排除 `*RequestDTO`） | [dto.md](./templates/core/dto.md) |
| VO/Response | `*VO.java`, `*Response.java` | [vo-response.md](./templates/core/vo-response.md) |
| Request | `*Request.java`, `*RequestDTO.java` | [request.md](./templates/core/request.md) |
| Handler | 见[Handler细分规则](#handler细分规则) | [handler.md](./templates/core/handler.md) |
| Job/Task | `@Scheduled`, `@Async` | [job-task.md](./templates/core/job-task.md) |
| MQ Listener | `@RabbitListener`, `@KafkaListener` | [mq-listener.md](./templates/core/mq-listener.md) |
| Utils | `*Util.java`, `*Utils.java` | [utils.md](./templates/core/utils.md) |
| **Other（兜底）** | **无法匹配上述任何类型时使用** | [default.md](./templates/core/default.md) |

#### 模板使用要求（规则5）

```
┌─────────────────────────────────────────────────────────────────┐
│                      模板使用要求                                │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ✅ 必须：读取模板 → 包含所有章节 → 保持章节顺序和格式          │
│                                                                  │
│  ❌ 禁止：凭记忆生成、省略章节、修改章节顺序                    │
│                                                                  │
│  📋 模板必含章节（所有类型通用）：                               │
│     头部信息 | 统计信息 | 方法列表 | 依赖组件 | 被依赖方 | 关键注解 │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

**批次进度报告示例**: "批次 3 完成，处理文件 41-60，进度 60/180 (33.3%)"

### 生成依赖关系图

分析所有类的依赖关系，生成 `kb/architecture.md`。

### 生成总索引

使用 [templates/core/directory-index.md](./templates/core/directory-index.md) 生成 `kb/README.md`。

### 质量检查与完善

自动验证所有文档，修正不符合约束的内容。

### 询问是否生成扩展文档

**核心文档完成后询问**:
```
✅ 所有类文档已生成完成，共 X 个文件。

是否需要生成扩展文档？扩展文档包括：
- directory-structure.md (目录结构)
- spring-configuration.md (Spring配置)
- business-flows.md (业务流程)
- api-contracts.md (API契约)
- interceptors-aspects.md (拦截器切面)
- security-auth.md (安全认证)
- database-structure.md (数据库结构)
- environment-config.md (环境配置)
- third-party-interfaces.md (第三方接口)
- third-party-components.md (第三方组件)
- custom-annotations.md (自定义注解)

请选择:
1) 生成全部扩展文档
2) 选择性生成（请指定文档名）
3) 跳过，完成知识库生成
```

---

## 扩展文档生成策略

⚠️ **扩展文档使用与核心文档相同的任务管理策略**

### 扩展文档任务管理文件

| 文件 | 用途 | 生成时机 |
|------|------|----------|
| `kb/extra/.ext-task-plan.md` | 扩展文档执行计划 | 用户选择后，开始前 |
| `kb/extra/.ext-task-progress.md` | 扩展文档进度跟踪 | 执行过程中实时更新 |
| `kb/extra/.ext-task-report.md` | 扩展文档完成报告 | 全部完成后 |

**模板位置**:
- [ext-task-plan.md](./templates/ext-task-plan.md) - 扩展文档执行计划模板
- [ext-task-progress.md](./templates/ext-task-progress.md) - 扩展文档进度跟踪模板
- [ext-task-report.md](./templates/ext-task-report.md) - 扩展文档完成报告模板

### 扩展文档执行流程

```
┌─────────────────────────────────────────────────────────────────┐
│                    扩展文档执行流程                              │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  步骤1: 选择阶段                                                 │
│     ├── 展示 11 个可选扩展文档                                   │
│     ├── 用户选择需要生成的文档                                   │
│     └── 生成 .ext-task-plan.md（执行计划）                      │
│                                                                  │
│  步骤2: 数据准备阶段                                             │
│     ├── 收集目录结构信息                                         │
│     ├── 收集 API 信息（从 Controller 文档）                     │
│     ├── 收集业务流程（从 Service 文档）                         │
│     ├── 收集数据库结构（从 Entity/Mapper 文档）                 │
│     └── 收集配置信息（从 Config 文档 + 配置文件）               │
│                                                                  │
│  步骤3: 逐文档生成阶段                                           │
│     ├── 按优先级逐个生成扩展文档                                 │
│     ├── 每完成一个文档，更新 .ext-task-progress.md              │
│     └── 记录问题和警告                                           │
│                                                                  │
│  步骤4: 索引更新阶段                                             │
│     ├── 生成 kb/extra/README.md（扩展文档索引）                 │
│     └── 更新 kb/README.md（添加扩展文档链接）                   │
│                                                                  │
│  步骤5: 报告阶段                                                 │
│     ├── 质量检查                                                 │
│     ├── 统计汇总                                                 │
│     └── 生成 .ext-task-report.md（完成报告）                    │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

> ⚠️ **注意**：扩展文档按优先级逐个生成，不需要按批次处理（因为总共只有 11 个可选文档）。

### 扩展文档优先级

| 优先级 | 文档 | 依赖数据 | 说明 |
|--------|------|----------|------|
| P1 | directory-structure.md | 目录扫描 | 项目结构概览 |
| P1 | spring-configuration.md | Config 类 | 配置全景 |
| P1 | business-flows.md | Controller/Service | 核心业务流程 |
| P1 | api-contracts.md | Controller | API 契约文档 |
| P2 | interceptors-aspects.md | Handler/Config | 横切关注点 |
| P2 | security-auth.md | Security 类 | 安全认证 |
| P2 | database-structure.md | Entity/Mapper | 数据模型 |
| P2 | environment-config.md | 配置文件 | 环境配置 |
| P2 | custom-annotations.md | Annotation 类 | 自定义注解 |
| P3 | third-party-interfaces.md | Feign | 外部依赖 |
| P3 | third-party-components.md | 依赖分析 | 第三方组件 |

### 扩展文档输出结构

```
kb/
├── README.md                  # 更新：添加扩展文档链接
├── ...                        # 核心文档
│
└── extra/                     # 扩展文档目录
    ├── .ext-task-plan.md      # 执行计划
    ├── .ext-task-progress.md  # 进度跟踪
    ├── .ext-task-report.md    # 完成报告
    │
    ├── README.md              # 扩展文档索引
    ├── directory-structure.md
    ├── spring-configuration.md
    ├── business-flows.md
    ├── api-contracts.md
    ├── interceptors-aspects.md
    ├── security-auth.md
    ├── database-structure.md
    ├── environment-config.md
    ├── third-party-interfaces.md
    └── third-party-components.md
```

### 扩展文档断点续传

如果生成中断，可以从上次位置继续：

```
检测到未完成的扩展文档生成任务...
已完成: 4/8 个扩展文档
上次停止位置: api-contracts.md

是否继续上次的生成？
1) 继续生成（从 interceptors-aspects.md 开始）
2) 重新开始
3) 仅更新索引（如果所有文档已生成完成）
```

## 输出结构

```
kb/
├── README.md                  # 总索引（最后生成）
├── architecture.md            # 架构依赖图
│
│   # === 按类型分类的独立文件 ===
├── interface/                 # 接口定义
├── abstract/                  # 抽象类
├── controller/
├── service/
├── mapper/
├── entity/
├── dto/
├── vo-response/
├── request/
├── feign/
├── config/
├── handler/
├── job-task/
├── mq-listener/
├── utils/
├── annotation/
├── exception/
├── enum/
├── constants/                 # 常量类
│
│   # === 扩展文档（可选，用户确认后生成）===
└── extra/
    ├── README.md
    ├── directory-structure.md
    ├── business-flows.md
    ├── api-contracts.md
    └── ...
```

## 核心约束

- **统一分批模式**: 所有项目统一使用分批模式，边扫描边生成，最终汇总依赖关系
- **一类一文件**: 每个类生成独立的 `.md` 文件
- **类型识别优先**: 根据注解/继承/作用识别类型，**完全忽略目录名**
- **完整读取**: 必须完整读取源码文件，不得截断
- **每方法必生成**: 必须为每个方法生成完整文档
- **分批处理**: 每批读取 10 个文件，生成文档后更新进度
- **进度不可变**: 任务清单生成后不得增减条目，仅可更新状态
- **双向依赖**: 记录依赖方和被依赖方
- **完整方法签名**: 每个方法必须记录完整签名（见[方法签名规范](#方法签名规范)）

---

## 分批执行策略

### 执行前置检查（必须）

```
**每次执行前必须执行以下检查**：

1. 检查 kb/.task-plan.md 是否存在
   - 若不存在 → 执行扫描，生成计划
   - 若存在 → 读取计划

2. 检查 kb/.task-progress.md 是否存在
   - 若不存在 → 基于计划创建进度文件
   - 若存在 → 读取进度，找到未完成任务

3. 进度同步检查（防止会话中断导致不一致）
   - 对于进度文件中状态为 ⏳ 或 🔄 的文件
   - 检查对应的文档文件是否已存在（kb/{type}/{className}.md）
   - 若文档已存在 → 将进度状态更新为 ✅
   - 若文档不存在 → 保持原状态

4. 确定续传起点
   - 找到第一个状态为 ⏳ 或 🔄 的文件
   - 从该文件所在批次开始继续
```

### 分批规则

| 规则 | 说明 |
|------|------|
| 批次大小 | **固定 10 个文件** |
| 读取方式 | **完整读取**，不使用 offset/limit |
| 方法要求 | **每个方法都必须生成文档** |
| 进度更新 | **每个文件处理完成后立即更新**（规则3） - 详见 [进度更新规则](#进度更新规则-) |
| 条目约束 | **不得增减任务清单条目**（规则7） |

### 单批次执行流程

```
┌─────────────────────────────────────────────────────────────────┐
│                    单批次执行流程（10 个文件）                    │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  步骤1: 读取阶段                                                 │
│     ├── 读取进度文件，确定当前批次                               │
│     ├── 获取本批次 10 个文件路径                                 │
│     └── 完整读取 10 个代码文件（不截断）                         │
│                                                                  │
│  步骤2: 逐文件处理（每个文件完成后立即更新进度）                │
│     │                                                            │
│     │  对于批次中的每个文件，执行以下子步骤：                    │
│     │                                                            │
│     ├── 2.1 读取源码文件（完整读取）                             │
│     │   ├── 识别类的类型（基于注解/关键字）                      │
│     │   ├── 提取所有方法及完整签名                               │
│     │   └── 提取依赖关系                                         │
│     │                                                            │
│     ├── 2.2 读取对应类型的模板文件（规则5）                      │
│     │   └── 模板路径: templates/core/{type}.md                  │
│     │                                                            │
│     ├── 2.3 生成文档并写入文件系统                               │
│     │   ├── 严格按照模板结构生成                                 │
│     │   ├── 包含模板中的所有章节                                 │
│     │   └── 为每个方法生成完整记录                               │
│     │                                                            │
│     └── 2.4 立即更新进度文件（规则3、规则8）                     │
│         ├── 确认文档已成功写入                                   │
│         ├── 更新该文件状态: ⏳ → ✅ 或 ❌                        │
│         ├── 填写实际生成的文档路径和方法数                       │
│         └── 完成更新后才能处理下一个文件                         │
│                                                                  │
│  步骤3: 继续或完成                                               │
│     ├── 若还有未处理批次 → 继续下一批                            │
│     └── 若全部完成 → 进入汇总阶段                                │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

### 完整文件清单要求

**计划文件必须包含完整的文件清单**（不含状态字段）：

```markdown
## 📋 完整文件清单（任务清单）

| 序号 | 文件路径 | 预计类型 | 批次 |
|------|----------|----------|------|
| 1 | com/xxx/controller/UserController.java | Controller | 1 |
| 2 | com/xxx/controller/OrderController.java | Controller | 1 |
| 3 | com/xxx/service/UserService.java | Interface | 1 |
| ... | ... | ... | ... |
| 100 | com/xxx/utils/DateUtils.java | Utils | 5 |
```

**进度文件包含状态字段，用于跟踪执行进度**：

```markdown
## 📋 文件级进度清单

| 序号 | 文件路径 | 类型 | 批次 | 状态 | 生成文档 | 方法数 |
|------|----------|------|------|------|----------|--------|
| 1 | com/xxx/controller/UserController.java | Controller | 1 | ✅ | kb/controller/UserController.md | 15 |
| 2 | com/xxx/controller/OrderController.java | Controller | 1 | ✅ | kb/controller/OrderController.md | 12 |
| 3 | com/xxx/service/UserService.java | Interface | 1 | ✅ | kb/interface/UserService.md | 10 |
| ... | ... | ... | ... | ... | ... | ... |
| 21 | com/xxx/service/impl/UserServiceImpl.java | Service | 3 | 🔄 | - | - |
| 22 | com/xxx/service/impl/OrderServiceImpl.java | Service | 3 | ⏳ | - | - |
```

---

## 进度更新规则 ⭐

这是最核心的规则，支撑规则3和规则8，确保断点续传的可靠性。

```
┌─────────────────────────────────────────────────────────────────┐
│                        进度更新规则                              │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  📌 更新时机（规则3）：                                          │
│     └── 每生成一个文档后【立即】更新，处理下一个文件前完成      │
│                                                                  │
│  📌 更新内容（规则8）：                                          │
│     └── 状态、文档路径、方法数 - 必须基于实际生成结果           │
│                                                                  │
│  ✅ 允许更新：状态、文档路径、方法数、批次状态、进度百分比      │
│                                                                  │
│  ❌ 禁止操作（规则7）：                                          │
│     └── 新增/删除/修改文件条目，修改路径/序号/批次分配          │
│                                                                  │
│  📌 正确流程：                                                   │
│     读取源码 → 读取模板 → 生成文档 → 确认写入 → 立即更新进度    │
│                                                                  │
│  ❌ 错误流程：                                                   │
│     批量更新状态、文档未生成就标记✅、修改条目内容              │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

详细说明参见 [强制执行规则](#强制执行规则) 中的规则3、规则7、规则8。

---

### 断点续传流程

```
检测到 kb/.task-progress.md 存在...

读取进度文件...
- 总文件数: 100
- 已完成: 22 (22%)
- 当前批次: 3
- 批次内进度: 2/10

找到续传起点:
- 下一个文件: 序号 23
- 文件路径: com/xxx/service/impl/OrderServiceImpl.java
- 所在批次: 3

是否从批次 3 继续执行？(Y/n)
```

## 类型识别补充说明

**目录名不可信**：`controller` 目录可能含 Service，`service` 目录可能含 Mapper。

完整识别规则和模板对照详见 [类型识别与模板选择](#类型识别与模板选择) 章节。

### Handler细分规则

Handler 类型需要细分识别：

| 子类型 | 识别依据 | 归类 |
|--------|----------|------|
| ExceptionHandler | `@ControllerAdvice` + `@ExceptionHandler` | `handler/` |
| EventHandler | `@EventListener`, `implements ApplicationListener` | `event-listener/` |
| WebSocketHandler | `@ServerEndpoint`, `extends WebSocketHandler` | `websocket/` |
| 通用Handler | `*Handler.java`（不匹配上述） | `handler/` |

### 命名冲突优先级

当类名同时满足多个规则时，按以下优先级：

```
*RequestDTO.java → Request（而非 DTO）
*ResponseVO.java → VO/Response
*ServiceImpl.java + @Service → Service
```

**示例**:
- `com.xxx.controller.UserService.java` 含 `@Service` → `kb/service/UserService.md`
- `com.xxx.dto.CreateUserRequestDTO.java` → `kb/request/CreateUserRequestDTO.md`

## 类文档必含章节

每个类文档必须包含以下章节：

```markdown
# {{CLASS_NAME}}

> **路径**: `{{PACKAGE_NAME}}.{{CLASS_NAME}}`  
> **类型**: {{TYPE}}  
> **职责**: {{RESPONSIBILITY}}  
> **代码行数**: {{LOC}} 行（SLOC，不含空行和注释）

---

## 📊 统计信息
[类型特定的统计表格]

---

## 📋 方法/接口列表
[方法详情，必须包含完整方法签名]

---

## 🔗 依赖组件（我依赖谁）
[列出本类依赖的其他组件]

---

## 🔙 被依赖方（谁依赖我）
[列出哪些组件依赖本类，用于影响分析]

---

## 🏷️ 关键注解
[类上的关键注解]
```

### 代码行数定义

**LOC (Lines of Code)** = SLOC（Source Lines of Code）
- ✅ 包含：有效代码行
- ❌ 不含：空行、纯注释行、仅含 `{` 或 `}` 的行

## 方法签名规范

⚠️ **关键要求**: 每个方法必须记录**完整的方法签名**，包含以下全部信息：

### 必须包含的信息

| 信息类型 | 说明 | 示例 |
|----------|------|------|
| **方法注解** | 方法上的所有注解 | `@GetMapping`, `@Transactional`, `@Async` |
| **访问修饰符** | public/protected/private | `public` |
| **返回类型** | 完整的返回类型（含泛型） | `List<UserVO>`, `ResponseEntity<Result<PageInfo<UserDTO>>>` |
| **方法名** | 方法名称 | `getUserById` |
| **参数列表** | 每个参数的完整信息 | 见下方参数格式 |
| **异常声明** | throws 声明的异常 | `throws BusinessException, IOException` |

### 参数格式要求

每个参数必须包含：
- **参数注解**: `@RequestParam`, `@PathVariable`, `@RequestBody`, `@Valid` 等
- **参数类型**: 完整类型（含泛型）
- **参数名**: 参数名称

**参数格式示例**:
```
@PathVariable("id") Long id
@RequestParam(value = "name", required = false) String name
@RequestBody @Valid CreateUserRequest request
@RequestHeader("Authorization") String token
```

### 完整方法签名示例

**Controller 方法**:
```java
@GetMapping("/users/{id}")
@PreAuthorize("hasRole('ADMIN')")
public ResponseEntity<Result<UserVO>> getUserById(
    @PathVariable("id") Long id,
    @RequestParam(value = "includeOrders", defaultValue = "false") Boolean includeOrders
)
```

**Service 方法**:
```java
@Transactional(rollbackFor = Exception.class)
public UserVO createUser(@Valid CreateUserDTO dto) throws BusinessException
```

**Mapper 方法**:
```java
@Select("SELECT * FROM user WHERE id = #{id}")
User selectById(@Param("id") Long id)
```

### 方法文档格式

在文档中，每个方法应按以下格式记录：

```markdown
### getUserById
- **完整签名**:
  ```java
  @GetMapping("/users/{id}")
  @PreAuthorize("hasRole('ADMIN')")
  public ResponseEntity<Result<UserVO>> getUserById(
      @PathVariable("id") Long id,
      @RequestParam(value = "includeOrders", defaultValue = "false") Boolean includeOrders
  )
  ```
- **参数说明**:
  | 参数 | 类型 | 注解 | 必填 | 说明 |
  |------|------|------|------|------|
  | id | Long | @PathVariable | ✅ | 用户ID |
  | includeOrders | Boolean | @RequestParam | ❌ | 是否包含订单，默认false |
- **返回**: `ResponseEntity<Result<UserVO>>` - 用户详情
- **异常**: 无
- **说明**: 根据ID查询用户详细信息
```

## 灵活性原则

### 目录命名
模板中的目录名称**仅供参考**，可根据项目实际情况调整：
- `controller/` → `api/` 或 `web/`
- `service/` → `domain/` 或 `business/`
- `vo-response/` → `vo/` 或 `response/`
- 命名应反映项目实际术语和团队习惯

### 按需生成
**不是所有项目都需要生成全部类型目录**：
- **无内容则跳过**: 如项目无 Feign 客户端，则不创建 `feign/` 目录
- **有内容则生成**: 如项目有 WebSocket 处理器，应创建 `websocket/` 目录
- **扫描时统计**: 完整扫描后，仅为有内容的类型创建目录

### 扩展未列分类
如发现模板未涵盖的重要代码分类，**应主动生成**：
- 事件监听器 → `event-listener/`
- WebSocket → `websocket/`
- GraphQL → `graphql/`
- gRPC → `grpc/`
- 缓存管理 → `cache/`
- 状态机 → `state-machine/`
- 规则引擎 → `rule-engine/`
- 其他项目特有的重要组件

**原则**: 文档服务于项目理解，而非机械套用模板。

## 文件读取和方法生成约束

```
┌─────────────────────────────────────────────────────────────────┐
│                   文件读取和方法生成约束                         │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  📖 文件读取：                                                   │
│     ✅ 完整读取每个代码文件（不使用 offset/limit）              │
│     ❌ 禁止截断读取、跳过大文件                                  │
│                                                                  │
│  📋 方法生成：                                                   │
│     ✅ 记录所有 public 方法的完整签名和参数说明                  │
│     ❌ 禁止遗漏方法、省略注解、使用模糊描述                      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 模板组织

```
templates/
├── complete-file-list.md   # 完整文件清单模板（阶段1生成）
├── task-plan.md            # 核心文档执行计划模板
├── task-progress.md        # 核心文档进度跟踪模板
├── task-report.md          # 核心文档完成报告模板
├── ext-task-plan.md        # 扩展文档执行计划模板
├── ext-task-progress.md    # 扩展文档进度跟踪模板
├── ext-task-report.md      # 扩展文档完成报告模板
├── core/                   # 19个核心类型模板 + 1个兜底模板 + 3个特殊文档模板（必须）
│   ├── README.md           # 特殊：模板说明
│   ├── directory-index.md  # 特殊：总索引模板
│   ├── architecture.md     # 特殊：架构文档模板
│   ├── default.md          # 兜底：无法识别类型时使用
│   ├── interface.md
│   ├── abstract.md
│   ├── constants.md
│   ├── controller.md
│   ├── service.md
│   ├── exception.md
│   ├── enum.md
│   └── ...
└── optional/            # 扩展模板（可选）
    ├── README.md
    ├── business-flows.md
    ├── api-contracts.md
    ├── directory-structure.md
    ├── database-structure.md
    └── ...
```

## 参考资源

| 类型 | 资源 |
|------|------|
| 规则参考 | [reference.md](./reference.md) - 类型识别规则、依赖分析算法、循环检测<br>[examples.md](./examples.md) - 使用示例<br>[checklist.md](./checklist.md) - 验证清单 |
| 任务管理模板 | 详见文档开头的 [任务管理文件](#任务管理文件) 章节 |
| 文档模板 | [核心模板](./templates/core/) - 19个核心类型模板<br>[扩展模板](./templates/optional/) - 可选扩展文档模板 |
