# 业务流程文档

> **项目**: {{PROJECT_NAME}}  
> **生成时间**: {{SCAN_DATE}}

---

## 📋 核心业务流程

### 1. {{FLOW_NAME}}

**入口方法**:
```java
@PostMapping("{{PATH}}")
public Result<{{RETURN_TYPE}}> {{METHOD_NAME}}(
    @RequestBody @Valid {{REQUEST_TYPE}} request
)
```

**涉及组件**: {{COMPONENT_COUNT}} 个  
**事务边界**: `{{SERVICE_CLASS}}.{{TX_METHOD}}()`

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           {{FLOW_NAME}} 流程图                               │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌─────────┐                                                                │
│  │  开始   │                                                                │
│  └────┬────┘                                                                │
│       ↓                                                                      │
│  ┌─────────────────────┐                                                    │
│  │   {{CONTROLLER}}    │  ← HTTP Request                                    │
│  │   {{METHOD}}()      │                                                    │
│  └──────────┬──────────┘                                                    │
│             │ 参数校验                                                       │
│             ↓                                                                │
│  ┌─────────────────────┐      ┌─────────────────────┐                       │
│  │    {{SERVICE}}      │─────→│    {{MAPPER}}       │                       │
│  │    {{METHOD}}()     │      │    selectById()     │                       │
│  │   @Transactional    │      └─────────────────────┘                       │
│  └──────────┬──────────┘               │                                    │
│             │                          │ 查询结果                            │
│             │←─────────────────────────┘                                    │
│             │                                                                │
│             ↓                                                                │
│       ┌─────────────┐                                                       │
│       │  数据存在?  │                                                       │
│       └──────┬──────┘                                                       │
│         是 ↙   ↘ 否                                                         │
│          ↓       ↓                                                          │
│  ┌───────────┐  ┌───────────────┐                                          │
│  │ 业务处理  │  │ 抛出异常      │                                          │
│  └─────┬─────┘  │ NotFoundException│                                        │
│        │        └───────────────┘                                          │
│        ↓                                                                     │
│  ┌─────────────────────┐                                                    │
│  │    {{MAPPER}}       │                                                    │
│  │    updateById()     │                                                    │
│  └──────────┬──────────┘                                                    │
│             │                                                                │
│             ↓                                                                │
│  ┌─────────────────────┐                                                    │
│  │  {{OTHER_SERVICE}}  │  ← 异步调用                                        │
│  │  sendNotification() │                                                    │
│  │      @Async         │                                                    │
│  └──────────┬──────────┘                                                    │
│             │                                                                │
│             ↓                                                                │
│  ┌─────────┐                                                                │
│  │  结束   │  → HTTP Response                                               │
│  └─────────┘                                                                │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

**详细步骤**:

| 步骤 | 组件 | 方法签名 | 说明 |
|------|------|----------|------|
| 1 | {{CONTROLLER}} | `public Result<{{TYPE}}> {{METHOD}}(@RequestBody @Valid {{REQUEST}} req)` | {{STEP_DESC}} |
| 2 | {{SERVICE}} | `@Transactional public {{TYPE}} {{METHOD}}({{PARAM_TYPE}} param)` | {{STEP_DESC}} |
| 3 | {{MAPPER}} | `{{TYPE}} {{METHOD}}(@Param("id") Long id)` | {{STEP_DESC}} |
| 4 | {{MAPPER}} | `int {{METHOD}}({{ENTITY}} entity)` | {{STEP_DESC}} |
| 5 | {{OTHER_SERVICE}} | `@Async public void {{METHOD}}({{PARAM_TYPE}} param)` | {{STEP_DESC}} |

**异常处理**:
| 异常类型 | 触发条件 | 处理方式 |
|----------|----------|----------|
| `{{EXCEPTION_TYPE}}` | {{TRIGGER_CONDITION}} | {{HANDLING}} |

---

### 2. {{FLOW_NAME_2}}

**入口方法**:
```java
@GetMapping("{{PATH}}")
public Result<{{RETURN_TYPE}}> {{METHOD_NAME}}(
    @PathVariable("id") Long id
)
```

**涉及组件**: {{COMPONENT_COUNT}} 个  
**事务边界**: 无（只读操作）

```
┌──────────────────┐
│  {{CONTROLLER}}  │
│  {{METHOD}}()    │
└────────┬─────────┘
         ↓
┌──────────────────┐
│   {{SERVICE}}    │
│   {{METHOD}}()   │
└────────┬─────────┘
         │
         ├──→ {{CACHE_SERVICE}}.get()
         │
         └──→ {{MAPPER}}.{{METHOD}}()
```

**详细步骤**:

| 步骤 | 组件 | 方法签名 | 说明 |
|------|------|----------|------|
| 1 | {{CONTROLLER}} | `public Result<{{VO}}> {{METHOD}}(@PathVariable("id") Long id)` | {{STEP_DESC}} |
| 2 | {{SERVICE}} | `@Cacheable(value = "{{CACHE}}", key = "#id") public {{VO}} {{METHOD}}(Long id)` | {{STEP_DESC}} |
| 3 | {{MAPPER}} | `{{ENTITY}} {{METHOD}}(@Param("id") Long id)` | {{STEP_DESC}} |

---

## 📊 流程统计

| 流程名称 | 涉及组件数 | 事务方法数 | 异步调用数 | 缓存操作数 |
|----------|------------|------------|------------|------------|
| {{FLOW_NAME}} | {{N}} | {{N}} | {{N}} | {{N}} |

---

## 🔄 状态流转

### {{STATE_MACHINE_NAME}}

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         {{STATE_MACHINE_NAME}} 状态机                        │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│                          ┌─────────────────┐                                │
│                          │   {{STATE_1}}   │                                │
│                          │    (初始状态)    │                                │
│                          └────────┬────────┘                                │
│                                   │                                          │
│                          {{ACTION_1}}│                                       │
│                                   ↓                                          │
│                          ┌─────────────────┐                                │
│           ┌──────────────│   {{STATE_2}}   │──────────────┐                 │
│           │              │    (处理中)     │              │                 │
│           │              └────────┬────────┘              │                 │
│           │                       │                       │                 │
│  {{ACTION_X}}│              {{ACTION_2}}│           {{ACTION_Y}}│            │
│           ↓                       ↓                       ↓                 │
│  ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐         │
│  │   {{STATE_X}}   │    │   {{STATE_3}}   │    │   {{STATE_Y}}   │         │
│  │    (已取消)     │    │    (已完成)     │    │    (已失败)     │         │
│  └─────────────────┘    └─────────────────┘    └────────┬────────┘         │
│                                                         │                   │
│                                                {{ACTION_RETRY}}│             │
│                                                         │                   │
│                                                         └──────→ {{STATE_2}}│
│                                                                              │
│  ═══════════════════════════════════════════════════════════════════════    │
│  状态说明:                                                                   │
│  • {{STATE_1}}: {{STATE_1_DESC}}                                            │
│  • {{STATE_2}}: {{STATE_2_DESC}}                                            │
│  • {{STATE_3}}: {{STATE_3_DESC}}（终态）                                     │
│  • {{STATE_X}}: {{STATE_X_DESC}}（终态）                                     │
│  • {{STATE_Y}}: {{STATE_Y_DESC}}（可重试）                                   │
└─────────────────────────────────────────────────────────────────────────────┘
```

**状态转换方法**:
| 当前状态 | 目标状态 | 触发方法 | 方法签名 |
|----------|----------|----------|----------|
| {{STATE_1}} | {{STATE_2}} | {{METHOD}} | `@Transactional public void {{METHOD}}(Long id)` |
| {{STATE_2}} | {{STATE_3}} | {{METHOD}} | `@Transactional public void {{METHOD}}(Long id)` |

---

## 💡 流程优化建议

1. **{{FLOW_NAME}}**: {{OPTIMIZATION_SUGGESTION}}
2. **{{FLOW_NAME_2}}**: {{OPTIMIZATION_SUGGESTION}}

---

## 📝 业务规则

### {{FLOW_NAME}} 规则

- {{BUSINESS_RULE_1}}
- {{BUSINESS_RULE_2}}
- {{BUSINESS_RULE_3}}

### {{FLOW_NAME_2}} 规则

- {{BUSINESS_RULE_1}}
- {{BUSINESS_RULE_2}}

*示例：*
- *状态流转：待处理(0) → 处理中(1) → 已完成(2) → 已拒绝(3)*
- *同一候选人对同一职位只能推荐一次*
- *推荐成功后24小时内可撤回*

---

## 📝 维护记录

| 时间 | 维护人 | 维护内容 | 版本 |
|------|--------|----------|------|
| {{SCAN_DATE}} | AI自动生成 | 初始创建文档 | v1.0 |
