# 执行计划

> **项目**: {{PROJECT_NAME}}  
> **创建时间**: {{CREATE_DATE}}  
> **执行模式**: 统一分批模式（每批 10 个文件，适用于所有项目）

---

## 📊 项目规模统计（精准扫描）

|| 指标 | 数值 |
||------|------|
|| 扫描工具 | list_files 或 search_file（已记录） |
|| Java 文件总数 | {{TOTAL_FILES}}（工具扫描精确结果，非预估或估算） |
|| 子目录数量 | {{TOTAL_DIRS}}（工具扫描精确结果，非预估或估算） |
|| 批次数量 | {{BATCH_COUNT}} （每批 10 个文件） |
|| 类型分布统计 | 见下表（基于实际扫描） |

### 类型统计分布（实际扫描结果）

> ⚠️ **重要说明**：此表为 list_files 或 search_file 工具扫描的精确结果，非预估或估算值

|| 类型 | 实际数量 | 识别依据 |
||------|----------|----------|
|| Controller | {{N}} | @RestController, @Controller |
|| Service | {{N}} | @Service, *ServiceImpl |
|| Mapper | {{N}} | @Mapper, extends BaseMapper |
|| Entity | {{N}} | @Entity, @TableName |
|| DTO | {{N}} | *DTO.java, *Dto.java |
|| VO/Response | {{N}} | *VO.java, *Response.java |
|| Request | {{N}} | *Request.java |
|| Config | {{N}} | @Configuration |
|| Utils | {{N}} | *Util.java, *Utils.java |
|| Exception | {{N}} | extends Exception |
|| Enum | {{N}} | enum 定义 |
|| Feign | {{N}} | @FeignClient |
|| Handler | {{N}} | *Handler.java |
|| Job/Task | {{N}} | @Scheduled, @Async |
|| MQ Listener | {{N}} | @RabbitListener, @KafkaListener |
|| Annotation | {{N}} | @interface 定义 |
|| Constants | {{N}} | *Constants.java, *Constant.java |
|| Interface | {{N}} | interface 关键字 |
|| Abstract | {{N}} | abstract class |

---

## 📋 完整文件清单（任务清单）

⚠️ **此清单基于精准扫描生成，在计划生成后不得增减条目**

### 文件任务清单

|| 序号 | 文件路径 | 初步识别类型 | 批次 |
||------|----------|------------|------|
|| 1 | {{FILE_PATH_1}} | {{TYPE}} | 1 |
|| 2 | {{FILE_PATH_2}} | {{TYPE}} | 1 |
|| 3 | {{FILE_PATH_3}} | {{TYPE}} | 1 |
|| 4 | {{FILE_PATH_4}} | {{TYPE}} | 1 |
|| 5 | {{FILE_PATH_5}} | {{TYPE}} | 1 |
|| 6 | {{FILE_PATH_6}} | {{TYPE}} | 1 |
|| 7 | {{FILE_PATH_7}} | {{TYPE}} | 1 |
|| 8 | {{FILE_PATH_8}} | {{TYPE}} | 1 |
|| 9 | {{FILE_PATH_9}} | {{TYPE}} | 1 |
|| 10 | {{FILE_PATH_10}} | {{TYPE}} | 1 |
|| 11 | {{FILE_PATH_11}} | {{TYPE}} | 2 |
|| 12 | {{FILE_PATH_12}} | {{TYPE}} | 2 |
|| 13 | {{FILE_PATH_13}} | {{TYPE}} | 2 |
|| 14 | {{FILE_PATH_14}} | {{TYPE}} | 2 |
|| 15 | {{FILE_PATH_15}} | {{TYPE}} | 2 |
|| 16 | {{FILE_PATH_16}} | {{TYPE}} | 2 |
|| 17 | {{FILE_PATH_17}} | {{TYPE}} | 2 |
|| 18 | {{FILE_PATH_18}} | {{TYPE}} | 2 |
|| 19 | {{FILE_PATH_19}} | {{TYPE}} | 2 |
|| 20 | {{FILE_PATH_20}} | {{TYPE}} | 2 |
|| 21 | {{FILE_PATH_21}} | {{TYPE}} | 3 |
|| 22 | {{FILE_PATH_22}} | {{TYPE}} | 2 |
|| ... | ... | ... | ... |

---

## 📦 批次规划

|| 批次 | 文件序号范围 | 文件数 |
||------|--------------|--------|
|| 1 | 1-10 | 10 |
|| 2 | 11-20 | 10 |
|| 3 | 21-30 | 10 |
|| 4 | 31-40 | 10 |
|| 5 | 41-50 | 10 |
|| ... | ... | ... |
|| {{LAST_BATCH}} | {{RANGE}} | {{N}} |

---

## 🔒 执行约束（必须遵守）

### 文件读取约束

```
⚠️ 必须完整读取每个代码文件
- 不得跳过任何代码行
- 不得使用 offset/limit 截断读取
- 如文件过大，仍需完整读取
```

### 方法生成约束

```
⚠️ 必须为每个方法生成文档
- 不得遗漏任何 public/protected 方法
- 不得遗漏任何 private 方法（如有业务逻辑）
- 每个方法必须包含完整签名
- 每个方法必须包含参数说明表格
```

### 批次执行约束

```
⚠️ 每批次处理 10 个文件
- 读取 10 个代码文件
- 为每个文件生成完整文档
- 更新进度文件中对应条目状态
- 不得增减任务清单条目
```

### 进度更新约束 ⭐⭐⭐

```
┌─────────────────────────────────────────────────────────────────┐
│              ⚠️ 进度更新规则（严格遵守）                         │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  📌 更新时机（必须立即更新）：                                   │
│     ├── 每生成一个文档后【立即】更新对应条目                     │
│     ├── 必须在处理下一个文件【之前】完成更新                     │
│     ├── ❌ 禁止等批次完成后批量更新                              │
│     └── ❌ 禁止跳过更新直接处理下一个文件                        │
│                                                                  │
│  📌 更新内容（必须基于实际结果）：                               │
│     ├── 状态：基于实际生成结果更新（成功✅/失败❌）              │
│     ├── 生成文档：填写实际生成的文档路径                         │
│     ├── 方法数：填写实际提取的方法数量                           │
│     └── ❌ 禁止填写预估值、估算值或虚假值                        │
│                                                                  │
│  📌 条目不可变原则：                                             │
│     ├── ❌ 禁止新增任何文件条目                                  │
│     ├── ❌ 禁止删除任何文件条目                                  │
│     ├── ❌ 禁止修改文件路径                                      │
│     ├── ❌ 禁止修改文件序号                                      │
│     ├── ❌ 禁止修改批次分配                                      │
│     └── ✅ 仅允许更新：状态、生成文档路径、方法数                │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

---

## 📋 执行阶段

### 阶段一：精准扫描与建立清单

|| 步骤 | 任务 | 产出 |
||------|------|------|
|| 1.1 | 使用 list_files 或 search_file 工具递归扫描所有 Java 文件（🚫绝不使用预估） | 完整文件清单 |
|| 1.2 | 初步识别类类型（最终类型在生成文档时确定） | 类型标注 |
|| 1.3 | 分配批次 | 批次规划 |
|| 1.4 | 生成本计划文件 | .task-plan.md |

### 阶段二：分批生成文档

|| 步骤 | 任务 | 产出 |
||------|------|------|
|| 2.1 | 读取当前批次 10 个文件 | 完整源码 |
|| 2.2 | 识别类类型（基于注解） | 确定类型 |
|| 2.3 | 提取所有方法签名 | 方法列表 |
|| 2.4 | 提取依赖关系 | 依赖索引 |
|| 2.5 | 生成 20 个类文档 | kb/{type}/*.md |
|| 2.6 | 更新进度文件 | .task-progress.md |
|| 2.7 | 重复直到所有批次完成 | - |

### 阶段三：汇总

|| 步骤 | 任务 | 产出 |
||------|------|------|
|| 3.1 | 合并依赖索引 | 全局依赖图 |
|| 3.2 | 生成反向依赖 | 被依赖关系 |
|| 3.3 | 更新所有文档的被依赖方 | 更新文档 |
|| 3.4 | 生成架构图 | architecture.md |
|| 3.5 | 生成总索引 | README.md |

### 阶段四：质量检查

|| 步骤 | 检查项 | 标准 |
||------|--------|------|
|| 4.1 | 文档完整性 | 文件数 = 文档数 |
|| 4.2 | 方法完整性 | 每个方法都有文档 |
|| 4.3 | 签名完整性 | 含注解、参数、返回值 |
|| 4.4 | 依赖完整性 | 双向依赖完整 |

---

## 📁 输出目录结构

```
kb/
├── .task-plan.md              # 本文件（含完整文件清单）
├── .task-progress.md          # 进度跟踪（实时更新状态）
├── .task-report.md            # 完成报告
├── .index/                    # 临时索引
│   └── dependencies.json      # 依赖索引
├── README.md                  # 总索引
├── architecture.md            # 架构图
├── controller/
├── service/
├── mapper/
├── entity/
├── dto/
└── ...
```

---

## ⚠️ 风险与应对

|| 风险 | 影响 | 应对措施 |
||------|------|----------|
|| 文件过大（>1000行） | 读取耗时 | 仍需完整读取，不可截断 |
|| 方法过多（>50个） | 文档过长 | 全部生成，不可省略 |
|| 中断恢复 | 进度丢失 | 读取进度文件续传 |
|| 类型识别错误 | 归类错误 | 基于注解识别，人工复核 |

---

## ✅ 确认开始

- [ ] 已确认项目路径正确
- [ ] 已确认输出目录 `kb/`
- [ ] 已确认完整文件清单（{{TOTAL_FILES}} 个文件，工具扫描精确结果，非预估或估算）
- [ ] 已记录扫描工具名称（list_files 或 search_file）
- [ ] 已确认批次规划（{{BATCH_COUNT}} 批，每批 10 个）
- [ ] 开始执行

**执行时必须先读取 `.task-progress.md`，若存在则继续未完成任务**

