# RC-017 编辑器右键菜单增加"执行"功能

## 1. 需求概述

| 项目 | 内容 |
|------|------|
| 需求编号 | RC-017 |
| 需求名称 | 编辑器右键菜单增加"执行"功能 |
| 提出日期 | 2026-01-29 |
| 优先级 | 中 |

### 1.1 背景
- 当前用户执行选中的 SQL 只能通过工具栏的"执行"按钮或快捷键
- 用户选中一段 SQL 后，需要移动鼠标到工具栏点击执行，操作路径较长
- 右键菜单是常见的快捷操作入口，添加"执行"菜单项可提升用户体验

### 1.2 目标
- 用户在 SQL 编辑器中选择文字后，右键菜单显示"执行"菜单项
- 点击"执行"后执行选中的 SQL 脚本
- 行为与工具栏"执行"按钮完全一致

---

## 2. 需求详情

### 2.1 功能描述

#### 2.1.1 触发条件
- 用户在 Monaco 编辑器中选中一段文字
- 右键弹出上下文菜单

#### 2.1.2 菜单项
| 菜单项 | 说明 |
|--------|------|
| 执行 | 执行当前选中的 SQL 语句（与工具栏按钮名称一致） |

#### 2.1.3 执行行为
与工具栏"执行"按钮行为一致：
1. 检查是否已连接数据库，未连接时提示"请先连接数据库"
2. 检查是否有选中文本，无选中时执行当前编辑器全部内容
3. 检查是否有未保存的数据修改，有则弹出确认对话框
4. 执行 SQL 并显示结果

### 2.2 技术方案

#### 2.2.1 实现方式
使用 Monaco Editor 的 `addAction` API 添加右键菜单项：

```typescript
editor.addAction({
  id: 'sql.execute',
  label: '执行',
  contextMenuGroupId: 'navigation',  // 菜单分组
  contextMenuOrder: 0,               // 菜单排序
  precondition: undefined,           // 可选：条件
  run: () => {
    // 触发执行逻辑
    eventBus.emit('execute-sql')
  }
})
```

#### 2.2.2 执行逻辑复用
- 方案：通过事件总线 `eventBus` 触发执行
- `SqlEditor.vue` 发送事件 `execute-sql`
- `Toolbar.vue` 监听事件并调用 `handleExecute()`

#### 2.2.3 影响文件
| 文件 | 修改内容 |
|------|----------|
| `SqlEditor.vue` | 添加 `addAction` 注册右键菜单项 |
| `Toolbar.vue` | 监听 `execute-sql` 事件，调用执行逻辑 |
| `eventBus.ts` | 添加 `execute-sql` 事件类型 |

### 2.3 验收标准

| 编号 | 测试场景 | 预期结果 |
|------|----------|----------|
| TC01 | 选中 SQL 后右键 | 菜单中显示"执行" |
| TC02 | 未连接数据库时点击执行 | 提示"请先连接数据库" |
| TC03 | 有未保存修改时执行 | 弹出覆盖确认对话框 |
| TC04 | 执行有效 SQL | 正常显示查询结果 |
| TC05 | 执行无效 SQL | 显示错误信息 |
| TC06 | 未选中文字时执行 | 执行编辑器全部内容 |

---

## 3. 交互设计

### 3.1 右键菜单位置
菜单项位于 Monaco 默认右键菜单中，建议放在靠前位置（navigation 分组）

### 3.2 菜单名称
使用"执行"，与工具栏按钮保持一致

---

## 4. 非功能需求

| 需求类型 | 描述 |
|----------|------|
| 兼容性 | 不影响现有右键菜单项 |
| 性能 | 无性能影响 |
| 快捷键 | 可选：考虑添加快捷键 `Ctrl+Enter` |

---

## 5. 变更历史

| 日期 | 变更内容 | 状态 |
|------|----------|------|
| 2026-01-29 | 初始创建 | 待实现 |
