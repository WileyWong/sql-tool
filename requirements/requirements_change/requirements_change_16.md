# RC-016 用户体验优化（连接失败提示 + 编辑输入框尺寸）

## 1. 需求概述

| 项目 | 内容 |
|------|------|
| 需求编号 | RC-016 |
| 需求名称 | 用户体验优化 |
| 提出日期 | 2026-01-29 |
| 优先级 | 中 |

### 1.1 背景
1. 连接数据库失败时，用户没有收到任何错误提示，无法得知失败原因
2. 结果表格双击编辑单元格时，输入框尺寸太小，影响编辑体验

### 1.2 目标
1. 连接数据库失败时显示错误提示消息
2. 编辑输入框尺寸与当前单元格保持一致

---

## 2. 需求详情

### 2.1 功能点一：连接失败提示

#### 2.1.1 当前行为
- 用户点击连接节点或选择"连接"菜单时，如果连接失败，界面没有任何反馈
- 用户无法知道连接是否失败、失败原因是什么

#### 2.1.2 期望行为
- 连接失败时，显示 `ElMessage.error()` 提示，包含错误信息
- 提示内容格式：`连接失败: {错误信息}`

#### 2.1.3 影响范围
| 场景 | 触发位置 | 文件 |
|------|----------|------|
| 展开连接节点（懒加载） | `loadNode()` | `ConnectionTree.vue` |
| 点击连接节点 | `handleNodeClick()` | `ConnectionTree.vue` |
| 右键菜单"连接" | `handleMenuClick()` | `ConnectionTree.vue` |
| 切换编辑器连接 | `handleConnectionChange()` | `SqlEditor.vue` |

#### 2.1.4 验收标准
| 编号 | 测试场景 | 预期结果 |
|------|----------|----------|
| TC01 | 输入错误密码后连接 | 显示 "连接失败: Access denied..." |
| TC02 | 连接不存在的主机 | 显示 "连接失败: connect ECONNREFUSED..." |
| TC03 | 连接超时 | 显示 "连接失败: connect ETIMEDOUT..." |
| TC04 | 连接成功 | 无错误提示，正常展开数据库列表 |

---

### 2.2 功能点二：编辑输入框尺寸优化

#### 2.2.1 当前行为
- 双击单元格进入编辑模式
- 输入框使用 CSS `width: 100%; height: 100%`
- 由于父容器 `.edit-cell` 使用负 margin 抵消 padding，实际输入框可见区域较小

#### 2.2.2 期望行为
- 编辑输入框的宽度和高度与当前单元格完全一致
- 输入框应该覆盖整个单元格区域，不留空白

#### 2.2.3 技术方案
当前样式：
```css
.edit-cell {
  margin: -8px -12px;
  padding: 0;
  width: 100%;
  height: 100%;
}

.edit-input {
  width: 100%;
  height: 100%;
  padding: 8px 12px;
  ...
}
```

优化方案：确保 `.edit-cell` 容器尺寸与单元格一致，输入框填满容器

```css
.edit-cell {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  margin: 0;
  padding: 0;
}

.table-cell {
  position: relative;  /* 为 .edit-cell 提供定位上下文 */
}

.edit-input {
  width: 100%;
  height: 100%;
  padding: 8px 12px;
  box-sizing: border-box;
}
```

#### 2.2.4 验收标准
| 编号 | 测试场景 | 预期结果 |
|------|----------|----------|
| TC01 | 双击正常宽度单元格 | 输入框宽高与单元格一致 |
| TC02 | 双击宽列（如 300px） | 输入框宽度为 300px |
| TC03 | 编辑后按 Enter 确认 | 正常保存，样式恢复 |
| TC04 | 编辑后按 Escape 取消 | 正常取消，样式恢复 |

---

## 3. 非功能需求

| 需求类型 | 描述 |
|----------|------|
| 兼容性 | 不影响现有功能 |
| 性能 | 无性能影响 |

---

## 4. 变更历史

| 日期 | 变更内容 | 状态 |
|------|----------|------|
| 2026-01-29 | 初始创建 | 待实现 |
