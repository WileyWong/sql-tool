# 需求变更单

## 基本信息

| 项目 | 内容 |
|------|------|
| 变更编号 | RC-012 |
| 变更日期 | 2026-01-27 |
| 提出人 | |
| 优先级 | P1-高 |
| 影响范围 | 全栈 |

---

## 1. 变更内容

### 1.1 功能需求

> 详细描述需要实现的功能

| 序号 | 功能点 | 描述 | 验收标准 |
|------|--------|------|----------|
| 1 | 菜单使用electron原生菜单 | 把现在使用HTML的菜单，替换成electron原生菜单 | |
| 2 | 文件 菜单 | 保留：新建链接，新建查询，最新打开的文件，打开文件，保存，另存为，退出 | |
| 3 | 编辑 菜单 | 保留：撤销（点击后实现control+Z功能），重做（点击后实现control+Y功能），剪切（点击后实现control+X功能），复制（点击后实现control+C功能），粘贴（点击后实现control+V功能） | |
| 4 | 查看、查询、工具 菜单 | 还没有实现，删除这个菜单 | |
| 5 | 帮助 菜单 | 只保留 关于 菜单项，点击后，显示版本信息 | |

---

## 2. 变更实现记录

### 2.1 实现细节

#### 2.1.1 最近打开文件菜单刷新功能

**问题描述：**
保存文件后，"最近打开的文件"菜单没有自动更新

**实现方案：**
1. 在 `src/renderer/components/Toolbar.vue` 的 `handleSave` 方法中，保存成功后调用 `updateRecentFiles` 更新菜单
2. 在 `src/renderer/components/SqlEditor.vue` 的 `handleSaveShortcut` 方法中，Ctrl+S 保存成功后调用 `updateRecentFiles` 更新菜单

**涉及的文件：**
- `src/renderer/components/Toolbar.vue` (第92-100行)
- `src/renderer/components/SqlEditor.vue` (第418-426行)

#### 2.1.2 不存在文件自动删除功能

**问题描述：**
点击"最新打开的文件"菜单项时，如果文件已删除，没有提示和清理机制

**实现方案：**
1. 在 `src/renderer/App.vue` 的 `onOpenRecent` 事件处理中，检测到文件打开失败
2. 使用 `ElMessage.warning` 弹出提示消息"文件不存在：xxx"
3. 调用 `window.api.file.removeRecentFile(filePath)` 从列表中移除该文件
4. 重新获取文件列表并更新菜单

**涉及的文件：**
- `src/renderer/App.vue` (第148-156行)
  - 导入 `ElMessage` (第58行)

---

## 3. 变更验证

### 3.1 功能测试

| 序号 | 测试项 | 测试步骤 | 预期结果 | 测试状态 |
|------|--------|----------|----------|----------|
| 1 | 菜单保存后刷新 | 打开文件 → 点击菜单"文件 → 保存" | 保存成功后，"最近打开的文件"菜单立即刷新 | ✅ |
| 2 | 工具栏保存后刷新 | 打开文件 → 点击工具栏保存按钮 | 保存成功后，"最近打开的文件"菜单立即刷新 | ✅ |
| 3 | 快捷键保存后刷新 | 打开文件 → 按 Ctrl+S | 保存成功后，"最近打开的文件"菜单立即刷新 | ✅ |
| 4 | 不存在文件提示 | 删除一个文件 → 在菜单中点击该文件 | 弹出警告"文件不存在：xxx"，菜单中该文件被移除 | ✅ |

---

## 4. 备注

- 本次变更是对 RC-012 原始需求的完善和修复
- 菜单图标功能已人工回滚，不在本次变更记录范围内
