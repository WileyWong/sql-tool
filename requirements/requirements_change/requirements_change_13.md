# 需求变更单

## 基本信息

| 项目 | 内容 |
|------|------|
| 变更编号 | RC-013 |
| 变更日期 | 2026-01-28 |
| 提出人 | |
| 优先级 | P1-高 |
| 影响范围 | 全栈 |

---

## 1. 变更概述

> 在 SQL 编辑器的表名 hover 提示中，改进字段显示方式并添加表管理入口

---

## 2. 变更背景

### 2.1 现状问题

> 描述当前系统存在的问题或不足

- **字段显示不完整**：当前表名 hover 只显示前 5 个字段，当表字段较多时，用户无法快速查看完整字段信息
- **无表管理快捷入口**：用户在编写 SQL 时 hover 到表名，想要查看表详细信息（建表语句、索引等），需要切换到左侧连接树右键"管理"菜单，操作繁琐
- **缺少滚动支持**：字段列表超出显示区域时没有滚动条，影响用户体验

### 2.2 变更原因

> 说明为什么需要进行这个变更

- 提升编写 SQL 时的开发效率，减少在编辑器和连接树之间切换的操作
- 支持快速查看表的完整字段信息，特别是在字段较多的场景
- 增强用户体验，与左侧连接树的功能形成互补

---

## 3. 变更内容

### 3.1 功能需求

> 详细描述需要实现的功能

| 序号 | 功能点 | 描述 | 验收标准 |
|------|--------|------|----------|
| 1 | 显示所有字段 | hover 表名时，显示该表的所有字段，不再限制为前 5 个 | hover 任意字段数量（如 20+）的表，都能看到完整字段列表 |
| 2 | 字段列表滚动条 | 当字段数量较多时，字段列表容器支持垂直滚动 | 字段列表最大高度 300px，超出时出现滚动条 |
| 3 | 表名可点击 | hover 浮层中的表名改为可点击状态 | 点击表名后，弹出表管理对话框 |
| 4 | 触发表管理弹框 | 在hover后的浮层中，表名为可点击样式，点击表名后，打开表管理对话框TableManageDialog.vue | |
| 5 | 字段信息增强 | 在字段列表中显示主键标识（🔑）和字段注释 | 主键字段显示 🔑 标识，有注释的字段显示注释内容 |
| 6 | 操作提示 | 在 hover表弹出的浮层中，鼠标放在表名上时，底部(StatusBar.vue)添加提示文字 :"💡 点击表名打开表管理" | |

### 3.2 非功能需求（可选）

> 性能、安全、兼容性等要求

- hover 响应时间 < 300ms
- 兼容 Monaco Editor 0.45.0+
- 字段列表滚动性能流畅（100+ 字段无明显卡顿）

---

## 4. 输入输出示例

> 提供具体的输入输出示例，帮助理解需求

### 示例 1：字段数量少的表（≤ 5 个字段）

**输入：**
```sql
SELECT * FROM |users|
```
（用户鼠标 hover 在 `users` 表名上）

**期望输出（hover 浮层）：**
```
表: users (可点击)
━━━━━━━━━━━━━━━━━━━━
说明: 用户信息表

字段数: 5

字段列表:
┌─────────────────────────────────────┐
│ - id 🔑: int NOT NULL // 主键ID      │
│ - name: varchar(100) NOT NULL // 姓名 │
│ - email: varchar(255) UNIQUE         │
│ - age: int // 年龄                    │
│ - created_at: datetime // 创建时间      │
└─────────────────────────────────────┘

```

### 示例 2：字段数量多的表（> 5 个字段）

**输入：**
```sql
SELECT * FROM |order_items|
```
（用户鼠标 hover 在 `order_items` 表名上）

**期望输出（hover 浮层）：**
```
表: order_items (可点击)
━━━━━━━━━━━━━━━━━━━━
说明: 订单明细表

字段数: 20

字段列表:
┌─────────────────────────────────────┐
│ - id 🔑: bigint NOT NULL // 订单ID    │
│ - order_id: bigint NOT NULL // 订单ID │
│ - product_id: int NOT NULL // 商品ID  │
│ - quantity: int NOT NULL // 数量      │
│ - unit_price: decimal(10,2) // 单价  │
│ - discount: decimal(10,2) // 折扣    │
│ - updated_at: datetime // 更新时间     │
│ - is_deleted: tinyint(1) // 是否删除  │
│ - 剩下的所有字段一一展示，这里就不一一列了  │
└─────────────────────────────────────┘
  ↑ 超过 300px 高度时显示滚动条

```

### 示例 3：点击表名行为

**操作：**
1. 用户 hover 在 SQL 中的表名上
2. 点击 hover 浮层中的表名（如 `users`）

**期望结果：**
- hover在表名上，底部状态栏（stattusbar.vue）显示"💡 点击表名打开表管理" 
- 弹出表管理对话框（TableManageDialog.vue）

---

## 5. 影响分析

### 5.1 向后兼容性

- ✅ 现有 hover 功能完全兼容
- ✅ 点击表名是增强功能，不影响原有流程
- ✅ 用户可以选择点击或忽略，无强制行为

---

## 6. 测试用例

> 用于验证变更是否正确实现

| 用例ID | 场景 | 输入 | 期望结果 |
|--------|------|------|----------|
| TC01 | 小字段表 hover | SQL 中字段数 ≤ 5 的表（如 users 表） | 显示所有字段，无滚动条 |
| TC02 | 大字段表 hover | SQL 中字段数 > 5 的表（如 order_items 表） | 显示所有字段，字段列表高度超过 300px 时出现滚动条 |
| TC03 | 表名点击 - 弹出管理框 | 点击 hover 浮层中的表名 | 弹出表管理对话框，标题正确显示 database.table |
| TC04 | 管理框内容验证 | 在管理框中切换页签 | 可以看到建表语句、列信息、索引信息 |
| TC05 | 主键标识显示 | hover 有主键的表 | 主键字段显示 🔑 标识 |
| TC06 | 字段注释显示 | hover 有注释字段的表 | 字段列表显示字段注释（如 `// 用户姓名`） |
| TC07 | 滚动条性能测试 | hover 有 100+ 字段的表 | 滚动流畅，无明显卡顿 |
| TC08 | 多表切换测试 | hover 不同数据库的表 | 每次点击都能正确弹出对应表的管理框 |
| TC09 | 别名表 hover | SQL 中使用表别名（如 `orders o`） | 显示表的原名，而非别名 |
| TC10 | 无数据库连接测试 | 没有hover功能 |  |


---

## 7. 备注

> 其他需要说明的事项

- **设计原则**：遵循项目现有的代码风格和架构模式
- **后续优化方向**：
  - 考虑在 hover 中添加表统计信息（如行数、大小）
  - 支持直接复制表名或字段名
  - 支持快捷键操作（如按 Enter 打开表管理）
- **用户体验**：
  - 表名可点击应有视觉提示（如 hover 时变色、下划线）
  - 确保点击区域足够大，避免误操作
