# 需求澄清文档

## 基本信息

| 项目 | 内容 |
|------|------|
| 变更编号 | RC-002 |
| 变更ID | 2026-01-09-file-operations |
| 需求来源 | requirements/requirements_change/requirements_change_2.md |
| 澄清日期 | 2026-01-09 |

---

## 执行策略

**推进方式**: 一次性全部确认（适合快速闭环）

---

## 澄清问题清单

### [NEEDS CLARIFICATION] 业务规则: 最近打开的文件存储

**当前描述**: 在菜单"文件"->"新建查询"下方增加"最近打开的文件"菜单，显示最新打开的10个文件全路径

**关联功能**: 功能1 - 最近打开的文件菜单

**需要澄清的问题**:
1. "最近打开的文件"记录何时添加？仅在打开文件时？还是保存文件时也算？
2. 如果文件被删除或移动，点击后如何处理？
3. 最近文件列表是否需要跨会话持久化？

**方案选项**（三选一）:

- **方案A: 仅打开时记录**
  - 只有通过"打开文件"操作才记录到最近列表
  - 优点: 逻辑简单，符合"最近打开"的字面意思
  - 缺点: 新建并保存的文件不会出现在列表中

- **方案B: 打开和保存都记录**
  - 打开文件、保存文件（包括另存为）都记录到最近列表
  - 优点: 用户新建的文件也能快速再次打开
  - 缺点: 需要更多的触发点

- **方案C: 打开、保存、另存为都记录**
  - 所有涉及文件路径的操作都记录
  - 优点: 最完整的记录
  - 缺点: 可能产生重复记录（同一文件多次保存）

**建议方案**: 方案B
- 理由: 用户新建查询并保存后，希望能快速再次打开，这是常见使用场景

**影响评估**: 如不澄清，可能导致用户新建的文件无法通过最近文件快速打开

---

### [NEEDS CLARIFICATION] 业务规则: 文件不存在处理

**当前描述**: 点击最近打开的文件后打开

**关联功能**: 功能1 - 最近打开的文件菜单

**需要澄清的问题**:
1. 如果文件已被删除或移动，点击后如何处理？

**方案选项**（三选一）:

- **方案A: 提示文件不存在，自动从列表移除**
  - 弹窗提示"文件不存在"，并从最近列表中移除该记录
  - 优点: 保持列表干净
  - 缺点: 用户可能想保留记录（文件可能会恢复）

- **方案B: 提示文件不存在，保留在列表中**
  - 弹窗提示"文件不存在"，但不移除记录
  - 优点: 用户可以知道曾经打开过这个文件
  - 缺点: 列表可能有无效项

- **方案C: 提示文件不存在，询问是否移除**
  - 弹窗提示并询问用户是否从列表移除
  - 优点: 用户可控
  - 缺点: 多一步操作

**建议方案**: 方案A
- 理由: 保持列表干净，无效记录没有意义

---

### [NEEDS CLARIFICATION] 业务规则: 打开文件时的编辑器选择

**当前描述**: 如果当前打开的编辑器是空的并且没有保存到磁盘，直接在当前编辑器中打开，否则新建一个编辑窗口打开

**关联功能**: 功能2 - 打开文件功能优化

**需要澄清的问题**:
1. "空的"如何定义？是内容为空字符串，还是内容未被修改（isDirty=false）？
2. 如果当前编辑器有内容但未保存（isDirty=true），是否算"空的"？

**方案选项**（三选一）:

- **方案A: 内容为空 + 未保存到磁盘**
  - 条件: `content === '' && !filePath`
  - 优点: 严格定义，只有真正空白的新建编辑器才复用
  - 缺点: 用户可能输入了一些内容但不想保留

- **方案B: 未修改 + 未保存到磁盘**
  - 条件: `!isDirty && !filePath`
  - 优点: 即使有默认内容，只要未修改就复用
  - 缺点: 可能丢失默认内容

- **方案C: 内容为空或仅空白字符 + 未保存到磁盘**
  - 条件: `content.trim() === '' && !filePath`
  - 优点: 忽略空白字符
  - 缺点: 可能丢失用户有意输入的空格/换行

**建议方案**: 方案A
- 理由: 最严格的定义，避免误覆盖用户内容

---

### [NEEDS CLARIFICATION] 业务规则: 未保存提醒的触发时机

**当前描述**: 关闭编辑器或者程序的时候，如果存在文件有修改但是没有保存的编辑，提示用户是否保存

**关联功能**: 功能3 - 未保存提醒功能

**需要澄清的问题**:
1. 如果有多个编辑器有未保存内容，关闭程序时是逐个提示还是一次性列出？

**方案选项**（两选一）:

- **方案A: 逐个提示**
  - 依次弹窗询问每个未保存的编辑器
  - 优点: 用户可以逐个决定
  - 缺点: 多个文件时操作繁琐

- **方案B: 一次性列出所有未保存文件**
  - 弹窗显示所有未保存文件列表，用户可选择"全部保存"/"全部不保存"/"取消"
  - 优点: 操作高效
  - 缺点: 实现稍复杂

**建议方案**: 方案A
- 理由: 初期实现简单，与单个编辑器关闭逻辑一致

---

### [NEEDS CLARIFICATION] 业务规则: 未保存提醒的对话框选项

**当前描述**: 用户选择保存/不保存/取消

**关联功能**: 功能3 - 未保存提醒功能

**需要澄清的问题**:
1. 如果文件从未保存过（无 filePath），点击"保存"时是否需要弹出"另存为"对话框？

**方案选项**（两选一）:

- **方案A: 是，弹出另存为对话框**
  - 如果文件无路径，点击"保存"后弹出另存为对话框让用户选择保存位置
  - 优点: 符合用户预期
  - 缺点: 多一步操作

- **方案B: 否，直接丢弃**
  - 如果文件无路径，"保存"按钮不可用或等同于"不保存"
  - 优点: 简单
  - 缺点: 用户可能误操作丢失内容

**建议方案**: 方案A
- 理由: 符合用户预期，避免数据丢失

---

## 待用户确认

请确认以上澄清问题的方案选择：

| 问题 | 建议方案 | 您的选择 |
|------|----------|----------|
| 最近打开的文件存储时机 | 方案B（打开和保存都记录） | ✅ 确认 |
| 文件不存在处理 | 方案A（提示并移除） | ✅ 确认 |
| 编辑器"空的"定义 | 方案A（内容为空+未保存到磁盘） | ✅ 确认 |
| 多文件未保存提醒方式 | 方案A（逐个提示） | ✅ 确认 |
| 无路径文件的保存处理 | 方案A（弹出另存为对话框） | ✅ 确认 |

**状态**: ✅ 已确认 (2026-01-09)
