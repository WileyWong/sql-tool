---
change_id: RC-013
stage: requirements
document_type: requirements_specification
status: final
---

# RC-013 需求规格说明书 - 表名 Hover 功能增强

## 1. 概述

### 1.1 需求来源
- 变更单: `requirements/requirements_change/requirements_change_13.md`
- 变更编号: RC-013
- 优先级: P1-高
- 影响范围: 全栈

### 1.2 变更范围
- 后端: SQL Language Server - hoverProvider.ts
- 前端: Monaco Editor hover 交互、StatusBar.vue、connection store

## 2. 业务目标

### 2.1 背景问题
1. **字段显示不完整**: 当前表名 hover 只显示前 5 个字段，无法查看完整字段信息
2. **无表管理快捷入口**: 用户需要切换到连接树右键"管理"菜单，操作繁琐
3. **缺少滚动支持**: 字段列表超出显示区域时没有滚动条

### 2.2 业务价值
- 提升编写 SQL 时的开发效率
- 减少在编辑器和连接树之间切换的操作
- 增强用户体验，与左侧连接树功能形成互补

### 2.3 成功指标
- hover 响应时间 < 300ms
- 100+ 字段滚动流畅无卡顿
- 用户可直接从 hover 浮层进入表管理

## 3. 功能性需求（FR）

### FR-001: 显示所有字段

**功能描述**: hover 表名时显示该表的所有字段，不再限制为前 5 个

**用户场景**: 用户在 SQL 编辑器中 hover 表名，查看表的完整字段列表

**输入/输出**: 
- 输入: 鼠标 hover 到 SQL 中的表名
- 输出: 显示表的所有字段信息

**业务规则**:
- 字段按数据库中的顺序显示
- 无字段数量限制

**验收标准**:
- [x] 正常场景: hover 5 个字段的表，显示全部 5 个字段
- [x] 边界条件: hover 100+ 字段的表，显示全部字段
- [x] 异常情况: 表无字段时显示"无字段"提示

---

### FR-002: 字段列表滚动条

**功能描述**: 当字段数量较多时，字段列表容器支持垂直滚动

**用户场景**: 用户 hover 字段较多的表，通过滚动查看完整字段列表

**业务规则**:
- 字段列表最大高度 300px
- 超出高度时显示垂直滚动条
- 滚动条样式与暗色主题匹配

**验收标准**:
- [x] 正常场景: 字段数 ≤ 显示区域时无滚动条
- [x] 边界条件: 字段数刚好超出时显示滚动条
- [x] 性能测试: 100+ 字段滚动流畅

---

### FR-003: 表名可点击

**功能描述**: hover 浮层中的表名改为可点击状态，有视觉提示

**用户场景**: 用户 hover 表名后，点击表名进入表管理

**业务规则**:
- 表名显示为可点击样式（下划线、hover 变色）
- 点击区域足够大，避免误操作

**验收标准**:
- [x] 正常场景: 鼠标移到表名上有 hover 效果
- [x] 交互测试: 点击表名触发相应事件

---

### FR-004: 触发表管理弹框

**功能描述**: 点击 hover 浮层中的表名后，打开表管理对话框

**用户场景**: 用户点击表名，查看表的建表语句、列信息、索引信息

**输入/输出**:
- 输入: 点击表名
- 输出: 弹出 TableManageDialog.vue，标题显示 database.table

**业务规则**:
- 需要传递 connectionId、database、table 信息
- 复用现有 TableManageDialog.vue 组件

**验收标准**:
- [x] 正常场景: 点击表名弹出管理框，标题正确
- [x] 内容验证: 可以看到建表语句、列信息、索引信息
- [x] 多表测试: hover 不同数据库的表，点击都能正确弹出

---

### FR-005: 字段信息增强

**功能描述**: 在字段列表中显示主键标识（🔑）和字段注释

**用户场景**: 用户快速识别主键字段和理解字段含义

**业务规则**:
- 主键字段在字段名后显示 🔑 标识
- 有注释的字段显示注释内容（格式: `// 注释`）

**验收标准**:
- [x] 主键标识: 主键字段显示 🔑
- [x] 注释显示: 有注释字段显示 `// 注释内容`
- [x] 无注释: 无注释字段不显示注释部分

---

### FR-006: 操作提示

**功能描述**: 鼠标 hover 到表名浮层时，底部状态栏显示操作提示

**用户场景**: 引导用户发现表名可点击功能

**业务规则**:
- 状态栏显示: "💡 点击表名打开表管理"
- 离开 hover 状态后恢复原状态栏内容

**验收标准**:
- [x] 提示显示: hover 表名时状态栏显示提示
- [x] 提示消失: 离开 hover 状态时提示消失

## 4. 非功能性需求（NFR）

### NFR-001: 性能要求
- hover 响应时间 < 300ms
- 100+ 字段滚动无明显卡顿

### NFR-002: 兼容性要求
- 兼容 Monaco Editor 0.45.0+
- 支持项目现有的深色主题

### NFR-003: 用户体验
- 表名可点击应有明显视觉提示
- 点击区域足够大，避免误操作

## 5. 验收标准总览

| 用例ID | 场景 | 期望结果 |
|--------|------|----------|
| TC01 | 小字段表 hover | 显示所有字段，无滚动条 |
| TC02 | 大字段表 hover | 显示所有字段，超过 300px 出现滚动条 |
| TC03 | 表名点击 | 弹出表管理对话框 |
| TC04 | 管理框内容 | 可看到建表语句、列信息、索引信息 |
| TC05 | 主键标识 | 主键字段显示 🔑 |
| TC06 | 字段注释 | 有注释字段显示注释 |
| TC07 | 滚动性能 | 100+ 字段滚动流畅 |
| TC08 | 多表切换 | 每次点击正确弹出对应表管理框 |
| TC09 | 别名表 hover | 显示原表名 |
| TC10 | 状态栏提示 | hover 时显示操作提示 |

## 6. 附录

### 6.1 相关文件
- `src/main/sql-language-server/providers/hoverProvider.ts`
- `src/renderer/components/TableManageDialog.vue`
- `src/renderer/components/StatusBar.vue`
- `src/renderer/composables/useLanguageServer.ts`
- `src/renderer/stores/connection.ts`

### 6.2 UI 示例

**字段少的表 hover 效果:**
```
表: users (可点击)
━━━━━━━━━━━━━━━━━━━━
说明: 用户信息表

字段数: 5

字段列表:
- id 🔑: int NOT NULL // 主键ID
- name: varchar(100) NOT NULL // 姓名
- email: varchar(255) UNIQUE
- age: int // 年龄
- created_at: datetime // 创建时间
```

**字段多的表 hover 效果:**
```
表: order_items (可点击)
━━━━━━━━━━━━━━━━━━━━
说明: 订单明细表

字段数: 20

字段列表:
┌─────────────────────────────────────┐
│ - id 🔑: bigint NOT NULL // 订单ID  │
│ - order_id: bigint NOT NULL        │
│ ...（滚动查看更多）                   │
└─────────────────────────────────────┘
  ↑ 超过 300px 高度时显示滚动条
```
