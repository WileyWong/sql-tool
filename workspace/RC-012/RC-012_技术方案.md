# RC-012 Electron原生菜单替换 - 技术方案

## 1. 确认事项

| 项目 | 确认结果 |
|------|----------|
| 编辑菜单查找/替换 | 移除 |
| 最近文件数量限制 | 最多10个 |
| 关于对话框内容 | 应用名称、版本号 |
| macOS兼容性 | 需要考虑 |

## 2. 架构设计

### 2.1 模块职责

| 模块 | 职责 |
|------|------|
| `src/main/menu.ts` | 创建和管理Electron原生菜单 |
| `src/main/index.ts` | 初始化菜单，设置窗口引用 |
| `src/preload/index.ts` | 暴露菜单事件监听API |
| `src/renderer/App.vue` | 监听菜单事件，调用store处理 |

## 3. 详细设计

### 3.1 IPC通道定义

```typescript
MENU_NEW_CONNECTION = 'menu:new-connection',
MENU_NEW_QUERY = 'menu:new-query',
MENU_OPEN_FILE = 'menu:open-file',
MENU_OPEN_RECENT = 'menu:open-recent',
MENU_SAVE = 'menu:save',
MENU_SAVE_AS = 'menu:save-as',
MENU_ABOUT = 'menu:about',
MENU_UPDATE_RECENT_FILES = 'menu:update-recent-files'
```

### 3.2 macOS平台适配

- macOS需要添加应用程序菜单（第一个菜单项）
- 使用 `process.platform === 'darwin'` 判断平台
- macOS退出使用 `role: 'quit'`

### 3.3 最近文件限制

最多显示10个最近文件，超出部分不显示。

## 4. 文件变更清单

| 操作 | 文件路径 |
|------|----------|
| 新增 | `src/main/menu.ts` |
| 修改 | `src/shared/constants/index.ts` |
| 修改 | `src/main/index.ts` |
| 修改 | `src/preload/index.ts` |
| 修改 | `src/renderer/App.vue` |
| 删除 | `src/renderer/components/MenuBar.vue` |

## 5. 实现步骤

1. 添加IPC通道常量
2. 创建菜单模块 `src/main/menu.ts`
3. 修改主进程入口，初始化菜单
4. 更新preload暴露菜单API
5. 修改App.vue，监听菜单事件
6. 删除MenuBar.vue
