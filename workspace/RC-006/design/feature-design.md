---
change_id: RC-006
change_title: SQL工具用户体验优化功能设计
document_type: feature-design
stage: design
created_at: 2026-01-13T12:00:00Z
author: AI Assistant
version: 1.0
---

# 功能详细设计文档

## 1. 功能分解

### 1.1 主要功能模块

#### 模块1: 结果管理模块（Result Management）
**优先级**: P0
**子功能**:
- 1.1.1 单一结果页签管理（P0）
- 1.1.2 查询结果覆盖机制（P0）
- 1.1.3 数据修改确认对话框（P0）

#### 模块2: 连接管理模块（Connection Management）
**优先级**: P1
**子功能**:
- 2.1.1 连接状态检测（P1）
- 2.1.2 自动重连机制（P1）
- 2.1.3 连接异常处理（P1）

#### 模块3: 界面交互模块（UI Interaction）
**优先级**: P1
**子功能**:
- 3.1.1 服务器选择器过滤（P1）
- 3.1.2 数据库选择器过滤（P1）
- 3.2.1 树节点悬停过滤按钮（P1）
- 3.2.2 树节点过滤状态管理（P1）

#### 模块4: 数据处理模块（Data Processing）
**优先级**: P0
**子功能**:
- 4.1.1 JSON字段显示优化（P0）
- 4.1.2 JSON字段编辑功能（P0）
- 4.2.1 元数据刷新触发（P1）
- 4.2.2 智能提示同步更新（P1）

## 2. 用例设计

### 2.1 功能1.1.1: 单一结果页签管理

#### UC-001: 正常查询结果显示
**类型**: 正常用例
**优先级**: P0

**参与者**: 用户
**前置条件**: 
- 用户已打开SQL编辑器
- 编辑器已连接到数据库

**主流程**:
1. 用户在编辑器中输入SQL查询语句
2. 用户点击执行按钮
3. 系统执行SQL查询
4. 系统在"结果"页签中显示查询结果
5. 用户查看查询结果

**后置条件**: 
- 显示一个名为"结果"的页签
- 页签中包含查询结果数据

#### UC-002: 连续查询结果覆盖
**类型**: 正常用例
**优先级**: P0

**参与者**: 用户
**前置条件**: 
- 用户已执行过一次查询，存在"结果"页签
- 结果页签中有数据显示

**主流程**:
1. 用户输入新的SQL查询语句
2. 用户点击执行按钮
3. 系统检查当前结果是否有未保存修改
4. 如无修改，系统直接覆盖"结果"页签内容
5. 系统显示新的查询结果

**后置条件**: 
- 仍然只有一个"结果"页签
- 页签内容为最新查询结果

#### UC-003: 有未保存修改时的查询
**类型**: 异常用例
**优先级**: P0

**参与者**: 用户
**前置条件**: 
- 用户已执行过查询，存在"结果"页签
- 用户在结果中修改了数据但未保存

**主流程**:
1. 用户输入新的SQL查询语句
2. 用户点击执行按钮
3. 系统检测到未保存的修改
4. 系统弹出确认对话框，包含三个选项：提交、放弃、取消
5. 用户选择其中一个选项
6. 系统根据用户选择执行相应操作

**后置条件**: 
- 根据用户选择决定是否执行新查询

#### UC-004: 空查询语句执行
**类型**: 边界用例
**优先级**: P1

**参与者**: 用户
**前置条件**: 
- 用户已打开SQL编辑器
- 编辑器内容为空或只有空白字符

**主流程**:
1. 用户点击执行按钮
2. 系统检测到查询语句为空
3. 系统显示提示信息："请输入SQL语句"
4. 不执行任何查询操作

**后置条件**: 
- 不创建或修改结果页签
- 显示友好的提示信息

#### UC-005: 查询语法错误
**类型**: 异常用例
**优先级**: P0

**参与者**: 用户
**前置条件**: 
- 用户已输入SQL语句
- SQL语句存在语法错误

**主流程**:
1. 用户点击执行按钮
2. 系统执行SQL查询
3. 数据库返回语法错误
4. 系统在消息面板显示错误信息
5. 不创建或修改结果页签

**后置条件**: 
- 错误信息显示在消息面板
- 结果页签保持原状

### 2.2 功能2.1.2: 自动重连机制

#### UC-006: 连接断开后自动重连
**类型**: 正常用例
**优先级**: P1

**参与者**: 用户
**前置条件**: 
- 用户已连接到数据库
- 连接因超时或网络问题断开

**主流程**:
1. 用户执行SQL查询
2. 系统检测到连接已断开
3. 系统自动尝试重新连接
4. 重连成功后执行原SQL查询
5. 返回查询结果

**后置条件**: 
- 连接已恢复
- 查询正常执行

#### UC-007: 重连失败处理
**类型**: 异常用例
**优先级**: P1

**参与者**: 用户
**前置条件**: 
- 连接已断开
- 数据库服务不可用或网络异常

**主流程**:
1. 用户执行SQL查询
2. 系统检测到连接已断开
3. 系统尝试重新连接
4. 重连失败（服务器不可达、认证失败等）
5. 系统显示具体的错误信息

**后置条件**: 
- 显示明确的错误原因
- 连接状态保持断开

#### UC-008: 长时间空闲后执行查询
**类型**: 边界用例
**优先级**: P1

**参与者**: 用户
**前置条件**: 
- 用户已连接数据库
- 超过30分钟未进行任何操作

**主流程**:
1. 用户输入SQL查询语句
2. 用户点击执行按钮
3. 系统检测连接状态（可能已超时）
4. 系统自动重连（如需要）
5. 执行查询并返回结果

**后置条件**: 
- 查询正常执行
- 用户无感知连接恢复过程

### 2.3 功能3.1.1: 服务器选择器过滤

#### UC-009: 输入过滤服务器列表
**类型**: 正常用例
**优先级**: P1

**参与者**: 用户
**前置条件**: 
- 用户已配置多个数据库连接
- 服务器下拉选择框已展开

**主流程**:
1. 用户在服务器选择框中输入关键字（如"test"）
2. 系统实时过滤匹配的服务器连接
3. 下拉列表只显示包含关键字的连接
4. 用户从过滤后的列表中选择目标连接
5. 选择框显示选中的连接名称

**后置条件**: 
- 编辑器切换到选中的服务器连接
- 过滤状态清除，输入框显示连接名称

#### UC-010: 无匹配结果的过滤
**类型**: 边界用例
**优先级**: P2

**参与者**: 用户
**前置条件**: 
- 用户已配置多个数据库连接
- 用户输入了不存在的关键字

**主流程**:
1. 用户在选择框中输入不存在的关键字
2. 系统过滤后无匹配结果
3. 下拉列表显示"无匹配结果"提示
4. 用户清空输入或修改关键字

**后置条件**: 
- 显示友好的无结果提示
- 用户可以重新输入

#### UC-011: 清空过滤条件
**类型**: 正常用例
**优先级**: P2

**参与者**: 用户
**前置条件**: 
- 用户已输入过滤关键字
- 下拉列表显示过滤结果

**主流程**:
1. 用户清空输入框内容
2. 系统检测到输入为空
3. 系统恢复显示完整的连接列表
4. 用户可以查看所有可用连接

**后置条件**: 
- 显示完整的连接列表
- 过滤状态重置

### 2.4 功能3.2.1: 树节点悬停过滤按钮

#### UC-012: 悬停显示过滤按钮
**类型**: 正常用例
**优先级**: P1

**参与者**: 用户
**前置条件**: 
- 用户已连接到数据库
- 左侧树组件显示数据库结构

**主流程**:
1. 用户将鼠标悬停在数据库节点上
2. 系统在节点右侧显示"过滤"文字按钮
3. 用户移开鼠标，按钮消失
4. 用户再次悬停，按钮重新出现

**后置条件**: 
- 过滤按钮仅在悬停时显示
- 不影响树组件的正常显示

#### UC-013: 点击过滤按钮进入过滤模式
**类型**: 正常用例
**优先级**: P1

**参与者**: 用户
**前置条件**: 
- 用户已悬停在数据库节点上
- "过滤"按钮已显示

**主流程**:
1. 用户点击"过滤"按钮
2. 按钮位置变为单行文本输入框
3. 输入框自动获得焦点
4. 用户可以直接输入过滤关键字

**后置条件**: 
- 进入过滤模式
- 输入框获得焦点，用户可以输入

#### UC-014: 执行过滤操作
**类型**: 正常用例
**优先级**: P1

**参与者**: 用户
**前置条件**: 
- 用户已进入过滤模式
- 输入框已获得焦点

**主流程**:
1. 用户在输入框中输入过滤关键字
2. 用户按回车键执行过滤
3. 系统过滤该数据库节点下的所有子节点
4. 只显示名称包含关键字的表、视图、函数等
5. 输入框变回"过滤"按钮，显示当前过滤文本

**后置条件**: 
- 子节点按过滤条件显示
- 过滤状态保持，直到用户清除或切换节点

#### UC-015: 取消过滤操作
**类型**: 正常用例
**优先级**: P2

**参与者**: 用户
**前置条件**: 
- 用户已进入过滤模式
- 输入框已获得焦点

**主流程**:
1. 用户按ESC键
2. 系统退出过滤模式
3. 输入框变回"过滤"按钮
4. 保持原有的显示状态

**后置条件**: 
- 退出过滤模式
- 不改变当前的过滤状态

### 2.5 功能4.1.1: JSON字段显示优化

#### UC-016: 正常显示JSON字段内容
**类型**: 正常用例
**优先级**: P0

**参与者**: 用户
**前置条件**: 
- 用户已执行包含JSON字段的查询
- 查询结果包含JSON数据

**主流程**:
1. 系统执行查询并获得结果
2. 系统检测到JSON类型字段
3. 系统将JSON对象序列化为可读字符串
4. 在结果表格中显示JSON字符串内容
5. 用户可以查看完整的JSON内容

**后置条件**: 
- JSON字段显示为可读的字符串格式
- 不再显示"[object Object]"

#### UC-017: 编辑JSON字段内容
**类型**: 正常用例
**优先级**: P0

**参与者**: 用户
**前置条件**: 
- 查询结果中包含JSON字段
- JSON字段已正确显示为字符串

**主流程**:
1. 用户双击JSON字段单元格
2. 单元格进入编辑模式，显示文本输入框
3. 输入框中显示当前JSON字符串内容
4. 用户修改JSON内容
5. 用户按回车或点击其他地方保存修改

**后置条件**: 
- JSON字段内容已更新
- 编辑体验与字符串字段一致

#### UC-018: JSON格式错误处理
**类型**: 异常用例
**优先级**: P1

**参与者**: 用户
**前置条件**: 
- 用户正在编辑JSON字段
- 用户输入了无效的JSON格式

**主流程**:
1. 用户修改JSON字段为无效格式
2. 用户尝试保存修改（提交到数据库）
3. 数据库返回JSON格式错误
4. 系统显示数据库返回的错误信息
5. 用户可以重新编辑或取消修改

**后置条件**: 
- 显示具体的数据库错误信息
- 用户可以继续编辑或取消

#### UC-019: 复杂嵌套JSON编辑
**类型**: 边界用例
**优先级**: P1

**参与者**: 用户
**前置条件**: 
- JSON字段包含复杂的嵌套结构
- 包含数组、对象等多层嵌套

**主流程**:
1. 用户双击复杂JSON字段
2. 系统显示完整的JSON字符串
3. 用户可以编辑任意部分的内容
4. 系统保持JSON字符串的完整性
5. 用户保存修改

**后置条件**: 
- 复杂JSON结构正确处理
- 编辑功能正常工作

## 3. 输入输出定义

### 3.1 功能1.1: 结果页签管理

#### 输入定义
| 字段名 | 类型 | 必填 | 长度限制 | 验证规则 | 示例 |
|--------|------|------|----------|----------|------|
| sqlQuery | string | 是 | 1-10000 | 非空字符串 | "SELECT * FROM users" |
| editorTabId | string | 是 | 1-50 | UUID格式 | "editor-tab-123" |
| hasUnsavedChanges | boolean | 是 | - | true/false | true |

#### 成功输出
| 字段名 | 类型 | 说明 | 示例 |
|--------|------|------|------|
| resultTab | object | 结果页签信息 | {...} |
| resultTab.id | string | 页签ID | "result" |
| resultTab.title | string | 页签标题 | "结果" |
| resultTab.type | string | 页签类型 | "resultset" |
| resultTab.data | object | 查询结果数据 | {...} |

#### 失败输出
| 错误码 | 错误信息 | 说明 |
|--------|----------|------|
| 4001 | SQL语句不能为空 | 输入的SQL为空或只有空白字符 |
| 4002 | SQL语法错误 | 数据库返回的语法错误 |
| 5001 | 数据库连接失败 | 无法连接到数据库 |
| 5002 | 查询执行超时 | 查询执行时间超过限制 |

### 3.2 功能2.1: 连接管理

#### 输入定义
| 字段名 | 类型 | 必填 | 验证规则 | 示例 |
|--------|------|------|----------|------|
| connectionId | string | 是 | UUID格式 | "conn-123" |
| connectionConfig | object | 是 | 完整连接配置 | {...} |
| retryAttempts | number | 否 | 0-3 | 2 |

#### 成功输出
| 字段名 | 类型 | 说明 | 示例 |
|--------|------|------|------|
| connectionStatus | string | 连接状态 | "connected" |
| serverVersion | string | 服务器版本 | "8.0.25" |
| reconnected | boolean | 是否重新连接 | true |

#### 失败输出
| 错误码 | 错误信息 | 说明 |
|--------|----------|------|
| 4003 | 连接配置无效 | 连接参数不正确 |
| 5003 | 服务器不可达 | 无法连接到数据库服务器 |
| 5004 | 认证失败 | 用户名或密码错误 |
| 5005 | 数据库不存在 | 指定的数据库不存在 |

### 3.3 功能3.1: 选择器过滤

#### 输入定义
| 字段名 | 类型 | 必填 | 长度限制 | 验证规则 | 示例 |
|--------|------|------|----------|----------|------|
| filterText | string | 否 | 0-100 | 任意字符 | "test" |
| connectionList | array | 是 | 1-1000 | 连接对象数组 | [...] |

#### 成功输出
| 字段名 | 类型 | 说明 | 示例 |
|--------|------|------|------|
| filteredConnections | array | 过滤后的连接列表 | [...] |
| matchCount | number | 匹配的连接数量 | 3 |

### 3.4 功能4.1: JSON字段处理

#### 输入定义
| 字段名 | 类型 | 必填 | 验证规则 | 示例 |
|--------|------|------|----------|------|
| jsonValue | any | 是 | JSON对象或字符串 | {"name": "test"} |
| editedValue | string | 否 | 有效JSON字符串 | '{"name": "updated"}' |

#### 成功输出
| 字段名 | 类型 | 说明 | 示例 |
|--------|------|------|------|
| displayValue | string | 显示用的字符串 | '{"name": "test"}' |
| isValidJson | boolean | 是否为有效JSON | true |

#### 失败输出
| 错误码 | 错误信息 | 说明 |
|--------|----------|------|
| 4004 | JSON格式无效 | 输入的JSON格式不正确 |
| 5006 | 数据更新失败 | 数据库更新操作失败 |

## 4. 边界条件处理

### 4.1 数据边界

#### 字符串长度边界
- **SQL查询语句**: 最小1字符，最大10000字符，超长时提示并截断
- **过滤关键字**: 最小0字符（清空），最大100字符，超长时自动截断
- **JSON字符串**: 最大1MB，超大时提示用户
- **连接名称**: 最小1字符，最大50字符

#### 数值边界
- **查询结果行数**: 最大10000行，超过时分页显示
- **重连尝试次数**: 最大3次，超过后停止重试
- **过滤结果数量**: 最大1000个，超过时提示优化关键字

#### 特殊字符处理
- **SQL注入防护**: 使用参数化查询，转义特殊字符
- **HTML转义**: 显示内容进行HTML转义，防止XSS
- **JSON转义**: 正确处理JSON中的引号、换行等特殊字符

### 4.2 并发边界

#### 重复操作防护
- **重复查询**: 防抖处理，500ms内重复点击只执行一次
- **重复连接**: 连接建立中时，忽略新的连接请求
- **重复过滤**: 防抖处理，300ms内连续输入只执行最后一次

#### 状态竞态处理
- **连接状态**: 使用状态锁，防止同时建立多个连接
- **结果页签**: 使用版本号，防止过期结果覆盖新结果
- **过滤状态**: 按节点独立管理，避免状态混乱

### 4.3 性能边界

#### 响应时间要求
- **过滤操作**: < 200ms，超时时显示加载状态
- **连接检测**: < 1000ms，超时时进行重连
- **结果显示**: < 500ms，大结果集时分批渲染

#### 内存使用限制
- **查询结果缓存**: 最多缓存5个结果集，超过时清理最旧的
- **连接池**: 最多保持10个活跃连接，超过时关闭最久未使用的
- **过滤缓存**: 每个节点最多缓存100个过滤结果

#### 大数据量处理
- **虚拟滚动**: 结果表格使用虚拟滚动，只渲染可见行
- **分页加载**: 超过1000行时自动分页
- **懒加载**: 树节点按需加载，不一次性加载所有数据

### 4.4 状态边界

#### 连接状态边界
- **连接建立中**: 禁用查询操作，显示连接状态
- **连接断开**: 自动重连，重连期间缓存用户操作
- **连接超时**: 30分钟无操作后标记为可能超时

#### 编辑状态边界
- **编辑中**: 防止意外关闭，提示用户保存
- **保存中**: 禁用编辑操作，显示保存状态
- **冲突检测**: 检测数据是否被其他用户修改

## 5. 错误处理设计

### 5.1 错误分类和错误码

#### 客户端错误 (4xxx)
| 错误码 | 错误信息 | 触发条件 | 用户操作建议 |
|--------|----------|----------|--------------|
| 4001 | SQL语句不能为空 | 执行空查询 | 请输入SQL语句后重试 |
| 4002 | SQL语法错误：{具体错误} | 语法不正确 | 请检查SQL语法后重试 |
| 4003 | 连接配置无效 | 连接参数错误 | 请检查连接配置 |
| 4004 | JSON格式无效：{具体错误} | JSON格式错误 | 请检查JSON格式 |
| 4005 | 过滤关键字过长 | 超过100字符 | 请缩短关键字长度 |
| 4006 | 查询结果过大 | 超过行数限制 | 请添加LIMIT限制结果数量 |

#### 服务器错误 (5xxx)
| 错误码 | 错误信息 | 触发条件 | 系统处理 |
|--------|----------|----------|----------|
| 5001 | 数据库连接失败 | 连接建立失败 | 自动重试3次 |
| 5002 | 查询执行超时 | 查询时间过长 | 取消查询，提示优化 |
| 5003 | 服务器不可达 | 网络异常 | 自动重连 |
| 5004 | 认证失败 | 用户名密码错误 | 提示重新输入 |
| 5005 | 数据库不存在 | 数据库被删除 | 提示选择其他数据库 |
| 5006 | 数据更新失败 | 更新操作失败 | 显示具体错误原因 |

### 5.2 错误信息设计原则

#### 用户友好性
- **避免技术术语**: 不显示"NullPointerException"等技术错误
- **提供解决方案**: 每个错误都包含用户可执行的建议
- **上下文相关**: 错误信息与用户当前操作相关

#### 安全性
- **不泄露敏感信息**: 不显示数据库内部结构、密码等
- **统一认证错误**: 用户名和密码错误使用相同提示
- **限制错误详情**: 生产环境不显示详细的堆栈信息

#### 一致性
- **统一格式**: 所有错误信息使用相同的格式
- **统一术语**: 相同概念使用相同的词汇
- **统一交互**: 错误处理的用户交互保持一致

### 5.3 重试机制

#### 自动重试场景
| 场景 | 重试次数 | 重试间隔 | 退避策略 |
|------|----------|----------|----------|
| 网络超时 | 3次 | 1s, 2s, 4s | 指数退避 |
| 连接断开 | 3次 | 1s, 2s, 4s | 指数退避 |
| 临时锁定 | 2次 | 5s, 10s | 线性退避 |

#### 手动重试场景
- **查询失败**: 提供"重试"按钮
- **连接失败**: 提供"重新连接"按钮
- **保存失败**: 提供"重新保存"按钮

#### 不重试场景
- **语法错误**: 直接返回错误，不重试
- **权限错误**: 直接返回错误，不重试
- **业务逻辑错误**: 直接返回错误，不重试

### 5.4 降级方案

#### 功能降级
| 功能 | 降级条件 | 降级方案 | 用户体验 |
|------|----------|----------|----------|
| 智能提示 | 元数据获取失败 | 使用缓存数据 | 提示数据可能过期 |
| 过滤功能 | 数据量过大 | 禁用实时过滤 | 提示手动刷新 |
| 自动重连 | 重连多次失败 | 手动连接模式 | 显示连接状态 |

#### 性能降级
| 场景 | 触发条件 | 降级策略 | 恢复条件 |
|------|----------|----------|----------|
| 大结果集 | >1000行 | 分页显示 | 用户主动加载 |
| 高并发 | >100 QPS | 请求排队 | 并发降低 |
| 内存不足 | >80%使用率 | 清理缓存 | 内存释放 |

#### 数据降级
- **连接失败**: 显示最后成功的数据库结构
- **查询失败**: 显示历史查询结果
- **元数据失败**: 使用本地缓存的元数据

## 6. 功能间交互设计

### 6.1 功能依赖关系

#### 依赖图
```
连接管理模块 (2.1)
    ↓ 提供连接状态
结果管理模块 (1.1) ← 依赖连接状态
    ↓ 提供结果数据
数据处理模块 (4.1) ← 依赖结果数据

界面交互模块 (3.1) → 独立功能，无强依赖
    ↓ 触发刷新事件
数据处理模块 (4.2) ← 依赖刷新事件
```

#### 强依赖关系
- **结果管理 → 连接管理**: 必须有有效连接才能执行查询
- **JSON编辑 → 结果管理**: 必须有查询结果才能编辑JSON
- **元数据同步 → 连接管理**: 必须有有效连接才能获取元数据

#### 弱依赖关系
- **过滤功能 → 数据加载**: 可以独立工作，但需要数据才有意义
- **自动重连 → 查询执行**: 可以独立检测，但通常在查询时触发

### 6.2 交互流程设计

#### 流程1: 查询执行完整流程
```
1. 用户输入SQL → 结果管理模块
2. 检查连接状态 → 连接管理模块
3. 如连接断开 → 自动重连 → 连接管理模块
4. 执行查询 → 数据库
5. 处理结果 → 结果管理模块
6. 如有JSON字段 → JSON处理 → 数据处理模块
7. 显示结果 → 用户界面
```

#### 流程2: 树节点刷新流程
```
1. 用户右键刷新 → 界面交互模块
2. 触发刷新事件 → 事件总线
3. 获取最新元数据 → 连接管理模块
4. 更新语言服务器 → 数据处理模块
5. 通知所有编辑器 → 广播机制
6. 更新智能提示 → 编辑器组件
```

#### 流程3: 过滤操作流程
```
1. 用户输入过滤条件 → 界面交互模块
2. 防抖处理 → 延迟300ms
3. 执行过滤逻辑 → 本地处理
4. 更新显示状态 → 用户界面
5. 保存过滤状态 → 状态管理
```

### 6.3 数据传递方式

#### 同步调用
- **查询执行**: HTTP请求到主进程，等待结果返回
- **连接测试**: 同步检测连接状态
- **数据验证**: 同步验证用户输入

#### 异步调用
- **元数据刷新**: 异步获取最新数据库结构
- **自动重连**: 后台异步重连，不阻塞用户操作
- **大数据查询**: 异步执行，支持取消操作

#### 事件驱动
- **连接状态变化**: 广播连接状态事件
- **数据修改**: 发送数据变更事件
- **错误发生**: 发送错误事件到错误处理中心

### 6.4 数据一致性要求

#### 强一致性场景
- **查询结果显示**: 必须与数据库实际数据一致
- **连接状态**: 必须反映真实的连接状态
- **数据修改**: 提交的修改必须立即生效

#### 最终一致性场景
- **元数据同步**: 允许短暂延迟，但最终必须一致
- **过滤状态**: 允许不同组件间的状态延迟同步
- **缓存数据**: 允许与数据库有短暂不一致

#### 弱一致性场景
- **UI状态**: 界面状态可以有短暂不一致
- **日志记录**: 日志可以异步记录，允许丢失
- **统计信息**: 统计数据可以有延迟和误差

## 7. 测试契约

### 7.1 功能1.1.1: 单一结果页签管理

#### TC-001: 正常查询结果显示
**类型**: 正常用例
**优先级**: P0

**Given**:
- SQL编辑器已打开，ID为"editor-1"
- 已连接到测试数据库
- 当前无结果页签

**When**:
- 执行SQL查询"SELECT * FROM users LIMIT 10"

**Then**:
- 创建一个ID为"result"的结果页签
- 页签标题为"结果"
- 页签包含查询结果数据
- 页签自动激活显示

**验证点**:
- [ ] 页签数量为1
- [ ] 页签标题正确
- [ ] 结果数据正确显示

#### TC-002: 连续查询覆盖结果
**类型**: 正常用例
**优先级**: P0

**Given**:
- 已存在"结果"页签，包含上次查询结果
- 结果无未保存修改

**When**:
- 执行新的SQL查询"SELECT COUNT(*) FROM products"

**Then**:
- 仍然只有一个"结果"页签
- 页签内容被新查询结果覆盖
- 旧的查询结果被清除

**验证点**:
- [ ] 页签数量仍为1
- [ ] 显示新的查询结果
- [ ] 旧结果已清除

#### TC-003: 有未保存修改时查询
**类型**: 异常用例
**优先级**: P0

**Given**:
- 已存在"结果"页签，包含查询结果
- 用户修改了结果中的数据但未保存

**When**:
- 执行新的SQL查询

**Then**:
- 弹出确认对话框
- 对话框包含"提交"、"放弃"、"取消"三个选项
- 选择"取消"时不执行新查询
- 选择"提交"时先保存修改再执行查询
- 选择"放弃"时直接执行新查询

**验证点**:
- [ ] 对话框正确显示
- [ ] 三个选项功能正确
- [ ] 取消操作保持原状态

### 7.2 功能2.1.2: 自动重连机制

#### TC-004: 连接断开自动重连
**类型**: 正常用例
**优先级**: P1

**Given**:
- 数据库连接正常
- 连接因超时断开

**When**:
- 用户执行SQL查询

**Then**:
- 系统检测到连接断开
- 自动尝试重新连接
- 重连成功后执行查询
- 返回正确的查询结果

**验证点**:
- [ ] 连接状态正确检测
- [ ] 自动重连成功
- [ ] 查询正常执行

#### TC-005: 重连失败处理
**类型**: 异常用例
**优先级**: P1

**Given**:
- 数据库连接断开
- 数据库服务器不可用

**When**:
- 用户执行SQL查询

**Then**:
- 系统尝试重连
- 重连失败后显示错误信息
- 错误信息包含具体失败原因
- 不执行SQL查询

**验证点**:
- [ ] 重连尝试执行
- [ ] 错误信息准确
- [ ] 查询被正确阻止

### 7.3 功能3.1.1: 服务器选择器过滤

#### TC-006: 输入过滤服务器
**类型**: 正常用例
**优先级**: P1

**Given**:
- 已配置5个数据库连接：TestDB、ProductionDB、DevDB、StagingDB、LocalDB
- 服务器选择框已展开

**When**:
- 用户输入"test"

**Then**:
- 下拉列表只显示"TestDB"
- 其他连接被过滤掉
- 用户可以选择TestDB

**验证点**:
- [ ] 过滤结果正确
- [ ] 不区分大小写
- [ ] 选择功能正常

#### TC-007: 无匹配结果
**类型**: 边界用例
**优先级**: P2

**Given**:
- 已配置多个数据库连接
- 用户输入不存在的关键字"xyz"

**When**:
- 系统执行过滤

**Then**:
- 下拉列表显示"无匹配结果"
- 不显示任何连接选项
- 用户可以清空输入重新过滤

**验证点**:
- [ ] 无结果提示正确
- [ ] 界面友好
- [ ] 可以重新输入

### 7.4 功能4.1.1: JSON字段显示优化

#### TC-008: JSON字段正常显示
**类型**: 正常用例
**优先级**: P0

**Given**:
- 执行查询"SELECT id, profile FROM users WHERE id = 1"
- profile字段为JSON类型，值为{"name": "张三", "age": 25}

**When**:
- 查询结果显示在结果表格中

**Then**:
- JSON字段显示为可读字符串：'{"name": "张三", "age": 25}'
- 不显示"[object Object]"
- 内容完整可读

**验证点**:
- [ ] JSON正确序列化
- [ ] 中文字符正确显示
- [ ] 格式清晰可读

#### TC-009: JSON字段编辑
**类型**: 正常用例
**优先级**: P0

**Given**:
- 查询结果包含JSON字段
- JSON字段正确显示为字符串

**When**:
- 用户双击JSON字段单元格

**Then**:
- 单元格进入编辑模式
- 显示文本输入框
- 输入框包含当前JSON字符串
- 用户可以修改内容

**验证点**:
- [ ] 编辑模式正确激活
- [ ] 初始内容正确
- [ ] 编辑体验与字符串字段一致

#### TC-010: JSON格式错误处理
**类型**: 异常用例
**优先级**: P1

**Given**:
- 用户正在编辑JSON字段
- 用户输入无效JSON：'{"name": "test"'（缺少右括号）

**When**:
- 用户保存修改并提交到数据库

**Then**:
- 数据库返回JSON格式错误
- 系统显示错误信息："JSON格式无效：语法错误"
- 用户可以继续编辑或取消

**验证点**:
- [ ] 错误正确捕获
- [ ] 错误信息清晰
- [ ] 用户可以继续操作