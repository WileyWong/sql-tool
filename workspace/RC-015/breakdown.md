# RC-015 需求拆解清单

## 需求来源

- **需求文档**: `requirements/requirements_change/requirements_change_15.md`
- **变更编号**: RC-015
- **优先级**: P2-中

---

## 需求概述

优化查询结果表格的列宽展示逻辑：
1. 根据表头名称和数据内容长度动态计算列宽
2. 支持列宽状态按编辑器标签页持久化保留

---

## 功能拆解

### FR-001: 列宽动态计算

| 原子功能 | 描述 | 验收标准 | 依赖 |
|---------|------|----------|------|
| FR-001-1 | 采样数据行 | 获取第一屏可见行（约 10-20 行）用于计算 | 无 |
| FR-001-2 | 计算数据内容宽度 | 遍历采样行，计算每列数据的最大字符宽度 | FR-001-1 |
| FR-001-3 | 综合计算列宽 | 取表头宽度和数据宽度的较大值 | FR-001-2 |
| FR-001-4 | 应用宽度限制 | 最小 50px，最大 300px | FR-001-3 |
| FR-001-5 | NULL 值处理 | NULL 值按 "NULL" 4 字符计算 | FR-001-2 |

### FR-002: 列宽状态持久化

| 原子功能 | 描述 | 验收标准 | 依赖 |
|---------|------|----------|------|
| FR-002-1 | 状态存储结构 | 在 result store 中按编辑器标签页存储列宽 | 无 |
| FR-002-2 | 保存用户调整 | 用户手动拖动列宽后保存到 store | FR-002-1 |
| FR-002-3 | 恢复列宽状态 | 切换标签页时从 store 恢复列宽 | FR-002-1 |
| FR-002-4 | 重置列宽 | 重新执行 SQL 后清除已保存的列宽，重新计算 | FR-002-1 |

---

## 依赖关系图

```
FR-001-1 (采样数据行)
    ↓
FR-001-2 (计算数据内容宽度) ← FR-001-5 (NULL值处理)
    ↓
FR-001-3 (综合计算列宽)
    ↓
FR-001-4 (应用宽度限制)

FR-002-1 (状态存储结构)
    ↓
FR-002-2 (保存用户调整)
FR-002-3 (恢复列宽状态)
FR-002-4 (重置列宽)
```

---

## 非功能需求

| 编号 | 描述 | 指标 |
|------|------|------|
| NFR-001 | 列宽计算性能 | < 10ms |
| NFR-002 | 采样行数 | 可视区域高度 / 行高（约 10-20 行） |

---

## 并行开发分析

| 功能组 | 可并行 | 说明 |
|--------|--------|------|
| FR-001 | ✅ | 列宽动态计算，独立功能 |
| FR-002 | ✅ | 列宽持久化，依赖 FR-001 完成后集成 |

**建议开发顺序**: FR-001 → FR-002（有数据依赖）

---

## 影响范围

| 文件 | 修改类型 | 说明 |
|------|----------|------|
| `src/renderer/components/ResultTable.vue` | 修改 | 优化 `initColumnWidths()` |
| `src/renderer/stores/result.ts` | 修改 | 新增列宽状态存储 |

---

## 风险识别

| 风险 | 可能性 | 影响 | 缓解措施 |
|------|--------|------|----------|
| 中文字符宽度计算 | 中 | 中文比英文宽，可能计算不准 | 中文按 2 倍字符宽度计算 |

---

## 确认记录

| 日期 | 问题 | 确认结果 |
|------|------|----------|
| 2026-01-29 | 最大列宽限制 | ✅ 300px（已更新需求文档） |
