---
name: SQL-Tool 编辑器
change_id: 2025-12-19-sql-tool
created_at: 2025-12-19
updated_at: 2025-12-19
---

# 需求审查文档

## 1. 概述

| 项目 | 内容 |
|------|------|
| 需求名称 | SQL-Tool 编辑器 |
| 变更ID | 2025-12-19-sql-tool |
| 需求来源 | `requirements/ba-requirements/requirements.md`<br>`requirements/ui/ui_requirement.md` |
| 审查日期 | 2025-12-19 |
| 利益相关者 | 开发人员、DBA、数据分析师 |

---

## 2. 功能需求（FR）

### FR1: 首次打开工具
**描述**: 首次打开时，数据库连接树形展示区域提示没有数据，并提供新建连接入口

**用户故事**: 作为用户，我希望首次打开工具时能看到清晰的引导，以便快速创建第一个数据库连接

**输入/输出**:
- 输入: 无
- 输出: 显示空状态提示"未连接数据库，点击新建连接"

**验收标准**:
- [ ] AC1: 无连接时左侧树显示空状态提示
- [ ] AC2: 点击"新建连接"弹出连接弹框
- [ ] AC3: 右侧显示"无数据库连接"提示

**确认项**:
- [CLARIFIED] 空状态UI已在原型 `index_empty.html` 中体现

---

### FR2: 连接数据库
**描述**: 用户可以创建、保存数据库连接

**用户故事**: 作为用户，我希望能够配置并保存数据库连接信息，以便后续快速连接

**输入/输出**:
- 输入: 名称、服务地址（host:port格式）、用户名、密码、默认数据库（可选）
- 输出: 连接保存成功，显示在左侧树中

**业务规则**:
- BR1: 密码为必填项
- BR2: 测试连接与保存是独立操作
- BR3: 连接信息使用MAC地址 + 对称加密（AES）存储
- BR4: 服务地址格式为 host:port，端口默认3306（MySQL）

**验收标准**:
- [ ] AC1: 必填字段（名称、服务地址、用户名、密码）未填时无法保存
- [ ] AC2: 可选字段（默认数据库）可为空
- [ ] AC3: 保存成功后连接显示在左侧树
- [ ] AC4: 测试连接失败时仍可保存
- [ ] AC5: 连接信息使用AES对称加密存储在本地
- [ ] AC6: 服务地址支持 host:port 格式，端口默认3306

**确认项**:
- [CLARIFIED] 密码必填 - 已确认
- [CLARIFIED] 测试与保存独立 - 已确认
- [CLARIFIED] 服务地址格式为 host:port - 已确认
- [CLARIFIED] 端口默认值3306（MySQL） - 已确认
- [CLARIFIED] 加密算法为对称加密（AES） - 已确认

---

### FR3: SQL编辑与自动联想
**描述**: 在SQL编辑区编写SQL时，系统实时提供智能联想

**用户故事**: 作为用户，我希望编写SQL时能获得智能提示，以便提高编写效率和准确性

**输入/输出**:
- 输入: 用户键入的SQL文本
- 输出: 联想列表（关键词、表名、字段名、函数等）

**业务规则**:
- BR1: 实时自动触发联想
- BR2: Tab/Enter确认选择，Esc关闭
- BR3: 注释区域内不触发联想
- BR4: 联想列表最大显示20条
- BR5: 联想列表随用户输入实时更新过滤
- BR6: 联想列表按字符串排序

**联想场景**:
| 场景 | 联想内容 |
|------|----------|
| 空语句开始输入 | SQL关键词（select、set、show等） |
| `SELECT * FROM ` | 所有可用表、视图、函数 |
| `SELECT * FROM t1` 的 * 位置 | t1的所有字段、函数 |
| `SELECT * FROM t1 WHERE ` | t1的所有字段、函数 |
| `SELECT * FROM t1 WHERE t1.` | t1的所有字段 |
| `SELECT * FROM t1 INNER JOIN ` | 所有可用表、视图、函数 |
| `SELECT * FROM t1 INNER JOIN t2 ON ` | t1和t2的字段（不唯一时加表名前缀） |
| 子查询的 * 位置 | 子查询涉及的字段 |
| 注释区域 `/* */ --` | 无联想 |

**验收标准**:
- [ ] AC1: 输入时自动弹出联想列表
- [ ] AC2: Tab/Enter可确认选择
- [ ] AC3: Esc可关闭联想列表
- [ ] AC4: 各场景联想内容正确
- [ ] AC5: 联想列表最多显示20条
- [ ] AC6: 联想列表按字符串排序

**确认项**:
- [CLARIFIED] 实时自动触发 - 已确认
- [CLARIFIED] 联想列表最大20条 - 已确认
- [CLARIFIED] 随用户输入实时更新 - 已确认
- [CLARIFIED] 按字符串排序 - 已确认
- [ ] [P2-清晰性] "输入select不需要提示"表述模糊 - 建议明确为"SELECT关键词后、FROM之前不提示表名"

---

### FR4: 语法错误识别
**描述**: 编写SQL时自动识别语法错误并反馈

**用户故事**: 作为用户，我希望能实时看到SQL语法错误，以便及时修正

**输入/输出**:
- 输入: SQL文本
- 输出: 错误位置标记（红色波浪线）+ 悬浮提示

**业务规则**:
- BR1: 支持MySQL语法
- BR2: 实时检查语法错误

**验收标准**:
- [ ] AC1: 语法错误位置显示红色波浪线
- [ ] AC2: 鼠标悬停显示错误详情
- [ ] AC3: 错误修正后波浪线消失
- [ ] AC4: 支持MySQL语法检查

**确认项**:
- [CLARIFIED] 红色波浪线 + 悬浮提示 - 已确认
- [CLARIFIED] 支持MySQL语法 - 已确认

---

### FR5: 执行SQL语句
**描述**: 执行编辑区的SQL语句并显示结果

**用户故事**: 作为用户，我希望能执行SQL并查看结果，以便验证查询正确性

**输入/输出**:
- 输入: 选中的SQL文本或整个编辑区内容
- 输出: 查询结果（表格）或执行消息

**业务规则**:
- BR1: 无选中文本时执行整个编辑区
- BR2: 有选中文本时仅执行选中部分
- BR3: 多语句批量执行，遇错停止
- BR4: SELECT结果显示为独立标签页（结果1、结果2...）
- BR5: 非查询语句在"消息"区显示影响行数
- BR6: 执行超时时间默认10分钟（后续增加用户设置功能）
- BR7: 结果集最大行数默认5000行，用户可自行修改

**验收标准**:
- [ ] AC1: 无选中时执行全部SQL
- [ ] AC2: 有选中时仅执行选中SQL
- [ ] AC3: 多SELECT结果显示为多个标签页
- [ ] AC4: INSERT/UPDATE/DELETE在消息区显示影响行数
- [ ] AC5: 遇到错误停止执行后续语句
- [ ] AC6: 超过10分钟显示超时提示
- [ ] AC7: 结果集最大返回5000行（用户可修改）

**确认项**:
- [CLARIFIED] 批量执行，遇错停止 - 已确认
- [CLARIFIED] 多结果集标签页 - 已确认
- [CLARIFIED] 执行超时时间默认10分钟 - 已确认
- [CLARIFIED] 结果集最大行数默认5000行 - 已确认

---

### FR6: 停止执行
**描述**: 中断当前正在执行的SQL语句

**用户故事**: 作为用户，我希望能中断长时间运行的查询，以便释放资源

**输入/输出**:
- 输入: 用户点击停止按钮
- 输出: 当前查询被中断

**业务规则**:
- BR1: 发送KILL QUERY命令中断查询
- BR2: 已提交数据不回滚
- BR3: 用户自行管理事务

**验收标准**:
- [ ] AC1: 点击停止按钮中断当前查询
- [ ] AC2: 停止后显示"查询已中断"消息
- [ ] AC3: 已提交的数据保持不变

**确认项**:
- [CLARIFIED] 仅中断，不回滚 - 已确认
- [ ] [P2-清晰性] 停止按钮在无执行时的状态未定义 - 建议禁用状态

---

### FR7: 执行计划
**描述**: 显示SQL的查询执行计划

**用户故事**: 作为用户，我希望查看SQL执行计划，以便优化查询性能

**输入/输出**:
- 输入: SQL语句
- 输出: 执行计划（流程图形式 + 表格形式）

**业务规则**:
- BR1: 支持MySQL EXPLAIN格式
- BR2: "执行计划"标签页以流程图形式展示
- BR3: "结果"标签页以表格形式展示

**验收标准**:
- [ ] AC1: "执行计划"标签页以流程图形式展示
- [ ] AC2: "结果"标签页以表格形式展示执行计划
- [ ] AC3: 支持MySQL EXPLAIN输出解析

**确认项**:
- [CLARIFIED] 执行计划以流程图形式展示 - 已确认
- [CLARIFIED] 支持MySQL EXPLAIN格式 - 已确认

---

### FR8: 数据库连接树操作
**描述**: 对左侧数据库连接树进行操作

**用户故事**: 作为用户，我希望能管理连接树，以便组织和访问数据库对象

**功能列表**:
1. 重命名连接
2. 删除连接（二次确认）
3. 展开/折叠树
4. 刷新树（手动刷新整个树）
5. 右键菜单"刷新"（刷新指定节点下的内容）

**树结构**: 服务器地址 → 数据库名 → Schema（SQL Server有，MySQL无） → 表、视图、存储过程、函数

**验收标准**:
- [ ] AC1: 鼠标悬停显示重命名、删除图标
- [ ] AC2: 点击重命名可编辑，回车确认
- [ ] AC3: 删除前弹出确认对话框
- [ ] AC4: 菜单"查看"有展开/折叠全部选项
- [ ] AC5: 刷新时重新加载所有数据库结构
- [ ] AC6: 右键节点显示"刷新"菜单，刷新该节点下的数据库结构

**确认项**:
- [CLARIFIED] 手动刷新整个树 - 已确认
- [CLARIFIED] 树节点右键菜单增加"刷新"功能 - 已确认

---

### FR9: SQL文件标签页管理
**描述**: 管理多个SQL编辑标签页

**用户故事**: 作为用户，我希望能同时编辑多个SQL文件，以便提高工作效率

**业务规则**:
- BR1: 新建查询命名为"查询1"、"查询2"...
- BR2: 关闭未保存文件时提示保存
- BR3: 不限制标签页数量

**验收标准**:
- [ ] AC1: 新建查询自动命名
- [ ] AC2: 关闭未保存标签时弹出保存提示
- [ ] AC3: 可同时打开多个标签页

**确认项**:
- [CLARIFIED] 简单管理模式 - 已确认
- [ ] [P2-完整性] 保存文件的默认路径未定义 - 建议使用上次保存路径或用户目录
- [ ] [P2-完整性] 支持的文件格式未定义 - 建议 .sql 格式

---

### FR10: 结果区标签切换
**描述**: 在结果、消息、执行计划标签页间切换

**验收标准**:
- [ ] AC1: 点击"结果"显示查询结果表格
- [ ] AC2: 点击"消息"显示执行消息
- [ ] AC3: 点击"执行计划"显示执行计划

**确认项**:
- [ ] [P2-清晰性] 默认显示哪个标签页未定义 - 建议执行后默认显示"结果"

---

## 3. 业务规则（BR）

| 编号 | 规则名称 | 规则描述 | 关联FR |
|------|----------|----------|--------|
| BR1 | 密码必填 | 所有数据库连接必须输入密码 | FR2 |
| BR2 | 测试保存独立 | 测试连接和保存是独立操作 | FR2 |
| BR3 | 加密存储 | 连接信息使用MAC地址 + AES对称加密 | FR2 |
| BR4 | 地址格式 | 服务地址格式为host:port，端口默认3306 | FR2 |
| BR5 | 实时联想 | 输入时自动触发联想 | FR3 |
| BR6 | 注释无联想 | 注释区域内不触发联想 | FR3 |
| BR7 | 联想列表 | 最大20条，按字符串排序，实时更新 | FR3 |
| BR8 | MySQL语法 | 语法检查支持MySQL | FR4 |
| BR9 | 批量执行遇错停止 | 多语句执行遇错停止 | FR5 |
| BR10 | 多结果集标签页 | 每个SELECT结果独立标签页 | FR5 |
| BR11 | 执行超时 | 默认10分钟，后续增加用户设置 | FR5 |
| BR12 | 结果集最大行数 | 默认5000行，用户可修改 | FR5 |
| BR13 | 仅中断不回滚 | 停止执行不回滚已提交数据 | FR6 |
| BR14 | 执行计划 | 流程图展示，支持MySQL EXPLAIN | FR7 |
| BR15 | 手动刷新 | 刷新时重新加载所有结构 | FR8 |
| BR16 | 节点右键刷新 | 右键菜单刷新指定节点下的内容 | FR8 |
| BR17 | 简单标签管理 | 新建查询自动命名，关闭提示保存 | FR9 |

---

## 4. 数据模型（DM）

### DM1: 连接信息
| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| id | string | 是 | 连接唯一标识 |
| name | string | 是 | 连接显示名称 |
| host | string | 是 | 服务地址（host:port格式，端口默认3306） |
| username | string | 是 | 数据库用户名 |
| password | string | 是 | 数据库密码（加密） |
| defaultDatabase | string | 否 | 默认数据库 |
| createdAt | datetime | 是 | 创建时间 |
| updatedAt | datetime | 是 | 更新时间 |

**确认项**:
- [CLARIFIED] host字段格式为host:port，端口默认3306 - 已确认

---

## 5. 异常处理

| 场景 | 处理方式 |
|------|----------|
| 连接失败 | 显示错误消息，允许重试 |
| SQL执行超时（10分钟） | 显示超时提示，建议优化SQL |
| 语法错误 | 红色波浪线标记，悬浮提示详情 |
| 未保存关闭 | 弹出保存确认对话框 |
| 删除连接 | 二次确认对话框 |

---

## 6. 测试策略

| 测试类型 | 覆盖范围 |
|----------|----------|
| 单元测试 | SQL解析、加密解密、联想逻辑 |
| 集成测试 | 数据库连接、SQL执行、结果展示 |
| UI测试 | 标签页切换、树操作、编辑器交互 |
| 兼容性测试 | MySQL支持 |

---

## 7. 风险评估

### 问题统计

| 优先级 | 数量 | 说明 |
|--------|------|------|
| **P0** | 0 | 阻塞性问题（已解决） |
| **P1** | 0 | 重要问题（已解决） |
| **P2** | 7 | 优化建议（已解决3个） |

### P2 问题清单（优化建议）
| FR | 问题 | 建议 | 状态 |
|----|------|------|------|
| FR2 | MAC地址加密算法未明确 | 使用AES对称加密 | ✅ 已解决 |
| FR3 | "输入select不需要提示"表述模糊 | 明确为"SELECT关键词后、FROM之前不提示表名" | 待优化 |
| FR5 | 结果集最大行数未定义 | 默认5000行，用户可修改 | ✅ 已解决 |
| FR6 | 停止按钮无执行时状态未定义 | 建议禁用状态 | 待优化 |
| FR8 | 树节点右键菜单功能未定义 | 右键增加"刷新"功能 | ✅ 已解决 |
| FR9 | 保存文件默认路径和格式未定义 | 使用上次路径，.sql格式 | 待优化 |
| FR10 | 默认显示标签页未定义 | 执行后默认显示"结果" | 待优化 |

### 整体评估

| 维度 | 评估 |
|------|------|
| **P0 问题** | 0 ✅ |
| **P1 问题** | 0 ✅ |
| **P2 问题** | 4（已解决3个） |
| **整体风险** | 🟢 低 |
| **建议** | 可进入设计阶段，P2问题可在后续迭代中优化 |

---

## 8. 审查结论

### 需求质量评估

| 维度 | 评分 | 说明 |
|------|------|------|
| 一致性 | ⭐⭐⭐⭐⭐ | 术语使用一致 |
| 完整性 | ⭐⭐⭐⭐ | 核心需求完整 |
| 清晰性 | ⭐⭐⭐⭐⭐ | 描述清晰明确 |
| 准确性 | ⭐⭐⭐⭐⭐ | 业务逻辑准确 |
| 无重复性 | ⭐⭐⭐⭐⭐ | 无重复 |
| 可验证性 | ⭐⭐⭐⭐ | 验收标准明确 |

### 后续行动

1. **已解决（P0/P1）**: ✅ 全部解决
   - [x] 执行计划图表展示形式 → 流程图
   - [x] 服务地址格式 → host:port
   - [x] 端口默认值 → 3306
   - [x] 联想列表数量 → 最大20条
   - [x] 联想列表排序 → 按字符串排序
   - [x] 支持的SQL方言 → MySQL
   - [x] 执行超时时间 → 默认10分钟
   - [x] 执行计划数据库支持 → MySQL

2. **已解决的P2问题**:
   - [x] 加密算法 → AES对称加密
   - [x] 结果集最大行数 → 默认5000行，用户可修改
   - [x] 树节点右键菜单 → 增加"刷新"功能

3. **剩余P2问题（可选优化）**:
   - [ ] "输入select不需要提示"表述优化
   - [ ] 停止按钮无执行时状态
   - [ ] 保存文件默认路径和格式
   - [ ] 默认显示标签页

---

**审查完成**: 2025-12-19  
**审查人**: AI Assistant  
**状态**: ✅ 可进入设计阶段
