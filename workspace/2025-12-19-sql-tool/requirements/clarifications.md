# SQL-Tool 需求澄清文档

## 执行策略

**推进方式**: 一次性全部确认  
**澄清日期**: 2025-12-19  
**确认日期**: 2025-12-19  
**输入来源**: 
- `requirements/ui/ui_requirement.md`
- `requirements/ba-requirements/requirements.md`
- `requirements/ui/output/index.html` (原型)
- `requirements/ui/output/index_empty.html` (空状态原型)

---

## [CLARIFIED] 业务规则: 新建连接时密码是否为必填项

**当前描述**: 新建连接弹框要求有：名称、服务地址、用户名、密码、默认数据库名（可选）。必填项后面加上红色的*标记

**关联功能**: 连接数据库

**最终决议**: **方案A - 密码必填**
- 所有连接必须输入密码
- 数据库工具涉及敏感数据，强制密码可提升安全意识

---

## [CLARIFIED] 业务规则: 测试连接失败时的处理

**当前描述**: 新建连接弹框功能有：测试连接，保存、取消

**关联功能**: 连接数据库

**最终决议**: **方案B - 允许直接保存，无需测试**
- 测试连接和保存是独立操作
- 用户可能需要预先配置多个连接，数据库不一定随时在线

---

## [CLARIFIED] 业务规则: 多SQL语句执行策略

**当前描述**: 
- 如果没有选择的sql文本，直接点执行，执行整个编辑区域中的sql
- 如果有选择的sql文本，执行选择的sql文本

**关联功能**: 执行sql语句

**最终决议**: **方案A - 批量执行，遇错停止**
- 所有语句一次性发送执行，遇到第一个错误即停止
- 这是大多数SQL工具的默认行为，符合用户预期

---

## [CLARIFIED] 业务规则: 执行结果的显示方式

**当前描述**: 
- 执行结果区有"结果"、"消息"、"执行计划"三个标签页
- 执行计划以图表形式展示，结果里以表格形式展示

**关联功能**: 执行sql语句、执行计划按钮

**最终决议**: **方案A - 多结果集标签页**
- 每个SELECT结果显示为独立标签页（结果1、结果2...）
- 非查询语句在"消息"区显示影响行数
- 专业SQL工具的通用做法，用户体验更好

---

## [CLARIFIED] 业务规则: SQL自动联想的触发时机

**当前描述**: 编写时自动联想，详细列出了各种场景下的联想内容

**关联功能**: 在sql编辑区编写sql

**最终决议**: **方案A - 实时自动触发**
- 输入时自动弹出联想列表
- Tab/Enter确认选择，Esc关闭
- 现代IDE的标准体验，用户已习惯

---

## [CLARIFIED] 业务规则: 语法错误识别的反馈方式

**当前描述**: 编写时自动识别语法错误

**关联功能**: 在sql编辑区编写sql

**最终决议**: **方案A - 红色波浪线 + 悬浮提示**
- 错误位置显示红色波浪线
- 鼠标悬停显示错误详情
- 与VS Code等主流编辑器体验一致

---

## [CLARIFIED] 业务规则: 停止执行的行为

**当前描述**: 中止当前执行的sql语句

**关联功能**: 停止执行

**最终决议**: **方案A - 仅中断，不回滚**
- 发送KILL QUERY命令中断当前查询
- 已提交的数据不回滚
- 符合MySQL KILL QUERY的默认行为，用户应自行管理事务

---

## [CLARIFIED] 数据模型: 连接信息的存储内容

**当前描述**: 保存后，将连接保存在本地（使用本机mac地址加密，防止泄漏）

**关联功能**: 连接数据库

**最终决议**: **方案A - 基础字段**
- 仅存储：名称、服务地址（含端口）、用户名、密码、默认数据库
- MVP阶段先实现核心功能，后续可扩展

---

## [CLARIFIED] 业务规则: 数据库树的刷新机制

**当前描述**: 菜单"查看"里有"刷新"选项

**关联功能**: 左侧数据库连接树形展示操作

**最终决议**: **方案A - 手动刷新整个树**
- 点击刷新时重新加载所有连接的数据库结构
- MVP阶段先实现基础功能

---

## [CLARIFIED] 业务规则: SQL文件标签页管理

**当前描述**: 原型中显示有sql1.txt、sql2.txt等多个标签页

**关联功能**: 新建查询、打开文件、保存

**最终决议**: **方案A - 简单管理**
- 新建查询命名为"查询1"、"查询2"...
- 关闭未保存文件时提示保存
- 不限制标签页数量
- MVP阶段先实现核心功能

---

## 澄清摘要

| 编号 | 类别 | 标题 | 状态 | 最终决议 |
|------|------|------|------|----------|
| 1 | 业务规则 | 新建连接时密码是否为必填项 | ✅ 已确认 | 方案A: 密码必填 |
| 2 | 业务规则 | 测试连接失败时的处理 | ✅ 已确认 | 方案B: 允许直接保存 |
| 3 | 业务规则 | 多SQL语句执行策略 | ✅ 已确认 | 方案A: 批量执行，遇错停止 |
| 4 | 业务规则 | 执行结果的显示方式 | ✅ 已确认 | 方案A: 多结果集标签页 |
| 5 | 业务规则 | SQL自动联想的触发时机 | ✅ 已确认 | 方案A: 实时自动触发 |
| 6 | 业务规则 | 语法错误识别的反馈方式 | ✅ 已确认 | 方案A: 红色波浪线+悬浮提示 |
| 7 | 业务规则 | 停止执行的行为 | ✅ 已确认 | 方案A: 仅中断，不回滚 |
| 8 | 数据模型 | 连接信息的存储内容 | ✅ 已确认 | 方案A: 基础字段 |
| 9 | 业务规则 | 数据库树的刷新机制 | ✅ 已确认 | 方案A: 手动刷新整个树 |
| 10 | 业务规则 | SQL文件标签页管理 | ✅ 已确认 | 方案A: 简单管理 |

**统计**:
- 待澄清: 0
- 已澄清: 10
- 不需澄清: 0

---

## 决议汇总

### 连接管理
1. **密码必填** - 所有数据库连接必须输入密码
2. **测试与保存独立** - 允许直接保存连接，无需先测试成功
3. **基础字段存储** - 仅存储名称、服务地址、用户名、密码、默认数据库

### SQL执行
4. **批量执行，遇错停止** - 多条SQL语句一次性执行，遇到第一个错误即停止
5. **多结果集标签页** - 每个SELECT结果显示为独立标签页
6. **仅中断，不回滚** - 停止执行时只中断查询，不回滚已提交数据

### 编辑器体验
7. **实时自动联想** - 输入时自动弹出联想列表，Tab/Enter确认
8. **红色波浪线+悬浮提示** - 语法错误以红色波浪线标识，悬停显示详情

### 界面交互
9. **手动刷新整个树** - 点击刷新时重新加载所有数据库结构
10. **简单标签页管理** - 新建查询命名为"查询1"、"查询2"...，关闭时提示保存

---

**后续行动**:
1. ✅ 所有澄清问题已确认
2. 根据决议更新需求文档 `requirements/ba-requirements/requirements.md`
3. 如有需要，更新原型设计以体现决议内容
